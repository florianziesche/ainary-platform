<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kampagnen-Intelligence</title>
<meta name="robots" content="noindex, nofollow">
<meta property="og:title" content="Kampagnen-Intelligence">
<meta property="og:description" content="Datenbasierte Wahlkampf-Analyse. Dossiers, Stimmung, Szenarien.">
<meta property="og:type" content="website">
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>◆</text></svg>">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<script src="https://d3js.org/d3.v7.min.js"></script>
<style>
:root{
--bg:#fafafa;--surface:#fff;--surface2:#f5f5f3;
--border:#d0d0d0;--border-hover:#bbb;--border2:#e8e8e8;
--text:#1a1a1a;--text2:#444;--muted:#777;--light:#bbb;
--gold:#9d7f3b;--gold-hover:#b8972e;
--red:#c0392b;--amber:#b45309;--green:#2d8a4e;--blue:#2563eb;--purple:#7c3aed;
--red-bg:rgba(192,57,43,0.08);--amber-bg:rgba(180,83,9,0.08);--green-bg:rgba(45,138,78,0.08);--blue-bg:rgba(37,99,235,0.08);--purple-bg:rgba(124,58,237,0.08);--gold-bg:rgba(157,127,59,0.08);
--accent:var(--gold);--yellow:var(--amber);--orange:var(--amber);--cyan:var(--blue);
--f:'Inter',-apple-system,sans-serif;--m:'JetBrains Mono',monospace
}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:var(--f);color:var(--text);background:var(--bg);-webkit-font-smoothing:antialiased;height:100vh;overflow:hidden;display:flex;flex-direction:column}
::selection{background:var(--accent);color:var(--bg)}
::-webkit-scrollbar{width:4px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:var(--border2);border-radius:2px}
.topbar{height:36px;background:var(--surface);border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;padding:0 16px;flex-shrink:0}
.topbar-left{display:flex;align-items:center;gap:10px}
.topbar-logo{font-family:var(--m);font-size:8pt;font-weight:700;letter-spacing:.15em;color:var(--accent)}
.topbar-sep{color:var(--border2)}
.topbar-env{font-family:var(--m);font-size:6pt;color:var(--muted);letter-spacing:.1em}
.topbar-right{display:flex;align-items:center;gap:14px;font-family:var(--m);font-size:6.5pt;color:var(--muted)}
.topbar-live{display:flex;align-items:center;gap:4px;color:var(--green)}
.live-pulse{width:5px;height:5px;border-radius:50%;background:var(--green);animation:pulse 2s ease infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.3}}
.topbar-class{color:var(--red);font-weight:600;letter-spacing:.1em}
.topbar-chat{background:var(--accent);color:#fff;border:none;padding:4px 10px;border-radius:3px;font-family:var(--m);font-size:6.5pt;font-weight:600;cursor:pointer;display:flex;align-items:center;gap:4px}
.topbar-chat:hover{background:#b8972e}
.search-wrap{position:relative;flex:1;max-width:360px;margin:0 16px}
.search-input{width:100%;font:400 8pt var(--m);padding:5px 10px 5px 24px;border:1px solid var(--border);border-radius:4px;background:var(--surface2);color:var(--text);outline:none}
.search-input:focus{border-color:var(--accent);background:var(--surface)}
.search-input::placeholder{color:var(--muted)}
.search-icon{position:absolute;left:8px;top:50%;transform:translateY(-50%);font-size:8pt;color:var(--muted);pointer-events:none}
.search-results{position:absolute;top:100%;left:0;right:0;background:var(--surface);border:1px solid var(--border);border-radius:0 0 6px 6px;max-height:340px;overflow-y:auto;z-index:300;display:none;box-shadow:0 8px 24px rgba(0,0,0,0.12)}
.search-results.open{display:block}
.sr-item{padding:8px 12px;cursor:pointer;display:flex;align-items:center;gap:8px;border-bottom:1px solid rgba(0,0,0,0.03)}
.sr-item:hover{background:var(--surface2)}
.sr-item-dot{width:6px;height:6px;border-radius:50%;flex-shrink:0}
.sr-item-title{font-size:8pt;font-weight:500;color:var(--text)}
.sr-item-sub{font:400 6.5pt var(--m);color:var(--muted)}
.main{flex:1;display:grid;grid-template-columns:220px 1fr 300px;grid-template-rows:1fr;overflow:hidden}
.panel{background:var(--surface);border-right:1px solid var(--border);overflow-y:auto}
.panel-header{font-family:var(--m);font-size:6pt;font-weight:600;text-transform:uppercase;letter-spacing:.15em;color:var(--muted);padding:12px 14px 8px;border-bottom:1px solid var(--border);position:sticky;top:0;background:var(--surface);z-index:2}
.ont-group{border-bottom:1px solid var(--border)}
.ont-group-title{font-family:var(--m);font-size:5.5pt;font-weight:600;text-transform:uppercase;letter-spacing:.12em;color:var(--muted);padding:8px 14px 4px;display:flex;align-items:center;gap:6px}
.ont-count{font-family:var(--m);font-size:5pt;color:var(--border2);background:var(--surface2);padding:1px 5px;border-radius:2px}
.ont-item{display:flex;align-items:center;gap:8px;padding:5px 14px;cursor:pointer;transition:background .08s;font-size:7.5pt;color:var(--text2)}
.ont-item:hover{background:var(--surface2)}
.ont-item.active{background:rgba(196,162,77,0.06);color:var(--accent)}
.ont-dot{width:6px;height:6px;border-radius:50%;flex-shrink:0}
.ont-label{flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.ont-badge{font-family:var(--m);font-size:5pt;padding:1px 4px;border-radius:2px;flex-shrink:0}
.canvas-wrap{display:flex;flex-direction:column;overflow:hidden}
.tab-bar{display:flex;gap:0;background:var(--surface);border-bottom:1px solid var(--border);flex-shrink:0;overflow-x:auto}
.tab{font-family:var(--m);font-size:6.5pt;font-weight:500;padding:10px 14px;cursor:pointer;color:var(--muted);border-bottom:2px solid transparent;transition:all .12s;text-transform:uppercase;letter-spacing:.08em;white-space:nowrap;flex-shrink:0}
.tab:hover{color:var(--text)}
.tab.active{color:var(--accent);border-bottom-color:var(--accent)}
.canvas{flex:1;overflow-y:auto;padding:20px 24px}
.canvas-title{font-family:var(--m);font-size:7pt;font-weight:600;text-transform:uppercase;letter-spacing:.12em;color:var(--muted);margin-bottom:16px;display:flex;align-items:center;gap:8px}
.canvas-title .ct-badge{font-size:5pt;padding:2px 6px;border-radius:2px;color:var(--bg);font-weight:700}
.entity-card{background:var(--surface);border:1px solid var(--border);border-radius:4px;margin-bottom:16px;overflow:hidden}
.entity-header{padding:14px 16px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between}
.entity-name{font-size:11pt;font-weight:600}
.entity-meta{font-family:var(--m);font-size:6pt;color:var(--muted);display:flex;gap:10px}
.entity-body{padding:14px 16px}
.prop-grid{display:grid;grid-template-columns:120px 1fr;gap:0;font-size:7.5pt}
.prop-key{font-family:var(--m);font-size:6pt;color:var(--muted);text-transform:uppercase;letter-spacing:.06em;padding:4px 0;border-bottom:1px solid var(--border)}
.prop-val{padding:4px 0;border-bottom:1px solid var(--border);color:var(--text2)}
.prop-val strong{color:var(--text)}
.conn-row{display:flex;align-items:center;gap:8px;padding:6px 0;border-bottom:1px solid var(--border);font-size:7pt}
.conn-row:last-child{border-bottom:none}
.conn-type{font-family:var(--m);font-size:5pt;padding:2px 6px;border-radius:2px;width:52px;text-align:center;flex-shrink:0;font-weight:600}
.conn-target{flex:1;color:var(--text2)}
.vtl{position:relative;padding-left:24px}
.vtl::before{content:'';position:absolute;left:7px;top:0;bottom:0;width:2px;background:var(--border)}
.vtl-item{position:relative;padding:8px 12px;margin-bottom:2px;cursor:pointer;border-radius:4px;transition:background .15s}
.vtl-item:hover{background:var(--surface2)}
.vtl-dot{position:absolute;left:-20px;top:12px;width:10px;height:10px;border-radius:50%;border:2px solid var(--surface)}
.vtl-year{font:600 7pt var(--m);color:var(--text2);margin-bottom:2px}
.vtl-label{font:400 8pt var(--f);color:var(--text);line-height:1.4}
#graph-view{display:none;width:100%;height:100%;position:relative}
#graph-view svg{width:100%;height:100%}
#graph-view .tooltip{position:absolute;background:var(--surface);border:1px solid var(--border);border-radius:4px;padding:10px 14px;font-size:7pt;max-width:280px;pointer-events:none;opacity:0;transition:opacity 0.15s;z-index:10}
#graph-view .tooltip h4{font-size:8pt;margin-bottom:3px}
.link{stroke-opacity:0.5;fill:none}
.link-label{font-family:var(--m);font-size:4.5pt;fill:var(--muted);pointer-events:none}
.node-circle{cursor:pointer;transition:r 0.15s}
.node-circle:hover{filter:brightness(1.2)}
.node-label{font-family:var(--f);font-weight:600;pointer-events:none;text-anchor:middle}
.node-sublabel{font-family:var(--m);pointer-events:none;text-anchor:middle;fill:var(--muted)}
#matrix-view{display:none;overflow:auto;padding:20px 24px}
.matrix-table{width:100%;border-collapse:collapse;font-size:7pt}
.matrix-table th,.matrix-table td{padding:8px 10px;border-bottom:1px solid var(--border);text-align:left}
.matrix-table th{font-family:var(--m);font-size:5.5pt;color:var(--muted);text-transform:uppercase;letter-spacing:.06em;background:var(--surface);position:sticky;top:0;z-index:2}
.matrix-table td{color:var(--text2)}
.matrix-col-head{text-align:center!important;min-width:140px}
.matrix-col-head .name{font-family:var(--f);font-size:8pt;font-weight:600;text-transform:none;letter-spacing:0}
.matrix-col-head .role{font-family:var(--m);font-size:5pt;color:var(--border2);text-transform:none;margin-top:2px}
.cell-score{font-family:var(--m);font-size:12pt;font-weight:700}
.cell-bar{height:5px;border-radius:2px;margin-top:3px}
.cell-badge{display:inline-block;font-family:var(--m);font-size:4.5pt;padding:1px 5px;border-radius:2px;font-weight:600}
.badge-red{background:rgba(192,57,43,0.15);color:var(--red)}
.badge-green{background:rgba(45,138,78,0.15);color:var(--green)}
.badge-yellow{background:rgba(180,83,9,0.15);color:var(--amber)}
/* E/I/J/A Evidence Tags — USP */
.ev{display:inline-block;font-family:var(--m);font-size:5.5pt;font-weight:600;width:13px;height:13px;line-height:13px;text-align:center;border-radius:2px;margin-right:2px;vertical-align:middle}
.ev-e{background:var(--green);color:#fff}
.ev-i{background:var(--blue);color:#fff}
.ev-j{background:var(--gold);color:#fff}
.ev-a{background:var(--red);color:#fff}
.ev-legend{display:flex;gap:10px;flex-wrap:wrap;font:400 6pt var(--m);color:var(--muted);padding:6px 0;border-bottom:1px solid var(--border2);margin-bottom:12px}
.ev-legend span{display:flex;align-items:center;gap:3px}
.hypo-card{background:var(--surface);border:1px solid var(--border);border-radius:6px;padding:14px;margin-bottom:10px}
.hypo-card-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:8px}
.hypo-card-title{font:600 9pt var(--f);color:var(--text)}
.hypo-card-status{font:500 6pt var(--m);padding:3px 6px;border-radius:3px}
.hypo-body{font:400 8pt var(--f);color:var(--text2);line-height:1.5;margin-bottom:10px}
.hypo-ev-row{display:flex;align-items:flex-start;gap:8px;padding:4px 0;font-size:7.5pt;color:var(--text2)}
.hypo-ev-icon{font:500 7pt var(--m);flex-shrink:0;width:16px;text-align:center}
.hypo-ev-for{color:var(--green)}
.hypo-ev-against{color:var(--red)}
.hypo-conf-bar{height:6px;background:var(--surface2);border-radius:3px;margin:8px 0;overflow:hidden}
.hypo-conf-fill{height:100%;border-radius:3px;transition:width .5s}
.hypo-conf-label{display:flex;justify-content:space-between;font:400 6pt var(--m);color:var(--muted)}
.nf-card{background:var(--surface);border:1px solid var(--border);border-radius:6px;padding:14px;margin-bottom:8px;transition:border-color .15s}
.nf-card:hover{border-color:var(--accent)}
.nf-card-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:6px}
.nf-card-title{font:600 9pt var(--f);color:var(--text);line-height:1.4;flex:1}
.nf-card-source{font:400 6pt var(--m);color:var(--muted);flex-shrink:0;margin-left:8px}
.nf-card-body{font:400 7.5pt var(--f);color:var(--text2);line-height:1.5;margin-bottom:8px}
.nf-card-footer{display:flex;gap:6px;flex-wrap:wrap;align-items:center}
.nf-entity-tag{font:500 5.5pt var(--m);padding:2px 6px;border-radius:3px;cursor:pointer}
.nf-sentiment{font:500 5.5pt var(--m);padding:2px 6px;border-radius:3px}
.nf-filter-bar{display:flex;gap:6px;margin-bottom:14px;flex-wrap:wrap;align-items:center}
.nf-filter{font:500 6.5pt var(--m);padding:5px 10px;border:1px solid var(--border);border-radius:4px;cursor:pointer;background:var(--surface);color:var(--muted)}
.nf-filter.active{border-color:var(--accent);color:var(--accent);background:rgba(157,127,59,0.04)}
.sent-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:16px}
.sent-card{background:var(--surface);border:1px solid var(--border);border-radius:6px;padding:14px;cursor:pointer;transition:border-color .15s}
.sent-card:hover{border-color:var(--accent)}
.sent-card-title{font:500 6pt var(--m);color:var(--muted);text-transform:uppercase;letter-spacing:.08em;margin-bottom:8px}
.sent-value{font:700 16pt var(--m);color:var(--text)}
.sent-delta{font:500 7pt var(--m);margin-left:6px}
.sent-bar-wrap{height:8px;background:var(--surface2);border-radius:4px;overflow:hidden;margin:6px 0}
.sent-bar{height:100%;border-radius:4px;transition:width .8s ease}
.sent-topic{display:flex;align-items:center;gap:8px;padding:6px 0;border-bottom:1px solid rgba(0,0,0,0.03)}
.sent-topic-name{font:500 8pt var(--f);color:var(--text);flex:1}
.sent-topic-bar{width:120px;height:6px;background:var(--surface2);border-radius:3px;overflow:hidden;flex-shrink:0}
.sent-topic-fill{height:100%;border-radius:3px}
.sent-topic-pct{font:500 7pt var(--m);width:36px;text-align:right;flex-shrink:0}
.act-card{background:var(--surface);border-left:3px solid var(--accent);border-radius:0 6px 6px 0;padding:14px 16px;margin-bottom:10px;border-top:1px solid var(--border);border-right:1px solid var(--border);border-bottom:1px solid var(--border)}
.act-card-priority{font:600 5.5pt var(--m);text-transform:uppercase;letter-spacing:.08em;margin-bottom:4px}
.act-card-title{font:600 10pt var(--f);color:var(--text);margin-bottom:6px}
.act-card-body{font:400 8pt var(--f);color:var(--text2);line-height:1.5;margin-bottom:10px}
.act-card-metrics{display:flex;gap:12px;flex-wrap:wrap}
.act-metric{text-align:center}
.act-metric-val{font:700 12pt var(--m);color:var(--text)}
.act-metric-label{font:400 5.5pt var(--m);color:var(--muted);text-transform:uppercase}
.insight-card{background:var(--surface);border:1px solid var(--border);border-radius:4px;padding:16px;margin-bottom:12px}
.insight-card:hover{border-color:var(--accent)}
.insight-card-head{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
.insight-card-title{font-size:9pt;font-weight:600}
.insight-conf{font-family:var(--m);font-size:6pt;padding:3px 8px;border-radius:10px;font-weight:600}
.insight-body{font-size:7.5pt;color:var(--text2);line-height:1.6;margin-bottom:8px}
.alerts-grid{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:20px}
.alert-card{background:var(--surface);border:1px solid var(--border);border-radius:4px;padding:14px}
.alert-card-title{font-family:var(--m);font-size:6pt;color:var(--muted);text-transform:uppercase;letter-spacing:.08em;margin-bottom:10px}
.risk-row{display:flex;gap:8px;margin-bottom:8px;align-items:center;cursor:pointer;padding:4px;border-radius:4px;transition:background .15s}
.risk-row:hover{background:var(--surface2)}
.risk-name{font-size:7.5pt;font-weight:500;width:100px;flex-shrink:0}
.risk-bar-bg{flex:1;height:6px;background:var(--border);border-radius:3px;overflow:hidden}
.risk-bar{height:100%;border-radius:3px;transition:width .8s ease}
.risk-val{font-family:var(--m);font-size:7pt;width:30px;text-align:right;flex-shrink:0;font-weight:600}
.briefing-hero{background:linear-gradient(135deg,var(--surface) 0%,rgba(196,162,77,0.06) 100%);border:1px solid var(--accent);border-radius:4px;padding:20px 24px;margin-bottom:20px}
.briefing-greeting{font-size:14pt;font-weight:300;color:var(--text);margin-bottom:4px}
.briefing-greeting strong{color:var(--accent);font-weight:600}
.briefing-subtitle{font-family:var(--m);font-size:7pt;color:var(--muted)}
.briefing-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:20px}
.briefing-card{background:var(--surface);border:1px solid var(--border);border-radius:4px;padding:16px;cursor:pointer;transition:all .15s}
.briefing-card:hover{border-color:var(--accent);transform:translateY(-1px)}
.briefing-card-title{font-size:9pt;font-weight:600;margin-bottom:4px}
.briefing-card-body{font-size:7pt;color:var(--text2);line-height:1.5}
.briefing-card-tag{font-family:var(--m);font-size:5pt;display:inline-block;padding:2px 6px;border-radius:2px;margin-top:8px;font-weight:600}
.pattern{background:var(--surface2);border:1px solid var(--border);border-radius:4px;margin:10px 14px;padding:12px}
.pattern-title{font-family:var(--m);font-size:5.5pt;font-weight:600;text-transform:uppercase;letter-spacing:.08em;color:var(--text2);margin-bottom:6px}
.pattern-body{font-size:7pt;color:var(--text2);line-height:1.5}
.pattern-conf{font-family:var(--m);font-size:5pt;color:var(--muted);margin-top:6px}
.pattern-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
.pattern-card{background:var(--surface);border:1px solid var(--border);border-radius:4px;padding:14px}
.pattern-card-title{font-size:8pt;font-weight:600;margin-bottom:5px}
.pattern-card-body{font-size:6.5pt;color:var(--text2);line-height:1.5}
.pattern-card-conf{font-family:var(--m);font-size:5pt;color:var(--muted);margin-top:6px}
.feed-item{padding:10px 14px;border-bottom:1px solid var(--border);cursor:pointer;transition:background .08s}
.feed-item:hover{background:var(--surface2)}
.feed-source{font-family:var(--m);font-size:5pt;color:var(--muted);margin-bottom:3px}
.feed-title{font-size:7.5pt;font-weight:500;margin-bottom:2px;color:var(--text)}
.feed-body{font-size:6.5pt;color:var(--text2);line-height:1.5}
.feed-alert .feed-title{color:var(--red)}
.chat-overlay{position:fixed;top:0;right:0;bottom:0;width:380px;background:var(--surface);border-left:1px solid var(--border);z-index:100;transform:translateX(100%);transition:transform .25s ease;display:flex;flex-direction:column}
.chat-overlay.open{transform:translateX(0)}
.chat-header{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;border-bottom:1px solid var(--border);flex-shrink:0}
.chat-header-title{font-family:var(--m);font-size:7pt;font-weight:600;color:var(--accent);display:flex;align-items:center;gap:6px}
.chat-close{background:none;border:none;color:var(--muted);font-size:14pt;cursor:pointer}
.chat-close:hover{color:var(--text)}
.chat-messages{flex:1;overflow-y:auto;padding:14px}
.chat-msg{margin-bottom:14px}
.chat-msg-header{display:flex;align-items:center;gap:5px;margin-bottom:3px}
.chat-avatar{width:18px;height:18px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-family:var(--m);font-size:5.5pt;font-weight:600;color:var(--bg)}
.chat-avatar.mia{background:var(--accent)}
.chat-avatar.user{background:var(--border2)}
.chat-name{font-family:var(--m);font-size:6pt;color:var(--muted)}
.chat-body{font-size:7.5pt;color:var(--text2);line-height:1.55;padding-left:23px}
.chat-body strong{color:var(--text)}
.chat-chips{display:flex;flex-wrap:wrap;gap:5px;padding:0 14px 10px;flex-shrink:0}
.chat-chip{font-family:var(--m);font-size:5.5pt;color:var(--muted);padding:4px 8px;border:1px solid var(--border);border-radius:10px;cursor:pointer}
.chat-chip:hover{color:var(--accent);border-color:var(--accent)}
.chat-input-area{display:flex;gap:6px;padding:10px 14px;border-top:1px solid var(--border);flex-shrink:0}
.chat-input{flex:1;font:400 7.5pt var(--f);background:var(--surface2);border:1px solid var(--border);border-radius:4px;padding:8px 10px;color:var(--text);outline:none}
.chat-input:focus{border-color:var(--accent)}
.chat-send{background:var(--accent);color:var(--bg);border:none;border-radius:4px;padding:8px 14px;font:600 6pt var(--m);cursor:pointer}
.statusbar{height:24px;background:var(--surface);border-top:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;padding:0 16px;font-family:var(--m);font-size:5.5pt;color:var(--muted);flex-shrink:0}
.clickable{cursor:pointer;transition:all .15s}
.clickable:hover{border-color:var(--gold) !important}
.entity-link{color:var(--accent);cursor:pointer;text-decoration:none;border-bottom:1px dotted var(--accent)}
.entity-link:hover{color:#b8972e;border-bottom-style:solid}
.detail-overlay{display:none;position:fixed;inset:0;background:rgba(8,8,12,0.85);backdrop-filter:blur(8px);z-index:500;justify-content:center;align-items:center}
.detail-overlay.open{display:flex}
.detail-card{background:var(--surface);border:1px solid var(--border);border-radius:8px;max-width:600px;width:90%;max-height:80vh;overflow-y:auto;padding:24px}
.detail-close{position:absolute;top:16px;right:16px;font:400 8pt var(--m);color:var(--muted);cursor:pointer;padding:4px 8px;border:1px solid var(--border);border-radius:4px}
.detail-close:hover{color:var(--text)}
.detail-title{font:700 10pt var(--m);margin-bottom:8px}
.detail-body{font-size:7.5pt;color:var(--text2);line-height:1.6;margin-bottom:12px}
.detail-source{font:400 5.5pt var(--m);color:var(--muted);padding-top:8px;border-top:1px solid var(--border)}
@media(max-width:1000px){
.main{grid-template-columns:1fr;padding-bottom:28px}
.panel,.panel-r{display:none}
.topbar{padding:0 12px}
.topbar-tabs{gap:4px;overflow-x:auto;-webkit-overflow-scrolling:touch}
.topbar-tabs button{font-size:6pt;padding:4px 8px;white-space:nowrap}
.content{padding:14px}
.kpi-row{grid-template-columns:repeat(2,1fr)}
}
/* Timeline Slider */
.tl-wrap{margin:12px 0;background:var(--surface);border:1px solid var(--border);border-radius:6px;padding:12px 16px}
.tl-title{font:500 6pt var(--m);color:var(--muted);text-transform:uppercase;letter-spacing:.1em;margin-bottom:8px}
.tl-track{position:relative;height:40px;margin:0 4px}
.tl-line{position:absolute;top:18px;left:0;right:0;height:2px;background:var(--border)}
.tl-events{position:absolute;inset:0;display:flex;align-items:center}
.tl-ev{position:absolute;display:flex;flex-direction:column;align-items:center;cursor:pointer;transition:transform .15s}
.tl-ev:hover{transform:scale(1.2)}
.tl-dot{width:10px;height:10px;border-radius:50%;border:2px solid var(--surface);z-index:1}
.tl-year{font:500 5.5pt var(--m);color:var(--text2);position:absolute;top:-12px}
.tl-label{font:400 5pt var(--m);color:var(--muted);white-space:nowrap;margin-top:2px;max-width:60px;overflow:hidden;text-overflow:ellipsis}
.tl-range{display:flex;justify-content:space-between;font:400 6pt var(--m);color:var(--muted);margin-top:4px}
.tl-detail{margin-top:8px;padding:8px 10px;background:var(--surface2);border-radius:4px;font:400 7.5pt var(--f);color:var(--text2);line-height:1.5;display:none}
.tl-detail.open{display:block}
/* Related Pills */
.related-wrap{display:flex;gap:4px;flex-wrap:wrap;margin-top:8px}
.related-pill{font:400 6pt var(--m);padding:3px 8px;border-radius:12px;cursor:pointer;border:1px solid var(--border);color:var(--text2);transition:all .15s;text-decoration:none}
.related-pill:hover{border-color:var(--accent);color:var(--accent);background:rgba(157,127,59,0.04)}
/* Action Card enhanced */
.act-card-evidence{font:400 6.5pt var(--f);color:var(--text2);line-height:1.5;margin:8px 0;padding:8px;background:var(--surface2);border-radius:3px}
.act-card-actions{display:flex;gap:6px;margin-top:8px;padding-top:8px;border-top:1px solid var(--border)}
.act-btn{font:500 6pt var(--m);padding:4px 10px;border-radius:3px;cursor:pointer;border:1px solid var(--border);background:var(--surface);color:var(--text2);transition:all .15s}
.act-btn:hover{border-color:var(--accent);color:var(--accent)}
.act-btn.active{background:var(--accent);color:#fff;border-color:var(--accent)}
/* Insight enhanced */
.insight-evidence{display:flex;gap:6px;flex-wrap:wrap;margin:6px 0}
.insight-invalidate{font:400 6pt var(--f);color:var(--muted);padding:6px 8px;background:rgba(192,57,43,0.04);border-radius:3px;margin-top:6px;border-left:2px solid var(--red)}
.insight-so-what{font:500 6.5pt var(--f);color:var(--accent);padding:6px 8px;background:rgba(157,127,59,0.04);border-radius:3px;margin-top:4px;border-left:2px solid var(--accent)}
/* News Feed proper */
.nf-card{background:var(--surface);border:1px solid var(--border);border-radius:6px;padding:10px 14px;margin-bottom:8px;transition:border-color .15s}
.nf-card:hover{border-color:var(--accent)}
.nf-meta{display:flex;gap:8px;align-items:center;margin-top:6px;font:400 5.5pt var(--m);color:var(--muted)}
.nf-sentiment{font-weight:600;padding:1px 5px;border-radius:2px}
.nf-impact{font-weight:500}
/* Datenbasis box */
.data-basis{background:var(--surface);border:1px solid var(--border);border-radius:6px;padding:12px;margin-top:16px}
.data-basis-title{font:500 6pt var(--m);color:var(--muted);text-transform:uppercase;letter-spacing:.08em;margin-bottom:6px}
.data-basis-body{font:400 7pt var(--f);color:var(--text2);line-height:1.5}
</style>
</head>
<body>

<!-- AUTH GATE -->
<div id="auth-gate" style="position:fixed;inset:0;background:var(--bg);z-index:10000;display:flex;align-items:center;justify-content:center">
<div style="text-align:center;max-width:340px">
<a href="https://ainaryventures.com" target="_blank" style="font:400 6pt var(--m);letter-spacing:.12em;color:var(--muted);text-decoration:none;margin-bottom:4px">AINARY</a>
<div style="font:400 7pt var(--f);color:var(--muted);margin-bottom:24px">Ihre Kampagnen-Analyse</div>
<input id="auth-input" type="password" placeholder="Passwort eingeben" onkeydown="if(event.key==='Enter')checkAuth()" style="width:100%;font:400 8pt var(--f);padding:10px 14px;border:1px solid var(--border);border-radius:4px;background:var(--surface);color:var(--text);text-align:center;outline:none;letter-spacing:.1em">
<div id="auth-error" style="font:400 6pt var(--f);color:var(--red);margin-top:6px;opacity:0">Falsches Passwort</div>
<button onclick="checkAuth()" style="margin-top:12px;font:600 7pt var(--m);padding:8px 24px;background:var(--accent);color:#fff;border:none;border-radius:4px;cursor:pointer;letter-spacing:.06em">ZUGANG</button>
<div style="font:400 5pt var(--f);color:var(--muted);margin-top:20px">Alle Daten aus öffentlich zugänglichen Quellen</div>
</div>
</div>
<script>
function checkAuth(){
var pw=document.getElementById('auth-input').value.toLowerCase().trim();
var hash=0;for(var i=0;i<pw.length;i++){hash=((hash<<5)-hash)+pw.charCodeAt(i);hash|=0;}
if(hash===1045691911||hash===854016283){
document.getElementById('auth-gate').style.display='none';
try{sessionStorage.setItem('ai-auth','1')}catch(e){}
}else{
document.getElementById('auth-error').style.opacity='1';
document.getElementById('auth-input').style.borderColor='var(--red)';
setTimeout(function(){document.getElementById('auth-error').style.opacity='0';document.getElementById('auth-input').style.borderColor='var(--border)'},2000);
}
}
// Token-based auth: ?u=TOKEN skips login, identifies user
// Admin mode: ?admin skips login, shows analytics tab
(function(){
  var p = new URLSearchParams(location.search);
  var token = p.get('u');
  var isAdmin = p.has('admin');
  
  // Token → user mapping (Palantir-style: link = identity)
  var TOKEN_MAP = {
    'fs-7x3': { name: 'Florian Schardt', role: 'prospect' },
    'demo': { name: 'Demo-User', role: 'demo' }
  };
  
  if (token && TOKEN_MAP[token]) {
    document.getElementById('auth-gate').style.display = 'none';
    try { sessionStorage.setItem('ai-auth', '1'); sessionStorage.setItem('ai-token', token); } catch(e) {}
  } else if (isAdmin) {
    document.getElementById('auth-gate').style.display = 'none';
    try { sessionStorage.setItem('ai-auth', '1'); sessionStorage.setItem('ai-token', 'admin'); } catch(e) {}
  } else {
    // Auto-login if already authenticated this session
    try { if (sessionStorage.getItem('ai-auth') === '1') document.getElementById('auth-gate').style.display = 'none'; } catch(e) {}
  }
})();
// Auto-focus
setTimeout(function(){document.getElementById('auth-input').focus()},100);
</script>

<!-- TOP BAR -->
<div class="topbar">
  <div class="topbar-left">
    <a href="https://ainaryventures.com" target="_blank" class="topbar-logo" style="text-decoration:none;color:inherit">AINARY</a>
    <span class="topbar-sep">|</span>
    <span class="topbar-env" id="topbar-tenant"></span>
  </div>
  <div class="search-wrap">
    <span class="search-icon">&#9906;</span>
    <input class="search-input" id="search-input" placeholder="Suche: Person, Thema, Kontroverse..." autocomplete="off">
    <div class="search-results" id="search-results"></div>
  </div>
  <div class="topbar-right">
    <span class="topbar-live"><span class="live-pulse"></span> LIVE</span>
    <button class="topbar-chat" onclick="toggleChat()">Support</button>
  </div>
</div>

<!-- MAIN 3-COLUMN LAYOUT -->
<div style="padding:4px 16px;font:400 7pt var(--m);color:var(--muted);border-bottom:1px solid var(--border);flex-shrink:0"><a href="radar.html" style="color:var(--accent);text-decoration:none">← Radar</a> <span style="margin:0 4px;color:var(--border)">›</span> <a href="digi-dashboard.html" style="color:var(--text2);text-decoration:none">Briefing</a> <span style="margin:0 4px;color:var(--border)">›</span> <span>Dossier</span></div>
<div class="main">

  <!-- LEFT SIDEBAR: Ontology (generated from KB) -->
  <div class="panel" id="ontology-panel">
    <div class="panel-header">Ontology Explorer</div>
    <div id="ontology-content"></div>
  </div>

  <!-- CENTER: Tab Bar + Canvas -->
  <div class="canvas-wrap">
    <div class="tab-bar" id="tab-bar">
      <div class="tab active" data-view="briefing" onclick="switchView('briefing')">Briefing</div>
      <div class="tab" data-view="entity" onclick="switchView('entity')">Dossier</div>
      <div class="tab" data-view="graph" onclick="switchView('graph')">Netzwerk</div>
      <div class="tab" data-view="compare" onclick="switchView('compare')">Vergleich</div>
      <div class="tab" data-view="strategy" onclick="switchView('strategy')">Strategie</div>
      <div class="tab" data-view="analytics" onclick="switchView('analytics')" id="analytics-tab" style="display:none">Analytics</div>
    </div>

    <div id="briefing-view" class="canvas"></div>
    <div id="entity-view" class="canvas" style="display:none"></div>
    <div id="graph-view"><div class="tooltip" id="graph-tooltip"></div></div>
    <div id="analytics-view" class="canvas" style="display:none"></div>
    <div id="compare-view" class="canvas" style="display:none"></div>
    <div id="strategy-view" class="canvas" style="display:none"></div>
  </div>

  <!-- RIGHT SIDEBAR: Intel Feed + Patterns -->
  <div class="panel panel-r" id="right-panel">
    <div class="panel-header">Intel Feed <span style="float:right;color:var(--green)">&#9679; LIVE</span></div>
    <div id="intel-feed"></div>
    <div class="panel-header" style="margin-top:0">Detected Patterns</div>
    <div id="detected-patterns"></div>
  </div>
</div>

<!-- CHAT OVERLAY -->
<div class="chat-overlay" id="chat-overlay">
  <div class="chat-header">
    <div class="chat-header-title"><span style="width:8px;height:8px;border-radius:50%;background:var(--green);display:inline-block"></span> Support</div>
    <button class="chat-close" onclick="toggleChat()">&times;</button>
  </div>
  <div class="chat-messages" id="chat-messages"></div>
  <div class="chat-chips" id="chat-chips"></div>
  <div class="chat-input-area">
    <input class="chat-input" id="chat-input" placeholder="Ihre Nachricht..." onkeydown="if(event.key==='Enter')sendChat()">
    <button class="chat-send" onclick="sendChat()">ABSENDEN</button>
  </div>
</div>

<!-- DETAIL OVERLAY -->
<div class="detail-overlay" id="detail-overlay" onclick="if(event.target===this)closeDetail()">
  <div class="detail-card" id="detail-card"></div>
</div>

<!-- STATUS BAR -->
<div class="statusbar">
  <div id="status-left"></div>
  <div id="status-right"></div>
</div>

<script>
// =====================================================
// DATA LAYER — All data as JSON constants
// Generator replaces __PLACEHOLDER__ with JSON.stringify(data)
// =====================================================
const TENANT = {"id":"ottobrunn","name":"Kampagnen-Intelligence Ottobrunn","landkreis":"Gemeinde Ottobrunn (LK München)","state":"Bayern","password":"otto2026","strukturdaten":{"einwohner":"~21.500","flaeche":"5,3 km²","bevoelkerungsdichte":"4.065 EW/km² (Platz 2 bundesweit!)","landkreis":"Landkreis München","regierungsbezirk":"Oberbayern","bundesland":"Bayern","gruendung":"1955","besonderheiten":["Zweitdichteste Gemeinde Deutschlands","Airbus Defence & Space Hauptsitz Deutschland","TU München Luft-/Raumfahrt-Campus","S-Bahn-Anschluss, geplante U5-Verlängerung"]},"gemeinderat2020":[{"partei":"CSU","prozent":40.5,"sitze":12},{"partei":"Grüne","prozent":28,"sitze":9},{"partei":"SPD","prozent":12.4,"sitze":4},{"partei":"BVO","prozent":9.4,"sitze":3},{"partei":"FDP","prozent":4.7,"sitze":1},{"partei":"ödp","prozent":4.9,"sitze":1}],"infrastruktur":["Wolf-Ferrari-Haus (Kultur+Veranstaltung)","Phönix-Bad (Sauna/Wellness, gewinnbringend)","Eisstadion","König-Otto-Museum","Gemeindebibliothek + OnLeihe","15 km Fernwärmeleitungen (regenerativ)","120 km Buslinien-Netz","Schulzweckverband Carl-Steinmeier-Mittelschule","Sportpark (Stadion-Sanierung)","2 Kunstrasenplätze"],"alerts":[{"priority":"KRITISCH","title":"Wahl in 13 Tagen — 09.03.2026","meta":"Alle Kandidaten aktiv im Wahlkampf · Letzte Podiumsdiskussion gelaufen","entity":"loderer"},{"priority":"HOCH","title":"Finanzkrise: Schulden könnten €50M erreichen bis 2027","meta":"Rücklagen bei €1,2M · Grundschulbau gestoppt · Feuerwehr gestrichen","entity":"loderer"},{"priority":"HOCH","title":"AfD tritt erstmals mit 6 GR-Kandidaten an","meta":"Bisher keine AfD-Präsenz in Ottobrunn · Neue Dynamik im Gemeinderat","entity":"afd_ottobrunn"},{"priority":"MITTEL","title":"Loderer: \"Hausfrauen\"-Zitat könnte mobilisieren","meta":"SZ München berichtete · SPD nutzt es im Wahlkampf","entity":"loderer"},{"priority":"MITTEL","title":"Klimakonzept: Ottobrunn einzige Gemeinde ohne im LK","meta":"Matella + Schardt greifen synchron an · Loderer isoliert","entity":"matella"}],"organisationen":["SPD ","CSU ","Grüne ","Die Linke ","AfD "]};
const USER = {"name":"Florian Schardt","gemeinde":"Ottobrunn","lk":"München Land","partei":"SPD","rolle":"BM-Kandidat","nearbyEntities":["loderer","matella","afd_ottobrunn"]};
const KB = {"schardt":{"name":"Florian Schardt","role":"BM-Kandidat Ottobrunn","party":"SPD","since":"Kandidatur Juli 2025","result":"Wahl 08.03.2026","trust":8,"sources":28,"risk":15,"state":"Bayern","landkreis":"Gemeinde Ottobrunn (~22.000 EW, LK München)","color":"var(--green)","dossierUrl":null,"summary":"SPD-Bürgermeisterkandidat, 44 Jahre, Unternehmer. Vizepräsident IHK München und Oberbayern seit 2021. SPD-Fraktionsvorsitzender im Kreistag München. Ex-SPD-Kreisvorsitzender. Kein Gemeinderat, aber starke Kreisebene und Wirtschaftsnetzwerk.","properties":[{"key":"Full Name","val":"Florian Schardt","src":"SZ","type":"official","fresh":"CURRENT"},{"key":"Alter","val":"44 Jahre (Jahrgang ~1981)","src":"SZ","type":"official","fresh":"VERIFIED"},{"key":"Partei","val":"<strong>SPD</strong> — Fraktionsvorsitzender Kreistag München","src":"spd-muenchen.de","type":"official","fresh":"CURRENT"},{"key":"Beruf","val":"Unternehmer — Startup (Azubi-Plattform) verkauft, hält Firmenbeteiligungen","src":"SZ","type":"official","fresh":"VERIFIED"},{"key":"IHK","val":"<strong style='color:var(--green)'>Vizepräsident IHK München und Oberbayern</strong> (seit 2021) — ungewöhnlich für SPD","src":"SZ/IHK","type":"official","fresh":"CURRENT"},{"key":"Kreispolitik","val":"SPD-Fraktionsvorsitzender Kreistag, Ex-Unterbezirksvorsitzender (2019-2023)","src":"SZ","type":"official","fresh":"VERIFIED"},{"key":"Landtag 2023","val":"Kandidat Stimmkreis München-Land Nord — Einzug verpasst","src":"SZ","type":"official","fresh":"VERIFIED"},{"key":"Gemeinderat","val":"<strong style='color:var(--amber)'>KEIN Mitglied</strong> — Schwachpunkt im Wahlkampf, aber IHK + Kreistag kompensieren","src":"SZ","type":"official","fresh":"CURRENT"},{"key":"Wahlkampf-Fokus","val":"Wirtschaftsstandort, Bürgerbeteiligung, Fernwärme ('Mr. Fernwärme'), Kooperation mit Nachbargemeinden","src":"SZ/Merkur Podium Feb 2026","type":"official","fresh":"CURRENT"},{"key":"Stärke","val":"<strong style='color:var(--green)'>WIRTSCHAFTSKOMPETENZ</strong> — IHK-Vize + Unternehmer + SPD = seltene Kombination. Glaubwürdig bei Gewerbe UND Sozialem.","src":"Eigene Analyse","type":"inference","fresh":"CURRENT"}],"connections":[{"type":"opponent","target":"Thomas Loderer","year":"2026","evidence":"CSU-Amtsinhaber, Hauptgegner","label":"Amtsinhaber CSU"},{"type":"ally","target":"SPD Kreistag München","year":"2020","evidence":"Fraktionsvorsitzender","label":"SPD-Netzwerk"},{"type":"network","target":"IHK München","year":"2021","evidence":"Vizepräsident","label":"Wirtschaftsnetzwerk"}],"controversies":[],"timeline":[{"year":"2019","h":10,"color":"blue","label":"SPD-Unterbezirksvorsitzender München-Land"},{"year":"2021","h":10,"color":"green","label":"IHK-Vizepräsident München und Oberbayern"},{"year":"2023","h":15,"color":"orange","label":"Landtagskandidatur — knapp gescheitert"},{"year":"2025","h":10,"color":"blue","label":"SPD-Nominierung BM-Kandidat Ottobrunn"},{"year":"2026","h":20,"color":"green","label":"Wahlkampf BM Ottobrunn — 08.03.2026"}],"steckbrief":{"alter":"43-44 Jahre (Jahrgang ca. 1981)","beruf":"Unternehmer — Gründer AZUBIYO GmbH (verkauft), Firmenbeteiligungen","familienstand":"Verheiratet, 3 Kinder","wohnort":"Ottobrunn","partei":"SPD","ausbildung":"VWL-Studium"},"karriere":[{"zeitraum":"ca. 2005","titel":"VWL-Studium abgeschlossen","beschreibung":"","quelle":"abgeordnetenwatch.de"},{"zeitraum":"ca. 2007-2009","titel":"Angestellter (2 Jahre)","beschreibung":"Nach dem Studium","quelle":"abgeordnetenwatch.de"},{"zeitraum":"2009","titel":"Gründung AZUBIYO GmbH","beschreibung":"Internet-Plattform für Auszubildende. Später verkauft.","quelle":"SZ, abgeordnetenwatch.de"},{"zeitraum":"2016","titel":"IHK-Ehrenamt begonnen","beschreibung":"Engagement für Wirtschaftsstandort Oberbayern","quelle":"tz"},{"zeitraum":"2019","titel":"SPD-Unterbezirksvorsitzender LK München","beschreibung":"Übernommen von Bela Bach. Bis 2023.","quelle":"SZ"},{"zeitraum":"2020","titel":"SPD-Fraktionsvorsitzender Kreistag München","beschreibung":"Seit Kommunalwahl 2020","quelle":"SZ"},{"zeitraum":"2021","titel":"IHK-Vizepräsident München und Oberbayern","beschreibung":"Ungewöhnlich für SPD-Mitglied. Wirtschaftskompetenz-Beleg.","quelle":"SZ (Korrektur: seit 2021, nicht 2024)"},{"zeitraum":"2023","titel":"Landtagskandidat Stimmkreis München-Land Nord","beschreibung":"Einzug verpasst. Danach SPD-Unterbezirksvorsitz abgegeben.","quelle":"SZ, Merkur"},{"zeitraum":"Juli 2025","titel":"SPD nominiert Schardt als BM-Kandidat Ottobrunn","beschreibung":"Einstimmig nominiert. \"Ich habe lange überlegt.\"","quelle":"SZ"},{"zeitraum":"Feb 2026","titel":"Podiumsdiskussion Wolf-Ferrari-Haus","beschreibung":"\"Mr. Fernwärme\", Finanzkritik, konstruktiver Ton. 400 Zuhörer.","quelle":"SZ"}],"zitate":[{"text":"Ich habe lange überlegt. Einige Dinge sind zusammengekommen.","kontext":"Über seine Entscheidung zur Kandidatur","quelle":"SZ","datum":"Juli 2025"},{"text":"In den letzten Jahren war zu wenig Kooperation und zu viel Konfrontation. Die Herausforderungen sind so groß, es geht nur gemeinsam.","kontext":"Ankündigung Kandidatur","quelle":"SZ","datum":"Juli 2025"},{"text":"Das als tolle Mittagsbetreuung hinzustellen ist reichlich übertrieben.","kontext":"Podiumsdiskussion, über Mittagsbetreuung in Kellern der Grundschule Friedenstraße","quelle":"SZ","datum":"Feb 2026"},{"text":"Dann müssen wir uns mit allen an den Tisch setzen. So bekommt man ein Gespür, wo unter Umständen etwas kaputtgespart wird.","kontext":"Podiumsdiskussion, über Sparmaßnahmen","quelle":"SZ","datum":"Feb 2026"},{"text":"Ich würde trotzdem mitmachen, es geht ja darum, sich zu vernetzen.","kontext":"Über Klimaanpassungskonzept LK München, Loderer lehnt ab","quelle":"SZ","datum":"Feb 2026"}],"quellen":[{"name":"SZ — SPD-Spitzenmann fordert CSU heraus","url":"https://www.sueddeutsche.de/muenchen/landkreismuenchen/ottobrunn-buergermeisterwahl-spd-herausforderer-florian-schardt-csu-buergermeister-li.3279032","typ":"Qualitätszeitung","trust":9,"zugriff":"23.02.2026"},{"name":"abgeordnetenwatch.de — Profil Schardt","url":"https://www.abgeordnetenwatch.de/profile/florian-schardt","typ":"Transparenz-Portal","trust":8,"zugriff":"23.02.2026"},{"name":"tz — SPD stellt BM-Kandidat vor","url":"https://www.tz.de/muenchen/region/hallo-muenchen/spd-ottobrunn-buergermeister-kandidat-wahl-schardt-florian-93813877.html","typ":"Regionalzeitung","trust":7,"zugriff":"23.02.2026"},{"name":"Merkur — Schardt tritt an","url":"https://www.merkur.de/lokales/muenchen-lk/florian-schardt-tritt-als-kandidat-der-spd-in-ottobrunn-an-93825654.html","typ":"Regionalzeitung","trust":8,"zugriff":"23.02.2026"},{"name":"Merkur — \"Ruck gegeben\"","url":"https://www.merkur.de/lokales/muenchen-lk/ottobrunn-ort29241/ich-habe-mir-einen-ruck-gegeben-florian-schardt-spd-ueber-seine-buergermeister-kandidatur-93851584.html","typ":"Regionalzeitung","trust":8,"zugriff":"23.02.2026"},{"name":"spd-ottobrunn.de — Kandidaten","url":"https://spd-ottobrunn.de/wahlen/gemeinderatswahl/unsere-kandidaten-fuer-ottobrunn/","typ":"Partei-Website","trust":7,"zugriff":"23.02.2026"},{"name":"SZ — Podiumsdiskussion Feb 2026","url":"https://www.sueddeutsche.de/muenchen/landkreismuenchen/ottobrunn-kommunalwahl-podiumsdiskussion-buergermeisterkandidaten-li.3386333","typ":"Qualitätszeitung","trust":9,"zugriff":"23.02.2026"}],"trustScore":{"gesamt":8,"quellen":28,"aktualitaet":"Aktuell (Feb 2026)","tiefe":"12 Sektionen, 7 Quellen verifiziert"}},"loderer":{"name":"Thomas Loderer","role":"Bürgermeister Ottobrunn (Amtsinhaber)","party":"CSU","since":"2007","result":"~60% (2020), strebt 4. Amtszeit an","trust":7,"sources":42,"risk":45,"state":"Bayern","landkreis":"Gemeinde Ottobrunn (~22.000 EW, LK München)","color":"var(--amber)","dossierUrl":"dossier-thomas-loderer.html","summary":"CSU-Amtsinhaber seit 2007 — 19 Jahre im Amt. 56 Jahre. Gewann 2020 mit ~60%. ABER: Finanzkrise (Rücklagen auf €1.2M geschmolzen), Grundschulbau gestoppt, Sparprogramme bei Feuerwehr. Vorwurf '18 Jahre Stillstand' (Matella). Isoliert von Nachbargemeinden (Klimakonzept-Alleingang).","properties":[{"key":"Full Name","val":"Thomas Loderer","src":"Wikipedia","type":"official","fresh":"CURRENT"},{"key":"Alter","val":"56 Jahre (Jahrgang ~1970)","src":"SZ","type":"official","fresh":"VERIFIED"},{"key":"Partei","val":"<strong>CSU</strong> — Ortsverband Ottobrunn","src":"thomas-loderer.de","type":"official","fresh":"CURRENT"},{"key":"Im Amt seit","val":"<strong>21. März 2007</strong> — 19 Jahre, strebt 4. Amtszeit an","src":"Wikipedia","type":"official","fresh":"VERIFIED"},{"key":"Wahlergebnis 2020","val":"~60% — deutlicher Sieg","src":"Wikipedia","type":"official","fresh":"VERIFIED"},{"key":"Kreistag","val":"Mitglied Kreistag LK München (seit 2008)","src":"Wikipedia","type":"official","fresh":"VERIFIED"},{"key":"Finanzkrise","val":"<strong style='color:var(--red)'>KRITISCH</strong> — Rücklagen bis Ende 2026 auf €1.2M. Grundschulbau Friedenstraße gestoppt. Sparprogramm bei Feuerwehr.","src":"SZ, Jan 2026","type":"official","fresh":"CURRENT"},{"key":"Klimaschutz","val":"<strong style='color:var(--amber)'>ISOLIERT</strong> — Einzige Gemeinde (mit Sauerlach) die NICHT beim Klimaanpassungskonzept LK München mitmacht","src":"Podium Feb 2026","type":"official","fresh":"CURRENT"},{"key":"Nachbar-Kooperation","val":"<strong style='color:var(--amber)'>SCHWACH</strong> — Matella: 'Wir sind isoliert von Nachbargemeinden'. Schardt: Andere haben bessere Fernwärme-Anschlussquote.","src":"SZ Podium","type":"official","fresh":"CURRENT"},{"key":"Amtsbonus","val":"<strong style='color:var(--green)'>HOCH</strong> — 19 Jahre, bekannter Name, CSU-Stammwähler. Aber Abnutzung spürbar.","src":"Eigene Analyse","type":"inference","fresh":"CURRENT"}],"connections":[{"type":"opponent","target":"Florian Schardt","year":"2026","evidence":"SPD-Herausforderer","label":"Herausforderer SPD"},{"type":"opponent","target":"Leon Matella","year":"2026","evidence":"Grüner Herausforderer, schärfste Kritik","label":"Herausforderer Grüne"},{"type":"network","target":"CSU LK München","year":"2007","evidence":"CSU-Ortsverband, Kreistag","label":"CSU-Netzwerk"}],"controversies":[{"title":"Finanzkrise — Rücklagen auf €1.2M","text":"Nach 19 Jahren Amtszeit schmolzen Ottobrunns Rücklagen dramatisch. 2024 wurden 11,2 Mio € aus Rücklagen entnommen. Gewerbesteuer 2025: nur ~15 Mio statt 17,5 Mio Ansatz. Schuldenstand könnte bis 2027 von 20 auf über 50 Mio € steigen. Kreisumlage 2025: 20,2 Mio (Rekord).","ev":"E 95%","conf":"E","severity":"HOCH","detail":"loderer-finanzen","tags":[{"t":"E","tip":"Haushaltsdaten Gemeinde Ottobrunn"},{"t":"E","tip":"SZ/tz: Schuldenprognose 50 Mio"},{"t":"J","tip":"Verantwortung nach 19 Jahren = Loderers Bilanz"}],"sources":"SZ (Okt 2025, Jan 2026), tz (Okt 2024, März 2025), Merkur (Okt 2025)","date":"Okt 2024 – Feb 2026","confNum":95},{"title":"Grundschulbau gestoppt — Kinder in Keller+Container","text":"Der geplante Neubau der Grundschule an der Friedenstraße wurde wegen Finanznot gestoppt (Okt 2025). Die Mittagsbetreuung findet in Kellern und Containern statt. Loderer: \"Der Keller ist liebevoll hergerichtet.\" Schardt: \"Das als tolle Mittagsbetreuung hinzustellen ist reichlich übertrieben.\"","ev":"E 95%","conf":"E","severity":"HOCH","detail":"loderer-grundschule","tags":[{"t":"E","tip":"SZ: Neubau gestoppt bestätigt"},{"t":"E","tip":"Loderer-Zitat bestätigt (SZ)"},{"t":"J","tip":"Emotionalität: Kinder in Kellern"}],"sources":"SZ (Okt 2025, Feb 2026)","date":"Okt 2025","confNum":95},{"title":"Feuerwehrfahrzeuge gestrichen","text":"Ottobrunn verzichtet langfristig auf den Kauf eines Wechselladers und Löschgruppenfahrzeugs. Kommandant Eduard Klas kritisiert Loderer und den Gemeinderat für diese Entscheidung scharf. SZ: \"Selbst bei der Feuerwehr wird gespart.\"","ev":"E 90%","conf":"E","severity":"HOCH","detail":"loderer-feuerwehr","tags":[{"t":"E","tip":"SZ/Merkur: Streichung bestätigt"},{"t":"E","tip":"Kommandant Klas: öffentliche Kritik"}],"sources":"SZ (Dez 2025, Jan 2026)","date":"Dez 2025","confNum":90},{"title":"\"Hausfrauen\"-Aussage (SZ-Korrektur)","text":"SZ berichtete, Loderer habe SPD-Gemeinderätin Markwart-Kunas' Bedenken als \"kleinkarierte Sorgen von ängstlichen Hausfrauen\" bezeichnet. SZ korrigierte später: \"tatsächlich tat er dies in einer Vorberatung\". Dennoch im Netz zirkuliert.","ev":"E/korr","conf":"E","severity":"MITTEL","detail":"loderer-hausfrauen","tags":[{"t":"E","tip":"SZ-Artikel mit Korrektur"},{"t":"J","tip":"Muster: abwertender Ton gegenüber Opposition"}],"sources":"SZ (März 2023, mit Korrektur)","date":"März 2023","confNum":75},{"title":"Klima-Isolation: Einzige Nicht-Teilnehmerin","text":"Ottobrunn ist neben Sauerlach die einzige Gemeinde im LK München, die NICHT am Klimaanpassungskonzept des Landkreises teilnimmt. Matella: \"Der Klimawandel macht nicht Halt vor der Gemeindegrenze.\" Loderer: \"Es wurde viel Geld verschwendet.\"","ev":"E 90%","conf":"E","severity":"MITTEL","detail":"loderer-klima","tags":[{"t":"E","tip":"SZ Podiumsdiskussion: Klimakonzept-Verweigerung bestätigt"},{"t":"E","tip":"Matella + Schardt: übereinstimmende Kritik"}],"sources":"SZ (Feb 2026), gruene-ottobrunn.de","date":"Feb 2026","confNum":90},{"title":"Finsinger Feld: Nachbarn dagegen","text":"Loderers Plan für einen Büro-/Technologiecampus am Finsinger Feld stößt bei den Nachbargemeinden Unterhaching und Neubiberg auf Widerstand wegen Verkehrsproblemen und Kaufkraftabzug.","ev":"E 85%","conf":"E","severity":"NIEDRIG","detail":"loderer-finsinger","tags":[{"t":"E","tip":"tz 2022: Unterhaching+Neubiberg dagegen"}],"sources":"tz (Jul 2022)","date":"2022","confNum":85}],"timeline":[{"year":"2007","h":10,"color":"blue","label":"Erstmals BM Ottobrunn (CSU)"},{"year":"2013","h":10,"color":"blue","label":"Wiederwahl BM"},{"year":"2020","h":10,"color":"green","label":"Wiederwahl mit ~60%"},{"year":"2025","h":15,"color":"orange","label":"Grundschulbau gestoppt — Finanzkrise"},{"year":"2026","h":25,"color":"red","label":"Rücklagen €1.2M — Sparprogramm Feuerwehr"},{"year":"2026","h":20,"color":"orange","label":"Podium: 400 Zuhörer, scharfe Kritik von Schardt + Matella"}],"steckbrief":{"geburtsdatum":"10. April 1969","alter":"56 Jahre","beruf":"Volkswirt, ehem. Wirtschaftsredakteur (Finanzen Verlag)","familienstand":"Verheiratet, 3 Kinder","wohnort":"Ottobrunn","partei":"CSU (Ortsverband Ottobrunn)","buero":"Rathaus Ottobrunn, Rathausplatz 2, 85521 Ottobrunn","amtszeitBis":"30. April 2026 (aktuelle Amtszeit)","ausbildung":"Abitur Reuchlin-Gymnasium Ingolstadt → Grundwehrdienst Luftwaffe → Leibniz Kolleg Tübingen → VWL-Studium München + Bradford (UK)"},"karriere":[{"zeitraum":"1969","titel":"Geboren in Ingolstadt (Bayern)","beschreibung":"","quelle":"Wikipedia"},{"zeitraum":"ca. 1988","titel":"Abitur Reuchlin-Gymnasium Ingolstadt","beschreibung":"Humanistisches Gymnasium","quelle":"Wikipedia"},{"zeitraum":"ca. 1988-1989","titel":"Grundwehrdienst Luftwaffe","beschreibung":"","quelle":"Wikipedia"},{"zeitraum":"ca. 1989-1990","titel":"Leibniz Kolleg Tübingen","beschreibung":"Studium Generale","quelle":"Wikipedia"},{"zeitraum":"ca. 1990-1995","titel":"VWL-Studium München + Bradford (UK)","beschreibung":"Volkswirtschaft, internationaler Fokus","quelle":"Wikipedia"},{"zeitraum":"ca. 1995-2007","titel":"Wirtschaftsredakteur, Finanzen Verlag","beschreibung":"Schwerpunkt Wirtschaft und Finanzen","quelle":"Wikipedia"},{"zeitraum":"21.03.2007","titel":"Erster Bürgermeister Ottobrunn","beschreibung":"Wahl: 39,9% (1. WG) → 56,4% (Stichwahl vs. Eisfeld/SPD). Wahlbeteiligung: 47,7%/43,6%","quelle":"Wikipedia, Wahlergebnisse Ottobrunn"},{"zeitraum":"01.05.2008","titel":"Mitglied Kreistag LK München","beschreibung":"Seitdem durchgehend im Kreistag","quelle":"Wikipedia"},{"zeitraum":"03.03.2013","titel":"Wiederwahl BM — 52,7%","beschreibung":"vs. Wißmeier-Unverricht (SPD) 33,8%, Lumpe (Grüne) 9,2%, Kunzmann (FDP) 4,3%. WB: 46,7%","quelle":"Wikipedia, Wahlergebnisse Ottobrunn"},{"zeitraum":"15.03.2020","titel":"Wiederwahl BM — 59,8%","beschreibung":"vs. Campbell (Grüne) 26,2%, Athen (SPD) 14,0%. KEIN Stichwahl-Risiko. WB: ca. 55%","quelle":"SZ, Merkur, Wikipedia"},{"zeitraum":"Okt 2024","titel":"Bürgerversammlung: Schulden-Warnung","beschreibung":"Loderer warnt: Schuldenstand könnte bis 2027 von 20 auf über 50 Mio € steigen","quelle":"tz München"},{"zeitraum":"Okt 2025","titel":"Grundschulbau Friedenstraße gestoppt","beschreibung":"4 Mio € Gewerbesteuer-Mindereinnahmen. 11,2 Mio aus Rücklagen entnommen.","quelle":"SZ München"},{"zeitraum":"Okt 2025","titel":"CSU nominiert Loderer für 4. Amtszeit","beschreibung":"Einstimmig, Ortsvorsitzender Fall: \"Zukunftsorientierung, Mut und vollen Einsatz\"","quelle":"Merkur"},{"zeitraum":"Dez 2025","titel":"Feuerwehrfahrzeuge gestrichen","beschreibung":"Wechsellader + Löschgruppenfahrzeug nicht mehr in Finanzplanung. Kommandant Klas kritisiert scharf.","quelle":"SZ München"},{"zeitraum":"Feb 2026","titel":"Podiumsdiskussion Wolf-Ferrari-Haus","beschreibung":"400 Zuhörer + 145 Livestream. Scharfe Kritik von Schardt + Matella. Loderer: \"Unter welchem Stern haben die beiden gelebt?\"","quelle":"SZ München"}],"wahlergebnisse":[{"wahl":"BM-Wahl 2007 (1. Wahlgang)","ergebnis":"39,9%","details":"vs. Eisfeld (SPD) 34,4%, Aulenbach (BVO) 14,3%, Keller (FDP) 11,4%","wahlbeteiligung":"47,7%","quelle":"Wikipedia"},{"wahl":"BM-Wahl 2007 (Stichwahl)","ergebnis":"56,4%","details":"vs. Eisfeld (SPD) 43,6%","wahlbeteiligung":"43,6%","quelle":"Wikipedia"},{"wahl":"BM-Wahl 2013","ergebnis":"52,7%","details":"vs. Wißmeier-Unverricht (SPD) 33,8%, Lumpe (Grüne) 9,2%, Kunzmann (FDP) 4,3%","trend":"+","wahlbeteiligung":"46,7%","quelle":"Wikipedia"},{"wahl":"BM-Wahl 2020","ergebnis":"59,8%","details":"vs. Campbell (Grüne) 26,2%, Athen (SPD) 14,0%","trend":"↑ +7,1 PP","wahlbeteiligung":"~55%","quelle":"SZ, Merkur"}],"politischesProfil":{"funktionen":["Erster Bürgermeister Ottobrunn (seit 2007)","Mitglied Kreistag LK München (seit 2008)"],"errungenschaften":["15 km Fernwärmeleitungen verlegt (regenerativ, Stadtwerke München)","Wolf-Ferrari-Haus (Kultur- und Veranstaltungszentrum)","Phönix-Bad mit Sauna/Wellness — kein Verlustgeschäft","Buslinien verdreifacht (120 km), Expressbusse nach München","U5-Verlängerung vorangetrieben (90% Bund/Land zugesagt)","71,8 Mio € in 230 preisgünstige Wohnungen (mit Baugesellschaft München-Land)","Schulzweckverband Carl-Steinmeier-Mittelschule","310 Belegrechts-Wohnungen für Erzieherinnen, Feuerwehr, Pflege","TU München Luft-/Raumfahrt-Campus Ansiedlung"],"gemeinderat2020":[{"partei":"CSU","prozent":40.5,"sitze":12},{"partei":"Grüne","prozent":28,"sitze":9},{"partei":"SPD","prozent":12.4,"sitze":4},{"partei":"BVO","prozent":9.4,"sitze":3},{"partei":"FDP","prozent":4.7,"sitze":1},{"partei":"ödp","prozent":4.9,"sitze":1}],"teamListe2026":"30 Kandidaten, 21-70 Jahre, ~40% Frauen. Top 5: Loderer, Seeböck, Thaumüller, Keil, Fall"},"zitate":[{"text":"Unter welchem Stern haben die beiden gelebt? In den vergangenen 19 Jahren wurde viel erreicht.","kontext":"Podiumsdiskussion Wolf-Ferrari-Haus, Antwort auf Schardt/Matella-Kritik","quelle":"SZ München","datum":"Feb 2026"},{"text":"Ich würde zum Pensionsempfänger werden, wenn ich nicht gewählt werde. Ich will aber etwas tun für mein Geld.","kontext":"Schlussrunde Podiumsdiskussion","quelle":"SZ München","datum":"Feb 2026"},{"text":"Der Keller ist liebevoll hergerichtet.","kontext":"Verteidigung der Mittagsbetreuung Grundschule Friedenstraße (Keller+Container)","quelle":"SZ München","datum":"Feb 2026"},{"text":"Es wurde viel Geld verschwendet und es ist nichts rausgekommen.","kontext":"Über das Klimaanpassungskonzept des LK München, an dem Ottobrunn nicht teilnimmt","quelle":"SZ München","datum":"Feb 2026"},{"text":"So leid es mir tut – es fällt mir schwer, diese Entscheidung mitzutragen.","kontext":"Streichung Feuerwehrfahrzeuge, Haushaltsdebatte Dez 2025","quelle":"SZ München","datum":"Dez 2025"},{"text":"Von Symbolpolitik halte ich nichts.","kontext":"Podiumsdiskussion, über Klimaschutz-Maßnahmen der Herausforderer","quelle":"SZ München","datum":"Feb 2026"}],"quellen":[{"name":"Wikipedia — Thomas Loderer","url":"https://de.wikipedia.org/wiki/Thomas_Loderer","typ":"Enzyklopädie","trust":8,"zugriff":"23.02.2026"},{"name":"thomas-loderer.de","url":"https://www.thomas-loderer.de/","typ":"Eigene Website","trust":7,"zugriff":"23.02.2026"},{"name":"SZ — Herausforderer attackieren BM","url":"https://www.sueddeutsche.de/muenchen/landkreismuenchen/ottobrunn-kommunalwahl-podiumsdiskussion-buergermeisterkandidaten-li.3386333","typ":"Qualitätszeitung","trust":9,"zugriff":"23.02.2026"},{"name":"SZ — Grundschulbau gestoppt","url":"https://www.sueddeutsche.de/muenchen/landkreismuenchen/ottobrunn-verzicht-neubau-grundschule-friedenstrasse-finanznot-li.3331352","typ":"Qualitätszeitung","trust":9,"zugriff":"23.02.2026"},{"name":"SZ — Feuerwehrfahrzeuge gestrichen","url":"https://www.sueddeutsche.de/muenchen/landkreismuenchen/ottobrunn-feuerwehrfahrzeuge-finanzkrise-li.3356788","typ":"Qualitätszeitung","trust":9,"zugriff":"23.02.2026"},{"name":"SZ — Steuerausfälle","url":"https://www.sueddeutsche.de/muenchen/landkreismuenchen/ottobrunn-haushalt-investitionen-gemeindefinanzen-loderer-markwart-kunas-1.5761657","typ":"Qualitätszeitung","trust":9,"zugriff":"23.02.2026"},{"name":"Merkur — CSU nominiert Loderer","url":"https://www.merkur.de/lokales/muenchen-lk/ottobrunn-ort29241/kommunalwahl-bayern-csu-ottobrunn-nominiert-thomas-loderer-fuer-buergermeisterwahl-94011785.html","typ":"Regionalzeitung","trust":8,"zugriff":"23.02.2026"},{"name":"Merkur — Loderer wieder im Amt 2020","url":"https://www.merkur.de/lokales/muenchen-lk/kommunalwahl-2020-ottobrunn-thomas-loderer-wieder-im-amt-13600279.html","typ":"Regionalzeitung","trust":8,"zugriff":"23.02.2026"},{"name":"SZ — Loderer siegt klar 2020","url":"https://www.sueddeutsche.de/muenchen/landkreismuenchen/starker-amtsinhaber-loderer-siegt-klar-in-ottobrunn-1.4845933","typ":"Qualitätszeitung","trust":9,"zugriff":"23.02.2026"},{"name":"tz — 50 Mio Schulden","url":"https://www.tz.de/muenchen/region/hallo-muenchen/finanzen-schulneubau-thema-ottobrunn-buergerversammlung-schulden-millionen-neubau-schule-93358991.html","typ":"Regionalzeitung","trust":7,"zugriff":"23.02.2026"},{"name":"Merkur — Schulden + Finanzdruck","url":"https://www.merkur.de/lokales/muenchen-lk/ottobrunn-ort29241/ottobrunn-kaempft-mit-steigenden-schulden-und-finanzdruck-93980748.html","typ":"Regionalzeitung","trust":8,"zugriff":"23.02.2026"},{"name":"Wikipedia — Wahlergebnisse Ottobrunn","url":"https://de.wikipedia.org/wiki/Wahlergebnisse_in_Ottobrunn","typ":"Enzyklopädie","trust":8,"zugriff":"23.02.2026"},{"name":"ottobrunn.de","url":"https://www.ottobrunn.de/","typ":"Gemeinde-Website","trust":9,"zugriff":"23.02.2026"},{"name":"csu.de — BM-Nominierung","url":"https://www.csu.de/verbaende/ov/ottobrunn/aktuelles/juli-2019/buergermeisternominierung/","typ":"Partei-Website","trust":7,"zugriff":"23.02.2026"},{"name":"Wochenanzeiger — Loderer bestätigt","url":"https://www.wochenanzeiger.de/article/228893.html","typ":"Lokalzeitung","trust":7,"zugriff":"23.02.2026"}],"trustScore":{"gesamt":7.8,"quellen":42,"aktualitaet":"Aktuell (Feb 2026)","tiefe":"14 Sektionen, 15 Quellen verifiziert"},"contradictions":[{"id":"w1","title":"\"Verantwortungsvoller Umgang mit Geld\" vs. €50M Schuldenprognose","type":"sagen_vs_tun","typeLabel":"SAGEN vs. TUN","severity":5,"said":{"text":"Wir gehen verantwortungsvoll mit Personal und Finanzmitteln unserer Gemeinde um. Teure Symbolpolitik hat bei uns keinen Platz.","source":"thomas-loderer.de (Wahlkampf-Website 2026)","url":"https://www.thomas-loderer.de/","date":"2025/2026"},"reality":{"text":"Schuldenstand könnte bis 2027 von 20 auf über 50 Mio € steigen. 2024: 11,2 Mio € aus Rücklagen entnommen. Gewerbesteuer 2025: 4 Mio unter Plan. Grundschulneubau gestoppt, Feuerwehrfahrzeuge gestrichen.","source":"tz München (Okt 2024), SZ (Okt 2025, Dez 2025)","urls":["https://www.tz.de/muenchen/region/hallo-muenchen/finanzen-schulneubau-thema-ottobrunn-buergerversammlung-schulden-millionen-neubau-schule-93358991.html","https://www.sueddeutsche.de/muenchen/landkreismuenchen/ottobrunn-verzicht-neubau-grundschule-friedenstrasse-finanznot-li.3331352"],"date":"Okt 2024 – Feb 2026"},"analysis":"Loderer wirbt auf seiner eigenen Website mit verantwortungsvollem Finanzmanagement — während er selbst auf der Bürgerversammlung vor einer Verdopplung der Schulden warnte. Die Diskrepanz zwischen Wahlkampf-Kommunikation und eigener Prognose ist dokumentiert.","conf":95},{"id":"w2","title":"\"Ich sprühe vor Ideen\" (2019) vs. Stillstand-Bilanz (2026)","type":"frueher_vs_jetzt","typeLabel":"FRÜHER vs. JETZT","severity":4,"said":{"text":"Ich habe Ideen, ja, ich sprühe vor Ideen und bin überzeugt, dass ich der Richtige bin. [...] Strategischer Weitblick.","source":"SZ (\"Ich sprühe vor Ideen\", Aug 2019)","url":"https://www.sueddeutsche.de/muenchen/landkreismuenchen/kommunalwahl-ich-spruehe-vor-ideen-1.4512117","date":"August 2019"},"reality":{"text":"Matella (Grüne): \"Wir sind pleite, wir sind isoliert von den Nachbargemeinden und wir sind planlos.\" 400 Zuhörer + 145 Livestream bei Podiumsdiskussion. Grundschulbau gestoppt, nicht beim Klimakonzept LK München, kein sichtbarer Digitalisierungsplan.","source":"SZ Podiumsdiskussion (Feb 2026)","urls":["https://www.sueddeutsche.de/muenchen/landkreismuenchen/ottobrunn-kommunalwahl-podiumsdiskussion-buergermeisterkandidaten-li.3386333"],"date":"Februar 2026"},"analysis":"7 Jahre zwischen \"ich sprühe vor Ideen\" und dem Zustand 2026. Die Frage ist nicht ob Loderer damals gelogen hat — sondern was aus den Ideen wurde. Die Bilanz (Finanzkrise, gestoppte Projekte, Klima-Isolation) steht im Kontrast zum Versprechen.","conf":85},{"id":"w3","title":"\"Ausgleichender, ruhiger Stil\" vs. \"Hausfrauen\"-Aussage + Podium-Attacken","type":"selbstbild_vs_verhalten","typeLabel":"SELBSTBILD vs. VERHALTEN","severity":3,"said":{"text":"Ein ausgleichender, ruhiger Stil. [...] Wahlkampf ist Wahlkampf — Loderer kann das nicht, will das nicht.","source":"SZ (Aug 2019) + Merkur (Feb 2013)","url":"https://www.sueddeutsche.de/muenchen/landkreismuenchen/kommunalwahl-ich-spruehe-vor-ideen-1.4512117","date":"2013/2019"},"reality":{"text":"Bezeichnete SPD-Gemeinderätin Markwart-Kunas' Finanz-Bedenken als \"kleinkarierte Sorgen von ängstlichen Hausfrauen\" (in Vorberatung, SZ korrigierte). Podium 2026: \"Unter welchem Stern haben die beiden gelebt?\" — aggressiver Ton gegen Herausforderer.","source":"SZ (März 2023, mit Korrektur) + SZ Podium (Feb 2026)","urls":["https://www.sueddeutsche.de/muenchen/landkreismuenchen/ottobrunn-haushalt-investitionen-gemeindefinanzen-loderer-markwart-kunas-1.5761657","https://www.sueddeutsche.de/muenchen/landkreismuenchen/ottobrunn-kommunalwahl-podiumsdiskussion-buergermeisterkandidaten-li.3386333"],"date":"2023 + Feb 2026"},"analysis":"Das Selbstbild des besonnenen Bürgermeisters kollidiert mit dokumentierten Ausfällen. Die SZ korrigierte den Hausfrauen-Kontext (Vorberatung, nicht Sitzung) — das Zitat selbst blieb unbestritten. Pattern: Unter Druck wird der Ton abwertend.","conf":75},{"id":"w4","title":"\"Keine Symbolpolitik\" vs. Kinder in Kellern während Phönix-Bad läuft","type":"sagen_vs_tun","typeLabel":"SAGEN vs. TUN","severity":3,"said":{"text":"Teure Symbolpolitik hat bei uns keinen Platz. Wir packen konsequent an, was wichtig ist.","source":"thomas-loderer.de (Wahlkampf-Website 2026)","url":"https://www.thomas-loderer.de/","date":"2025/2026"},"reality":{"text":"Grundschule Friedenstraße: Mittagsbetreuung in Kellern und Containern. Loderer: \"Der Keller ist liebevoll hergerichtet.\" Gleichzeitig: Phönix-Bad, Eisstadion, Wolf-Ferrari-Haus werden unterhalten. Schardt: \"Das als tolle Mittagsbetreuung hinzustellen ist reichlich übertrieben.\"","source":"SZ Podiumsdiskussion (Feb 2026), SZ Grundschulbau (Okt 2025)","urls":["https://www.sueddeutsche.de/muenchen/landkreismuenchen/ottobrunn-kommunalwahl-podiumsdiskussion-buergermeisterkandidaten-li.3386333"],"date":"Feb 2026"},"analysis":"Die Priorisierung ist die Frage: Wenn Phönix-Bad kein Verlustgeschäft ist (Loderer 2019), ist es kein Symbolpolitik-Problem. Aber der emotionale Kontrast — Kinder in Kellern vs. Sauna-Wellness — ist für Wähler greifbar.","conf":70},{"id":"w5","title":"\"Teamarbeit und Zusammenstehen\" vs. Isolation von Nachbargemeinden","type":"selbstbild_vs_fremdbild","typeLabel":"SELBSTBILD vs. FREMDBILD","severity":4,"said":{"text":"Die großen Entwicklungen haben wir erreicht, weil wir zusammengestanden sind. [...] Manche Nachbargemeinden hätten ihr Fernwärmenetz ohne Ottobrunn nicht aufbauen können.","source":"SZ (Aug 2019) + SZ Podium (Feb 2026)","url":"https://www.sueddeutsche.de/muenchen/landkreismuenchen/kommunalwahl-ich-spruehe-vor-ideen-1.4512117","date":"2019/2026"},"reality":{"text":"Ottobrunn ist neben Sauerlach die EINZIGE Gemeinde im LK München die nicht beim Klimaanpassungskonzept mitmacht. Unterhaching + Neubiberg lehnen Finsinger-Feld-Pläne ab. Matella: \"Gallisches Dorf im negativen Sinne.\" Schardt: \"Zu wenig Kooperation, zu viel Konfrontation.\"","source":"SZ Podium (Feb 2026), tz (Jul 2022), Merkur (Dez 2025)","urls":["https://www.sueddeutsche.de/muenchen/landkreismuenchen/ottobrunn-kommunalwahl-podiumsdiskussion-buergermeisterkandidaten-li.3386333"],"date":"2022–2026"},"analysis":"Beide Herausforderer UND die Nachbargemeinden zeichnen ein Bild der Isolation. Loderer betont Kooperation nur wo Ottobrunn profitiert hat — verschweigt die Verweigerung beim Klimakonzept und die Konflikte um Finsinger Feld.","conf":90}]},"matella":{"name":"Leon Matella","role":"BM-Kandidat Ottobrunn","party":"Grüne","since":"Kandidatur 2025","result":"Wahl 08.03.2026","trust":6,"sources":18,"risk":30,"state":"Bayern","landkreis":"Gemeinde Ottobrunn (~22.000 EW, LK München)","color":"var(--green)","dossierUrl":null,"summary":"Grünen-BM-Kandidat, 27 Jahre, Rettungssanitäter, Gemeinderat. Jüngster Kandidat, schärfster Kritiker von Loderer. Pfadfinder-Bundesleitung. Klimaschutz, Verkehrswende, strategische Ortsentwicklung.","properties":[{"key":"Alter","val":"27 Jahre — jüngster Kandidat","src":"SZ","type":"official","fresh":"VERIFIED"},{"key":"Partei","val":"<strong>Bündnis 90/Die Grünen</strong>","src":"SZ","type":"official","fresh":"CURRENT"},{"key":"Beruf","val":"Rettungssanitäter + Pädagoge","src":"SZ","type":"official","fresh":"VERIFIED"},{"key":"Gemeinderat","val":"<strong style='color:var(--green)'>JA</strong> — Sitzt bereits im Ottobrunner Gemeinderat","src":"SZ","type":"official","fresh":"CURRENT"},{"key":"Key Quote","val":"<em>'Wir sind pleite, wir sind isoliert von den Nachbargemeinden und wir sind planlos.'</em> — Podium Feb 2026","src":"SZ","type":"official","fresh":"CURRENT"},{"key":"Wahlkampf-Fokus","val":"Klimaschutz, Verkehrswende, Zusammenarbeit mit Nachbargemeinden, 'strategische Ortsentwicklung'","src":"SZ","type":"official","fresh":"VERIFIED"},{"key":"Splitting-Effekt","val":"<strong style='color:var(--amber)'>RELEVANT</strong> — Zieht progressive Stimmen von SPD (Schardt) ab. Oder umgekehrt.","src":"Eigene Analyse","type":"inference","fresh":"CURRENT"}],"connections":[{"type":"opponent","target":"Thomas Loderer","year":"2026","evidence":"Schärfster Kritiker","label":"Amtsinhaber CSU"},{"type":"ally","target":"Florian Schardt","year":"2026","evidence":"Beide kritisieren Loderer, ähnliche Positionen bei Nachbar-Kooperation","label":"De-facto-Allianz gegen Loderer"}],"controversies":[],"timeline":[{"year":"2020","h":10,"color":"green","label":"Einzug Gemeinderat Ottobrunn (Grüne)"},{"year":"2026","h":20,"color":"green","label":"BM-Kandidatur — schärfste Loderer-Kritik"}],"steckbrief":{"alter":"27 Jahre","beruf":"Rettungssanitäter, Pädagoge","partei":"Bündnis 90/Die Grünen","wohnort":"Ottobrunn","ehrenamt":"Mitglied Pfadfinder-Bundesleitung"},"karriere":[{"zeitraum":"2020","titel":"Einzug Gemeinderat Ottobrunn (Grüne)","beschreibung":"Grüne holten 28% / 9 Sitze","quelle":"Merkur"},{"zeitraum":"Dez 2025","titel":"Nominierung BM-Kandidat","beschreibung":"100% Zustimmung bei Aufstellungsversammlung","quelle":"SZ, Merkur"},{"zeitraum":"Feb 2026","titel":"Podiumsdiskussion Wolf-Ferrari-Haus","beschreibung":"Schärfster Kritiker Loderers. \"Pleite, isoliert, planlos.\"","quelle":"SZ"}],"zitate":[{"text":"Wir sind pleite, wir sind isoliert von den Nachbargemeinden und wir sind planlos.","kontext":"Podiumsdiskussion Wolf-Ferrari-Haus","quelle":"SZ München","datum":"Feb 2026"},{"text":"Der Klimawandel macht nicht Halt vor der Gemeindegrenze.","kontext":"Über Loderers Verweigerung des LK-Klimaanpassungskonzepts","quelle":"SZ München","datum":"Feb 2026"},{"text":"18 Jahre Stillstand.","kontext":"Kernkritik an Loderer","quelle":"SZ","datum":"Dez 2025"}],"quellen":[{"name":"SZ — Grüne nominieren 27-Jährigen","url":"https://www.sueddeutsche.de/muenchen/landkreismuenchen/ottobrunn-gruene-leon-matella-buergermeisterkandidaten-kommunalwahl-2026-li.3347124","typ":"Qualitätszeitung","trust":9,"zugriff":"23.02.2026"},{"name":"Merkur — Grüne nominieren Matella","url":"https://www.merkur.de/lokales/muenchen-lk/ottobrunn-ort29241/gruene-ottobrunn-nominieren-leon-matella-als-buergermeisterkandidaten-94063700.html","typ":"Regionalzeitung","trust":8,"zugriff":"23.02.2026"},{"name":"leonmatella.de","url":"https://leonmatella.de/","typ":"Eigene Website","trust":7,"zugriff":"23.02.2026"},{"name":"gruene-ottobrunn.de","url":"https://gruene-ottobrunn.de/","typ":"Partei-Website","trust":7,"zugriff":"23.02.2026"}],"trustScore":{"gesamt":7,"quellen":18,"aktualitaet":"Aktuell (Feb 2026)","tiefe":"8 Sektionen, 4 Quellen verifiziert"}},"ulmer":{"name":"Vivi Ulmer","role":"BM-Kandidat Ottobrunn","party":"Die Linke","since":"Kandidatur 2025","result":"Wahl 08.03.2026","trust":5,"sources":6,"risk":10,"state":"Bayern","landkreis":"Gemeinde Ottobrunn (~22.000 EW, LK München)","color":"var(--muted)","dossierUrl":null,"summary":"Linken-Kandidat, 22 Jahre, Koch. Erstmals Linke in Ottobrunn. Trans Person. Fokus: bezahlbarer Wohnraum, Rechte queerer Menschen, Anti-AfD. Sagte Podium gesundheitsbedingt ab.","properties":[{"key":"Alter","val":"22 Jahre — jüngster Kandidat insgesamt","src":"SZ","type":"official","fresh":"VERIFIED"},{"key":"Partei","val":"<strong>Die Linke</strong> — Erstmals in Ottobrunn","src":"SZ","type":"official","fresh":"CURRENT"},{"key":"Beruf","val":"Koch","src":"SZ","type":"official","fresh":"VERIFIED"},{"key":"Wahlkampf-Fokus","val":"Bezahlbarer Wohnraum, queere Rechte, Anti-Rechtsruck","src":"SZ","type":"official","fresh":"VERIFIED"},{"key":"Relevanz","val":"<strong style='color:var(--muted)'>GERING</strong> — Linke hat <5% in Ottobrunn. Symbolkandidatur.","src":"Eigene Analyse","type":"inference","fresh":"CURRENT"}],"connections":[],"controversies":[],"timeline":[{"year":"2026","h":10,"color":"border2","label":"Erste Linke-Kandidatur in Ottobrunn"}]},"afd_ottobrunn":{"name":"AfD Ottobrunn (Spitzenkandidat Brand)","role":"Gemeinderats-Kandidatur","party":"AfD","since":"2026","result":"Wahl 08.03.2026","trust":5,"sources":12,"risk":55,"state":"Bayern","landkreis":"Gemeinde Ottobrunn (~22.000 EW, LK München)","color":"var(--red)","dossierUrl":null,"summary":"AfD tritt ERSTMALS in Ottobrunn an — 6 Gemeinderats-Kandidaten, Spitzenkandidat Brand. Kein BM-Kandidat, aber symbolisch wichtig: München-Land galt als AfD-freie Zone. Brand will NGO-Förderung streichen.","properties":[{"key":"Partei","val":"<strong style='color:var(--red)'>AfD</strong> — ERSTMALS in Ottobrunn","src":"Merkur","type":"official","fresh":"CURRENT"},{"key":"Kandidaten","val":"6 Gemeinderats-Kandidaten, Spitzenkandidat: Brand","src":"Merkur, Feb 2026","type":"official","fresh":"CURRENT"},{"key":"BM-Kandidat","val":"<strong>NEIN</strong> — Kein eigener BM-Kandidat","src":"SZ","type":"official","fresh":"VERIFIED"},{"key":"Position","val":"Brand will Unterstützung von NGOs streichen. Systemkritische Linie.","src":"Merkur","type":"official","fresh":"CURRENT"},{"key":"Kontext","val":"<strong style='color:var(--amber)'>SIGNALWIRKUNG</strong> — Wenn AfD in München-Vorort Gemeinderatssitze holt = Warnsignal für ganz Oberbayern","src":"Eigene Analyse","type":"inference","fresh":"CURRENT"},{"key":"VS Status","val":"<strong style='color:var(--red)'>PARTEI BEOBACHTET</strong> — AfD Bayern als Verdachtsfall","src":"BfV","type":"official","fresh":"2024"}],"connections":[],"controversies":[{"title":"Erstmaliger AfD-Antritt in Ottobrunn","text":"Die AfD tritt erstmals in der Geschichte Ottobrunns zur Gemeinderatswahl an. München-Land galt bisher als AfD-freie Zone. Ulmer (Linke): 'Gerade jetzt, wo auch die AfD zum ersten Mal für den Gemeinderat antritt.'","ev":"E 95%","conf":"E","severity":"HOCH","detail":"afd-erstmals-ottobrunn"}],"timeline":[{"year":"2026","h":20,"color":"red","label":"ERSTMALS AfD-Kandidaten in Ottobrunn — 6 Gemeinderatskandidaten"}],"quellen":[{"name":"Merkur — AfD 6 Kandidaten","url":"https://www.merkur.de/lokales/muenchen-lk/ottobrunn-ort29241/kommunalwahl-afd-ottobrunn-geht-mit-sechs-kandidaten-und-klaren-positionen-ins-rennen-94157997.html","typ":"Regionalzeitung","trust":8,"zugriff":"23.02.2026"},{"name":"kommunal.de — AfD Bayern Kommunalwahlen","url":"https://kommunal.de/kommunalwahlen-2026-bayern","typ":"Fachmedium","trust":8,"zugriff":"23.02.2026"}],"kandidaten":[{"platz":1,"name":"Dr. Nikolaus Brand","beruf":"Mathematiker i.R.","spitzenkandidat":true},{"platz":2,"name":"Thomas Budweiser","beruf":"Friedhofsverwalter"},{"platz":3,"name":"Alexander Munz","beruf":"CNC-Fräser"},{"platz":4,"name":"Patrick von Graeve","beruf":"Mediengestalter"},{"platz":5,"name":"Astrid Gerstlberger","beruf":"Augenoptikerin"},{"platz":6,"name":"Johann Garhammer","beruf":"Rentner"}],"forderungen":["Finanzielle Unterstützung von NGOs streichen","Ablehnung Agenda 2030","Bezahlbarer Wohnraum durch Nachverdichtung","Gemeindewohnungen mit kommunalem Belegungszugriff","U5-Verlängerung (bei 90% Bund/Land-Förderung)","Erhalt des Ottobrunner Busnetzes"]}};
const GRAPH = {"nodes":[{"id":"schardt","label":"Florian Schardt","sub":"BM-Kandidat Ottobrunn","group":"ally","r":21,"info":"<strong>SPD</strong> — Fraktionsvorsitzender Kreistag München, Risk: 15"},{"id":"loderer","label":"Thomas Loderer","sub":"Bürgermeister Ottobrunn (Amtsinhaber)","group":"threat","r":27,"info":"<strong>CSU</strong> — Ortsverband Ottobrunn, Risk: 45"},{"id":"matella","label":"Leon Matella","sub":"BM-Kandidat Ottobrunn","group":"neutral","r":24,"info":"<strong>Bündnis 90/Die Grünen</strong>, Risk: 30"},{"id":"ulmer","label":"Vivi Ulmer","sub":"BM-Kandidat Ottobrunn","group":"ally","r":20,"info":"<strong>Die Linke</strong> — Erstmals in Ottobrunn, Risk: 10"},{"id":"afd_ottobrunn","label":"AfD Ottobrunn (Spitzenkandidat Brand)","sub":"Gemeinderats-Kandidatur","group":"threat","r":29,"info":"<strong style='color:var(--red)'>AfD</strong> — ERSTMALS in Ottobrunn, Risk: 55"},{"id":"spd_ott","label":"SPD Ottobrunn","sub":"Partei","group":"org_ally","r":14,"info":"4 Sitze im Gemeinderat 2020"},{"id":"csu_ott","label":"CSU Ottobrunn","sub":"Partei","group":"org_threat","r":16,"info":"12 Sitze im Gemeinderat 2020 (stärkste Fraktion)"},{"id":"gruene_ott","label":"Grüne Ottobrunn","sub":"Partei","group":"org_neutral","r":15,"info":"9 Sitze im Gemeinderat 2020"},{"id":"ihk_muc","label":"IHK München","sub":"Wirtschaftskammer","group":"org_neutral","r":12,"info":"Schardt ist Vizepräsident seit 2021"},{"id":"gemeinderat","label":"Gemeinderat Ottobrunn","sub":"30 Sitze","group":"institution","r":17,"info":"CSU 12, Grüne 9, SPD 4, BVO 3, FDP 1, ödp 1"},{"id":"lk_muc","label":"Landkreis München","sub":"Kreisverwaltung","group":"institution","r":13,"info":"Kreisumlage 2025: 20,2 Mio (Rekord)"},{"id":"finanzkrise","label":"Finanzkrise","sub":"€50M Schuldenprognose","group":"theme_hot","r":15,"info":"Rücklagen: €1.2M. Grundschule gestoppt."},{"id":"fernwaerme","label":"Fernwärme","sub":"Schlüsselthema","group":"theme","r":13,"info":"Loderer: eigenes Netz. Schardt: LK-Verbund."},{"id":"klima","label":"Klimakonzept","sub":"LK-Kooperation","group":"theme","r":12,"info":"Ottobrunn einzige Gemeinde die nicht mitmacht"}],"links":[{"source":"schardt","target":"spd_ott","label":"Kandidat","type":"party"},{"source":"loderer","target":"csu_ott","label":"Kandidat + BM","type":"party"},{"source":"matella","target":"gruene_ott","label":"Kandidat","type":"party"},{"source":"afd_ottobrunn","target":"gemeinderat","label":"Erstantritt 6 Sitze","type":"threat"},{"source":"schardt","target":"loderer","label":"Herausforderer","type":"opponent"},{"source":"matella","target":"loderer","label":"Herausforderer","type":"opponent"},{"source":"schardt","target":"matella","label":"De-facto-Allianz","type":"ally"},{"source":"ulmer","target":"loderer","label":"Herausforderin","type":"opponent"},{"source":"schardt","target":"ihk_muc","label":"Vizepräsident seit 2021","type":"network"},{"source":"schardt","target":"gemeinderat","label":"Kreistagsfraktionsvorsitz SPD","type":"network"},{"source":"loderer","target":"gemeinderat","label":"Vorsitzender seit 2008","type":"network"},{"source":"loderer","target":"lk_muc","label":"19 Jahre Zusammenarbeit","type":"network"},{"source":"loderer","target":"finanzkrise","label":"Verantwortung (19yr)","type":"conflict"},{"source":"schardt","target":"finanzkrise","label":"Kritik: Missmanagement","type":"conflict"},{"source":"matella","target":"finanzkrise","label":"\"Wir sind pleite\"","type":"conflict"},{"source":"loderer","target":"fernwaerme","label":"Eigenes Netz","type":"conflict"},{"source":"schardt","target":"fernwaerme","label":"LK-Verbund","type":"conflict"},{"source":"loderer","target":"klima","label":"Verweigerung","type":"conflict"},{"source":"matella","target":"klima","label":"Forderung: Beitritt","type":"conflict"}]};
const NEWS = [{"title":"Wertstoffhof-Krise: Schardt fordert schnelle Lösung","source":"Münchner Merkur","date":"18.02.2026","body":"Dem Wertstoffhof am Haidgraben droht die Kündigung wegen Überlastung durch Ottobrunn. SPD-Kandidat Schardt fordert in Pressemitteilung eine sofortige Übergangslösung. Zeigt Handlungsfähigkeit noch vor Amtsantritt.","sentiment":"POS","impact":"MITTEL","entities":["schardt"],"url":"https://www.merkur.de/lokales/muenchen-lk/ottobrunn-ort29241/ist-ueberlastet-wegen-ottobrunn-der-wertstoffhof-am-haidgraben-94171629.html"},{"id":"n1","title":"Podiumsdiskussion: 400 Zuhörer erleben scharfe Kritik an Loderer","body":"Schardt und Matella attackieren den Amtsinhaber bei Finanzen, Fernwärme und Nachbarkooperation. Matella: 'Wir sind pleite, isoliert und planlos.' 145 weitere im Livestream.","source":"Süddeutsche Zeitung","date":"11.02.2026","time":"12d","sentiment":-0.4,"entities":["schardt","loderer","matella"],"tags":["Podium","Finanzen","Wahlkampf"],"impact":"400 Zuhörer + 145 Livestream = höchstes politisches Interesse seit Jahren in Ottobrunn."},{"id":"n2","title":"Finanzkrise: Rücklagen schmelzen, Grundschulbau gestoppt","body":"Ottobrunns Rücklagen sinken bis Ende 2026 auf voraussichtlich €1.2M. Der geplante Neubau der Grundschule Friedenstraße wurde gestoppt. Selbst bei der Feuerwehr wird gespart.","source":"Süddeutsche Zeitung","date":"12.01.2026","time":"42d","sentiment":-0.7,"entities":["loderer"],"tags":["Finanzen","Grundschule","Sparprogramm"],"impact":"Stärkster Angriffspunkt auf Loderer: 19 Jahre im Amt → Finanzkrise."},{"id":"n3","title":"AfD tritt erstmals in Ottobrunn an — 6 Gemeinderats-Kandidaten","body":"Mit Spitzenkandidat Brand und 5 weiteren Bewerbern zieht die AfD erstmals in den Ottobrunner Gemeinderatswahlkampf. Brand will die Unterstützung von NGOs streichen.","source":"Münchner Merkur","date":"10.02.2026","time":"13d","sentiment":-0.6,"entities":["afd_ottobrunn"],"tags":["AfD","Erstantritt","Gemeinderat"],"impact":"Symbolisch: München-Land war bisher AfD-freie Zone. Warnsignal für Oberbayern."},{"id":"n4","title":"Wertstoffhof-Krise: Schardt fordert schnelle Lösung","body":"Dem Wertstoffhof am Haidgraben droht die Kündigung. SPD-Kandidat Schardt fordert eine Übergangslösung, um Belastungen für Bürger gering zu halten.","source":"Münchner Merkur","date":"18.02.2026","time":"5d","sentiment":0.2,"entities":["schardt"],"tags":["Wertstoffhof","Kommunalpolitik"],"impact":"Schardt zeigt Handlungsfähigkeit bei konkretem Problem — proaktiv vor Loderer."},{"id":"n5","title":"Klimadebatte: Kandidaten streiten über E-Mobilität und Ladesäulen","body":"Schardt fordert Ladesäulen auf Grünstreifen, Matella will mehr kommunales Engagement. Loderer verweist auf bestehende Fernwärmeleitungen.","source":"Münchner Merkur","date":"17.02.2026","time":"6d","sentiment":0.1,"entities":["schardt","matella","loderer"],"tags":["Klima","E-Mobilität","Ladesäulen"],"impact":"Schardt und Matella proaktiv, Loderer defensiv."}];
const HYPOTHESES = [{"id":"H1","title":"Loderer verliert erstmals <50% — Stichwahl SPD vs. CSU","status":"TESTING","confidence":55,"stColor":"var(--amber)","summary":"Nach 19 Jahren, Finanzkrise und 'Stillstand'-Narrativ könnte Loderer erstmals unter 50% fallen. 2020 hatte er ~60% — aber ohne ernsthafte Herausforderer.","forEvidence":["Finanzkrise: Rücklagen €1.2M, Grundschulbau gestoppt","400 Zuhörer beim Podium = Wechselstimmung","Schardt + Matella attackieren koordiniert","Sentiment Loderer: -15%, Trend fallend"],"againstEvidence":["CSU-Stammwähler in Ottobrunn traditionell stark","Loderer hat 19 Jahre Amtsbonus","SPD bei BM-Wahl 2020: nur 14%"]},{"id":"H2","title":"AfD zieht in Gemeinderat ein (>5%)","status":"TESTING","confidence":42,"stColor":"var(--amber)","summary":"Erstmaliger AfD-Antritt in Ottobrunn. Wenn sie die 5%-Hürde schaffen, ist das ein Warnsignal für ganz Oberbayern.","forEvidence":["AfD LTW Bayern 2023: 14.6%","Bundestrend: AfD wächst auch in Vororten","6 Gemeinderats-Kandidaten aufgestellt"],"againstEvidence":["München-Land ist CSU/Grüne-Hochburg","Ottobrunn: hoher Bildungsstand, urban","Keine bekannten AfD-Strukturen bisher"]},{"id":"H3","title":"Schardt profitiert vom 'Wirtschaft UND Sozial'-USP","status":"TESTING","confidence":65,"stColor":"var(--green)","summary":"Als einziger Kandidat der Wirtschaftskompetenz (IHK-Vize) UND soziale Positionen (SPD) vereint, könnte Schardt Wähler aus beiden Lagern anziehen.","forEvidence":["IHK-Vizepräsident = Wirtschaftsglaubwürdigkeit","SPD = soziale Glaubwürdigkeit","Podium: konstruktiv + konkret (Mr. Fernwärme)","Sentiment: +28%, Trend steigend"],"againstEvidence":["Kein Gemeinderatsmitglied — 'kennt Ottobrunn nicht von innen'","SPD 2020: nur 14%","Landtagswahl 2023: gescheitert"]}];
const SENTIMENT = {"topics":[{"name":"Finanzkrise Ottobrunn","pct":-72,"n":187,"sent":-0.65,"ev":"I","topThemes":["Schulden","Kreisumlage","Gewerbesteuer","Rücklagen","Sparprogramm"],"posts":[{"text":"Schuldenstand könnte bis 2027 von 20 auf über 50 Mio Euro steigen. Loderer warnt auf Bürgerversammlung.","src":"tz München","date":"2024-10-17","sent":-0.8,"cat":"Haushalt"},{"text":"11,2 Mio Euro aus Rücklagen entnommen. Rücklage auf 6,8 Mio geschmolzen.","src":"Hallo München","date":"2025-03-13","sent":-0.7,"cat":"Haushalt"},{"text":"Kredit von 8 Mio Euro aufgenommen um laufende Kosten zu decken. Schuldenstand Kernhaushalt über 31 Mio.","src":"Hallo München","date":"2025-03-13","sent":-0.8,"cat":"Haushalt"},{"text":"Gewerbesteuereinnahmen 2025 nur 15 Mio statt geplanter 17,5 Mio. Kreisumlage steigt auf 21 Mio — Rekord.","src":"Merkur","date":"2025-10-11","sent":-0.7,"cat":"Steuern"},{"text":"Weniger Rücklagen, mehr Schulden: Ottobrunn hofft auf die Wende. Dem Haushalt merkt man die prekäre Situation an.","src":"Merkur","date":"2025-03-12","sent":-0.6,"cat":"Haushalt"},{"text":"Rücklagenvorrat schrumpft: In diesem Jahr müssen rund 12 Mio Euro entnommen werden.","src":"Merkur","date":"2024-03-22","sent":-0.6,"cat":"Haushalt"},{"text":"Hohe Bevölkerungsdichte mit wenig Gewerbefläche = weniger Gewerbeeinnahmen als Nachbarn im LK.","src":"tz München","date":"2024-10-17","sent":-0.5,"cat":"Struktur"},{"text":"SZ: Ottobrunn verwirft wegen fehlender Millionen den Bau einer Grundschule. Und Neuried bringt nicht mal Geld für Dorffest zusammen.","src":"SZ München","date":"2025-11-03","sent":-0.9,"cat":"Kürzungen"},{"text":"Sinkende Steuereinnahmen und gleichzeitig Projekte die viel Geld verschlingen — Ottobrunn ist knapp bei Kasse.","src":"SZ München","date":"2024-03-21","sent":-0.6,"cat":"Haushalt"},{"text":"Sternhaus-Sanierung: 5 Mio im aktuellen Haushalt. Kredite für laufende Ausgaben nötig.","src":"SZ München","date":"2024-03-21","sent":-0.5,"cat":"Investitionen"},{"text":"Steigende Zinsen verschärfen die Lage. Haushaltsjahr 2025 wird Schulden abermals steigen.","src":"Merkur","date":"2025-10-11","sent":-0.7,"cat":"Haushalt"},{"text":"Feuerwehrfahrzeuge werden wegen knapper Finanzlage nicht beschafft. Wechsellader 2025 gestrichen, Löschgruppenfahrzeug 2026 auch.","src":"SZ München","date":"2025-12-21","sent":-0.8,"cat":"Kürzungen"},{"text":"Kommandant Klas: \"Es fällt mir schwer, diese Entscheidung mitzutragen.\" Scharfe Kritik an Gemeinderat.","src":"SZ München","date":"2025-12-21","sent":-0.9,"cat":"Kürzungen"},{"text":"Matella: \"Wir sind pleite, wir sind isoliert von den Nachbargemeinden und wir sind planlos.\"","src":"SZ München (Podium)","date":"2026-02-10","sent":-0.9,"cat":"Wahlkampf"},{"text":"19 Jahre Amtszeit und am Ende steht Ottobrunn vor dem Schuldenberg. Wer trägt die Verantwortung?","src":"Leserbriefe SZ","date":"2026-02-15","sent":-0.8,"cat":"Meinung"}]},{"name":"Fernwärme & Energie","pct":42,"n":98,"sent":0.35,"ev":"I","topThemes":["Geothermie","SWM-Netz","Anschlussquote","Wärmeplan","Loderer-Verdienst"],"posts":[{"text":"15 km Fernwärmeleitungen regenerativ verlegt. Loderer-Verdienst: Partnerschaft mit SWM früh eingefädelt.","src":"CSU Ottobrunn","date":"2023-05-15","sent":0.7,"cat":"Leistung"},{"text":"Stadtwerke München übernehmen Energieversorgung Ottobrunn (EVO). 22.000 Bürger, 280 km Stromnetz, 12 km Fernwärme.","src":"SZ München","date":"2018-08-03","sent":0.3,"cat":"Infrastruktur"},{"text":"Fernwärmenetz Ost und Südost werden mit Münchner Netz zusammengeführt. Geothermie aus Kirchstockach, Dürrnhaar, Sauerlach.","src":"SZ München","date":"2022-12-05","sent":0.5,"cat":"Ausbau"},{"text":"Ortsmitte wird an Fernwärmenetz angeschlossen. Perspektivisch >20% Wärmeversorgung durch Geothermie.","src":"SZ München","date":"2023-02-15","sent":0.6,"cat":"Ausbau"},{"text":"Schardt: Nachbargemeinden haben bessere Fernwärme-Anschlussquoten. Ottobrunn erst bei 10%.","src":"SZ (Podium)","date":"2026-02-10","sent":-0.3,"cat":"Kritik"},{"text":"Loderer: \"Manche Nachbargemeinden hätten ihr Fernwärmenetz ohne Ottobrunn nicht aufbauen können.\"","src":"SZ München","date":"2026-02-10","sent":0.3,"cat":"Leistung"},{"text":"Schardt nennt sich \"Mr. Fernwärme\" — will Anschlussquote verdoppeln durch aktive Kooperation.","src":"SZ München","date":"2026-02-10","sent":0.2,"cat":"Wahlkampf"},{"text":"CSU-Infoveranstaltung: Wie funktioniert Geothermie? Wo werden die nächsten Leitungen verlegt?","src":"CSU Ottobrunn","date":"2023-05-15","sent":0.4,"cat":"Information"},{"text":"SWM: Bis 2040 soll Fernwärme komplett CO2-neutral sein. Ottobrunn ist Teil des Plans.","src":"SWM/SZ","date":"2020-01-29","sent":0.5,"cat":"Vision"},{"text":"10% Wärmedeckung aktuell. Andere im LK deutlich weiter. Warum?","src":"Grüne Ottobrunn","date":"2025-12-01","sent":-0.2,"cat":"Kritik"},{"text":"Carmen e.V.: Klimaschutzbemühungen Ottobrunn wurden durch hohe Auszeichnungen gewürdigt: 2009 Platz 4 bundesweit.","src":"Carmen e.V.","date":"2024-05-01","sent":0.5,"cat":"Leistung"},{"text":"Loderer: \"Von Symbolpolitik halte ich nichts.\" Setzt auf praktische Maßnahmen wie Fernwärme statt Konzepte.","src":"SZ (Podium)","date":"2026-02-10","sent":0,"cat":"Position"},{"text":"Energieversorgung Ottobrunn komplett an SWM übergeben — Chance oder Kontrollverlust?","src":"Merkur","date":"2024-09-27","sent":-0.1,"cat":"Debatte"},{"text":"Wärmeplan der Gemeinde zeigt: Fernwärme hauptsächlich im Süden und Westen. Norden noch schlecht versorgt.","src":"ottobrunn.de","date":"2025-01-15","sent":-0.2,"cat":"Infrastruktur"},{"text":"Matella will Geothermie-Ausbau beschleunigen und Bürger-Genossenschaft gründen.","src":"leonmatella.de","date":"2025-12-10","sent":0.3,"cat":"Wahlkampf"}]},{"name":"Grundschule Friedenstraße","pct":-81,"n":134,"sent":-0.72,"ev":"I","topThemes":["Neubau gestoppt","Keller","Container","Ganztagsbetreuung","Elternprotest"],"posts":[{"text":"Neubau der Grundschule Friedenstraße wegen Finanznot gestoppt. Geplanter Vierzug wird nicht gebaut.","src":"SZ München","date":"2025-10-30","sent":-0.9,"cat":"Entscheidung"},{"text":"Mittagsbetreuung im Keller des Bauteils A. Eltern und Schulleitung empfinden Situation als unbefriedigend.","src":"SZ München","date":"2025-10-30","sent":-0.8,"cat":"Zustand"},{"text":"Gemeinderat stoppt Neubau der Ottobrunner Grundschule. Keller muss weiterhin herhalten.","src":"Merkur","date":"2025-10-31","sent":-0.8,"cat":"Entscheidung"},{"text":"Container statt neuer Schule? Kindertagesbetreuung vor großen Herausforderungen.","src":"tz München","date":"2025-11-11","sent":-0.7,"cat":"Zustand"},{"text":"Loderer: \"Der Keller ist liebevoll hergerichtet.\" Massive Kritik auf Social Media.","src":"SZ (Podium)","date":"2026-02-10","sent":-0.9,"cat":"Zitat"},{"text":"Schardt: \"Das als tolle Mittagsbetreuung hinzustellen ist reichlich übertrieben.\"","src":"SZ (Podium)","date":"2026-02-10","sent":-0.6,"cat":"Reaktion"},{"text":"Schardt schlägt günstige Modulbau-Lösung statt teurem Neubau vor. Pressemitteilung Jan 2026.","src":"SZ München","date":"2026-01-14","sent":0.3,"cat":"Alternative"},{"text":"120 Kinder in der Mittagsbetreuung — 30 davon im Container draußen. Seit 2021 bekannt.","src":"SZ München","date":"2021-02-24","sent":-0.5,"cat":"Zustand"},{"text":"Ab September 2026 gilt Anspruch auf Ganztagsbetreuung. Kann Ottobrunn das ohne Neubau erfüllen?","src":"SZ München","date":"2025-10-30","sent":-0.4,"cat":"Rechtsanspruch"},{"text":"Kinderwelt-Gebäude muss nun nicht abgerissen werden — 50 Hortplätze bleiben erhalten. Teillösung.","src":"SZ München","date":"2025-10-30","sent":0.1,"cat":"Kompromiss"},{"text":"Umbau Grundschule für Ganztagsbetrieb geplant: Pausenhof, Bäume und Schulgarten sollen erhalten bleiben.","src":"Merkur","date":"2023-06-02","sent":0.2,"cat":"Planung"},{"text":"Noch vor 4 Jahren hieß es die Schulkinder fühlten sich im Keller wohl. Das ist zumindest ein Trost.","src":"Merkur","date":"2025-10-31","sent":-0.3,"cat":"Meinung"},{"text":"Elternbeirat: \"Wir fordern sofortige Verbesserung der Räumlichkeiten. Der Keller ist keine Lösung.\"","src":"Elternbrief (lokal)","date":"2025-11-20","sent":-0.9,"cat":"Protest"},{"text":"PhönixBad und Eisstadion werden weiter betrieben — aber Grundschulneubau gestrichen. Prioritäten?","src":"Leserbrief SZ","date":"2025-11-10","sent":-0.8,"cat":"Meinung"},{"text":"SPD fordert Sofortprogramm: Mindestens Modulbau als Übergangslösung. Kosten: geschätzt 2-3 Mio statt 30 Mio Neubau.","src":"SPD Ottobrunn","date":"2026-01-20","sent":0.2,"cat":"Alternative"}]},{"name":"Nachbargemeinden & Kooperation","pct":-55,"n":89,"sent":-0.45,"ev":"I","topThemes":["Klimakonzept","Finsinger Feld","Gallisches Dorf","Unterhaching","Neubiberg"],"posts":[{"text":"Ottobrunn und Sauerlach einzige Gemeinden im LK die NICHT beim Klimaanpassungskonzept mitmachen.","src":"SZ (Podium)","date":"2026-02-10","sent":-0.7,"cat":"Isolation"},{"text":"Matella: \"Der Klimawandel macht nicht Halt vor der Gemeindegrenze.\"","src":"SZ (Podium)","date":"2026-02-10","sent":-0.5,"cat":"Kritik"},{"text":"Körner (Grüner 2. BM Neubiberg): Ottobrunn ist das gallische Dorf im Landkreis — aber im negativen Sinne.","src":"Merkur","date":"2025-12-02","sent":-0.8,"cat":"Fremdbild"},{"text":"Unterhaching und Neubiberg lehnen Finsinger-Feld-Pläne ab: Verkehrsprobleme und Kaufkraftabzug.","src":"tz München","date":"2022-07-15","sent":-0.5,"cat":"Konflikt"},{"text":"Schardt: \"In den letzten Jahren war zu wenig Kooperation und zu viel Konfrontation.\"","src":"SZ München","date":"2025-07-04","sent":-0.4,"cat":"Kritik"},{"text":"Loderer: \"Es wurde viel Geld verschwendet und es ist nichts rausgekommen\" — über LK-Klimakonzept.","src":"SZ (Podium)","date":"2026-02-10","sent":-0.3,"cat":"Position"},{"text":"Loderer hält wenig von Landkreisprojekt. Setzt auf Bäume, Sickergruben, maßvolle Nachverdichtung.","src":"Merkur","date":"2026-02-19","sent":0,"cat":"Position"},{"text":"Matella kündigt Kühleortekarte und Hitzetelefone an. Will sofort beim LK-Konzept einsteigen.","src":"Merkur","date":"2026-02-19","sent":0.3,"cat":"Wahlversprechen"},{"text":"Schardt: \"Ich würde trotzdem mitmachen, es geht ja darum sich zu vernetzen.\" Pragmatischer als Matella.","src":"SZ (Podium)","date":"2026-02-10","sent":0.2,"cat":"Position"},{"text":"Rundherum kooperieren Gemeinden, gestalten, gehen voran. Ottobrunn duckt sich weg.","src":"Merkur (Körner)","date":"2025-12-02","sent":-0.7,"cat":"Fremdbild"},{"text":"Fernwärme-Kooperation mit SWM funktioniert gut. Aber bei allem anderen: Isolation.","src":"SZ München","date":"2022-12-05","sent":-0.2,"cat":"Analyse"},{"text":"Loderer: \"Manche Nachbargemeinden hätten ohne Ottobrunn kein Fernwärmenetz.\" Selektive Kooperation.","src":"SZ (Podium)","date":"2026-02-10","sent":-0.1,"cat":"Selbstbild"},{"text":"Neubiberg: Kooperation bei Schulzweckverband funktioniert. Warum nicht beim Rest?","src":"Merkur","date":"2025-06-15","sent":-0.3,"cat":"Vergleich"},{"text":"Geothermie, Windkraft, Klimaanpassung — in allen drei Bereichen steht Ottobrunn allein.","src":"Merkur (Körner)","date":"2025-12-02","sent":-0.8,"cat":"Isolation"},{"text":"Agenda 21 Ottobrunn-Neubiberg: Interkommunale Zusammenarbeit bei Klimaschutz ist Standard im LK.","src":"VHS/Agenda21","date":"2026-02-11","sent":-0.3,"cat":"Kontext"}]},{"name":"BM-Wahl & Kandidaten","pct":12,"n":245,"sent":0.05,"ev":"I","topThemes":["Podiumsdiskussion","Loderer","Schardt","Matella","Wechselstimmung"],"posts":[{"text":"Podiumsdiskussion Wolf-Ferrari-Haus: 400 Zuhörer + 145 Livestream. Größte Veranstaltung seit Jahren.","src":"SZ München","date":"2026-02-10","sent":0.1,"cat":"Event"},{"text":"Herausforderer attackieren Bürgermeister: Schardt und Matella greifen Loderer frontal an.","src":"SZ München","date":"2026-02-10","sent":-0.2,"cat":"Wahlkampf"},{"text":"SPD-Spitzenmann fordert CSU-Platzhirsch heraus. Schardt: ehemaliger Kreisvorsitzender, IHK-Vize.","src":"SZ München","date":"2025-07-04","sent":0.3,"cat":"Kandidatur"},{"text":"Loderer strebt 4. Amtszeit an. CSU nominiert einstimmig. Fall: \"Zukunftsorientierung und Mut\".","src":"Merkur","date":"2025-10-15","sent":0.2,"cat":"Kandidatur"},{"text":"Grüne nominieren 27-Jährigen Matella. 100% Zustimmung. Rettungssanitäter und Gemeinderat.","src":"SZ München","date":"2025-12-02","sent":0.3,"cat":"Kandidatur"},{"text":"Vier Kandidaten kämpfen um Bürgermeisteramt. Merkur/VHS/Agenda21 veranstalten Podium am 11.02.","src":"Merkur","date":"2026-02-07","sent":0.1,"cat":"Event"},{"text":"Kandidaten diskutieren über Klimaschutz, Ortsentwicklung und E-Mobilität. Zweites Podium.","src":"Merkur","date":"2026-02-19","sent":0.1,"cat":"Event"},{"text":"SZ: Loderer verteidigt Bilanz. \"Unter welchem Stern haben die beiden gelebt? In 19 Jahren viel erreicht.\"","src":"SZ München","date":"2026-02-10","sent":-0.1,"cat":"Verteidigung"},{"text":"Loderer: \"Ich würde zum Pensionsempfänger wenn nicht gewählt. Ich will aber etwas tun für mein Geld.\"","src":"SZ (Podium)","date":"2026-02-10","sent":0,"cat":"Motivation"},{"text":"Schardt: \"Habe lange überlegt. Einige Dinge sind zusammengekommen.\" Einstimmig nominiert.","src":"SZ München","date":"2025-07-04","sent":0.2,"cat":"Kandidatur"},{"text":"Ulmer (Linke): 22 Jahre, Koch, trans Person. Erste Linke-Kandidatur in Ottobrunn. Sagte Podium ab.","src":"SZ München","date":"2025-12-15","sent":0,"cat":"Kandidatur"},{"text":"SZ-Überblick: Alle Bürgermeisterkandidaten im Portrait. Loderer, Schardt, Matella, Ulmer.","src":"SZ München","date":"2026-01-15","sent":0.1,"cat":"Information"},{"text":"Wechselstimmung? 400 Besucher beim Podium deuten auf hohes Interesse. 2020 waren es deutlich weniger.","src":"eigene Analyse","date":"2026-02-12","sent":0.2,"cat":"Analyse"},{"text":"CSU-Team 2026: 30 Kandidaten, 21-70 Jahre, ~40% Frauen. Top 5: Loderer, Seeböck, Thaumüller.","src":"Merkur","date":"2025-10-15","sent":0.1,"cat":"Listen"},{"text":"Kommunalwahlen LK München 2026: SZ richtet eigene Themen-Seite ein. Höchste Aufmerksamkeit seit 2020.","src":"SZ München","date":"2026-02-01","sent":0.2,"cat":"Medien"}]},{"name":"AfD-Antritt & Rechtsruck","pct":-45,"n":67,"sent":-0.4,"ev":"I","topThemes":["Erstmals AfD","Brand","NGO-Streichung","Brandmauer","München-Land Signal"],"posts":[{"text":"AfD Ottobrunn geht mit 6 Kandidaten und klaren Positionen ins Rennen. Erstmals in der Geschichte.","src":"Merkur","date":"2026-02-07","sent":-0.5,"cat":"Antritt"},{"text":"Spitzenkandidat Brand (Mathematiker i.R.) will Unterstützung von NGOs streichen.","src":"Merkur","date":"2026-02-07","sent":-0.6,"cat":"Position"},{"text":"SZ-Analyse: AfD kandidiert in dreimal so vielen Gemeinden wie 2020. Brandmauer von unten wird angegriffen.","src":"SZ München","date":"2026-02-20","sent":-0.7,"cat":"Trend"},{"text":"AfD Bayern als Verdachtsfall vom BfV eingestuft. Ottobrunn-Kandidaten: keine bekannten VS-Fälle.","src":"BfV/Merkur","date":"2024-06-15","sent":-0.3,"cat":"VS-Status"},{"text":"Gerold Otten (AfD-MdB) tritt als Landratskandidat LK München an. Kontext für Ottobrunn-Kandidaten.","src":"SZ München","date":"2026-01-15","sent":-0.4,"cat":"Kontext"},{"text":"Ulmer (Linke): \"Gerade jetzt wo auch die AfD zum ersten Mal für den Gemeinderat antritt\" — Motivation.","src":"SZ München","date":"2025-12-15","sent":-0.2,"cat":"Reaktion"},{"text":"München-Land galt als AfD-freie Zone. Wenn AfD hier GR-Sitze holt = Warnsignal für ganz Oberbayern.","src":"eigene Analyse","date":"2026-02-20","sent":-0.7,"cat":"Einschätzung"},{"text":"Brand: Ablehnung Agenda 2030. Bezahlbarer Wohnraum durch Nachverdichtung. U5-Verlängerung ja.","src":"Merkur","date":"2026-02-07","sent":-0.2,"cat":"Programm"},{"text":"AfD-Gemeinderatsliste: Brand, Budweiser (Friedhofsverwalter), Munz (CNC), von Graeve, Gerstlberger, Garhammer.","src":"Merkur","date":"2026-02-07","sent":0,"cat":"Personal"},{"text":"Kein AfD-Bürgermeisterkandidat in Ottobrunn. Fokus auf Gemeinderatssitze. Taktisch klug.","src":"eigene Analyse","date":"2026-02-12","sent":-0.1,"cat":"Strategie"},{"text":"AfD-GR-Sitze könnten CSU 3-5% kosten aus bürgerlichem Lager. Stichwahl-Treiber.","src":"eigene Analyse","date":"2026-02-15","sent":-0.5,"cat":"Auswirkung"},{"text":"SPD + Grüne haben sich bisher nicht zur AfD-Brandmauer in Ottobrunn positioniert.","src":"eigene Beobachtung","date":"2026-02-18","sent":-0.2,"cat":"Lücke"},{"text":"CSU schweigt zum AfD-Antritt. Keine öffentliche Distanzierung. Kein Thema bei CSU-Nominierung.","src":"Merkur","date":"2025-10-15","sent":-0.3,"cat":"Reaktion"},{"text":"Dachau ist AfD-stärkster Standort im Münchner Umland. Ottobrunn ist Neuland.","src":"SZ München","date":"2026-02-20","sent":-0.3,"cat":"Vergleich"},{"text":"Matella: Will Ottobrunn als \"weltoffene Gemeinde\" positionieren. Implizite Anti-AfD-Strategie.","src":"leonmatella.de","date":"2025-12-10","sent":0.2,"cat":"Reaktion"}]}],"entities":{"schardt":{"sent":28,"trend":"steigend","mentions":98,"topThemes":["Wirtschaft","IHK","Fernwärme","Bürgerbeteiligung"],"delta":8},"loderer":{"sent":-15,"trend":"fallend","mentions":156,"topThemes":["Finanzkrise","Grundschule","Klimaschutz","19 Jahre"],"delta":-6},"matella":{"sent":12,"trend":"steigend","mentions":72,"topThemes":["Klimaschutz","Verkehr","Jugend","Stillstand-Vorwurf"],"delta":5},"ulmer":{"sent":5,"trend":"stabil","mentions":18,"topThemes":["Wohnraum","Queere Rechte","Anti-AfD"],"delta":1},"afd_ottobrunn":{"sent":-45,"trend":"stabil","mentions":38,"topThemes":["Erstantritt","NGO-Streichung","Rechtsruck"],"delta":-2}},"overview":{"gesamt":{"pct":-28,"label":"Gesamt-Stimmung Ottobrunn","n":820,"trend":"fallend seit Okt 2025"},"finanzen":{"pct":-72,"label":"Finanzen & Haushalt","n":321,"trend":"stark negativ, beschleunigend"},"wahlkampf":{"pct":12,"label":"Wahlkampf & Kandidaten","n":312,"trend":"neutral-positiv, mobilisierend"},"klima":{"pct":-45,"label":"Klima & Kooperation","n":156,"trend":"negativ, isolations-narrativ dominant"}}};
const PATTERNS = [{"id":"cp1","label":"19-Jahre-Abnutzung","entities":["loderer"],"severity":"KRITISCH","color":"var(--red)","meaning":"Nach 19 Jahren im Amt häufen sich die Schwachstellen: Finanzkrise, gestoppte Projekte, Klima-Isolation. 'Stillstand'-Narrativ gewinnt an Kraft.","confidence":90,"invalidateIf":"CSU gewinnt trotz AfD-Antritt mit >55% — dann ist der Splitting-Effekt irrelevant.","soWhat":"Schardt und Matella kritisieren beide Loderer, aber nehmen sich gegenseitig Stimmen. Bei Stichwahl jedoch: vereint gegen Loderer.","evidenceTags":[{"type":"E"},{"type":"E"},{"type":"E"},{"type":"J"}],"relatedViews":[{"view":"compare","label":"Vergleichs-Matrix"},{"view":"briefing","label":"Stichwahl-Prognose"}]},{"id":"cp2","label":"Schardt-Matella-Allianz (de facto)","entities":["schardt","matella"],"severity":"CHANCE","color":"var(--green)","meaning":"Beide kritisieren Loderer bei denselben Themen (Finanzen, Nachbar-Kooperation, Klima). Keine gegenseitigen Angriffe. De-facto-Reformlager gegen CSU.","confidence":80,"invalidateIf":"Loderer gewinnt mit >55% trotz Finanzkrise.","soWhat":"Loderers Trend (39%→53%→60%→47%?) zeigt zum ersten Mal nach unten. 3 sichtbare Schwächen: Finanzen, Grundschule, Feuerwehr.","evidenceTags":[{"type":"E"},{"type":"E"},{"type":"I"},{"type":"J"}],"relatedViews":[{"view":"briefing","label":"Risiko-Ranking"}]},{"id":"cp3","label":"AfD-Durchbruch München-Land","entities":["afd_ottobrunn"],"severity":"WARNSIGNAL","color":"var(--amber)","meaning":"Wenn die AfD in einem Münchner Vorort Gemeinderatssitze holt, ist das ein Warnsignal für ganz Oberbayern. Bisher galt LK München als 'AfD-frei'.","confidence":45,"invalidateIf":"AfD bekommt 0 Sitze — München-Land bleibt AfD-frei.","soWhat":"Jede AfD-GR-Stimme kostet CSU 3-5% bei der BM-Wahl. Stichwahl-Treiber Nr. 1.","evidenceTags":[{"type":"E"},{"type":"I"},{"type":"A"}],"relatedViews":[{"view":"compare","label":"Hypothesen"}]},{"id":"cp4","label":"Wirtschaft + Sozial = Schardt-USP","entities":["schardt"],"severity":"STÄRKE","color":"var(--green)","meaning":"IHK-Vizepräsident UND SPD. Unternehmer UND Bürgerbeteiligung. Diese Kombination hat in Ottobrunn kein anderer Kandidat. Loderer hat nur Wirtschaft, Matella hat nur Sozial/Klima.","confidence":75,"invalidateIf":"Schardt gewinnt 1. Wahlgang direkt — dann ist Stichwahl irrelevant.","soWhat":"Bei Stichwahl: Grüne+Linke gehen zu Schardt → Chance 55-60%. Die Stichwahl IST das Ziel.","evidenceTags":[{"type":"E"},{"type":"I"},{"type":"J"}],"relatedViews":[{"view":"briefing","label":"Stichwahl-Band"},{"view":"compare","label":"Prognose"}]}];
const ACTIONS = [{"priority":"DRINGEND","prColor":"var(--red)","title":"Finanzkrise als Hauptnarrativ gegen Loderer nutzen","body":"Die Finanzkrise ist Loderers größte Schwäche nach 19 Jahren. €1.2M Rücklagen, gestoppter Schulbau, Sparen bei der Feuerwehr — das ist emotional und greifbar für jeden Bürger.","evidence":"SZ Podium: 400 Zuhörer. Finanzkrise = Thema Nr.1 (Sentiment -72%). Schardt hat IHK-Netzwerk = Wirtschaftskompetenz gegen CSU.","metrics":[{"val":"-72%","label":"Finanz-Sentiment","link":{"type":"topic","id":0}},{"val":"400","label":"Podiums-Besucher"},{"val":"13d","label":"Bis Wahltag"}],"urgency":"Sofort — 13 Tage","borderColor":"var(--red)"},{"priority":"HOCH","prColor":"var(--amber)","title":"'Mr. Fernwärme' als Marke etablieren","body":"Schardts Fernwärme-Vorschlag beim Podium war konkret und einprägsam. 'Mr. Fernwärme' ist ein Narrativ das hängenbleibt — konkret, lösungsorientiert, im Kontrast zu Loderers Defensivhaltung.","evidence":"Loderer: \"Keller liebevoll hergerichtet\" (SZ). 120 Kinder, 30 in Containern. Neubau gestoppt. Eltern fordern Sofortmaßnahme.","metrics":[{"val":"-81%","label":"Schul-Sentiment","link":{"type":"topic","id":2}},{"val":"120","label":"Kinder betroffen"},{"val":"€2-3M","label":"Modulbau-Kosten"}],"urgency":"Diese Woche","borderColor":"var(--amber)"},{"priority":"HOCH","prColor":"var(--amber)","title":"Matella nicht angreifen — Reformlager stärken","body":"Schardt und Matella bilden ein de-facto-Reformlager gegen Loderer. Gegenseitige Angriffe würden nur Loderer helfen. Im Fall einer Stichwahl braucht Schardt die Grünen-Wähler.","evidence":"Ottobrunn = einzige Nicht-Teilnehmerin LK-Klimakonzept. Körner (Neubiberg): \"Gallisches Dorf.\" Schardt+Matella greifen synchron an.","metrics":[{"val":"-55%","label":"Kooperations-Sent.","link":{"type":"topic","id":3}},{"val":"27/29","label":"LK-Gemeinden dabei"},{"val":"2×","label":"Synchron-Angriffe"}],"urgency":"Laufend","borderColor":"var(--amber)"},{"priority":"MITTEL","prColor":"var(--blue)","title":"AfD-Erstantritt als demokratisches Warnsignal framen","body":"Die AfD tritt erstmals in Ottobrunn an. Das emotionalisiert und mobilisiert. Schardt kann sich als demokratische Stimme positionieren ohne den Fehler zu machen, die AfD größer zu machen als sie ist.","evidence":"AfD erstmals in Ottobrunn (6 GR-Kandidaten). SZ: AfD in 3× so vielen Gemeinden. >5% = Warnsignal für Oberbayern.","metrics":[{"val":"6","label":"AfD-Kandidaten"},{"val":"3-5%","label":"CSU-Kosten","link":{"type":"entity","id":"afd_ottobrunn"}},{"val":"3×","label":"Mehr AfD vs 2020"}],"urgency":"09.03 abends","borderColor":"var(--blue)"}];
const FORECAST = {"wahltermin":"08.03.2026","stichwahl":"22.03.2026","stichwahlWahrscheinlichkeit":null,"stichwahlConf":65,"kandidaten":[{"id":"loderer","name":"Thomas Loderer","partei":"CSU","min":42,"max":52,"zentral":47,"conf":60,"tag":"J"},{"id":"schardt","name":"Florian Schardt","partei":"SPD","min":25,"max":35,"zentral":30,"conf":55,"tag":"J"},{"id":"matella","name":"Leon Matella","partei":"Grüne","min":10,"max":18,"zentral":14,"conf":60,"tag":"J"},{"id":"ulmer","name":"Viwi Ulmer","partei":"Linke","min":1,"max":4,"zentral":2,"conf":80,"tag":"J"},{"id":"afd_ottobrunn","name":"AfD Ottobrunn","partei":"AfD","min":3,"max":8,"zentral":5,"conf":50,"tag":"A"}],"historie":[{"jahr":2007,"wg":1,"loderer":39.9,"gegner":"Eisfeld (SPD) 34,4%, Aulenbach (BVO) 14,3%, Keller (FDP) 11,4%","wb":47.7,"stichwahl":true},{"jahr":2007,"wg":2,"loderer":56.4,"gegner":"Eisfeld (SPD) 43,6%","wb":43.6,"stichwahl":false},{"jahr":2013,"wg":1,"loderer":52.7,"gegner":"Wißmeier-Unverricht (SPD) 33,8%, Lumpe (Grüne) 9,2%, Kunzmann (FDP) 4,3%","wb":46.7,"stichwahl":false},{"jahr":2020,"wg":1,"loderer":59.8,"gegner":"Campbell (Grüne) 26,2%, Athen (SPD) 14,0%","wb":55,"stichwahl":false}],"treiber":{"fuer_stichwahl":["Finanzkrise: Rücklagen €1,2M, Schulden >€50M bis 2027","AfD-Erstantritt kostet CSU 3-5% aus bürgerlichem Lager","Podium Feb 2026: 400+145 Zuhörer = höchste Mobilisierung seit Jahren","Koordinierte Opposition: Schardt + Matella greifen synchron an","19 Jahre Amtsabnutzung: längste Amtszeit eines Ottobrunner BM"],"gegen_stichwahl":["CSU-Stammwähler stark: 40-41% bei GR-Wahlen konsistent","Amtsbonus: +15-20% über CSU-Basiswert","SPD 2020 nur 14% — Schardt muss verdoppeln","Matella + Ulmer + AfD = 4 Gegenkandidaten splitten Anti-Loderer-Stimmen"],"stichwahlSzenario":"Bei Stichwahl Loderer vs Schardt: Grüne+Linke→Schardt. Schardt-Chance dann 55-60%."},"stichwahlRange":{"min":30,"max":55,"label":"Realistisches Szenario"}};
const TALKINGPOINTS = [{"topic":"Finanzkrise","target":"loderer","weakness":"Schulden könnten €50M erreichen — nach 19 Jahren Verantwortung","points":[{"text":"Herr Loderer spricht von verantwortungsvollem Umgang mit Geld. Aber die Zahlen sprechen eine andere Sprache: Die Rücklagen sind auf 1,2 Millionen Euro geschmolzen. Der Schuldenstand könnte bis 2027 auf über 50 Millionen steigen. Das ist keine verantwortungsvolle Finanzpolitik — das ist eine Hypothek für die nächste Generation.","source":"tz München Okt 2024, SZ Okt 2025","ev":"E"},{"text":"Wir mussten 2024 elf Millionen Euro aus den Rücklagen entnehmen, um laufende Kosten zu decken. Nicht für Investitionen — für den laufenden Betrieb. Wenn eine Gemeinde Kredite aufnehmen muss, um den Alltag zu finanzieren, dann ist das ein Alarmsignal.","source":"Hallo München März 2025","ev":"E"},{"text":"Die Gewerbesteuer lag 2025 bei nur 15 Millionen — vier Millionen unter Plan. Gleichzeitig zahlen wir 21 Millionen Kreisumlage. Da muss man ehrlich sein: Ottobrunn hat ein strukturelles Problem, nicht nur eine vorübergehende Delle.","source":"Merkur Okt 2025","ev":"E"}],"context":"Nutzen bei: Podiumsdiskussionen, Bürgerversammlungen, Pressegesprächen. Immer mit Quelle."},{"topic":"Grundschule Friedenstraße","target":"loderer","weakness":"Kinder in Kellern und Containern — Neubau gestoppt","points":[{"text":"120 Kinder werden in der Mittagsbetreuung betreut. 30 davon sitzen in einem veralteten Container im Schulhof. Die anderen im Keller. Der Bürgermeister sagt dazu: Der Keller ist liebevoll hergerichtet. Ich sage: Unsere Kinder verdienen mehr als einen liebevoll hergerichteten Keller.","source":"SZ München Feb 2026, Okt 2025","ev":"E"},{"text":"Ab September 2026 haben alle Grundschulkinder einen Rechtsanspruch auf Ganztagsbetreuung. Ottobrunn hat den Schulneubau gestoppt. Wie soll das funktionieren? Ich schlage eine Modulbau-Lösung vor — 2 bis 3 Millionen statt 30 Millionen, und die Kinder haben vernünftige Räume.","source":"SZ Jan 2026","ev":"E"},{"text":"PhönixBad mit Sauna und Wellness wird weiter betrieben. Aber der Grundschulneubau wird gestrichen. Das sind die Prioritäten der letzten 19 Jahre.","source":"SZ Okt 2025, Leserbrief SZ Nov 2025","ev":"E/J"}],"context":"Emotionalster Angriffspunkt. Funktioniert besonders bei Eltern. Modulbau-Vorschlag zeigt Lösungskompetenz."},{"topic":"Isolation von Nachbargemeinden","target":"loderer","weakness":"Einzige Gemeinde ohne Klimakonzept — Gallisches Dorf","points":[{"text":"27 von 29 Gemeinden im Landkreis München machen beim Klimaanpassungskonzept mit. Ottobrunn nicht. Der zweite Bürgermeister von Neubiberg nennt uns das gallische Dorf im Landkreis — aber im negativen Sinne. Das muss sich ändern.","source":"Merkur Dez 2025, SZ Feb 2026","ev":"E"},{"text":"Ich würde am ersten Tag im Amt den Landkreis anrufen und sagen: Wir sind dabei. Beim Klimakonzept, bei der Kooperation, bei der Vernetzung. Die Herausforderungen sind zu groß für Alleingänge.","source":"Eigene Position","ev":"J"},{"text":"Herr Loderer sagt, beim Klimakonzept sei viel Geld verschwendet worden. Aber 27 Gemeinden sehen das anders. Vielleicht ist nicht das Konzept das Problem — sondern die Verweigerung.","source":"SZ Podium Feb 2026","ev":"E"}],"context":"Kombinierbar mit Kooperations-Narrativ. Zeigt: Schardt = Teamplayer, Loderer = Einzelgänger."},{"topic":"Feuerwehr","target":"loderer","weakness":"Selbst bei der Feuerwehr wird gespart — Kommandant kritisiert","points":[{"text":"Feuerwehrkommandant Klas sagt: Es fällt mir schwer, diese Entscheidung mitzutragen. Wenn der Kommandant der eigenen Feuerwehr öffentlich kritisiert, dann stimmt etwas Grundlegendes nicht.","source":"SZ Dez 2025","ev":"E"},{"text":"Ein Wechsellader und ein Löschgruppenfahrzeug — gestrichen. Die Sicherheit unserer Gemeinde darf nicht dem Sparkurs zum Opfer fallen.","source":"SZ Dez 2025","ev":"E"}],"context":"Starkes Argument für ältere Wähler und Ehrenamtliche. Feuerwehr = emotionales Thema."},{"topic":"Widersprüche","target":"loderer","weakness":"Was er sagt vs. was er tut — dokumentiert","points":[{"text":"Auf seiner Wahlkampf-Website schreibt Herr Loderer: Verantwortungsvoller Umgang mit Finanzmitteln. Auf der Bürgerversammlung sagt er selbst: Schulden könnten auf 50 Millionen steigen. Das passt nicht zusammen.","source":"thomas-loderer.de + tz Okt 2024","ev":"E"},{"text":"2019 sagte er der SZ: Ich sprühe vor Ideen. Strategischer Weitblick. 2026 ist die Bilanz: Finanzkrise, gestoppter Schulbau, Klimaisolation. Die Frage ist nicht ob er damals gelogen hat — sondern was aus den Ideen wurde.","source":"SZ Aug 2019 + SZ Feb 2026","ev":"E"}],"context":"Stärkste Argumentation: Nicht Meinung, sondern seine EIGENEN Worte gegen seine Bilanz. Schwer zu kontern."}];
const SCENARIOS = [{"name":"Basis-Szenario","desc":"CSU-Stammwähler halten, moderate Mobilisierung","label":"likely","results":{"loderer":47,"schardt":30,"matella":14,"ulmer":2,"afd":5,"stichwahl":45}},{"name":"Stichwahl-Szenario","desc":"AfD stark + hohe Mobilisierung = Loderer unter 50%","label":"best","results":{"loderer":43,"schardt":32,"matella":15,"ulmer":2,"afd":7,"stichwahl":70}},{"name":"Loderer-Sieg","desc":"Niedrige Beteiligung, AfD schwach, CSU-Basis mobilisiert","label":"worst","results":{"loderer":53,"schardt":26,"matella":13,"ulmer":2,"afd":3,"stichwahl":15}},{"name":"Stichwahl → Schardt gewinnt","desc":"Grüne+Linke gehen geschlossen zu Schardt (22.03.2026)","label":"stichwahl_win","results":{"loderer":44,"schardt":56,"stichwahl":0},"note":"Grüne-Wähler (14%) + Linke (2%) → ~85% Transfer zu Schardt."}];
const WEEKLYBRIEF = {"week":"24.02 – 01.03.2026","daysToElection":12,"headline":"Letzte volle Woche vor der Wahl. Mobilisierung entscheidet.","priorities":[{"nr":1,"action":"Modulbau-Vorschlag als Pressemitteilung finalisieren","why":"Grundschul-Thema hat -81% Sentiment. Ihr Vorschlag (SZ Jan 2026) wurde positiv aufgenommen. Jetzt nachlegen.","deadline":"Mo/Di","ev":"J"},{"nr":2,"action":"SPD-Kreistag-Netzwerk für Wahlkampf-Endspurt aktivieren","why":"IHK + Kreistag = Ihr Alleinstellungsmerkmal. Wirtschaftskompetenz glaubwürdig machen. Persönliche Anrufe > Social Media.","deadline":"Diese Woche","ev":"J"},{"nr":3,"action":"Wahlbeteiligung in SPD-schwachen Vierteln steigern","why":"+5% Wahlbeteiligung = ca. -3% für CSU-Basis-Vorteil. Haustür-Wahlkampf in Ottobrunn-Süd.","deadline":"Sa/So","ev":"I"}],"watchItems":["AfD-Wahlkampf beobachten — GR-Kandidaten aktiv, kein BM-Kandidat","Weitere Podiumsdiskussionen? Merkur/VHS hatte zweites Podium am 19.02.","Feuerwehr-Thema: Kommandant Klas als potenzieller Unterstützer?"]};

// =====================================================
// STATE
// =====================================================
let currentView = 'briefing';
let currentEntity = Object.keys(KB)[0];
let graphInitialized = false;

// =====================================================
// INITIALIZATION
// =====================================================
document.addEventListener('DOMContentLoaded', () => {
  document.getElementById('topbar-tenant').textContent = TENANT.name;
  document.title = TENANT.name;
  buildOntology();
  buildIntelFeed();
  buildPatterns();
  buildChat();
  buildStatusBar();
  renderBriefing();
});

// =====================================================
// TAB SWITCHING
// =====================================================
function showOrgDetail(partyName) {
  // Find all entities in this party and show first one, or show a detail overlay
  var members = [];
  for (var k in KB) { if ((KB[k].party||'') === partyName) members.push(k); }
  if (members.length === 1) { showEntity(members[0]); return; }
  // Multiple members: show detail with list
  var h = '<div style="position:relative;max-width:500px">';
  h += '<div class="detail-close" onclick="closeDetail()">✕</div>';
  h += '<div class="detail-title" style="margin-top:8px">'+partyName+'</div>';
  h += '<div style="font:400 7pt var(--f);color:var(--muted);margin-bottom:12px">'+members.length+' Akteure in dieser Organisation</div>';
  for (var i=0;i<members.length;i++) {
    var e = KB[members[i]];
    var rc = e.risk>40?'var(--red)':e.risk>25?'var(--amber)':'var(--green)';
    h += '<div style="display:flex;align-items:center;gap:8px;padding:8px 0;border-bottom:1px solid var(--border);cursor:pointer" onclick="closeDetail();showEntity(\''+members[i]+'\')">';
    h += '<div style="width:8px;height:8px;border-radius:50%;background:'+e.color+'"></div>';
    h += '<div style="flex:1"><div style="font:600 8pt var(--f);color:var(--text)">'+e.name+'</div>';
    h += '<div style="font:400 6pt var(--f);color:var(--muted)">'+e.role+'</div></div>';
    h += '<div style="font:600 7pt var(--m);color:'+rc+'">Risk: '+e.risk+'</div>';
    h += '</div>';
  }
  h += '</div>';
  var overlay = document.getElementById('detail-overlay');
  overlay.querySelector('.detail-card').innerHTML = h;
  overlay.classList.add('open');
}

function showNewsDetail(idx) {
  var n = NEWS[idx]; if(!n) return;
  var nSentColor = n.sentiment==='NEG'?'var(--red)':n.sentiment==='POS'?'var(--green)':n.sentiment==='MIX'?'var(--amber)':'var(--muted)';
  var h = '<div style="position:relative;max-width:560px">';
  h += '<div class="detail-close" onclick="closeDetail()">✕</div>';
  h += '<div style="font:500 6pt var(--m);color:var(--muted);margin-bottom:4px">'+n.source+' · '+n.date+'</div>';
  h += '<div class="detail-title">'+n.title+'</div>';
  if (n.sentiment) h += '<span style="font:600 6pt var(--m);padding:2px 6px;border-radius:2px;background:'+nSentColor+'15;color:'+nSentColor+'">'+n.sentiment+'</span> ';
  if (n.impact) h += '<span style="font:500 6pt var(--m);color:var(--muted)">Impact: '+n.impact+'</span>';
  h += '<div class="detail-body" style="margin-top:10px"><span class="ev ev-e">E</span> '+n.body+'</div>';
  // Related entities
  if (n.entities && n.entities.length) {
    h += '<div style="margin-top:10px;display:flex;gap:4px;flex-wrap:wrap">';
    for (var i=0;i<n.entities.length;i++) {
      var ne = KB[n.entities[i]];
      if (ne) h += '<span class="related-pill" onclick="closeDetail();showEntity(\''+n.entities[i]+'\')">'+ne.name+'</span>';
    }
    h += '</div>';
  }
  if (n.url) h += '<div style="margin-top:10px"><a href="'+n.url+'" target="_blank" style="font:500 6.5pt var(--m);color:var(--accent);text-decoration:underline">Quelle öffnen →</a></div>';
  h += '</div>';
  var overlay = document.getElementById('detail-overlay');
  overlay.querySelector('.detail-card').innerHTML = h;
  overlay.classList.add('open');
}

function renderTimelineSlider(entityId, events) {
  if (!events || !events.length) return '';
  var years = events.map(function(ev){return parseInt(ev.year||ev.zeitraum)||2026});
  var minY = Math.min.apply(null,years);
  var maxY = Math.max.apply(null,years.concat([2026]));
  var range = maxY - minY || 1;
  var h = '<div class="tl-wrap">';
  h += '<div class="tl-title">Timeline · ' + minY + '–' + maxY + '</div>';
  h += '<div class="tl-track"><div class="tl-line"></div><div class="tl-events">';
  for (var i=0;i<events.length;i++) {
    var ev = events[i];
    var yr = parseInt(ev.year||ev.zeitraum)||2026;
    var pct = ((yr-minY)/range*92+4);
    var ec = ev.color==='red'?'var(--red)':ev.color==='blue'?'var(--blue)':ev.color==='orange'?'var(--amber)':ev.color==='green'?'var(--green)':'var(--muted)';
    h += '<div class="tl-ev" style="left:'+pct+'%" onclick="showTlDetail(\''+entityId+'\','+i+')">';
    h += '<div class="tl-year">'+yr+'</div>';
    h += '<div class="tl-dot" style="background:'+ec+'"></div>';
    h += '<div class="tl-label">'+(ev.label||ev.titel||'').split(' ')[0]+'</div>';
    h += '</div>';
  }
  h += '</div></div>';
  h += '<div class="tl-range"><span>'+minY+'</span><span>'+maxY+'</span></div>';
  h += '<div class="tl-detail" id="tl-detail-'+entityId+'"></div>';
  h += '</div>';
  return h;
}
function showTlDetail(entityId, idx) {
  var e = KB[entityId]; if(!e) return;
  var tl = e.timeline || e.karriere || [];
  var ev = tl[idx]; if(!ev) return;
  var el = document.getElementById('tl-detail-'+entityId); if(!el) return;
  var ec = (ev.color==='red')?'var(--red)':(ev.color==='orange')?'var(--amber)':'var(--text2)';
  el.innerHTML = '<strong style="color:'+ec+'">'+(ev.year||ev.zeitraum||'')+': '+(ev.label||ev.titel||'')+'</strong>'+(ev.beschreibung?'<br><span style="color:var(--muted)">'+ev.beschreibung+'</span>':'');
  el.className = 'tl-detail open';
}
var _watchlist = [];
var _annotations = {};
function exportEntity(id) {
  var e = KB[id]; if (!e) return;
  toast('Export wird vorbereitet: ' + e.name + ' — ' + (e.quellen||[]).length + ' Quellen, ' + (e.controversies||[]).length + ' Kontroversen');
  setTimeout(function(){ toast('PDF-Export: In der Vollversion verfügbar. Kontaktieren Sie uns.'); }, 1500);
}
function watchEntity(id) {
  var idx = _watchlist.indexOf(id);
  if (idx >= 0) { _watchlist.splice(idx,1); toast(KB[id].name + ' von Watchlist entfernt'); }
  else { _watchlist.push(id); toast(KB[id].name + ' auf Watchlist — Sie werden bei Änderungen benachrichtigt'); }
  var btn = document.getElementById('watch-btn-'+id);
  if (btn) btn.textContent = _watchlist.indexOf(id)>=0 ? '★ Watchlist' : '☆ Watchlist';
}
function annotateEntity(id) {
  var note = prompt('Notiz zu ' + KB[id].name + ':', _annotations[id] || '');
  if (note !== null) { _annotations[id] = note; toast('Notiz gespeichert: "' + note.substring(0,40) + (note.length>40?'...':'') + '"'); }
}
function shareEntity(id) {
  var url = window.location.href.split('#')[0] + '#entity-' + id;
  if (navigator.clipboard) { navigator.clipboard.writeText(url); toast('Link kopiert: ' + KB[id].name); }
  else toast('Link: ' + url);
}
function bookmarkAction(idx, btn) {
  if (!btn) return;
  if (btn.classList.contains('active')) { btn.classList.remove('active'); btn.textContent='○ Vormerken'; toast('Aktion entfernt'); }
  else { btn.classList.add('active'); btn.textContent='● Vorgemerkt'; toast('Aktion vorgemerkt — erscheint in Ihrem Wochenbericht'); }
}
function exportAction(idx) {
  var a = ACTIONS[idx]; if(!a) return;
  toast('Export: "'+a.title+'" — In Vollversion als PDF/Email verfügbar');
}
function shareAction(idx) {
  var a = ACTIONS[idx]; if(!a) return;
  if (navigator.clipboard) { navigator.clipboard.writeText(a.title+': '+a.body); toast('Aktion in Zwischenablage kopiert'); }
  else toast('Teilen: '+a.title);
}
function toast(msg) {
  var t = document.createElement('div');
  t.style.cssText = 'position:fixed;bottom:20px;left:50%;transform:translateX(-50%);background:var(--text);color:var(--bg);padding:8px 16px;border-radius:4px;font:500 7pt var(--f);z-index:9999;opacity:0;transition:opacity .3s';
  t.textContent = msg;
  document.body.appendChild(t);
  setTimeout(function(){t.style.opacity='1'},10);
  setTimeout(function(){t.style.opacity='0';setTimeout(function(){t.remove()},300)},3000);
}
function toggleTP(idx) {
  var el = document.getElementById('tp-detail-'+idx);
  var arrow = document.getElementById('tp-arrow-'+idx);
  if (!el) return;
  if (el.style.display==='none') {el.style.display='block';if(arrow)arrow.style.transform='rotate(180deg)';}
  else {el.style.display='none';if(arrow)arrow.style.transform='rotate(0deg)';}
}
function copyTP(btn) {
  var text = btn.getAttribute('data-text');
  if (navigator.clipboard) {navigator.clipboard.writeText(text);toast('Talking Point kopiert');}
  else toast('Kopieren nicht verfügbar');
}
function toggleTopic(idx) {
  var el = document.getElementById('topic-detail-'+idx);
  var arrow = document.getElementById('topic-arrow-'+idx);
  if (!el) return;
  if (el.style.display === 'none') { el.style.display='block'; if(arrow) arrow.style.transform='rotate(180deg)'; }
  else { el.style.display='none'; if(arrow) arrow.style.transform='rotate(0deg)'; }
}
function sortTopic(idx, by) {
  var t = SENTIMENT.topics[idx];
  if (!t || !t.posts) return;
  var posts = t.posts.slice();
  if (by==='date') posts.sort(function(a,b){return (b.date||'').localeCompare(a.date||'')});
  if (by==='sentiment') posts.sort(function(a,b){return (a.sent||0)-(b.sent||0)});
  if (by==='source') posts.sort(function(a,b){return (a.src||'').localeCompare(b.src||'')});
  var h = '';
  for (var pi=0;pi<posts.length;pi++) {
    var p=posts[pi];
    var pc=(p.sent||0)>0.3?'var(--green)':(p.sent||0)<-0.5?'var(--red)':(p.sent||0)<-0.2?'var(--amber)':'var(--muted)';
    var pl=(p.sent||0)>0.3?'POS':(p.sent||0)<-0.5?'NEG':(p.sent||0)<-0.2?'MIX':'NEU';
    h+='<div style="padding:6px 0;border-bottom:1px solid var(--border)">';
    h+='<div style="display:flex;align-items:flex-start;gap:6px">';
    h+='<span style="font:400 5.5pt var(--m);color:var(--muted);min-width:16px">'+(pi+1)+'.</span>';
    h+='<div style="flex:1">';
    h+='<div style="font:400 7pt var(--f);color:var(--text);line-height:1.4">"'+p.text+'"</div>';
    h+='<div style="display:flex;gap:8px;margin-top:3px;font:400 5.5pt var(--m);color:var(--muted)">';
    h+='<span style="color:'+pc+';font-weight:600">'+pl+'</span>';
    h+='<span>'+p.src+'</span><span>'+(p.date||'')+'</span>';
    if(p.cat)h+='<span style="padding:1px 4px;background:var(--surface2);border-radius:2px">'+p.cat+'</span>';
    h+='</div></div></div></div>';
  }
  document.getElementById('topic-posts-'+idx).innerHTML=h;
}
function switchView(view) {
  currentView = view;
  document.querySelectorAll('.tab').forEach(t => t.classList.toggle('active', t.dataset.view === view));
  var views = ['briefing','entity','graph','compare','strategy','analytics'];
  views.forEach(function(v) {
    var el = document.getElementById(v + '-view');
    if (el) el.style.display = (v === view) ? (v === 'graph' ? 'block' : '') : 'none';
  });
  if (view === 'briefing') renderBriefing();
  if (view === 'entity') showEntity(currentEntity);
  if (view === 'graph' && !graphInitialized) { renderGraph(); graphInitialized = true; }
  if (view === 'compare') renderCompare();
  if (view === 'strategy') renderStrategy();
  if (view === 'analytics') renderAnalytics();
}

// =====================================================
// LEFT SIDEBAR: Ontology (100% from KB)
// =====================================================
function buildOntology() {
  const el = document.getElementById('ontology-content');
  const keys = Object.keys(KB);
  let html = '<div class="ont-group">';
  html += '<div class="ont-group-title"><span style="color:var(--text2)">&#9679;</span> PERSONEN <span class="ont-count">' + keys.length + '</span></div>';
  for (const k of keys) {
    const e = KB[k];
    html += '<div class="ont-item' + (k === currentEntity ? ' active' : '') + '" data-entity="' + k + '" onclick="showEntity(\'' + k + '\',this)">';
    html += '<div class="ont-dot" style="background:' + e.color + '"></div>';
    html += '<span class="ont-label">' + e.name + '</span>';
    html += '<span class="ont-badge" style="background:' + e.color + '15;color:' + e.color + '">' + (e.party || '') + '</span>';
    html += '</div>';
  }
  html += '</div>';

  // Organizations — click filters to entities of that party
  var parties = {};
  for (var pk in KB) { var pp = KB[pk].party||''; if (pp && !parties[pp]) parties[pp] = []; if (pp) parties[pp].push(pk); }
  var partyKeys = Object.keys(parties);
  html += '<div class="ont-group"><div class="ont-group-title"><span style="color:var(--text2)">&#9679;</span> ORGANISATIONEN <span class="ont-count">' + partyKeys.length + '</span></div>';
  for (var oi2=0; oi2<partyKeys.length; oi2++) {
    var pname = partyKeys[oi2];
    var pMembers = parties[pname];
    var pColor = pMembers.length > 0 ? KB[pMembers[0]].color : 'var(--muted)';
    html += '<div class="ont-item" style="cursor:pointer" onclick="showOrgDetail(\''+pname.replace(/'/g,"\\'")+'\')">';
    html += '<div class="ont-dot" style="background:'+pColor+'"></div>';
    html += '<span class="ont-label">'+pname+'</span>';
    html += '<span class="ont-badge" style="background:var(--surface2);color:var(--muted)">'+pMembers.length+'</span>';
    html += '</div>';
  }
  html += '</div>';

  // Events from NEWS — click opens detail overlay
  html += '<div class="ont-group"><div class="ont-group-title"><span style="color:var(--text2)">&#9679;</span> EVENTS <span class="ont-count">' + NEWS.length + '</span></div>';
  for (var ni2=0; ni2<NEWS.length; ni2++) {
    var n = NEWS[ni2];
    var nColor = n.sentiment==='NEG'?'var(--red)':n.sentiment==='POS'?'var(--green)':n.sentiment==='MIX'?'var(--amber)':'var(--muted)';
    html += '<div class="ont-item" style="cursor:pointer" onclick="showNewsDetail('+ni2+')">';
    html += '<div class="ont-dot" style="background:'+nColor+'"></div>';
    html += '<span class="ont-label">' + n.title.substring(0, 35) + '...</span></div>';
  }
  html += '</div>';

  // Themes from SENTIMENT topics — click opens topic drill-down
  if (SENTIMENT.topics && SENTIMENT.topics.length) {
    html += '<div class="ont-group"><div class="ont-group-title"><span style="color:var(--text2)">&#9679;</span> THEMEN <span class="ont-count">' + SENTIMENT.topics.length + '</span></div>';
    for (var sti=0; sti<SENTIMENT.topics.length; sti++) {
      var st = SENTIMENT.topics[sti];
      var stColor = (st.pct||0) < -50 ? 'var(--red)' : (st.pct||0) < 0 ? 'var(--amber)' : 'var(--green)';
      html += '<div class="ont-item" style="cursor:pointer" onclick="switchView(\'strategy\');setTimeout(function(){toggleTopic('+sti+')},100)">';
      html += '<div class="ont-dot" style="background:'+stColor+'"></div>';
      html += '<span class="ont-label">'+st.name+'</span>';
      html += '<span class="ont-badge" style="background:'+stColor+'15;color:'+stColor+'">'+(st.pct||0)+'%</span>';
      html += '</div>';
    }
    html += '</div>';
  }

  // Hypotheses — click goes to compare tab
  if (HYPOTHESES.length) {
    html += '<div class="ont-group"><div class="ont-group-title"><span style="color:var(--text2)">&#9679;</span> HYPOTHESEN <span class="ont-count">' + HYPOTHESES.length + '</span></div>';
    for (var hi=0; hi<HYPOTHESES.length; hi++) {
      var hyp = HYPOTHESES[hi];
      var hConf = hyp.confidence || 50;
      var hColor = hConf > 70 ? 'var(--green)' : hConf > 40 ? 'var(--amber)' : 'var(--red)';
      html += '<div class="ont-item" style="cursor:pointer" onclick="switchView(\'compare\')">';
      html += '<div class="ont-dot" style="background:'+hColor+'"></div>';
      html += '<span class="ont-label">'+(hyp.title||hyp.label||'').substring(0,35)+'</span>';
      html += '<span class="ont-badge" style="background:'+hColor+'15;color:'+hColor+'">'+hConf+'%</span>';
      html += '</div>';
    }
    html += '</div>';
  }

  // Jurisdiction — click goes to briefing
  html += '<div class="ont-group"><div class="ont-group-title"><span style="color:var(--text2)">&#9679;</span> JURISDIKTIONEN <span class="ont-count">1</span></div>';
  html += '<div class="ont-item" style="cursor:pointer" onclick="switchView(\'briefing\')">';
  html += '<div class="ont-dot" style="background:var(--blue)"></div>';
  html += '<span class="ont-label">' + TENANT.landkreis + '</span>';
  html += '<span class="ont-badge" style="background:var(--blue-bg);color:var(--blue)">'+Object.keys(KB).length+' Entities</span>';
  html += '</div></div>';

  el.innerHTML = html;
}

// =====================================================
// RIGHT SIDEBAR: Intel Feed + Patterns
// =====================================================
function buildIntelFeed() {
  const el = document.getElementById('intel-feed');
  let html = '';
  for (var fi=0; fi<NEWS.length; fi++) {
    var n = NEWS[fi];
    var cls = n.sentiment==='NEG' ? 'feed-alert' : '';
    html += '<div class="feed-item ' + cls + '" onclick="showNewsDetail('+fi+')" style="cursor:pointer">';
    html += '<div class="feed-source">' + n.source + ' · ' + n.date + '</div>';
    html += '<div class="feed-title">' + n.title + '</div>';
    html += '<div class="feed-body">' + (n.body || '').substring(0, 100) + '...</div>';
    html += '</div>';
  }
  el.innerHTML = html;
}

function buildPatterns() {
  const el = document.getElementById('detected-patterns');
  let html = '';
  for (const p of PATTERNS) {
    html += '<div class="pattern clickable" onclick="switchView(\'strategy\')">';
    html += '<div class="pattern-title">' + p.label + '</div>';
    html += '<div class="pattern-body">' + p.meaning.substring(0, 150) + (p.meaning.length > 150 ? '...' : '') + '</div>';
    html += '<div class="pattern-conf">' + (p.confidence || 50) + '%</div>';
    html += '</div>';
  }
  el.innerHTML = html;
}

// =====================================================
// TAB: BRIEFING
// =====================================================
function renderBriefing() {
  const el = document.getElementById('briefing-view');
  const keys = Object.keys(KB);
  const topRisk = keys.sort((a, b) => KB[b].risk - KB[a].risk).slice(0, 3);
  const lastName = USER.name.split(' ').pop();

  let h = '';
  // E/I/J/A Legend
  h += '<div class="ev-legend"><span><span class="ev ev-e">E</span> Belegt</span><span><span class="ev ev-i">I</span> Abgeleitet</span><span><span class="ev ev-j">J</span> Einschätzung</span><span><span class="ev ev-a">A</span> Annahme</span></div>';
  h += '<div class="briefing-hero">';
  h += '<div class="briefing-greeting">Guten Tag, <strong>Herr ' + lastName + '</strong></div>';
  h += '<div class="briefing-subtitle"><span class="ev ev-e">E</span> ' + keys.length + ' Dossiers analysiert · ' + NEWS.length + ' aktuelle Meldungen · ' + HYPOTHESES.length + ' aktive Hypothesen</div>';
  h += '</div>';

  // KPI Row
  var totalQuellen = 0, totalKontroversen = 0, totalConnections = 0;
  for (var kk in KB) {
    totalQuellen += (KB[kk].quellen || []).length;
    totalKontroversen += (KB[kk].controversies || []).length + (KB[kk].contradictions || []).length;
    totalConnections += (KB[kk].connections || []).length;
  }
  totalConnections += (GRAPH.links || []).length;
  h += '<div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(100px,1fr));gap:8px;margin-bottom:16px">';
  var kpis = [
    {val:keys.length, label:'Dossiers', delta:'Aktuell', color:'var(--text)', click:"switchView('entity')"},
    {val:totalQuellen, label:'Quellen', delta:'verifiziert', color:'var(--text)', click:""},
    {val:(GRAPH.nodes||[]).length, label:'Akteure', delta:(GRAPH.links||[]).length+' Verbindungen', color:'var(--text)', click:"switchView('graph')"},
    {val:totalKontroversen, label:'Kontroversen', delta:(function(){var s=0;for(var x in KB)s+=(KB[x].contradictions||[]).length;return s})() + ' Widersprüche', color:'var(--red)', click:"switchView('compare')"},
    {val:HYPOTHESES.length, label:'Hypothesen', delta:'aktiv', color:'var(--accent)', click:"switchView('compare')"},
    {val:ACTIONS.length, label:'Aktionen', delta:'empfohlen', color:'var(--green)', click:"switchView('strategy')"}
  ];
  for (var ki=0; ki<kpis.length; ki++) {
    var kp = kpis[ki];
    h += '<div style="background:var(--surface);border:1px solid var(--border);border-radius:4px;padding:10px 12px;cursor:pointer;transition:border-color .15s" onclick="' + kp.click + '" onmouseover="this.style.borderColor=\'var(--accent)\'" onmouseout="this.style.borderColor=\'var(--border)\'">';
    h += '<div style="font:700 18pt var(--m);color:' + kp.color + '">' + kp.val + '</div>';
    h += '<div style="font:500 6.5pt var(--m);color:var(--muted);text-transform:uppercase;letter-spacing:.06em">' + kp.label + '</div>';
    h += '<div style="font:400 5.5pt var(--m);color:var(--muted);margin-top:2px">' + kp.delta + '</div>';
    h += '</div>';
  }
  h += '</div>';

  // Active Alerts
  if (TENANT.alerts && TENANT.alerts.length) {
    h += '<div class="canvas-title">Aktive Alerts <span class="ct-badge" style="background:var(--red)">' + TENANT.alerts.length + '</span></div>';
    for (var ai=0; ai<TENANT.alerts.length; ai++) {
      var al = TENANT.alerts[ai];
      var alColor = al.priority === 'KRITISCH' ? 'var(--red)' : al.priority === 'HOCH' ? 'var(--amber)' : 'var(--muted)';
      h += '<div style="display:flex;align-items:center;gap:10px;padding:8px 12px;background:var(--surface);border:1px solid var(--border);border-left:3px solid ' + alColor + ';border-radius:4px;margin-bottom:6px;cursor:pointer;transition:border-color .15s" onmouseover="this.style.borderColor=\'' + alColor + '\'" onmouseout="this.style.borderColor=\'var(--border)\'"';
      if (al.entity) h += ' onclick="showEntity(\'' + al.entity + '\')"';
      h += '>';
      h += '<div style="font:700 8pt var(--f);color:' + alColor + ';flex-shrink:0">●</div>';
      h += '<div style="flex:1"><div style="font:600 7.5pt var(--f);color:var(--text)">' + al.title + '</div>';
      h += '<div style="font:400 5.5pt var(--m);color:var(--muted)">' + al.meta + '</div></div>';
      h += '<div style="font:400 8pt var(--f);color:var(--accent)">→</div>';
      h += '</div>';
    }
  }

  // Weekly Brief mini (in Briefing)
  if (WEEKLYBRIEF) {
    h += '<div style="background:var(--surface);border:1px solid var(--border);border-left:3px solid var(--accent);border-radius:6px;padding:12px;margin-bottom:12px">';
    h += '<div style="display:flex;justify-content:space-between;align-items:center">';
    h += '<div style="font:600 8pt var(--f);color:var(--text)">Diese Woche: '+WEEKLYBRIEF.priorities.length+' Priorit\u00e4ten</div>';
    h += '<div style="font:700 9pt var(--m);color:var(--red)">'+WEEKLYBRIEF.daysToElection+' Tage bis Wahl</div>';
    h += '</div>';
    for (var bwi=0;bwi<WEEKLYBRIEF.priorities.length;bwi++) {
      var bwp = WEEKLYBRIEF.priorities[bwi];
      h += '<div style="font:400 6.5pt var(--f);color:var(--text2);margin-top:4px"><strong style="color:var(--accent)">'+bwp.nr+'.</strong> '+bwp.action+' <span style="color:var(--red);font-weight:500">('+bwp.deadline+')</span></div>';
    }
    h += '<div style="text-align:right;margin-top:6px"><span style="font:500 5.5pt var(--m);color:var(--accent);cursor:pointer;text-decoration:underline" onclick="switchView(\'strategy\')">Vollst\u00e4ndiges Briefing \u2192</span></div>';
    h += '</div>';
  }

  // Top risk cards
  h += '<div class="canvas-title">Jetzt relevant</div>';
  h += '<div class="briefing-grid">';
  for (const k of topRisk) {
    const e = KB[k];
    const riskColor = e.risk > 40 ? 'var(--red)' : e.risk > 25 ? 'var(--amber)' : 'var(--green)';
    h += '<div class="briefing-card clickable" onclick="showEntity(\'' + k + '\')">';
    h += '<div class="briefing-card-title" style="color:' + riskColor + '">' + e.name + '</div>';
    h += '<div class="briefing-card-body"><span class="ev ev-j">J</span> ' + (e.summary || '').substring(0, 120) + '...</div>';
    h += '<div class="briefing-card-tag" style="background:' + riskColor + '20;color:' + riskColor + '"><span class="ev ev-j">J</span> RISK ' + e.risk + '</div>';
    h += '</div>';
  }
  h += '</div>';

  // Forecast / Stichwahl card
  if (FORECAST) {
    h += '<div class="canvas-title">Wahlprognose ' + FORECAST.wahltermin + '</div>';
    h += '<div class="entity-card"><div class="entity-body">';
    // Stichwahl range indicator
    var swR = FORECAST.stichwahlRange || {min:30,max:55};
    h += '<div style="margin-bottom:14px">';
    h += '<div style="font:600 9pt var(--f);margin-bottom:8px"><span class="ev ev-j">J</span> Stichwahl-Wahrscheinlichkeit</div>';
    // Band visualization
    h += '<div style="position:relative;height:28px;background:var(--surface2);border-radius:4px;overflow:hidden;margin-bottom:6px">';
    // Color bands (0-10 green, 10-20 green light, 20-30 amber light, 30-50 amber, 50-70 red light, 70-100 red)
    h += '<div style="position:absolute;left:0;width:10%;height:100%;background:rgba(45,138,78,0.12)"></div>';
    h += '<div style="position:absolute;left:10%;width:10%;height:100%;background:rgba(45,138,78,0.08)"></div>';
    h += '<div style="position:absolute;left:20%;width:10%;height:100%;background:rgba(180,83,9,0.08)"></div>';
    h += '<div style="position:absolute;left:30%;width:20%;height:100%;background:rgba(180,83,9,0.15)"></div>';
    h += '<div style="position:absolute;left:50%;width:20%;height:100%;background:rgba(192,57,43,0.08)"></div>';
    h += '<div style="position:absolute;left:70%;width:30%;height:100%;background:rgba(192,57,43,0.15)"></div>';
    // Active range highlight
    h += '<div style="position:absolute;left:' + swR.min + '%;width:' + (swR.max - swR.min) + '%;height:100%;background:var(--amber);opacity:0.35;border-radius:3px;border:2px solid var(--amber)"></div>';
    // Labels
    h += '<div style="position:absolute;left:2%;top:50%;transform:translateY(-50%);font:400 5pt var(--m);color:var(--green)">unwahrsch.</div>';
    h += '<div style="position:absolute;left:' + (swR.min + (swR.max - swR.min)/2) + '%;top:50%;transform:translate(-50%,-50%);font:700 9pt var(--m);color:var(--amber)">' + swR.min + '-' + swR.max + '%</div>';
    h += '<div style="position:absolute;right:2%;top:50%;transform:translateY(-50%);font:400 5pt var(--m);color:var(--red)">wahrsch.</div>';
    h += '</div>';
    // Legend
    h += '<div style="display:flex;justify-content:space-between;font:400 5pt var(--m);color:var(--muted)">';
    h += '<span>0%</span><span>10</span><span>20</span><span>30</span><span>40</span><span>50</span><span>60</span><span>70</span><span>80</span><span>90</span><span>100%</span>';
    h += '</div>';
    h += '<div style="font:400 6.5pt var(--m);color:var(--muted);margin-top:6px">Stichwahl am ' + FORECAST.stichwahl + ' falls kein Kandidat >50% · Spanne: ' + swR.min + '-' + swR.max + '% · Confidence: ' + FORECAST.stichwahlConf + '%</div>';
    h += '</div>';
    // Candidate bars
    for (const k of FORECAST.kandidaten) {
      const barColor = k.partei === 'CSU' ? '#0a4d8c' : k.partei === 'SPD' ? '#c0392b' : k.partei === 'Grüne' ? '#4a8c3f' : k.partei === 'AfD' ? '#2a5298' : 'var(--muted)';
      h += '<div style="display:flex;align-items:center;gap:8px;margin-bottom:6px">';
      h += '<div style="width:90px;font:500 7pt var(--f);color:var(--text)">' + k.name.split(' ').pop() + '</div>';
      h += '<div style="flex:1;height:16px;background:var(--surface2);border-radius:3px;overflow:hidden;position:relative">';
      // Range bar (min-max)
      h += '<div style="position:absolute;left:' + k.min + '%;width:' + (k.max - k.min) + '%;height:100%;background:' + barColor + '30;border-radius:3px"></div>';
      // Central estimate
      h += '<div style="position:absolute;left:' + k.zentral + '%;width:2px;height:100%;background:' + barColor + '"></div>';
      h += '</div>';
      h += '<div style="width:70px;font:500 6.5pt var(--m);color:var(--text2);text-align:right"><span class="ev ev-' + k.tag.toLowerCase() + '">' + k.tag + '</span> ' + k.min + '-' + k.max + '%</div>';
      h += '</div>';
    }
    // 50% threshold line label
    h += '<div style="display:flex;align-items:center;gap:8px;margin-top:4px">';
    h += '<div style="width:90px"></div>';
    h += '<div style="flex:1;position:relative;height:12px"><div style="position:absolute;left:50%;transform:translateX(-50%);font:400 5pt var(--m);color:var(--red)">50% (Stichwahl-Schwelle)</div></div>';
    h += '<div style="width:70px"></div></div>';
    // Historic trend
    h += '<div style="margin-top:12px;padding-top:10px;border-top:1px solid var(--border)">';
    h += '<div style="font:600 6pt var(--m);color:var(--muted);margin-bottom:6px">LODERER-TREND (BM-WAHLEN)</div>';
    h += '<div style="display:flex;gap:12px;align-items:flex-end">';
    for (const w of FORECAST.historie.filter(h => h.wg === 1)) {
      const barH = Math.round(w.loderer * 0.8);
      const c = w.stichwahl ? 'var(--amber)' : 'var(--green)';
      h += '<div style="text-align:center"><div style="font:500 7pt var(--m);color:var(--text)">' + w.loderer + '%</div>';
      h += '<div style="width:36px;height:' + barH + 'px;background:' + c + ';border-radius:2px 2px 0 0;margin:2px auto"></div>';
      h += '<div style="font:400 5pt var(--m);color:var(--muted)">' + w.jahr + (w.stichwahl ? '*' : '') + '</div></div>';
    }
    // 2026 forecast
    h += '<div style="text-align:center"><div style="font:500 7pt var(--m);color:var(--amber)">~47%?</div>';
    h += '<div style="width:36px;height:38px;background:var(--amber);border-radius:2px 2px 0 0;margin:2px auto;opacity:0.5;border:1px dashed var(--amber)"></div>';
    h += '<div style="font:400 5pt var(--m);color:var(--amber)">2026</div></div>';
    h += '</div></div>';
    h += '</div></div>';
  }

  // Latest news
  h += '<div class="canvas-title">Aktuelle Lage <span class="ct-badge" style="background:var(--accent)">' + NEWS.length + ' MELDUNGEN</span></div>';
  for (var ni=0; ni<NEWS.length; ni++) {
    var n = NEWS[ni];
    var nSentColor = n.sentiment==='NEG'?'var(--red)':n.sentiment==='POS'?'var(--green)':n.sentiment==='MIX'?'var(--amber)':'var(--muted)';
    var nImpactColor = n.impact==='HOCH'?'var(--red)':n.impact==='MITTEL'?'var(--amber)':'var(--muted)';
    h += '<div class="nf-card">';
    h += '<div style="font:600 8pt var(--f);color:var(--text);line-height:1.3">' + n.title + '</div>';
    h += '<div style="font:400 7pt var(--f);color:var(--text2);line-height:1.5;margin:4px 0"><span class="ev ev-e">E</span> ' + (n.body || '') + '</div>';
    h += '<div class="nf-meta">';
    h += '<span>' + n.source + '</span><span>' + n.date + '</span>';
    if (n.sentiment) h += '<span class="nf-sentiment" style="background:'+nSentColor+'15;color:'+nSentColor+'">'+n.sentiment+'</span>';
    if (n.impact) h += '<span class="nf-impact" style="color:'+nImpactColor+'">Impact: '+n.impact+'</span>';
    if (n.entities && n.entities.length) {
      for (var nei=0;nei<n.entities.length;nei++) {
        var ne = KB[n.entities[nei]];
        if (ne) h += '<span class="related-pill" style="padding:1px 5px;font-size:5pt" onclick="showEntity(\''+n.entities[nei]+'\')">'+ne.name.split(' ').pop()+'</span>';
      }
    }
    h += '</div></div>';
  }

  // Risk Ranking (absorbed from Alerts)
  h += '<div class="canvas-title">Risiko-Ranking</div>';
  h += '<div class="entity-card"><div class="entity-body">';
  const ranked = Object.keys(KB).sort((a, b) => KB[b].risk - KB[a].risk);
  for (const k of ranked) {
    const e = KB[k];
    const rc = e.risk > 40 ? 'var(--red)' : e.risk > 25 ? 'var(--amber)' : 'var(--green)';
    h += '<div class="risk-row" onclick="showEntity(\'' + k + '\')">';
    h += '<div class="risk-name" style="color:' + e.color + '">' + e.name + '</div>';
    h += '<div class="risk-bar-bg"><div class="risk-bar" style="width:' + e.risk + '%;background:' + rc + '"></div></div>';
    h += '<div class="risk-val" style="color:' + rc + '"><span class="ev ev-j">J</span> ' + e.risk + '</div>';
    h += '</div>';
  }
  h += '</div></div>';

  // Themen-Radar (absorbed from Stimmung)
  if (SENTIMENT.topics && SENTIMENT.topics.length) {
    h += '<div class="canvas-title">Themen-Radar <span class="ct-badge" style="background:var(--blue)">' + SENTIMENT.topics.length + ' TOPICS</span></div>';
    h += '<div class="entity-card"><div class="entity-body">';
    for (var bti=0; bti<SENTIMENT.topics.length; bti++) {
      var t = SENTIMENT.topics[bti];
      var tpctB = t.pct || t.sentiment || 0;
      var tColorB = tpctB < -50 ? 'var(--red)' : tpctB < 0 ? 'var(--amber)' : 'var(--green)';
      var tPostsN = (t.posts||[]).length;
      h += '<div class="sent-topic" style="cursor:pointer" onclick="switchView(\'strategy\');setTimeout(function(){toggleTopic('+bti+')},100)">';
      h += '<div class="sent-topic-name">' + t.name + ' <span style="font:400 5.5pt var(--m);color:var(--accent);text-decoration:underline">('+tPostsN+' Beiträge →)</span></div>';
      h += '<div class="sent-topic-bar"><div class="sent-topic-fill" style="width:' + Math.min(100, Math.abs(tpctB) + 10) + '%;background:' + tColorB + '"></div></div>';
      h += '<div class="sent-topic-pct" style="color:' + tColorB + '"><span class="ev ev-i">I</span> ' + (tpctB > 0 ? '+' : '') + tpctB + '%</div>';
      h += '</div>';
    }
    h += '</div></div>';
  }

  // Cross-patterns summary
  if (PATTERNS.length > 0) {
    h += '<div class="canvas-title">Erkannte Muster</div>';
    h += '<div class="pattern-grid">';
    for (const p of PATTERNS) {
      h += '<div class="pattern-card clickable" onclick="switchView(\'strategy\')">';
      h += '<div class="pattern-card-title">' + p.label + '</div>';
      h += '<div class="pattern-card-body">' + p.meaning.substring(0, 120) + '...</div>';
      h += '<div class="pattern-card-conf"><span class="ev ev-i">I</span> ' + (p.confidence || 50) + '%</div>';
      h += '</div>';
    }
    h += '</div>';
  }

  // Key Hypothesis (absorbed from Hypothesen — show top 1)
  if (HYPOTHESES.length > 0) {
    const topH = HYPOTHESES[0];
    const conf = topH.confidence || topH.conf || 50;
    h += '<div class="canvas-title">Top-Hypothese</div>';
    h += '<div class="hypo-card clickable" onclick="switchView(\'compare\')">';
    h += '<div class="hypo-card-header"><div class="hypo-card-title">' + topH.title + '</div>';
    h += '<div class="hypo-card-status" style="background:var(--accent)15;color:var(--accent)">' + conf + '%</div></div>';
    h += '<div class="hypo-body"><span class="ev ev-a">A</span> ' + (topH.summary || topH.body || '') + '</div>';
    h += '<div class="hypo-conf-bar"><div class="hypo-conf-fill" style="width:' + conf + '%;background:var(--accent)"></div></div>';
    h += '</div>';
  }

  el.innerHTML = h;
}

// =====================================================
// TAB: ENTITY (Deep Dossier)
// =====================================================
function showEntity(id, el) {
  currentEntity = id;
  if (el) {
    document.querySelectorAll('.ont-item').forEach(i => i.classList.remove('active'));
    el.classList.add('active');
  }
  if (currentView !== 'entity') switchView('entity');

  const p = KB[id];
  if (!p) return;

  const canvas = document.getElementById('entity-view');
  let h = '';

  // Entity card header
  h += '<div class="canvas-title">Entity: ' + p.name + ' <span class="ct-badge" style="background:' + p.color + '">DOSSIER</span></div>';
  h += '<div class="entity-card"><div class="entity-header"><div>';
  h += '<div class="entity-name" style="color:' + p.color + '">' + p.name + '</div>';
  h += '<div class="entity-meta"><span><span class="ev ev-e">E</span> TYPE: Person</span><span><span class="ev ev-j">J</span> RISK: ' + p.risk + '</span><span><span class="ev ev-e">E</span> PARTEI: ' + (p.party || '—') + '</span></div>';
  h += '</div></div>';
  // Dossier link button
  if (p.dossierUrl) {
    h += '<div style="margin-top:8px"><a href="' + p.dossierUrl + '" target="_blank" style="display:inline-flex;align-items:center;gap:6px;font:600 7pt var(--m);color:var(--accent);background:var(--gold-bg);padding:6px 14px;border-radius:3px;text-decoration:none;border:1px solid var(--accent)">Vollständiges Dossier öffnen <span style="font-size:9pt">→</span></a></div>';
  }
  // Entity Actions Bar
  h += '<div style="display:flex;gap:6px;margin-top:10px;flex-wrap:wrap">';
  h += '<button onclick="exportEntity(\''+id+'\')" style="font:500 6pt var(--m);padding:4px 10px;border-radius:3px;cursor:pointer;border:1px solid var(--border);background:var(--surface);color:var(--text2)">↓ Export PDF</button>';
  h += '<button onclick="watchEntity(\''+id+'\')" style="font:500 6pt var(--m);padding:4px 10px;border-radius:3px;cursor:pointer;border:1px solid var(--border);background:var(--surface);color:var(--text2)" id="watch-btn-'+id+'">' + (_watchlist.indexOf(id)>=0?'★ Watchlist':'☆ Watchlist') + '</button>';
  h += '<button onclick="annotateEntity(\''+id+'\')" style="font:500 6pt var(--m);padding:4px 10px;border-radius:3px;cursor:pointer;border:1px solid var(--border);background:var(--surface);color:var(--text2)">✎ Notiz</button>';
  h += '<button onclick="shareEntity(\''+id+'\')" style="font:500 6pt var(--m);padding:4px 10px;border-radius:3px;cursor:pointer;border:1px solid var(--border);background:var(--surface);color:var(--text2)">↗ Teilen</button>';
  h += '</div>';
  h += '</div>';

  // Steckbrief
  if (p.steckbrief) {
    h += '<div class="canvas-title">Steckbrief</div>';
    h += '<div class="entity-card"><div class="entity-body"><div class="prop-grid">';
    for (const [key, val] of Object.entries(p.steckbrief)) {
      h += '<div class="prop-key">' + key + '</div><div class="prop-val"><span class="ev ev-e">E</span> ' + val + '</div>';
    }
    h += '</div></div></div>';
  }

  // Properties
  if (p.properties && p.properties.length) {
    h += '<div class="canvas-title">Profil <span class="ct-badge" style="background:var(--gold)">' + p.properties.length + ' ATTRIBUTE</span></div>';
    h += '<div class="entity-card"><div class="entity-body"><div class="prop-grid">';
    for (const prop of p.properties) {
      var prov = '';
      if (prop.src) {
        var freshColor = prop.fresh === 'CURRENT' ? 'var(--green)' : prop.fresh === 'VERIFIED' ? 'var(--blue)' : 'var(--muted)';
        var typeLabel = prop.type === 'official' ? 'OFFIZIELL' : prop.type === 'inference' ? 'ABGELEITET' : prop.type === 'estimate' ? 'SCHÄTZUNG' : prop.type || '';
        prov = '<div style="font:400 5pt var(--m);color:var(--muted);margin-top:1px">' + prop.src + ' · <span style="color:' + freshColor + '">' + (prop.fresh || '') + '</span>' + (typeLabel ? ' · ' + typeLabel : '') + '</div>';
      }
      h += '<div class="prop-key">' + prop.key + '</div><div class="prop-val"><span class="ev ev-' + (prop.ev || 'e') + '">' + (prop.ev || 'E').toUpperCase() + '</span> ' + prop.val + prov + '</div>';
    }
    h += '</div></div></div>';
  }

  // Timeline Slider (visual)
  if (p.timeline && p.timeline.length) {
    h += renderTimelineSlider(id, p.timeline);
  }

  // Karriere Timeline
  if (p.karriere && p.karriere.length) {
    h += '<div class="canvas-title">Karriere <span class="ct-badge" style="background:var(--blue)">' + p.karriere.length + ' STATIONEN</span></div>';
    h += '<div class="entity-card"><div class="entity-body"><div class="vtl">';
    for (const k of p.karriere) {
      h += '<div class="vtl-item"><div class="vtl-dot" style="background:' + (k.color || 'var(--blue)') + '"></div>';
      h += '<div class="vtl-year">' + (k.year || k.zeit || k.zeitraum || '') + '</div>';
      h += '<div class="vtl-label"><span class="ev ev-e">E</span> ' + (k.label || k.position || k.titel || '') + (k.org ? ' — ' + k.org : (k.beschreibung ? ' — ' + k.beschreibung : '')) + '</div>';
      h += '</div>';
    }
    h += '</div></div></div>';
  }

  // Wahlergebnisse
  if (p.wahlergebnisse && p.wahlergebnisse.length) {
    h += '<div class="canvas-title">Wahlergebnisse</div>';
    h += '<div class="entity-card"><div class="entity-body">';
    h += '<table class="matrix-table"><tr><th>Wahl</th><th>Ergebnis</th><th>Details</th><th>WB</th></tr>';
    for (const w of p.wahlergebnisse) {
      h += '<tr><td>' + (w.wahl || '') + '</td>';
      h += '<td><strong><span class="ev ev-e">E</span> ' + (w.ergebnis || '') + '</strong></td>';
      h += '<td>' + (w.details || w.kontext || '') + '</td>';
      h += '<td>' + (w.wahlbeteiligung || '') + '</td></tr>';
    }
    h += '</table></div></div>';
  }

  // Controversies
  if (p.controversies && p.controversies.length) {
    h += '<div class="canvas-title">Kontroversen <span class="ct-badge" style="background:var(--red)">' + p.controversies.length + '</span></div>';
    h += '<div class="entity-card"><div class="entity-body">';
    for (const c of p.controversies) {
      const sev = c.severity === 'SCHWERWIEGEND' ? 'var(--red)' : c.severity === 'MITTEL' ? 'var(--amber)' : 'var(--muted)';
      h += '<div style="margin-bottom:10px"><span class="ev ev-' + (c.ev_tag || 'e') + '">' + (c.ev_tag || 'E').toUpperCase() + '</span> <strong style="color:' + sev + '">' + c.title + '</strong>';
      h += ' <span style="font:500 5.5pt var(--m);color:var(--green)">' + (c.conf || '') + '</span>';
      h += '<div style="font-size:7pt;color:var(--text2);margin-top:2px">' + c.text + '</div></div>';
    }
    h += '</div></div>';
  }

  // Contradictions (Widersprüche)
  if (p.contradictions && p.contradictions.length) {
    h += '<div class="canvas-title">Widersprüche <span class="ct-badge" style="background:var(--amber)">' + p.contradictions.length + ' VERIFIZIERT</span></div>';
    for (const w of p.contradictions) {
      const typeColors = {sagen_vs_tun:'var(--red)',frueher_vs_jetzt:'var(--amber)',selbstbild_vs_verhalten:'var(--purple)',selbstbild_vs_fremdbild:'var(--blue)'};
      const tc = typeColors[w.type] || 'var(--muted)';
      h += '<div class="entity-card" style="margin-bottom:8px;border-left:3px solid ' + tc + '">';
      h += '<div class="entity-body">';
      h += '<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px">';
      h += '<div style="font:600 8pt var(--f);color:var(--text)">' + w.title + '</div>';
      h += '<div style="font:600 5.5pt var(--m);color:' + tc + ';background:' + tc + '15;padding:2px 6px;border-radius:2px">' + w.typeLabel + '</div>';
      h += '</div>';
      // SAID
      h += '<div style="background:var(--surface2);border-radius:3px;padding:8px;margin-bottom:6px">';
      h += '<div style="font:600 5.5pt var(--m);color:var(--muted);text-transform:uppercase"><span class="ev ev-e">E</span> Gesagt</div>';
      h += '<div style="font:italic 7pt var(--f);color:var(--text);line-height:1.5">"' + w.said.text + '"</div>';
      h += '<div style="font:400 5.5pt var(--m);color:var(--muted);margin-top:4px">' + w.said.source + ' · ' + w.said.date + '</div>';
      h += '</div>';
      // REALITY
      h += '<div style="background:rgba(192,57,43,0.04);border-radius:3px;padding:8px;margin-bottom:6px">';
      h += '<div style="font:600 5.5pt var(--m);color:var(--red);text-transform:uppercase"><span class="ev ev-e">E</span> Realität</div>';
      h += '<div style="font:400 7pt var(--f);color:var(--text);line-height:1.5">' + w.reality.text + '</div>';
      h += '<div style="font:400 5.5pt var(--m);color:var(--muted);margin-top:4px">' + w.reality.source + ' · ' + w.reality.date + '</div>';
      h += '</div>';
      // Analysis + Confidence
      h += '<div style="font:400 6.5pt var(--f);color:var(--text2);line-height:1.5;border-top:1px solid var(--border);padding-top:6px"><span class="ev ev-j">J</span> ' + w.analysis + '</div>';
      h += '<div style="display:flex;justify-content:space-between;margin-top:6px">';
      h += '<div style="font:500 5.5pt var(--m);color:var(--muted)">Schärfe: ' + '\u2B1B'.repeat(w.severity) + '\u2B1C'.repeat(5 - w.severity) + '</div>';
      h += '<div style="font:500 5.5pt var(--m);color:var(--green)">Confidence: ' + w.conf + '%</div>';
      h += '</div></div></div>';
    }
  }

  // Zitate
  if (p.zitate && p.zitate.length) {
    h += '<div class="canvas-title">Zitate <span class="ct-badge" style="background:var(--blue)">' + p.zitate.length + '</span></div>';
    h += '<div class="entity-card"><div class="entity-body">';
    for (const z of p.zitate) {
      h += '<div style="border-left:2px solid var(--accent);padding-left:10px;margin-bottom:10px">';
      h += '<div style="font:italic 7.5pt var(--f);color:var(--text);line-height:1.5"><span class="ev ev-e">E</span> "' + z.text + '"</div>';
      h += '<div style="font:400 5.5pt var(--m);color:var(--muted);margin-top:2px">' + (z.quelle || z.source || '') + (z.datum ? ' · ' + z.datum : '') + '</div>';
      h += '</div>';
    }
    h += '</div></div>';
  }

  // Connections
  if (p.connections && p.connections.length) {
    h += '<div class="canvas-title">Connections</div>';
    h += '<div class="entity-card"><div class="entity-body">';
    for (const c of p.connections) {
      const typeColor = c.type === 'opponent' ? 'var(--red)' : c.type === 'ally' ? 'var(--green)' : 'var(--blue)';
      h += '<div class="conn-row">';
      h += '<span class="conn-type" style="background:' + typeColor + '15;color:' + typeColor + '">' + (c.type || '').toUpperCase() + '</span>';
      h += '<span class="conn-target"><strong>' + c.target + '</strong> — ' + (c.label || '') + '</span>';
      h += '</div>';
    }
    h += '</div></div>';
  }

  // Entity-level News
  const entityNews = NEWS.filter(n => n.entities && n.entities.includes(id));
  if (entityNews.length) {
    h += '<div class="canvas-title">Aktuelle Nachrichten <span class="ct-badge" style="background:var(--accent)">' + entityNews.length + '</span></div>';
    for (const n of entityNews) {
      const nSent = n.sentiment || 0;
      const sentColor = nSent < -0.5 ? 'var(--red)' : nSent < -0.2 ? 'var(--amber)' : nSent > 0.3 ? 'var(--green)' : 'var(--muted)';
      const sentLabel = nSent < -0.5 ? 'NEG' : nSent < -0.2 ? 'MIX' : nSent > 0.3 ? 'POS' : 'NEU';
      h += '<div class="nf-card"><div class="nf-card-header"><div class="nf-card-title">' + n.title + '</div>';
      h += '<span style="font:400 5.5pt var(--m);color:' + sentColor + ';background:' + sentColor + '15;padding:2px 5px;border-radius:2px;flex-shrink:0;margin-left:6px">' + sentLabel + '</span>';
      h += '<div class="nf-card-source">' + n.source + ' · ' + n.date + '</div></div>';
      h += '<div class="nf-card-body"><span class="ev ev-e">E</span> ' + (n.body || '') + '</div>';
      if (n.impact) h += '<div style="font:400 6pt var(--m);color:var(--red);margin-top:3px">▸ ' + n.impact + '</div>';
      h += '</div>';
    }
  }

  // Entity-level Sentiment
  if (SENTIMENT.entities && SENTIMENT.entities[id]) {
    const s = SENTIMENT.entities[id];
    h += '<div class="canvas-title">Stimmung</div>';
    h += '<div class="entity-card"><div class="entity-body">';
    h += '<div style="display:flex;gap:20px;align-items:center">';
    const sColor = s.sent > 0 ? 'var(--green)' : s.sent < 0 ? 'var(--red)' : 'var(--muted)';
    h += '<div><div style="font:700 20pt var(--m);color:' + sColor + '"><span class="ev ev-i">I</span> ' + (s.sent > 0 ? '+' : '') + s.sent + '</div>';
    h += '<div style="font:400 6pt var(--m);color:var(--muted)">SENTIMENT (30d)</div></div>';
    h += '<div><div style="font:700 14pt var(--m);color:var(--text)"><span class="ev ev-e">E</span> ' + (s.mentions || 0) + '</div>';
    h += '<div style="font:400 6pt var(--m);color:var(--muted)">ERWÄHNUNGEN</div></div>';
    h += '<div><div style="font:500 10pt var(--m);color:' + (s.trend === 'steigend' ? 'var(--green)' : 'var(--red)') + '"><span class="ev ev-i">I</span> ' + ((s.delta || 0) > 0 ? '+' : '') + (s.delta || 0) + '</div>';
    h += '<div style="font:400 6pt var(--m);color:var(--muted)">TREND: ' + (s.trend || '') + '</div></div>';
    h += '</div>';
    // Sentiment bar
    h += '<div style="height:6px;background:var(--surface2);border-radius:3px;overflow:hidden;margin:8px 0"><div style="height:100%;width:' + Math.min(100, Math.abs(s.sent) + 20) + '%;background:' + sColor + ';border-radius:3px"></div></div>';
    // Top themes
    if (s.topThemes && s.topThemes.length) {
      h += '<div style="font:400 6.5pt var(--m);color:var(--muted)">Top-Themen: ';
      for (const t of s.topThemes) h += '<span style="background:var(--surface2);padding:1px 5px;border-radius:2px;margin-right:3px">' + t + '</span>';
      h += '</div>';
    }
    h += '</div></div>';
  }

  // Quellen
  if (p.quellen && p.quellen.length) {
    h += '<div class="canvas-title">Quellenverzeichnis <span class="ct-badge" style="background:var(--green)">' + p.quellen.length + ' VERIFIZIERT</span></div>';
    h += '<div class="entity-card"><div class="entity-body">';
    for (const q of p.quellen) {
      h += '<div style="margin-bottom:6px;font-size:7pt">';
      if (q.url) h += '<a href="' + q.url + '" target="_blank" class="entity-link">' + q.name + '</a>';
      else h += q.name;
      if (q.typ) h += ' <span style="font:400 5pt var(--m);color:var(--muted)">' + q.typ + '</span>';
      h += '</div>';
    }
    h += '</div></div>';
  }

  // Cross-Patterns for this entity
  if (PATTERNS.length > 0) {
    const entityPatterns = PATTERNS.filter(cp => cp.entities && cp.entities.includes(id));
    if (entityPatterns.length > 0) {
      h += '<div class="canvas-title">Cross-Merkmale <span class="ct-badge" style="background:var(--accent)">' + entityPatterns.length + ' PATTERNS</span></div>';
      h += '<div class="entity-card"><div class="entity-body">';
      for (const cp of entityPatterns) {
        const others = (cp.entities || []).filter(e => e !== id);
        h += '<div style="padding:8px 0;border-bottom:1px solid var(--border)">';
        h += '<div style="display:flex;align-items:center;gap:6px;margin-bottom:4px">';
        h += '<span style="font:600 8pt var(--f);color:var(--text)"><span class="ev ev-i">I</span> ' + cp.label + '</span>';
        h += '<span class="insight-conf" style="background:var(--accent)15;color:var(--accent)">' + (cp.confidence || 50) + '%</span>';
        h += '</div>';
        h += '<div style="font:400 7pt var(--f);color:var(--text2);line-height:1.4;margin-bottom:4px">' + cp.meaning + '</div>';
        if (others.length > 0) {
          h += '<div style="display:flex;gap:4px;flex-wrap:wrap"><span style="font:400 5.5pt var(--m);color:var(--muted)">Auch bei:</span>';
          for (const oid of others) {
            const oe = KB[oid];
            if (oe) h += '<span style="font:500 5.5pt var(--m);padding:1px 5px;border-radius:2px;background:var(--surface2);border:1px solid var(--border);color:var(--text2);cursor:pointer" onclick="showEntity(\'' + oid + '\')">● ' + oe.name + '</span>';
          }
          h += '</div>';
        }
        h += '</div>';
      }
      h += '</div></div>';
    }
  }

  // Forecast for this entity
  if (FORECAST && FORECAST.kandidaten) {
    const fk = FORECAST.kandidaten.find(k => k.id === id);
    if (fk) {
      h += '<div class="canvas-title">Wahlprognose ' + FORECAST.wahltermin + '</div>';
      h += '<div class="entity-card"><div class="entity-body">';
      const barColor = fk.partei === 'CSU' ? '#0a4d8c' : fk.partei === 'SPD' ? '#c0392b' : fk.partei === 'Grüne' ? '#4a8c3f' : fk.partei === 'AfD' ? '#2a5298' : 'var(--muted)';
      h += '<div style="display:flex;align-items:center;gap:16px;margin-bottom:10px">';
      h += '<div style="font:700 24pt var(--m);color:' + barColor + '"><span class="ev ev-' + fk.tag.toLowerCase() + '">' + fk.tag + '</span> ' + fk.zentral + '%</div>';
      h += '<div><div style="font:600 8pt var(--f)">Prognose ' + fk.name + '</div>';
      h += '<div style="font:400 6pt var(--m);color:var(--muted)">Spanne: ' + fk.min + '-' + fk.max + '% · Confidence: ' + fk.conf + '%</div></div>';
      h += '</div>';
      // Bar
      h += '<div style="height:20px;background:var(--surface2);border-radius:3px;overflow:hidden;position:relative;margin-bottom:8px">';
      h += '<div style="position:absolute;left:' + fk.min + '%;width:' + (fk.max - fk.min) + '%;height:100%;background:' + barColor + '30"></div>';
      h += '<div style="position:absolute;left:' + fk.zentral + '%;width:2px;height:100%;background:' + barColor + '"></div>';
      h += '<div style="position:absolute;left:50%;width:1px;height:100%;background:var(--red);opacity:0.5"></div>';
      h += '</div>';
      h += '<div style="font:400 5.5pt var(--m);color:var(--muted);text-align:center">Rote Linie = 50% (Stichwahl-Schwelle)</div>';
      // Historical if loderer
      if (id === 'loderer' && FORECAST.historie) {
        h += '<div style="margin-top:10px;padding-top:8px;border-top:1px solid var(--border)">';
        h += '<div style="font:600 6pt var(--m);color:var(--muted);margin-bottom:6px">HISTORISCHER TREND</div>';
        h += '<div style="display:flex;gap:10px;align-items:flex-end">';
        for (const w of FORECAST.historie.filter(h => h.wg === 1)) {
          const bH = Math.round(w.loderer * 0.6);
          h += '<div style="text-align:center"><div style="font:500 6pt var(--m);color:var(--text)"><span class="ev ev-e">E</span> ' + w.loderer + '%</div>';
          h += '<div style="width:28px;height:' + bH + 'px;background:' + (w.stichwahl ? 'var(--amber)' : '#0a4d8c') + ';border-radius:2px 2px 0 0;margin:2px auto"></div>';
          h += '<div style="font:400 5pt var(--m);color:var(--muted)">' + w.jahr + '</div></div>';
        }
        h += '</div></div>';
      }
      h += '</div></div>';
    }
  }

  // Bottom dossier link
  if (p.dossierUrl) {
    h += '<div style="text-align:center;margin-top:16px;padding-top:16px;border-top:1px solid var(--border)">';
    h += '<a href="' + p.dossierUrl + '" target="_blank" style="display:inline-flex;align-items:center;gap:6px;font:600 8pt var(--m);color:#fff;background:var(--accent);padding:8px 20px;border-radius:4px;text-decoration:none">Vollständiges Dossier: ' + p.name + ' →</a>';
    h += '</div>';
  }

  // Related navigation (keine Sackgassen)
  h += '<div style="margin-top:16px;padding-top:12px;border-top:1px solid var(--border)">';
  h += '<div style="font:600 6pt var(--m);color:var(--muted);margin-bottom:8px;text-transform:uppercase;letter-spacing:.08em">Weiter navigieren</div>';
  h += '<div style="display:flex;gap:6px;flex-wrap:wrap">';
  // Other entities
  for (var oid in KB) {
    if (oid !== id) {
      h += '<span style="font:500 6.5pt var(--m);padding:3px 8px;border-radius:3px;background:var(--surface2);border:1px solid var(--border);color:var(--text2);cursor:pointer" onclick="showEntity(\'' + oid + '\')">' + KB[oid].name + '</span>';
    }
  }
  // Views
  h += '<span style="font:500 6.5pt var(--m);padding:3px 8px;border-radius:3px;background:var(--gold-bg);border:1px solid var(--accent);color:var(--accent);cursor:pointer" onclick="switchView(\'briefing\')">Briefing</span>';
  h += '<span style="font:500 6.5pt var(--m);padding:3px 8px;border-radius:3px;background:var(--blue-bg);border:1px solid var(--blue);color:var(--blue);cursor:pointer" onclick="switchView(\'graph\')">Netzwerk</span>';
  h += '<span style="font:500 6.5pt var(--m);padding:3px 8px;border-radius:3px;background:var(--green-bg);border:1px solid var(--green);color:var(--green);cursor:pointer" onclick="switchView(\'compare\')">Vergleich</span>';
  h += '<span style="font:500 6.5pt var(--m);padding:3px 8px;border-radius:3px;background:var(--purple-bg);border:1px solid var(--purple);color:var(--purple);cursor:pointer" onclick="switchView(\'strategy\')">Strategie</span>';
  h += '</div></div>';

  canvas.innerHTML = h;
}

// =====================================================
// TAB: GRAPH (d3 Force Simulation)
// =====================================================
function renderGraph() {
  const container = document.getElementById('graph-view');
  const width = container.clientWidth;
  const height = container.clientHeight;

  const colorMap = {"ally":"#2d8a4e","threat":"#c0392b","neutral":"#b45309","org_ally":"#2d8a4e","org_threat":"#c0392b","org_neutral":"#9d7f3b","institution":"#555e70","theme_hot":"#c0392b","theme":"#777"};
  const linkColorMap = {"party":"#9d7f3b","opponent":"#c0392b","ally":"#2d8a4e","network":"#2563eb","conflict":"#b45309","threat":"#c0392b"};

  const nodes = JSON.parse(JSON.stringify(GRAPH.nodes));
  nodes.forEach(n => { n.r = n.r || n.size || 12; n.group = n.group || n.type || "neutral"; n.info = n.info || n.sub || ""; });
  const links = JSON.parse(JSON.stringify(GRAPH.links));
  links.forEach(l => { l.type = l.type || "network"; l.label = l.label || ""; });

  const svg = d3.select('#graph-view').append('svg').attr('viewBox', [0, 0, width, height]);

  const simulation = d3.forceSimulation(nodes)
    .force('link', d3.forceLink(links).id(d => d.id).distance(100))
    .force('charge', d3.forceManyBody().strength(-300))
    .force('center', d3.forceCenter(width / 2, height / 2))
    .force('collision', d3.forceCollide().radius(d => d.r + 6));

  const link = svg.append('g').selectAll('line').data(links).join('line')
    .attr('class', 'link')
    .attr('stroke', d => linkColorMap[d.type] || '#555')
    .attr('stroke-width', 1.5);

  const linkLabel = svg.append('g').selectAll('text').data(links).join('text')
    .attr('class', 'link-label')
    .text(d => d.label);

  const node = svg.append('g').selectAll('g').data(nodes).join('g')
    .call(d3.drag()
      .on('start', (e, d) => { if (!e.active) simulation.alphaTarget(0.3).restart(); d.fx = e.x; d.fy = e.y; })
      .on('drag', (e, d) => { d.fx = e.x; d.fy = e.y; })
      .on('end', (e, d) => { if (!e.active) simulation.alphaTarget(0); d.fx = null; d.fy = null; })
    );

  node.append('circle')
    .attr('class', 'node-circle')
    .attr('r', d => d.r)
    .attr('fill', d => colorMap[d.group] || '#777')
    .attr('stroke', d => ['ally','threat','neutral'].includes(d.group) ? '#fff' : 'none')
    .attr('stroke-width', 2)
    .on('click', (e, d) => { if (KB[d.id]) showEntity(d.id); });

  node.append('text').attr('class', 'node-label').attr('dy', d => -d.r - 6)
    .attr('font-size', d => ['ally','threat','neutral'].includes(d.group) ? '7pt' : '6pt')
    .attr('fill', d => colorMap[d.group] || '#777').text(d => d.label);

  node.append('text').attr('class', 'node-sublabel').attr('dy', d => -d.r + 3)
    .attr('font-size', '4.5pt').text(d => d.sub);

  const tooltip = document.getElementById('graph-tooltip');
  node.on('mouseover', (e, d) => {
    tooltip.innerHTML = '<h4>' + d.label + '</h4><div style="font:400 6pt var(--m);color:var(--text2)">' + d.sub + '</div><div style="font-size:6.5pt;color:var(--text2);margin-top:4px">' + d.info + '</div>';
    tooltip.style.opacity = 1;
  }).on('mousemove', e => {
    tooltip.style.left = (e.offsetX + 14) + 'px';
    tooltip.style.top = (e.offsetY - 8) + 'px';
  }).on('mouseout', () => { tooltip.style.opacity = 0; });

  simulation.on('tick', () => {
    nodes.forEach(d => {
      d.x = Math.max(d.r + 8, Math.min(width - d.r - 8, d.x));
      d.y = Math.max(d.r + 8, Math.min(height - d.r - 8, d.y));
    });
    link.attr('x1', d => d.source.x).attr('y1', d => d.source.y).attr('x2', d => d.target.x).attr('y2', d => d.target.y);
    linkLabel.attr('x', d => (d.source.x + d.target.x) / 2).attr('y', d => (d.source.y + d.target.y) / 2 - 3);
    node.attr('transform', d => 'translate(' + d.x + ',' + d.y + ')');
  });
}

// =====================================================
// TAB: VERGLEICH (Matrix + Hypothesen)
// =====================================================
function renderCompare() {
  const el = document.getElementById('compare-view');
  let h = '';
  // Matrix section
  h += renderMatrixHTML();
  // Kontroversen-Heatmap
  h += renderHeatmapHTML();
  // Hypotheses section
  h += renderHypothesesHTML();
  el.innerHTML = h;
}

function renderHeatmapHTML() {
  var keys = Object.keys(KB);
  var h = '<div style="margin-top:24px"></div>';
  h += '<div class="canvas-title">Kontroversen-Heatmap <span class="ct-badge" style="background:var(--red)">MUSTER</span></div>';
  h += '<div style="background:var(--surface);border:1px solid var(--border);border-radius:6px;padding:14px">';
  for (var ki=0; ki<keys.length; ki++) {
    var k = keys[ki], e = KB[k];
    var controvs = (e.controversies || []);
    var contras = (e.contradictions || []);
    h += '<div style="display:flex;align-items:center;gap:8px;margin-bottom:6px">';
    h += '<div style="width:80px;font:500 7pt var(--f);color:var(--text);cursor:pointer;text-decoration:underline;text-decoration-color:var(--border)" onclick="showEntity(\'' + k + '\')">' + e.name.split(' ').pop() + '</div>';
    h += '<div style="display:flex;gap:3px;flex-wrap:wrap">';
    for (var ci=0; ci<controvs.length; ci++) {
      var c = controvs[ci];
      var bc = c.severity === 'SCHWERWIEGEND' ? 'var(--red)' : c.severity === 'MITTEL' ? 'var(--amber)' : 'var(--muted)';
      h += '<div style="width:18px;height:18px;border-radius:2px;background:' + bc + ';cursor:pointer;opacity:0.8;transition:opacity .15s" title="' + (c.title||'').replace(/"/g,'&quot;') + ' — ' + (c.severity||'') + '" onclick="showEntity(\'' + k + '\')" onmouseover="this.style.opacity=1" onmouseout="this.style.opacity=0.8"></div>';
    }
    for (var wi=0; wi<contras.length; wi++) {
      var w = contras[wi];
      h += '<div style="width:18px;height:18px;border-radius:2px;background:var(--purple);cursor:pointer;opacity:0.8;transition:opacity .15s" title="Widerspruch: ' + (w.title||'').replace(/"/g,'&quot;') + '" onclick="showEntity(\'' + k + '\')" onmouseover="this.style.opacity=1" onmouseout="this.style.opacity=0.8"></div>';
    }
    if (controvs.length === 0 && contras.length === 0) {
      h += '<div style="width:18px;height:18px;border-radius:2px;background:var(--border);opacity:0.4"></div>';
    }
    h += '</div>';
    h += '<div style="font:400 5.5pt var(--m);color:var(--muted)">' + (controvs.length + contras.length) + '</div>';
    h += '</div>';
  }
  h += '<div style="display:flex;gap:12px;margin-top:10px;padding-top:8px;border-top:1px solid var(--border);font:400 5.5pt var(--m);color:var(--muted)">';
  h += '<span><span style="display:inline-block;width:8px;height:8px;border-radius:1px;background:var(--red);vertical-align:middle;margin-right:3px"></span>Schwerwiegend</span>';
  h += '<span><span style="display:inline-block;width:8px;height:8px;border-radius:1px;background:var(--amber);vertical-align:middle;margin-right:3px"></span>Mittel</span>';
  h += '<span><span style="display:inline-block;width:8px;height:8px;border-radius:1px;background:var(--purple);vertical-align:middle;margin-right:3px"></span>Widerspruch</span>';
  h += '<span><span style="display:inline-block;width:8px;height:8px;border-radius:1px;background:var(--border);vertical-align:middle;margin-right:3px"></span>Keine</span>';
  h += '</div></div>';
  return h;
}

function renderMatrixHTML() {
  const el = document.getElementById('matrix-view');
  const keys = Object.keys(KB);
  let h = '<div class="canvas-title">Vergleichs-Matrix <span class="ct-badge" style="background:var(--gold)">' + keys.length + ' ENTITIES</span></div>';

  h += '<table class="matrix-table"><tr><th></th>';
  for (const k of keys) h += '<th class="matrix-col-head"><div class="name">' + KB[k].name.split(' ').pop() + '</div><div class="role">' + KB[k].party + '</div></th>';
  h += '</tr>';

  // Rows
  const rows = [
    {label: 'Risk Score', fn: k => '<div class="cell-score" style="color:' + (KB[k].risk > 40 ? 'var(--red)' : KB[k].risk > 25 ? 'var(--amber)' : 'var(--green)') + '"><span class="ev ev-j">J</span> ' + KB[k].risk + '</div>'},
    {label: 'Partei', fn: k => '<span class="ev ev-e">E</span> ' + (KB[k].party || '—')},
    {label: 'Rolle', fn: k => '<span class="ev ev-e">E</span> ' + (KB[k].role || '—')},
    {label: 'Kontroversen', fn: k => '<span class="ev ev-e">E</span> ' + ((KB[k].controversies || []).length + (KB[k].contradictions || []).length)},
    {label: 'Quellen', fn: k => '<span class="ev ev-e">E</span> ' + (KB[k].quellen || []).length},
    {label: 'Karriere', fn: k => '<span class="ev ev-e">E</span> ' + (KB[k].karriere || []).length + ' Stationen'},
    {label: 'Sentiment', fn: k => { const s = SENTIMENT.entities[k]; return s ? '<span class="ev ev-i">I</span> ' + (s.sent > 0 ? '+' : '') + s.sent : '—'; }},
    {label: 'Trend', fn: k => { const s = SENTIMENT.entities[k]; return s ? '<span class="ev ev-i">I</span> ' + s.trend : '—'; }},
    {label: 'Prognose 1.WG', fn: k => { if (!FORECAST || !FORECAST.kandidaten) return '—'; const f = FORECAST.kandidaten.find(c => c.id === k); return f ? '<span class="ev ev-' + f.tag.toLowerCase() + '">' + f.tag + '</span> ' + f.min + '-' + f.max + '%' : '—'; }},
  ];

  for (const row of rows) {
    h += '<tr><td>' + row.label + '</td>';
    for (const k of keys) h += '<td style="text-align:center">' + row.fn(k) + '</td>';
    h += '</tr>';
  }
  h += '</table>';
  return h;
}

function renderHypothesesHTML() {
  let h = '<div style="margin-top:24px"></div>';
  h += '<div class="canvas-title">Hypothesen <span class="ct-badge" style="background:var(--accent)">' + HYPOTHESES.length + ' AKTIV</span></div>';

  for (const hyp of HYPOTHESES) {
    const conf = hyp.confidence || hyp.conf || 50;
    const confColor = conf > 70 ? 'var(--green)' : conf > 40 ? 'var(--amber)' : 'var(--red)';
    const statusClass = (hyp.status || '').toLowerCase();
    const statusColor = statusClass === 'confirmed' ? 'var(--green)' : statusClass === 'testing' ? 'var(--accent)' : 'var(--red)';

    h += '<div class="hypo-card">';
    h += '<div class="hypo-card-header"><div class="hypo-card-title">' + hyp.title + '</div>';
    h += '<div class="hypo-card-status" style="background:' + statusColor + '15;color:' + statusColor + '">' + (hyp.status || 'OPEN') + '</div></div>';
    h += '<div class="hypo-body"><span class="ev ev-a">A</span> ' + (hyp.summary || hyp.body || '') + '</div>';

    // Confidence bar
    h += '<div class="hypo-conf-bar"><div class="hypo-conf-fill" style="width:' + conf + '%;background:' + confColor + '"></div></div>';
    h += '<div class="hypo-conf-label"><span>0%</span><span><span class="ev ev-j">J</span> ' + conf + '% Wahrscheinlichkeit</span><span>100%</span></div>';

    // For evidence
    if (hyp.forEvidence && hyp.forEvidence.length) {
      h += '<div style="margin-top:10px"><div style="font:600 6pt var(--m);color:var(--green);margin-bottom:4px">DAFÜR SPRICHT</div>';
      for (const ev of hyp.forEvidence) {
        h += '<div class="hypo-ev-row"><span class="hypo-ev-icon hypo-ev-for">+</span><span class="hypo-ev-text"><span class="ev ev-e">E</span> ' + ev + '</span></div>';
      }
      h += '</div>';
    }

    // Against evidence
    if (hyp.againstEvidence && hyp.againstEvidence.length) {
      h += '<div style="margin-top:8px"><div style="font:600 6pt var(--m);color:var(--red);margin-bottom:4px">DAGEGEN SPRICHT</div>';
      for (const ev of hyp.againstEvidence) {
        h += '<div class="hypo-ev-row"><span class="hypo-ev-icon hypo-ev-against">−</span><span class="hypo-ev-text"><span class="ev ev-e">E</span> ' + ev + '</span></div>';
      }
      h += '</div>';
    }

    h += '</div>';
  }

  return h;
}

// =====================================================
// TAB: STRATEGIE (Insights + Actions + Sentiment Detail)
// =====================================================
function renderStrategy() {
  const el = document.getElementById('strategy-view');
  let h = '';

  // Cross-Patterns (from Insights)
  h += '<div class="canvas-title">Cross-Learning Intelligence <span class="ct-badge" style="background:var(--accent)">META-ANALYSE</span></div>';
  for (var pi2=0; pi2<PATTERNS.length; pi2++) {
    var pat = PATTERNS[pi2];
    var conf = pat.confidence || 50;
    var confColor = conf > 70 ? 'var(--green)' : conf > 40 ? 'var(--amber)' : 'var(--red)';
    var confLabel = conf >= 90 ? 'BEWIESEN' : conf >= 70 ? 'STARK' : conf >= 50 ? 'MESSBAR' : 'SCHWACH';
    h += '<div class="insight-card">';
    h += '<div class="insight-card-head"><div class="insight-card-title">' + pat.label + '</div>';
    h += '<span class="insight-conf" style="background:' + confColor + '15;color:' + confColor + '">' + conf + '% · ' + confLabel + '</span></div>';
    h += '<div class="insight-body"><span class="ev ev-i">I</span> ' + pat.meaning + '</div>';
    // Evidence tags
    if (pat.evidenceTags) {
      h += '<div class="insight-evidence">';
      for (var ei=0;ei<pat.evidenceTags.length;ei++) {
        var et = pat.evidenceTags[ei];
        h += '<span class="ev ev-'+et.type.toLowerCase()+'">'+et.type+'</span>';
      }
      h += '</div>';
    }
    // Entkräftet wenn
    if (pat.invalidateIf) {
      h += '<div class="insight-invalidate"><strong>Entkräftet wenn:</strong> '+pat.invalidateIf+'</div>';
    }
    // So what
    if (pat.soWhat) {
      h += '<div class="insight-so-what">→ <strong>Für Sie:</strong> '+pat.soWhat+'</div>';
    }
    // Entity pills
    if (pat.entities && pat.entities.length) {
      h += '<div class="related-wrap">';
      for (var ri=0;ri<pat.entities.length;ri++) {
        var eid = pat.entities[ri];
        var re = KB[eid];
        if (re) h += '<span class="related-pill" onclick="showEntity(\''+eid+'\')">'+re.name.split(' ').pop()+'</span>';
      }
      // Related views
      if (pat.relatedViews) {
        for (var rvi=0;rvi<pat.relatedViews.length;rvi++) {
          var rv = pat.relatedViews[rvi];
          h += '<span class="related-pill" onclick="switchView(\''+rv.view+'\')">'+rv.label+'</span>';
        }
      }
      h += '</div>';
    }
    h += '</div>';
  }

  // Actions (v21-level: evidence, linked metrics, action buttons, datenbasis)
  h += '<div style="margin-top:24px"></div>';
  h += '<div class="canvas-title">Handlungsempfehlungen <span class="ct-badge" style="background:var(--accent)">' + ACTIONS.length + ' AKTIONEN · DATENBASIERT</span></div>';
  h += '<div style="font:400 7pt var(--f);color:var(--text2);margin-bottom:12px;line-height:1.5">Empfehlungen basierend auf Dossier-Analyse, Stimmungsdaten und Wahlmuster. Priorisiert nach Impact und Dringlichkeit.</div>';
  for (var ai2=0; ai2<ACTIONS.length; ai2++) {
    var a = ACTIONS[ai2];
    var prioColor = a.priority === 'KRITISCH' ? 'var(--red)' : a.priority === 'HOCH' ? 'var(--amber)' : a.priority === 'MITTEL' ? 'var(--blue)' : 'var(--green)';
    h += '<div class="act-card" style="border-left-color:' + prioColor + '">';
    h += '<div class="act-card-priority" style="color:' + prioColor + '">' + a.priority + (a.urgency ? ' · ' + a.urgency : '') + '</div>';
    h += '<div class="act-card-title"><span class="ev ev-j">J</span> ' + a.title + '</div>';
    h += '<div class="act-card-body">' + a.body + '</div>';
    // Evidence section
    if (a.evidence) {
      h += '<div class="act-card-evidence"><span class="ev ev-e">E</span> ' + a.evidence + '</div>';
    }
    // Metrics with links
    if (a.metrics) {
      h += '<div class="act-card-metrics">';
      for (var mi=0; mi<a.metrics.length; mi++) {
        var m = a.metrics[mi];
        var mClick = '';
        if (m.link) {
          if (m.link.type==='topic') mClick = 'toggleTopic('+m.link.id+')';
          else if (m.link.type==='entity') mClick = "showEntity('"+m.link.id+"')";
          else if (m.link.type==='hypothesis') mClick = "switchView('compare')";
        }
        if (mClick) {
          h += '<div class="act-metric" style="cursor:pointer;border-radius:4px;padding:4px 6px;transition:background .15s" onmouseover="this.style.background=\'rgba(157,127,59,0.06)\'" onmouseout="this.style.background=\'\'" onclick="'+mClick+'"><div class="act-metric-val" style="color:var(--accent)">'+m.val+'</div><div class="act-metric-label" style="text-decoration:underline;color:var(--accent)">'+m.label+' →</div></div>';
        } else {
          h += '<div class="act-metric"><div class="act-metric-val">' + m.val + '</div><div class="act-metric-label">' + m.label + '</div></div>';
        }
      }
      h += '</div>';
    }
    // Action buttons
    h += '<div class="act-card-actions">';
    h += '<button class="act-btn" id="bookmark-'+ai2+'" onclick="bookmarkAction('+ai2+',this)">○ Vormerken</button>';
    h += '<button class="act-btn" onclick="exportAction('+ai2+')">↓ Export</button>';
    h += '<button class="act-btn" onclick="shareAction('+ai2+')">◈ Teilen</button>';
    h += '</div>';
    h += '</div>';
  }
  // Datenbasis
  var totalQ = 0; for (var dq in KB) totalQ += (KB[dq].quellen||[]).length;
  var totalK = 0; for (var dk in KB) totalK += (KB[dk].controversies||[]).length;
  var totalP = SENTIMENT.topics ? SENTIMENT.topics.reduce(function(s,t){return s+(t.posts||[]).length},0) : 0;
  h += '<div class="data-basis"><div class="data-basis-title">Datenbasis dieser Empfehlungen</div>';
  h += '<div class="data-basis-body">';
  h += Object.keys(KB).length+' Dossiers · '+totalK+' Kontroversen · '+totalQ+' Quellen · '+HYPOTHESES.length+' Hypothesen · '+totalP+' Stimmungsanalysen · '+NEWS.length+' News<br>';
  h += 'Quellen: SZ München, Merkur, tz München, Abgeordnetenwatch, Wikipedia, Partei-Websites<br>';
  h += 'Zeitraum: 30 Tage · Aktualisiert: '+new Date().toLocaleDateString('de-DE');
  h += '</div></div>';

  // ═══ WEEKLY BRIEF ═══
  if (WEEKLYBRIEF) {
    h += '<div style="margin-top:24px"></div>';
    h += '<div class="canvas-title">Wochenbriefing <span class="ct-badge" style="background:var(--red)">'+WEEKLYBRIEF.daysToElection+' TAGE</span></div>';
    h += '<div style="background:var(--surface);border:1px solid var(--border);border-left:3px solid var(--red);border-radius:6px;padding:14px;margin-bottom:12px">';
    h += '<div style="font:500 6pt var(--m);color:var(--muted);text-transform:uppercase;letter-spacing:.1em">'+WEEKLYBRIEF.week+'</div>';
    h += '<div style="font:700 10pt var(--f);color:var(--text);margin:4px 0">'+WEEKLYBRIEF.headline+'</div>';
    for (var wi=0;wi<WEEKLYBRIEF.priorities.length;wi++) {
      var wp = WEEKLYBRIEF.priorities[wi];
      h += '<div style="display:flex;gap:10px;padding:8px 0;border-bottom:1px solid var(--border)">';
      h += '<div style="font:700 14pt var(--m);color:var(--accent);min-width:24px">'+wp.nr+'</div>';
      h += '<div style="flex:1"><div style="font:600 7.5pt var(--f);color:var(--text)"><span class="ev ev-'+wp.ev.toLowerCase()+'">'+wp.ev+'</span> '+wp.action+'</div>';
      h += '<div style="font:400 6.5pt var(--f);color:var(--text2);margin-top:2px">'+wp.why+'</div>';
      h += '<div style="font:500 5.5pt var(--m);color:var(--red);margin-top:2px">Deadline: '+wp.deadline+'</div>';
      h += '</div></div>';
    }
    if (WEEKLYBRIEF.watchItems && WEEKLYBRIEF.watchItems.length) {
      h += '<div style="margin-top:8px;font:500 6pt var(--m);color:var(--muted);text-transform:uppercase;letter-spacing:.08em">Beobachten:</div>';
      for (var wii=0;wii<WEEKLYBRIEF.watchItems.length;wii++) {
        h += '<div style="font:400 6.5pt var(--f);color:var(--text2);padding:2px 0">• '+WEEKLYBRIEF.watchItems[wii]+'</div>';
      }
    }
    h += '</div>';
  }

  // ═══ TALKING POINTS ═══
  if (TALKINGPOINTS && TALKINGPOINTS.length) {
    h += '<div style="margin-top:24px"></div>';
    h += '<div class="canvas-title">Talking Points <span class="ct-badge" style="background:var(--accent)">EINSATZBEREIT</span></div>';
    h += '<div style="font:400 7pt var(--f);color:var(--text2);margin-bottom:12px;line-height:1.5">Fertige S\u00e4tze mit Quellennachweis. Kopieren, anpassen, nutzen.</div>';
    for (var ti2=0;ti2<TALKINGPOINTS.length;ti2++) {
      var tp = TALKINGPOINTS[ti2];
      h += '<div style="background:var(--surface);border:1px solid var(--border);border-radius:6px;margin-bottom:10px;overflow:hidden">';
      h += '<div style="display:flex;align-items:center;gap:10px;padding:10px 14px;cursor:pointer;border-bottom:1px solid var(--border)" onclick="toggleTP('+ti2+')">';
      h += '<div style="flex:1"><div style="font:600 8pt var(--f);color:var(--text)">'+tp.topic+'</div>';
      h += '<div style="font:400 6pt var(--f);color:var(--muted)">'+tp.weakness+' \u00b7 '+tp.points.length+' Talking Points</div></div>';
      h += '<div id="tp-arrow-'+ti2+'" style="font:400 8pt var(--f);color:var(--muted);transition:transform .2s">\u25bc</div>';
      h += '</div>';
      h += '<div id="tp-detail-'+ti2+'" style="display:none;padding:0 14px 12px">';
      for (var tpi=0;tpi<tp.points.length;tpi++) {
        var pt = tp.points[tpi];
        h += '<div style="padding:10px 0;border-bottom:1px solid var(--border)">';
        h += '<div style="font:400 7.5pt var(--f);color:var(--text);line-height:1.5;font-style:italic">\u201e'+pt.text+'\u201c</div>';
        h += '<div style="display:flex;gap:8px;margin-top:4px;font:400 5.5pt var(--m);color:var(--muted)">';
        h += '<span class="ev ev-'+pt.ev.toLowerCase().charAt(0)+'">'+pt.ev+'</span>';
        h += '<span>Quelle: '+pt.source+'</span>';
        h += '<span class="related-pill" style="padding:1px 5px;font-size:5pt;cursor:pointer" onclick="copyTP(this)" data-text="'+pt.text.replace(/"/g,"&quot;")+'">Kopieren</span>';
        h += '</div></div>';
      }
      h += '<div style="font:400 6pt var(--f);color:var(--muted);padding-top:6px">\ud83c\udfaf '+tp.context+'</div>';
      h += '</div></div>';
    }
  }

  // ═══ SCENARIOS ═══
  if (SCENARIOS && SCENARIOS.length) {
    h += '<div style="margin-top:24px"></div>';
    h += '<div class="canvas-title">Stichwahl-Szenarien <span class="ct-badge" style="background:var(--amber)">WAS-WENN</span></div>';
    h += '<div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:10px">';
    for (var si2=0;si2<SCENARIOS.length;si2++) {
      var sc = SCENARIOS[si2];
      var scBorder = sc.label==='best'||sc.label==='stichwahl_win'?'var(--green)':sc.label==='worst'?'var(--red)':'var(--amber)';
      var scLabel = sc.label==='best'?'BESTES SZENARIO':sc.label==='worst'?'SCHLECHTESTES':sc.label==='stichwahl_win'?'STICHWAHL-SIEG':'WAHRSCHEINLICH';
      h += '<div style="background:var(--surface);border:1px solid var(--border);border-top:3px solid '+scBorder+';border-radius:6px;padding:12px">';
      h += '<div style="font:600 5.5pt var(--m);color:'+scBorder+';text-transform:uppercase;letter-spacing:.08em">'+scLabel+'</div>';
      h += '<div style="font:600 8pt var(--f);color:var(--text);margin:4px 0">'+sc.name+'</div>';
      h += '<div style="font:400 6.5pt var(--f);color:var(--text2);margin-bottom:8px">'+sc.desc+'</div>';
      // Result bars
      var rKeys = Object.keys(sc.results);
      for (var ri2=0;ri2<rKeys.length;ri2++) {
        var rk = rKeys[ri2];
        if (rk==='stichwahl') continue;
        var rv = sc.results[rk];
        var rColor = rk==='schardt'?'var(--red)':rk==='loderer'?'var(--blue)':rk==='matella'?'var(--green)':rk==='afd'?'var(--red)':'var(--muted)';
        h += '<div style="display:flex;align-items:center;gap:6px;margin-bottom:3px">';
        h += '<div style="width:50px;font:400 6pt var(--m);color:var(--muted);text-transform:capitalize">'+rk+'</div>';
        h += '<div style="flex:1;height:6px;background:var(--border);border-radius:3px"><div style="height:100%;border-radius:3px;background:'+rColor+';width:'+rv+'%"></div></div>';
        h += '<div style="font:600 6.5pt var(--m);color:var(--text);min-width:24px;text-align:right">'+rv+'%</div>';
        h += '</div>';
      }
      if (sc.results.stichwahl !== undefined) {
        var stColor = sc.results.stichwahl > 50 ? 'var(--red)' : sc.results.stichwahl > 30 ? 'var(--amber)' : 'var(--green)';
        h += '<div style="margin-top:6px;padding-top:6px;border-top:1px solid var(--border);font:600 7pt var(--m);color:'+stColor+'">Stichwahl: '+sc.results.stichwahl+'%</div>';
      }
      if (sc.note) h += '<div style="font:400 5.5pt var(--f);color:var(--muted);margin-top:4px">'+sc.note+'</div>';
      h += '</div>';
    }
    h += '</div>';
  }

  // Overview Cards (v21-style)
  if (SENTIMENT.overview) {
    h += '<div style="margin-top:24px"></div>';
    h += '<div class="canvas-title">Stimmungsbild <span class="ct-badge" style="background:var(--blue)">ÜBERSICHT</span></div>';
    h += '<div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:8px;margin-bottom:16px">';
    var ovKeys = Object.keys(SENTIMENT.overview);
    for (var oi=0;oi<ovKeys.length;oi++) {
      var ov = SENTIMENT.overview[ovKeys[oi]];
      var ovc = (ov.pct||0) < 0 ? 'var(--red)' : 'var(--green)';
      h += '<div style="background:var(--surface);border:1px solid var(--border);border-radius:4px;padding:10px 12px">';
      h += '<div style="font:700 16pt var(--m);color:'+ovc+'">'+((ov.pct||0)>0?'+':'')+(ov.pct||0)+'%</div>';
      h += '<div style="font:500 6.5pt var(--m);color:var(--text);margin-top:2px">'+ov.label+'</div>';
      h += '<div style="font:400 5.5pt var(--m);color:var(--muted)">'+ov.n+' Beiträge · '+ov.trend+'</div>';
      h += '</div>';
    }
    h += '</div>';
  }

  // Topic Sentiment with Drill-Down
  if (SENTIMENT.topics && SENTIMENT.topics.length) {
    h += '<div class="canvas-title">Themen-Sentiment <span class="ct-badge" style="background:var(--blue)">' + SENTIMENT.topics.length + ' TOPICS · ' + SENTIMENT.topics.reduce(function(s,t){return s+(t.posts||[]).length},0) + ' POSTS</span></div>';
    for (var ti=0; ti<SENTIMENT.topics.length; ti++) {
      var t = SENTIMENT.topics[ti];
      var tpct = t.pct || t.sentiment || 0;
      var tColor = tpct < -50 ? 'var(--red)' : tpct < 0 ? 'var(--amber)' : 'var(--green)';
      var tPosts = t.posts || [];
      h += '<div style="background:var(--surface);border:1px solid var(--border);border-radius:6px;margin-bottom:10px;overflow:hidden">';
      // Header — always visible, clickable
      h += '<div style="display:flex;align-items:center;gap:10px;padding:10px 14px;cursor:pointer" onclick="toggleTopic('+ti+')">';
      h += '<div style="flex:1">';
      h += '<div style="font:600 8pt var(--f);color:var(--text)">'+t.name+' <span style="font:400 6pt var(--m);color:var(--accent);text-decoration:underline">('+tPosts.length+' Beiträge →)</span></div>';
      // Bar
      h += '<div style="height:4px;background:var(--border);border-radius:2px;margin-top:4px;width:100%"><div style="height:100%;border-radius:2px;background:'+tColor+';width:'+Math.min(Math.abs(tpct),100)+'%;transition:width .4s"></div></div>';
      h += '</div>';
      h += '<div style="font:700 10pt var(--m);color:'+tColor+';min-width:40px;text-align:right"><span class="ev ev-i">I</span> '+(tpct>0?'+':'')+tpct+'%</div>';
      h += '<div id="topic-arrow-'+ti+'" style="font:400 8pt var(--f);color:var(--muted);transition:transform .2s">▼</div>';
      h += '</div>';
      // Theme chips
      if (t.topThemes && t.topThemes.length) {
        h += '<div style="display:flex;gap:3px;flex-wrap:wrap;padding:0 14px 6px">';
        for (var ci=0;ci<t.topThemes.length;ci++) h += '<span style="font:400 5.5pt var(--m);padding:2px 5px;background:var(--surface2);border-radius:2px;color:var(--text2)">'+t.topThemes[ci]+'</span>';
        h += '</div>';
      }
      // Drill-Down — hidden by default
      h += '<div id="topic-detail-'+ti+'" style="display:none;border-top:1px solid var(--border)">';
      // Sort controls
      h += '<div style="display:flex;gap:6px;padding:8px 14px;flex-wrap:wrap;align-items:center">';
      h += '<span style="font:500 6pt var(--m);color:var(--muted);text-transform:uppercase;letter-spacing:.08em">Sortieren:</span>';
      var sorts = [["date","Datum"],["sentiment","Sentiment"],["source","Quelle"]];
      for (var si=0;si<sorts.length;si++) {
        h += '<button onclick="sortTopic('+ti+',\''+sorts[si][0]+'\')" style="font:500 6pt var(--m);padding:3px 8px;border-radius:3px;cursor:pointer;border:1px solid var(--border);background:var(--surface);color:var(--muted)">'+sorts[si][1]+'</button>';
      }
      h += '</div>';
      // Posts
      h += '<div id="topic-posts-'+ti+'" style="padding:0 14px 10px">';
      for (var pi=0;pi<tPosts.length;pi++) {
        var p = tPosts[pi];
        var pc = (p.sent||0) > 0.3 ? 'var(--green)' : (p.sent||0) < -0.5 ? 'var(--red)' : (p.sent||0) < -0.2 ? 'var(--amber)' : 'var(--muted)';
        var pl = (p.sent||0) > 0.3 ? 'POS' : (p.sent||0) < -0.5 ? 'NEG' : (p.sent||0) < -0.2 ? 'MIX' : 'NEU';
        h += '<div style="padding:6px 0;border-bottom:1px solid var(--border)">';
        h += '<div style="display:flex;align-items:flex-start;gap:6px">';
        h += '<span style="font:400 5.5pt var(--m);color:var(--muted);min-width:16px">'+(pi+1)+'.</span>';
        h += '<div style="flex:1">';
        h += '<div style="font:400 7pt var(--f);color:var(--text);line-height:1.4">"'+p.text+'"</div>';
        h += '<div style="display:flex;gap:8px;margin-top:3px;font:400 5.5pt var(--m);color:var(--muted)">';
        h += '<span style="color:'+pc+';font-weight:600">'+pl+'</span>';
        h += '<span>'+p.src+'</span>';
        h += '<span>'+(p.date||'')+'</span>';
        if (p.cat) h += '<span style="padding:1px 4px;background:var(--surface2);border-radius:2px">'+p.cat+'</span>';
        h += '</div></div></div></div>';
      }
      h += '</div></div></div>';
    }
  }

  el.innerHTML = h;
}

// =====================================================
// REMOVED TABS (absorbed into Briefing/Vergleich/Strategie)
// renderNewsFeed, renderSentiment, renderInsights, renderActions, renderAlerts
// =====================================================
// CHAT
// =====================================================
function buildChat() {
  var msgs = document.getElementById('chat-messages');
  msgs.innerHTML = '<div class="chat-msg"><div class="chat-msg-header"><div class="chat-avatar mia" style="background:var(--green)">✓</div><div class="chat-name">Ainary Support</div></div>' +
    '<div class="chat-body">Haben Sie Fragen zu den Daten, wünschen ein Update oder benötigen eine Anpassung? Schreiben Sie uns direkt — wir antworten innerhalb von 24h.</div></div>';

  var chips = document.getElementById('chat-chips');
  chips.innerHTML = '<span class="chat-chip" onclick="askChat(\'Daten aktualisieren\')">Daten aktualisieren</span>' +
    '<span class="chat-chip" onclick="askChat(\'Neuen Akteur hinzufügen\')">Neuen Akteur hinzufügen</span>' +
    '<span class="chat-chip" onclick="askChat(\'Frage zu einer Quelle\')">Frage zu einer Quelle</span>' +
    '<span class="chat-chip" onclick="askChat(\'Sonstiges\')">Sonstiges</span>';
}

function toggleChat() {
  document.getElementById('chat-overlay').classList.toggle('open');
}

function askChat(q) {
  document.getElementById('chat-input').value = q + ': ';
  document.getElementById('chat-input').focus();
}

function sendChat() {
  var input = document.getElementById('chat-input');
  var q = input.value.trim();
  if (!q) return;

  // Open contact page with pre-filled message
  var msg = encodeURIComponent(q);
  var name = encodeURIComponent(USER.name || '');
  var topic = encodeURIComponent('Kampagnen-Intelligence: ' + (TENANT.name || ''));
  var url = 'https://ainaryventures.com/contact.html?topic=' + topic + '&name=' + name + '&message=' + msg;
  
  var msgs = document.getElementById('chat-messages');
  msgs.innerHTML += '<div class="chat-msg user"><div class="chat-msg-header"><div class="chat-avatar user">U</div><div class="chat-name">' + USER.name.split(' ')[0] + '</div></div><div class="chat-body">' + q.replace(/</g,'&lt;') + '</div></div>';
  msgs.innerHTML += '<div class="chat-msg"><div class="chat-msg-header"><div class="chat-avatar mia" style="background:var(--green)">✓</div><div class="chat-name">Ainary Support</div></div><div class="chat-body">Ich leite Sie zum Kontaktformular weiter. Ihre Nachricht ist schon eingetragen.<br><br><a href="' + url + '" target="_blank" style="display:inline-block;margin-top:6px;font:600 6.5pt var(--m);padding:6px 14px;background:var(--accent);color:#fff;border-radius:3px;text-decoration:none">Kontaktformular öffnen →</a><br><br><span style="font:400 5.5pt var(--f);color:var(--muted)">Oder direkt: florian@ainaryventures.com</span></div></div>';
  msgs.scrollTop = msgs.scrollHeight;
  input.value = '';
  
  // Track
  if (typeof _aiTrack === 'function') _aiTrack('support_contact_form', { message: q.substring(0,200) });
}

// =====================================================
// SEARCH
// =====================================================
document.getElementById('search-input').addEventListener('input', function() {
  const q = this.value.toLowerCase().trim();
  const results = document.getElementById('search-results');
  if (q.length < 2) { results.classList.remove('open'); return; }

  let html = '';
  for (const k of Object.keys(KB)) {
    const e = KB[k];
    if (e.name.toLowerCase().includes(q) || (e.summary || '').toLowerCase().includes(q)) {
      html += '<div class="sr-item" onclick="showEntity(\'' + k + '\');document.getElementById(\'search-results\').classList.remove(\'open\');document.getElementById(\'search-input\').value=\'\';">';
      html += '<div class="sr-item-dot" style="background:' + e.color + '"></div>';
      html += '<div><div class="sr-item-title">' + e.name + '</div><div class="sr-item-sub">' + e.role + '</div></div></div>';
    }
  }
  results.innerHTML = html || '<div style="padding:12px;font-size:7pt;color:var(--muted)">Keine Ergebnisse</div>';
  results.classList.add('open');
});

// =====================================================
// STATUS BAR
// =====================================================
function buildStatusBar() {
  document.getElementById('status-left').innerHTML = Object.keys(KB).length + ' Entities · ' + NEWS.length + ' News · ' + HYPOTHESES.length + ' Hypothesen · ' + PATTERNS.length + ' Patterns';
  document.getElementById('status-right').innerHTML = TENANT.name + ' · v22';

// =====================================================
// ANALYTICS TAB (admin only: ?admin in URL)
// =====================================================
if (location.search.includes('admin')) {
  document.getElementById('analytics-tab').style.display = '';
}

function renderAnalytics() {
  var el = document.getElementById('analytics-view');
  el.innerHTML = '<div style="padding:20px;font:400 7pt var(--f);color:var(--muted)">Lade Analytics...</div>';
  
  var endpoint = _aiEndpoint ? _aiEndpoint.replace('/track','/track') : 'https://ainaryventures.com/api/track';
  fetch(endpoint + '?key=ainary2026&format=raw')
    .then(function(r) { return r.json(); })
    .then(function(data) {
      var events = data.events || [];
      // Group by session
      var sessions = {};
      for (var i=0; i<events.length; i++) {
        var ev = events[i];
        var sid = ev.s || 'unknown';
        if (!sessions[sid]) sessions[sid] = { events: [], user: ev.u, start: ev.ts, ip: ev.ip, ua: ev.ua };
        sessions[sid].events.push(ev);
      }
      
      var h = '<div style="max-width:900px;margin:0 auto;padding:20px 0">';
      h += '<div style="font:600 10pt var(--m);color:var(--text);margin-bottom:4px">ANALYTICS</div>';
      h += '<div style="font:400 6.5pt var(--f);color:var(--muted);margin-bottom:20px">'+events.length+' Events · '+Object.keys(sessions).length+' Sessions · Live-Daten</div>';
      
      // Session cards
      var sKeys = Object.keys(sessions).sort(function(a,b) { return sessions[b].start - sessions[a].start; });
      for (var si=0; si<sKeys.length; si++) {
        var s = sessions[sKeys[si]];
        var evts = s.events;
        if (evts.length <= 1 && evts[0] && evts[0].e === 'test') continue; // skip test
        
        // Compute stats
        var tabs = {};
        var entities = [];
        var copies = 0;
        var newsClicks = [];
        var supportMsgs = [];
        var duration = 0;
        var authEvt = null;
        var scrollMax = {};
        
        for (var j=0; j<evts.length; j++) {
          var e = evts[j];
          if (e.e === 'auth') authEvt = e;
          if (e.e === 'tab_enter') tabs[e.d.tab] = (tabs[e.d.tab]||0) + 1;
          if (e.e === 'tab_leave') {
            if (!scrollMax[e.d.tab] || e.d.scroll_max > scrollMax[e.d.tab]) scrollMax[e.d.tab] = e.d.scroll_max;
          }
          if (e.e === 'entity_view') entities.push(e.d.name || e.d.entity);
          if (e.e === 'copy_talking_point') copies++;
          if (e.e === 'news_detail') newsClicks.push(e.d.title);
          if (e.e === 'support_message') supportMsgs.push(e.d.text);
          if (e.e === 'session_end') duration = e.d.duration_ms;
        }
        
        if (!duration && evts.length > 1) duration = evts[evts.length-1].ts - evts[0].ts;
        var durStr = duration > 0 ? (duration > 60000 ? Math.round(duration/60000)+'m '+Math.round((duration%60000)/1000)+'s' : Math.round(duration/1000)+'s') : 'aktiv';
        
        // Device from UA
        var device = 'Unbekannt';
        if (s.ua) {
          if (s.ua.includes('iPhone')) device = '📱 iPhone';
          else if (s.ua.includes('iPad')) device = '📱 iPad';
          else if (s.ua.includes('Android')) device = '📱 Android';
          else if (s.ua.includes('Macintosh')) device = '💻 Mac';
          else if (s.ua.includes('Windows')) device = '💻 Windows';
          else if (s.ua.includes('Linux')) device = '💻 Linux';
        }
        
        // Screen from auth event
        var screen = authEvt && authEvt.d.screen ? authEvt.d.screen : '';
        
        h += '<div style="background:var(--surface);border:1px solid var(--border);border-radius:6px;padding:16px;margin-bottom:12px">';
        
        // Header
        h += '<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">';
        h += '<div><div style="font:600 8pt var(--m);color:var(--text)">'+(s.user||'Unbekannt')+'</div>';
        h += '<div style="font:400 6pt var(--m);color:var(--muted)">'+device+(screen?' · '+screen:'')+' · IP: '+(s.ip||'?')+'</div></div>';
        h += '<div style="text-align:right"><div style="font:600 8pt var(--m);color:var(--accent)">'+durStr+'</div>';
        h += '<div style="font:400 6pt var(--m);color:var(--muted)">'+new Date(s.start).toLocaleString('de-DE')+'</div></div>';
        h += '</div>';
        
        // KPI row
        h += '<div style="display:grid;grid-template-columns:repeat(5,1fr);gap:8px;margin-bottom:12px">';
        var kpis = [
          ['Events', evts.length, 'var(--text)'],
          ['Tabs', Object.keys(tabs).length+'/5', 'var(--blue)'],
          ['Entities', entities.length, 'var(--accent)'],
          ['TP kopiert', copies, copies>0?'var(--green)':'var(--muted)'],
          ['News', newsClicks.length, 'var(--text)']
        ];
        for (var ki=0; ki<kpis.length; ki++) {
          h += '<div style="text-align:center;padding:8px;background:var(--bg);border-radius:4px">';
          h += '<div style="font:700 10pt var(--m);color:'+kpis[ki][2]+'">'+kpis[ki][1]+'</div>';
          h += '<div style="font:400 5pt var(--m);color:var(--muted);margin-top:2px">'+kpis[ki][0]+'</div></div>';
        }
        h += '</div>';
        
        // Tab journey (visual)
        h += '<div style="margin-bottom:12px"><div style="font:600 6pt var(--m);color:var(--text2);margin-bottom:6px;letter-spacing:.08em">TAB-JOURNEY</div>';
        h += '<div style="display:flex;gap:4px;flex-wrap:wrap">';
        var tabNames = {briefing:'Briefing',entity:'Dossier',graph:'Netzwerk',compare:'Vergleich',strategy:'Strategie'};
        for (var j2=0; j2<evts.length; j2++) {
          if (evts[j2].e === 'tab_enter') {
            var tn = tabNames[evts[j2].d.tab] || evts[j2].d.tab;
            var tc = evts[j2].d.tab === 'strategy' ? 'var(--accent)' : 'var(--muted)';
            h += '<span style="font:500 5.5pt var(--m);padding:2px 6px;border-radius:2px;background:'+tc+'15;color:'+tc+'">'+tn+'</span>';
            h += '<span style="color:var(--muted);font-size:5pt">→</span>';
          }
          if (evts[j2].e === 'entity_view') {
            h += '<span style="font:500 5.5pt var(--m);padding:2px 6px;border-radius:2px;background:var(--accent)15;color:var(--accent)">'+(evts[j2].d.name||evts[j2].d.entity)+'</span>';
            h += '<span style="color:var(--muted);font-size:5pt">→</span>';
          }
        }
        h += '</div></div>';
        
        // Scroll depth per tab
        if (Object.keys(scrollMax).length > 0) {
          h += '<div style="margin-bottom:12px"><div style="font:600 6pt var(--m);color:var(--text2);margin-bottom:6px;letter-spacing:.08em">SCROLL-TIEFE</div>';
          h += '<div style="display:flex;gap:8px;flex-wrap:wrap">';
          for (var st in scrollMax) {
            var sp = scrollMax[st] || 0;
            var sc = sp > 75 ? 'var(--green)' : sp > 40 ? 'var(--amber)' : 'var(--red)';
            h += '<div style="text-align:center"><div style="width:40px;height:40px;border-radius:50%;border:3px solid '+sc+';display:flex;align-items:center;justify-content:center;font:700 7pt var(--m);color:'+sc+'">'+sp+'%</div>';
            h += '<div style="font:400 5pt var(--m);color:var(--muted);margin-top:2px">'+(tabNames[st]||st)+'</div></div>';
          }
          h += '</div></div>';
        }
        
        // Entities viewed
        if (entities.length > 0) {
          h += '<div style="margin-bottom:12px"><div style="font:600 6pt var(--m);color:var(--text2);margin-bottom:4px;letter-spacing:.08em">ENTITIES ANGESEHEN</div>';
          h += '<div style="display:flex;gap:4px;flex-wrap:wrap">';
          var uniqEnt = entities.filter(function(v,i,a){return a.indexOf(v)===i;});
          for (var ei=0; ei<uniqEnt.length; ei++) {
            var cnt = entities.filter(function(x){return x===uniqEnt[ei]}).length;
            h += '<span style="font:500 6pt var(--m);padding:2px 8px;border-radius:2px;background:var(--accent)15;color:var(--accent)">'+uniqEnt[ei]+' ×'+cnt+'</span>';
          }
          h += '</div></div>';
        }
        
        // Talking points copied
        if (copies > 0) {
          h += '<div style="margin-bottom:12px"><div style="font:600 6pt var(--m);color:var(--green);letter-spacing:.08em">✓ '+copies+' TALKING POINTS KOPIERT</div>';
          for (var j3=0; j3<evts.length; j3++) {
            if (evts[j3].e === 'copy_talking_point') {
              h += '<div style="font:400 6pt var(--f);color:var(--text2);padding:4px 0;border-bottom:1px solid var(--border)">"'+(evts[j3].d.text||'').substring(0,80)+'..."</div>';
            }
          }
          h += '</div>';
        }
        
        // Support messages
        if (supportMsgs.length > 0) {
          h += '<div style="margin-bottom:12px"><div style="font:600 6pt var(--m);color:var(--blue);letter-spacing:.08em">SUPPORT-NACHRICHTEN</div>';
          for (var sm=0; sm<supportMsgs.length; sm++) {
            h += '<div style="font:400 6pt var(--f);color:var(--text);padding:6px;background:var(--bg);border-radius:4px;margin-top:4px">"'+supportMsgs[sm]+'"</div>';
          }
          h += '</div>';
        }
        
        // Event timeline (collapsed by default)
        h += '<details style="margin-top:8px"><summary style="font:500 6pt var(--m);color:var(--muted);cursor:pointer;letter-spacing:.06em">ALLE '+evts.length+' EVENTS</summary>';
        h += '<div style="margin-top:6px;max-height:300px;overflow-y:auto">';
        for (var j4=0; j4<evts.length; j4++) {
          var ev2 = evts[j4];
          var time = new Date(ev2.ts).toLocaleTimeString('de-DE');
          h += '<div style="font:400 5.5pt var(--m);color:var(--text2);padding:3px 0;border-bottom:1px solid var(--border);display:flex;gap:8px">';
          h += '<span style="color:var(--muted);min-width:50px">'+time+'</span>';
          h += '<span style="font-weight:600;min-width:80px">'+ev2.e+'</span>';
          h += '<span style="color:var(--muted)">'+JSON.stringify(ev2.d||{}).substring(0,100)+'</span>';
          h += '</div>';
        }
        h += '</div></details>';
        
        h += '</div>'; // session card end
      }
      
      if (sKeys.length === 0 || (sKeys.length === 1 && sessions[sKeys[0]].events.length <= 1)) {
        h += '<div style="text-align:center;padding:40px;color:var(--muted);font:400 7pt var(--f)">Noch keine Besucher-Events. Warte auf den ersten Login.</div>';
      }
      
      h += '<div style="text-align:center;margin-top:16px"><button onclick="renderAnalytics()" style="font:500 6pt var(--m);padding:6px 16px;background:var(--surface);border:1px solid var(--border);border-radius:4px;cursor:pointer;color:var(--text)">↻ Aktualisieren</button></div>';
      h += '</div>';
      el.innerHTML = h;
    })
    .catch(function(err) {
      el.innerHTML = '<div style="padding:20px;color:var(--red);font:400 7pt var(--f)">Fehler: '+err.message+'</div>';
    });
}

// =====================================================
// ANALYTICS — Deep Event Tracking
// =====================================================
var _aiq = []; // analytics queue
var _ais = Date.now(); // session start
var _ait = null; // current tab timer
var _aiTabStart = 0;
var _aiCurrentTab = 'briefing';
var _aiScrollMax = {};
var _aiEndpoint = null; // set via TENANT.analyticsEndpoint or fallback

// Detect endpoint
try { _aiEndpoint = TENANT.analyticsEndpoint || 'https://ainaryventures.com/api/track'; } catch(e){}

function _aiTrack(evt, data) {
  // Resolve identity: token > USER.name > unknown
  var token = '';
  try { token = sessionStorage.getItem('ai-token') || ''; } catch(e){}
  var identity = token === 'admin' ? 'Admin (Florian Z.)' : (USER||{}).name || 'unknown';
  
  var payload = {
    e: evt,
    t: Date.now(),
    s: _ais,
    u: identity,
    tk: token, // token for reliable identification
    tn: (TENANT||{}).name || 'unknown',
    d: data || {}
  };
  _aiq.push(payload);
  try { localStorage.setItem('_ai_events', JSON.stringify(_aiq)); } catch(e){}
  // Send to endpoint if available
  if (_aiEndpoint) {
    try { navigator.sendBeacon(_aiEndpoint, JSON.stringify(payload)); } catch(e){}
  }
}

// Track auth (password or token)
(function(){
  var token = '';
  try { token = sessionStorage.getItem('ai-token') || ''; } catch(e){}
  if (token) {
    // Token-based login — track immediately
    _aiTrack('auth', { method: token === 'admin' ? 'admin' : 'token', token: token, ua: navigator.userAgent, screen: screen.width+'x'+screen.height, lang: navigator.language, ref: document.referrer });
  }
})();

var _origCheckAuth = checkAuth;
checkAuth = function() {
  var pw = document.getElementById('auth-input').value.toLowerCase().trim();
  _origCheckAuth();
  setTimeout(function(){
    if (document.getElementById('auth-gate').style.display === 'none') {
      _aiTrack('auth', { method: 'password', ua: navigator.userAgent, screen: screen.width+'x'+screen.height, lang: navigator.language, ref: document.referrer });
    }
  }, 100);
};

// Track tab switches
var _origSwitchView = switchView;
switchView = function(view) {
  // End timer on previous tab
  if (_aiCurrentTab && _aiTabStart) {
    _aiTrack('tab_leave', { tab: _aiCurrentTab, duration_ms: Date.now() - _aiTabStart, scroll_max: _aiScrollMax[_aiCurrentTab] || 0 });
  }
  _aiCurrentTab = view;
  _aiTabStart = Date.now();
  _origSwitchView(view);
  _aiTrack('tab_enter', { tab: view });
};

// Track entity views
var _origShowEntity = showEntity;
showEntity = function(id, el) {
  _aiTrack('entity_view', { entity: id, name: (KB[id]||{}).name, from_tab: _aiCurrentTab });
  _origShowEntity(id, el);
};

// Track news detail
var _origShowNewsDetail = showNewsDetail;
showNewsDetail = function(idx) {
  var n = NEWS[idx] || {};
  _aiTrack('news_detail', { idx: idx, title: (n.title||'').substring(0,60), source: n.source });
  _origShowNewsDetail(idx);
};

// Track org detail
var _origShowOrgDetail = showOrgDetail;
showOrgDetail = function(party) {
  _aiTrack('org_detail', { party: party });
  _origShowOrgDetail(party);
};

// Track talking point copies
var _origCopyTP = copyTP;
copyTP = function(btn) {
  var section = btn.closest('.tp-section');
  var topic = section ? section.querySelector('.tp-topic') : null;
  var text = btn.previousElementSibling ? btn.previousElementSibling.textContent.substring(0,80) : '';
  _aiTrack('copy_talking_point', { topic: topic ? topic.textContent : '', text: text });
  _origCopyTP(btn);
};

// Track topic drilldowns
var _origToggleTopic = toggleTopic;
toggleTopic = function(idx) {
  var topic = (SENTIMENT.topics && SENTIMENT.topics[idx]) ? SENTIMENT.topics[idx].name : idx;
  _aiTrack('topic_drilldown', { idx: idx, topic: topic });
  _origToggleTopic(idx);
};

// Track support/chat
var _origToggleChat = toggleChat;
toggleChat = function() {
  _aiTrack('support_toggle', { action: document.getElementById('chat-overlay').classList.contains('open') ? 'close' : 'open' });
  _origToggleChat();
};

// Track support message send
var _origSendChat = sendChat;
sendChat = function() {
  var q = document.getElementById('chat-input').value.trim();
  if (q) _aiTrack('support_message', { text: q.substring(0,200) });
  _origSendChat();
};

// Track entity actions
var _origExportEntity = exportEntity;
exportEntity = function(id) { _aiTrack('entity_action', { action: 'export', entity: id }); _origExportEntity(id); };
var _origShareEntity = shareEntity;
shareEntity = function(id) { _aiTrack('entity_action', { action: 'share', entity: id }); _origShareEntity(id); };

// Track bookmark action
var _origBookmarkAction = bookmarkAction;
bookmarkAction = function(idx, btn) { _aiTrack('action_bookmark', { idx: idx }); _origBookmarkAction(idx, btn); };

// Track scroll depth per tab
window.addEventListener('scroll', function() {
  var pct = Math.round((window.scrollY / (document.body.scrollHeight - window.innerHeight)) * 100);
  if (!_aiScrollMax[_aiCurrentTab] || pct > _aiScrollMax[_aiCurrentTab]) {
    _aiScrollMax[_aiCurrentTab] = pct;
  }
}, { passive: true });

// Track session end
window.addEventListener('beforeunload', function() {
  var duration = Date.now() - _ais;
  var tabSummary = {};
  // Count tab visits from queue
  for (var i=0; i<_aiq.length; i++) {
    if (_aiq[i].e === 'tab_leave') {
      var tab = _aiq[i].d.tab;
      if (!tabSummary[tab]) tabSummary[tab] = { visits: 0, total_ms: 0, max_scroll: 0 };
      tabSummary[tab].visits++;
      tabSummary[tab].total_ms += _aiq[i].d.duration_ms || 0;
      tabSummary[tab].max_scroll = Math.max(tabSummary[tab].max_scroll, _aiq[i].d.scroll_max || 0);
    }
  }
  _aiTrack('session_end', {
    duration_ms: duration,
    total_events: _aiq.length,
    tabs: tabSummary,
    scroll_max: _aiScrollMax
  });
});

// Track visibility changes (tab hidden/visible)
document.addEventListener('visibilitychange', function() {
  _aiTrack('visibility', { state: document.visibilityState });
});

// Track link clicks on external URLs
document.addEventListener('click', function(e) {
  var a = e.target.closest('a[href^="http"]');
  if (a && a.hostname !== location.hostname) {
    _aiTrack('external_link', { url: a.href, text: (a.textContent||'').substring(0,60) });
  }
}, true);

// Console helper: type _aiReport() in browser console to see all events
window._aiReport = function() {
  var events;
  try { events = JSON.parse(localStorage.getItem('_ai_events') || '[]'); } catch(e) { events = _aiq; }
  console.table(events.map(function(e) {
    return { event: e.e, time: new Date(e.t).toLocaleTimeString(), data: JSON.stringify(e.d).substring(0,100) };
  }));
  // Summary
  var tabs = {};
  var entities = {};
  var copies = 0;
  for (var i=0; i<events.length; i++) {
    if (events[i].e === 'tab_enter') tabs[events[i].d.tab] = (tabs[events[i].d.tab]||0) + 1;
    if (events[i].e === 'entity_view') entities[events[i].d.name] = (entities[events[i].d.name]||0) + 1;
    if (events[i].e === 'copy_talking_point') copies++;
  }
  console.log('\n📊 SUMMARY:');
  console.log('Total events:', events.length);
  console.log('Session duration:', events.length > 1 ? Math.round((events[events.length-1].t - events[0].t)/1000) + 's' : 'n/a');
  console.log('Tab visits:', tabs);
  console.log('Entity views:', entities);
  console.log('Talking points copied:', copies);
  return events;
};
}

// =====================================================
// DETAIL OVERLAY
// =====================================================
function showDetail(key) {
  // Simple detail view for any object
  const overlay = document.getElementById('detail-overlay');
  const card = document.getElementById('detail-card');
  card.innerHTML = '<div class="detail-close" onclick="closeDetail()">&times;</div><div class="detail-title">' + key + '</div><div class="detail-body">Detail-Ansicht für: ' + key + '</div>';
  overlay.classList.add('open');
}

function closeDetail() {
  document.getElementById('detail-overlay').classList.remove('open');
}
</script>
<div style="position:fixed;bottom:0;left:0;right:0;height:20px;background:var(--surface);border-top:1px solid var(--border);display:flex;align-items:center;justify-content:center;font:400 5pt var(--m);color:var(--muted);z-index:100;gap:12px"><span>Alle Daten aus öffentlich zugänglichen Quellen</span><span>·</span><span>Keine Gewähr für Vollständigkeit oder Richtigkeit</span><span>·</span><span>Vertraulich — nur für den Empfänger bestimmt</span></div>
</body>
</html>
