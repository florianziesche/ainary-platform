<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CNC Planner Pro</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        /* ================================================================
           CNC PLANNER PRO v15 ‚Äî GOLDEN STANDARD DESIGN SYSTEM
           Based on Linear, Notion, Stripe patterns
           ================================================================ */
        
        :root {
            /* Colors - Primary */
            --color-primary: #1E3A5F;
            --color-primary-hover: #152A45;
            --color-primary-light: #2D5A8A;
            
            /* Colors - Semantic */
            --color-success: #059669;
            --color-warning: #D97706;
            --color-error: #DC2626;
            --color-info: #2563EB;
            
            /* Colors - Neutrals */
            --color-bg: #F8FAFC;
            --color-surface: #FFFFFF;
            --color-border: #E2E8F0;
            --color-border-light: #F1F5F9;
            
            /* Colors - Text */
            --color-text: #1E293B;
            --color-text-secondary: #64748B;
            --color-text-muted: #94A3B8;
            
            /* Typography */
            --font-sans: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            --font-mono: 'JetBrains Mono', 'SF Mono', monospace;
            
            /* Spacing (4px base) */
            --space-1: 4px;
            --space-2: 8px;
            --space-3: 12px;
            --space-4: 16px;
            --space-5: 20px;
            --space-6: 24px;
            --space-8: 32px;
            --space-10: 40px;
            
            /* Sizes */
            --sidebar-width: 260px;
            --header-height: 56px;
            --input-height: 40px;
            --input-height-sm: 32px;
            --btn-height: 36px;
            
            /* Radius */
            --radius-sm: 4px;
            --radius-md: 6px;
            --radius-lg: 8px;
            --radius-xl: 12px;
            
            /* Shadows */
            --shadow-sm: 0 1px 2px rgba(0,0,0,0.05);
            --shadow-md: 0 4px 6px rgba(0,0,0,0.07);
            --shadow-lg: 0 10px 15px rgba(0,0,0,0.1);
            
            /* Transitions */
            --transition-fast: 150ms ease;
            --transition-normal: 200ms ease;
        }
        
        /* ================================================================
           RESET & BASE
           ================================================================ */
        
        *, *::before, *::after {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html, body {
            height: 100%;
        }
        
        body {
            font-family: var(--font-sans);
            font-size: 14px;
            line-height: 1.5;
            color: var(--color-text);
            background: var(--color-bg);
            -webkit-font-smoothing: antialiased;
        }
        
        /* ================================================================
           LAYOUT: APP SHELL
           ================================================================ */
        
        .app {
            display: flex;
            min-height: 100vh;
        }
        
        /* ================================================================
           SIDEBAR
           ================================================================ */
        
        .sidebar {
            width: var(--sidebar-width);
            height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            background: var(--color-surface);
            border-right: 1px solid var(--color-border);
            display: flex;
            flex-direction: column;
            z-index: 100;
        }
        
        .sidebar-header {
            height: var(--header-height);
            padding: 0 var(--space-4);
            display: flex;
            align-items: center;
            border-bottom: 1px solid var(--color-border);
        }
        
        .sidebar-logo {
            display: flex;
            align-items: center;
            gap: var(--space-3);
        }
        
        .sidebar-logo-icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, var(--color-primary), var(--color-primary-light));
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 12px;
        }
        
        .sidebar-logo-text {
            font-size: 15px;
            font-weight: 600;
            color: var(--color-text);
        }
        
        .sidebar-logo-text span {
            font-weight: 400;
            color: var(--color-text-secondary);
        }
        
        .sidebar-nav {
            flex: 1;
            overflow-y: auto;
            padding: var(--space-2);
        }
        
        .nav-section {
            margin-bottom: var(--space-6);
        }
        
        .nav-section-title {
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--color-text-muted);
            padding: var(--space-2) var(--space-3);
            margin-bottom: var(--space-1);
        }
        
        .nav-item {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            padding: var(--space-2) var(--space-3);
            margin: 2px 0;
            border-radius: var(--radius-md);
            font-size: 14px;
            font-weight: 500;
            color: var(--color-text-secondary);
            cursor: pointer;
            transition: all var(--transition-fast);
            border: none;
            background: none;
            width: 100%;
            text-align: left;
        }
        
        .nav-item:hover {
            background: var(--color-bg);
            color: var(--color-text);
        }
        
        .nav-item.active {
            background: var(--color-primary);
            color: white;
        }
        
        .nav-item-icon {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            opacity: 0.8;
        }
        
        .nav-item.active .nav-item-icon {
            opacity: 1;
        }
        
        .sidebar-footer {
            padding: var(--space-2);
            border-top: 1px solid var(--color-border);
        }
        
        /* ================================================================
           MAIN CONTENT
           ================================================================ */
        
        .main {
            flex: 1;
            margin-left: var(--sidebar-width);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .main-header {
            height: var(--header-height);
            padding: 0 var(--space-6);
            background: var(--color-surface);
            border-bottom: 1px solid var(--color-border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 50;
        }
        
        .main-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--color-text);
        }
        
        .main-actions {
            display: flex;
            gap: var(--space-2);
        }
        
        .main-content {
            flex: 1;
            padding: var(--space-6);
            max-width: 1200px;
        }
        
        /* ================================================================
           SECTIONS
           ================================================================ */
        
        .section {
            display: none;
        }
        
        .section.active {
            display: block;
        }
        
        /* ================================================================
           BUTTONS
           ================================================================ */
        
        .btn {
            height: var(--btn-height);
            padding: 0 var(--space-4);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-2);
            font-size: 13px;
            font-weight: 500;
            font-family: inherit;
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all var(--transition-fast);
            border: none;
            white-space: nowrap;
        }
        
        .btn-primary {
            background: var(--color-primary);
            color: white;
        }
        
        .btn-primary:hover {
            background: var(--color-primary-hover);
        }
        
        .btn-secondary {
            background: var(--color-surface);
            color: var(--color-text);
            border: 1px solid var(--color-border);
        }
        
        .btn-secondary:hover {
            background: var(--color-bg);
            border-color: var(--color-text-muted);
        }
        
        .btn-sm {
            height: 32px;
            padding: 0 var(--space-3);
            font-size: 12px;
        }
        
        /* ================================================================
           FORM ELEMENTS
           ================================================================ */
        
        .form-group {
            margin-bottom: var(--space-4);
        }
        
        .form-label {
            display: block;
            font-size: 13px;
            font-weight: 500;
            color: var(--color-text-secondary);
            margin-bottom: var(--space-1);
        }
        
        .form-label-caps {
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--color-text-muted);
        }
        
        .input {
            height: var(--input-height);
            width: 100%;
            padding: 0 var(--space-3);
            font-size: 14px;
            font-family: inherit;
            color: var(--color-text);
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-md);
            transition: all var(--transition-fast);
        }
        
        .input:hover {
            border-color: var(--color-text-muted);
        }
        
        .input:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(30, 58, 95, 0.1);
        }
        
        .input-sm {
            height: var(--input-height-sm);
            font-size: 13px;
        }
        
        .input-mono {
            font-family: var(--font-mono);
            text-align: right;
        }
        
        .select {
            height: var(--input-height);
            width: 100%;
            padding: 0 var(--space-8) 0 var(--space-3);
            font-size: 14px;
            font-family: inherit;
            color: var(--color-text);
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-md);
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%2364748B' stroke-width='2'%3E%3Cpolyline points='6 9 12 15 18 9'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            transition: all var(--transition-fast);
        }
        
        .select:hover {
            border-color: var(--color-text-muted);
        }
        
        .select:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(30, 58, 95, 0.1);
        }
        
        .input-with-unit {
            position: relative;
            display: inline-flex;
            width: 100%;
        }
        
        .input-with-unit .input {
            padding-right: var(--space-10);
        }
        
        .input-unit {
            position: absolute;
            right: var(--space-3);
            top: 50%;
            transform: translateY(-50%);
            font-size: 13px;
            color: var(--color-text-muted);
            pointer-events: none;
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }
        
        .checkbox {
            width: 18px;
            height: 18px;
            accent-color: var(--color-primary);
            cursor: pointer;
        }
        
        .checkbox-label {
            font-size: 14px;
            color: var(--color-text);
            cursor: pointer;
        }
        
        /* ================================================================
           CARDS
           ================================================================ */
        
        .card {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-lg);
            overflow: hidden;
        }
        
        .card-header {
            padding: var(--space-4) var(--space-5);
            border-bottom: 1px solid var(--color-border-light);
            font-size: 14px;
            font-weight: 600;
            color: var(--color-text);
        }
        
        .card-body {
            padding: var(--space-5);
        }
        
        /* ================================================================
           PRICE HERO
           ================================================================ */
        
        .price-hero {
            background: linear-gradient(135deg, var(--color-primary), var(--color-primary-light));
            color: white;
            padding: var(--space-8);
            border-radius: var(--radius-xl);
            text-align: center;
            margin-bottom: var(--space-6);
        }
        
        .price-label {
            font-size: 14px;
            font-weight: 500;
            opacity: 0.85;
            margin-bottom: var(--space-1);
        }
        
        .price-value {
            font-size: 48px;
            font-weight: 700;
            font-family: var(--font-mono);
            letter-spacing: -0.02em;
            line-height: 1.1;
        }
        
        .price-detail {
            font-size: 13px;
            opacity: 0.7;
            margin-top: var(--space-2);
        }
        
        /* ================================================================
           COST BREAKDOWN
           ================================================================ */
        
        .cost-breakdown {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-lg);
            overflow: hidden;
        }
        
        .cost-row {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            padding: var(--space-3) var(--space-4);
            border-bottom: 1px solid var(--color-border-light);
        }
        
        .cost-row:last-child {
            border-bottom: none;
        }
        
        .cost-label {
            font-size: 14px;
            color: var(--color-text-secondary);
        }
        
        .cost-formula {
            font-size: 12px;
            color: var(--color-text-muted);
            font-family: var(--font-mono);
            margin-top: 2px;
        }
        
        .cost-value {
            font-size: 14px;
            font-weight: 500;
            font-family: var(--font-mono);
            color: var(--color-text);
            text-align: right;
        }
        
        .cost-row.subtotal {
            background: var(--color-bg);
        }
        
        .cost-row.subtotal .cost-label,
        .cost-row.subtotal .cost-value {
            font-weight: 600;
        }
        
        .cost-row.total {
            background: var(--color-primary);
        }
        
        .cost-row.total .cost-label,
        .cost-row.total .cost-value {
            color: white;
            font-weight: 600;
        }
        
        /* ================================================================
           PART CARDS
           ================================================================ */
        
        .part-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--space-4);
            margin-bottom: var(--space-6);
        }
        
        .part-card {
            display: flex;
            gap: var(--space-4);
            padding: var(--space-4);
            background: var(--color-surface);
            border: 2px solid var(--color-border);
            border-radius: var(--radius-lg);
            cursor: pointer;
            transition: all var(--transition-fast);
        }
        
        .part-card:hover {
            border-color: var(--color-primary-light);
        }
        
        .part-card.selected {
            border-color: var(--color-primary);
            background: linear-gradient(135deg, rgba(30, 58, 95, 0.02), rgba(45, 90, 138, 0.02));
        }
        
        .part-thumb {
            width: 80px;
            height: 80px;
            flex-shrink: 0;
            background: var(--color-bg);
            border-radius: var(--radius-md);
            border: 1px solid var(--color-border);
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .part-thumb img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        
        .part-info {
            flex: 1;
            min-width: 0;
        }
        
        .part-name {
            font-size: 14px;
            font-weight: 600;
            color: var(--color-text);
            margin-bottom: 2px;
        }
        
        .part-number {
            font-size: 12px;
            font-family: var(--font-mono);
            color: var(--color-text-muted);
            margin-bottom: var(--space-2);
        }
        
        .part-meta {
            display: flex;
            gap: var(--space-3);
            font-size: 13px;
            color: var(--color-text-secondary);
        }
        
        .part-price {
            font-weight: 600;
            color: var(--color-primary);
        }
        
        /* ================================================================
           TABLES
           ================================================================ */
        
        .table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }
        
        .table th {
            padding: var(--space-3) var(--space-4);
            text-align: left;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--color-text-muted);
            background: var(--color-bg);
            border-bottom: 1px solid var(--color-border);
        }
        
        .table td {
            padding: var(--space-3) var(--space-4);
            border-bottom: 1px solid var(--color-border-light);
            vertical-align: middle;
        }
        
        .table tr:last-child td {
            border-bottom: none;
        }
        
        .table .mono {
            font-family: var(--font-mono);
        }
        
        .table .right {
            text-align: right;
        }
        
        /* ================================================================
           INFO BOX
           ================================================================ */
        
        .info-box {
            background: var(--color-bg);
            border-left: 3px solid var(--color-primary);
            padding: var(--space-4);
            border-radius: 0 var(--radius-md) var(--radius-md) 0;
            font-size: 13px;
            color: var(--color-text-secondary);
            line-height: 1.6;
        }
        
        .info-box strong {
            color: var(--color-text);
        }
        
        /* ================================================================
           GRID LAYOUTS
           ================================================================ */
        
        .grid-2 {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--space-5);
        }
        
        .grid-3 {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--space-4);
        }
        
        .dimension-group {
            display: flex;
            align-items: flex-end;
            gap: var(--space-2);
        }
        
        .dimension-group .form-group {
            flex: 1;
            margin-bottom: 0;
        }
        
        .dimension-separator {
            padding-bottom: 10px;
            color: var(--color-text-muted);
            font-size: 16px;
        }
        
        /* ================================================================
           CODE BLOCK
           ================================================================ */
        
        .code-block {
            background: #0F172A;
            border-radius: var(--radius-lg);
            padding: var(--space-5);
            overflow-x: auto;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .code-block pre {
            margin: 0;
            font-family: var(--font-mono);
            font-size: 13px;
            line-height: 1.6;
            color: #E2E8F0;
            white-space: pre-wrap;
        }
        
        .code-comment { color: #64748B; }
        .code-keyword { color: #F59E0B; }
        .code-number { color: #10B981; }
        
        /* ================================================================
           BADGES
           ================================================================ */
        
        .badge {
            display: inline-flex;
            align-items: center;
            padding: 2px 8px;
            font-size: 11px;
            font-weight: 500;
            border-radius: var(--radius-sm);
        }
        
        .badge-success {
            background: rgba(5, 150, 105, 0.1);
            color: var(--color-success);
        }
        
        .badge-warning {
            background: rgba(217, 119, 6, 0.1);
            color: var(--color-warning);
        }
        
        .badge-info {
            background: rgba(37, 99, 235, 0.1);
            color: var(--color-info);
        }
        
        /* ================================================================
           RESPONSIVE
           ================================================================ */
        
        @media (max-width: 768px) {
            .sidebar {
                display: none;
            }
            
            .main {
                margin-left: 0;
            }
            
            .grid-2, .grid-3 {
                grid-template-columns: 1fr;
            }
            
            .part-grid {
                grid-template-columns: 1fr;
            }
            
            .price-value {
                font-size: 36px;
            }
        }
    </style>
</head>
<body>
    <div class="app">
        <!-- ============================================================
             SIDEBAR
             ============================================================ -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">
                    <div class="sidebar-logo-icon">CP</div>
                    <div class="sidebar-logo-text">CNC Planner <span>Pro</span></div>
                </div>
            </div>
            
            <nav class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-section-title">Kalkulation</div>
                    <button class="nav-item active" onclick="showSection('part')">
                        <span class="nav-item-icon">‚óª</span>
                        <span>Teil ausw√§hlen</span>
                    </button>
                    <button class="nav-item" onclick="showSection('params')">
                        <span class="nav-item-icon">‚öô</span>
                        <span>Parameter</span>
                    </button>
                    <button class="nav-item" onclick="showSection('result')">
                        <span class="nav-item-icon">‚Ç¨</span>
                        <span>Ergebnis</span>
                    </button>
                </div>
                
                <div class="nav-section">
                    <div class="nav-section-title">Ausgabe</div>
                    <button class="nav-item" onclick="showSection('quote')">
                        <span class="nav-item-icon">üìÑ</span>
                        <span>Angebot</span>
                    </button>
                    <button class="nav-item" onclick="showSection('code')">
                        <span class="nav-item-icon">&lt;/&gt;</span>
                        <span>NC-Code</span>
                    </button>
                </div>
            </nav>
            
            <div class="sidebar-footer">
                <button class="nav-item" onclick="showSection('settings')">
                    <span class="nav-item-icon">‚öô</span>
                    <span>Einstellungen</span>
                </button>
            </div>
        </aside>
        
        <!-- ============================================================
             MAIN CONTENT
             ============================================================ -->
        <main class="main">
            <header class="main-header">
                <h1 class="main-title" id="mainTitle">Teil ausw√§hlen</h1>
                <div class="main-actions">
                    <button class="btn btn-secondary btn-sm" onclick="exportCSV()">CSV</button>
                    <button class="btn btn-primary btn-sm" onclick="generatePDF()">PDF Export</button>
                </div>
            </header>
            
            <div class="main-content">
                <!-- ========================================
                     SECTION: TEIL AUSW√ÑHLEN
                     ======================================== -->
                <div class="section active" id="section-part">
                    <div class="part-grid" id="partGrid">
                        <!-- Filled by JS -->
                    </div>
                    
                    <div class="info-box">
                        <strong>Anwendungsbereich:</strong> Prismatische Fr√§steile, 3-Achs-Bearbeitung, Standardwerkstoffe (Stahl, Edelstahl, Aluminium).<br>
                        <strong>Genauigkeit:</strong> ¬±15% f√ºr Standardteile. Aufspannungen werden manuell gew√§hlt (keine automatische Geometrieerkennung).
                    </div>
                </div>
                
                <!-- ========================================
                     SECTION: PARAMETER
                     ======================================== -->
                <div class="section" id="section-params">
                    <div class="grid-2" style="margin-bottom: var(--space-6);">
                        <!-- Werkst√ºck -->
                        <div class="card">
                            <div class="card-header">Werkst√ºck</div>
                            <div class="card-body">
                                <div class="form-group">
                                    <label class="form-label">Werkstoff</label>
                                    <select class="select" id="materialSelect" onchange="calculate()">
                                        <optgroup label="Edelstahl">
                                            <option value="1.4301">1.4301 (V2A)</option>
                                            <option value="1.4571">1.4571</option>
                                        </optgroup>
                                        <optgroup label="Baustahl">
                                            <option value="S235JR" selected>S235JR</option>
                                            <option value="S355J2">S355J2</option>
                                        </optgroup>
                                        <optgroup label="Aluminium">
                                            <option value="AlMg3">AlMg3</option>
                                            <option value="AlMgSi1">AlMgSi1</option>
                                        </optgroup>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">Rohma√üe</label>
                                    <div class="dimension-group">
                                        <div class="form-group">
                                            <div class="input-with-unit">
                                                <input type="number" class="input input-mono" id="dimX" value="440" oninput="calculate()">
                                                <span class="input-unit">mm</span>
                                            </div>
                                        </div>
                                        <span class="dimension-separator">√ó</span>
                                        <div class="form-group">
                                            <div class="input-with-unit">
                                                <input type="number" class="input input-mono" id="dimY" value="50" oninput="calculate()">
                                                <span class="input-unit">mm</span>
                                            </div>
                                        </div>
                                        <span class="dimension-separator">√ó</span>
                                        <div class="form-group">
                                            <div class="input-with-unit">
                                                <input type="number" class="input input-mono" id="dimZ" value="20" oninput="calculate()">
                                                <span class="input-unit">mm</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">St√ºckzahl</label>
                                    <div class="input-with-unit" style="width: 120px;">
                                        <input type="number" class="input input-mono" id="quantity" value="1" min="1" oninput="calculate()">
                                        <span class="input-unit">Stk</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Fertigung -->
                        <div class="card">
                            <div class="card-header">Fertigung</div>
                            <div class="card-body">
                                <div class="form-group">
                                    <label class="form-label">Spannung</label>
                                    <select class="select" id="clampingSelect" onchange="calculate()">
                                        <option value="schraubstock">Schraubstock (15 min)</option>
                                        <option value="schraubstock2">2√ó Schraubstock (25 min)</option>
                                        <option value="tischspannung">Tischspannung (35 min)</option>
                                        <option value="nullpunkt">Nullpunktspannsystem (5 min)</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">Aufspannungen</label>
                                    <select class="select" id="setupCount" onchange="calculate()">
                                        <option value="1">1 Aufspannung</option>
                                        <option value="2" selected>2 Aufspannungen</option>
                                        <option value="3">3 Aufspannungen</option>
                                        <option value="4">4+ Aufspannungen</option>
                                    </select>
                                </div>
                                
                                <div class="info-box" style="margin-top: var(--space-4);">
                                    <strong>Einrichtzeit:</strong> <span id="setupTimeDisplay">25 min</span> = <span id="setupCostDisplay">‚Ç¨35,42</span>
                                </div>
                                
                                <div style="margin-top: var(--space-5);">
                                    <label class="form-label form-label-caps">Zus√§tzliche Arbeitsg√§nge</label>
                                    <div style="display: flex; flex-direction: column; gap: var(--space-3); margin-top: var(--space-2);">
                                        <div class="checkbox-group">
                                            <input type="checkbox" class="checkbox" id="opEntgraten" checked onchange="calculate()">
                                            <label class="checkbox-label" for="opEntgraten">Entgraten</label>
                                            <div class="input-with-unit" style="width: 80px; margin-left: auto;">
                                                <input type="number" class="input input-sm input-mono" id="opEntgratenTime" value="5" onchange="calculate()">
                                                <span class="input-unit">min</span>
                                            </div>
                                        </div>
                                        <div class="checkbox-group">
                                            <input type="checkbox" class="checkbox" id="opSaegen" onchange="calculate()">
                                            <label class="checkbox-label" for="opSaegen">S√§gen</label>
                                            <div class="input-with-unit" style="width: 80px; margin-left: auto;">
                                                <input type="number" class="input input-sm input-mono" id="opSaegenTime" value="3" onchange="calculate()">
                                                <span class="input-unit">min</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <button class="btn btn-primary" onclick="showSection('result')">Kalkulation anzeigen ‚Üí</button>
                </div>
                
                <!-- ========================================
                     SECTION: ERGEBNIS
                     ======================================== -->
                <div class="section" id="section-result">
                    <div class="price-hero">
                        <div class="price-label">St√ºckpreis</div>
                        <div class="price-value" id="priceDisplay">‚Ç¨64,89</div>
                        <div class="price-detail">inkl. Material, Bearbeitung, Einrichtung</div>
                    </div>
                    
                    <div class="grid-2">
                        <!-- Kostenaufschl√ºsselung -->
                        <div class="card">
                            <div class="card-header">Kostenaufschl√ºsselung</div>
                            <div class="cost-breakdown" style="border: none; border-radius: 0;">
                                <div class="cost-row">
                                    <div>
                                        <div class="cost-label">Material</div>
                                        <div class="cost-formula" id="matFormula">2,2 kg √ó ‚Ç¨6,79/kg</div>
                                    </div>
                                    <div class="cost-value" id="matCost">‚Ç¨14,93</div>
                                </div>
                                <div class="cost-row">
                                    <div>
                                        <div class="cost-label">Bearbeitung</div>
                                        <div class="cost-formula" id="machFormula">12,5 min √ó ‚Ç¨91/h</div>
                                    </div>
                                    <div class="cost-value" id="machCost">‚Ç¨18,96</div>
                                </div>
                                <div class="cost-row">
                                    <div>
                                        <div class="cost-label">Einrichtung</div>
                                        <div class="cost-formula" id="setupFormula">25 min √ó ‚Ç¨91/h √∑ 1 Stk</div>
                                    </div>
                                    <div class="cost-value" id="setupCost">‚Ç¨37,92</div>
                                </div>
                                <div class="cost-row">
                                    <div class="cost-label">Werkzeugverschlei√ü</div>
                                    <div class="cost-value" id="toolCost">‚Ç¨20,74</div>
                                </div>
                                <div class="cost-row subtotal">
                                    <div class="cost-label">Herstellkosten</div>
                                    <div class="cost-value" id="totalCost">‚Ç¨58,99</div>
                                </div>
                                <div class="cost-row">
                                    <div class="cost-label">+ Marge (<span id="marginDisplay">10</span>%)</div>
                                    <div class="cost-value" id="marginCost">‚Ç¨5,90</div>
                                </div>
                                <div class="cost-row total">
                                    <div class="cost-label">Verkaufspreis</div>
                                    <div class="cost-value" id="sellPrice">‚Ç¨64,89</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Mengenstaffel -->
                        <div class="card">
                            <div class="card-header">Mengenstaffel</div>
                            <div class="card-body">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>St√ºckzahl</th>
                                            <th class="right">Pro St√ºck</th>
                                            <th class="right">Gesamt</th>
                                        </tr>
                                    </thead>
                                    <tbody id="quantityTable">
                                        <!-- Filled by JS -->
                                    </tbody>
                                </table>
                                
                                <div class="info-box" style="margin-top: var(--space-4);">
                                    Bei gr√∂√üeren Mengen sinkt der St√ºckpreis, da Einrichtkosten verteilt werden.
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Marge anpassen -->
                    <div class="card" style="margin-top: var(--space-5);">
                        <div class="card-body" style="display: flex; align-items: center; gap: var(--space-4);">
                            <span style="color: var(--color-text-secondary);">Marge anpassen:</span>
                            <div class="input-with-unit" style="width: 100px;">
                                <input type="number" class="input input-mono" id="marginInput" value="10" min="0" max="100" oninput="calculate()">
                                <span class="input-unit">%</span>
                            </div>
                            <span style="margin-left: auto; color: var(--color-text-secondary);">Gesamtauftragswert:</span>
                            <strong style="font-size: 18px; font-family: var(--font-mono);" id="orderTotal">‚Ç¨64,89</strong>
                        </div>
                    </div>
                </div>
                
                <!-- ========================================
                     SECTION: ANGEBOT
                     ======================================== -->
                <div class="section" id="section-quote">
                    <div class="card">
                        <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
                            <span>Angebot ANG-2026-0042</span>
                            <div style="display: flex; gap: var(--space-2);">
                                <button class="btn btn-secondary btn-sm">E-Mail</button>
                                <button class="btn btn-primary btn-sm" onclick="generatePDF()">PDF</button>
                            </div>
                        </div>
                        <div class="card-body">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Pos.</th>
                                        <th>Beschreibung</th>
                                        <th class="right">Menge</th>
                                        <th class="right">EP (‚Ç¨)</th>
                                        <th class="right">GP (‚Ç¨)</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>1</td>
                                        <td id="quoteDesc">Verbindungsplatte 2500473...</td>
                                        <td class="right mono" id="quoteQty">1</td>
                                        <td class="right mono" id="quoteEP">64,89</td>
                                        <td class="right mono" id="quoteGP">64,89</td>
                                    </tr>
                                </tbody>
                            </table>
                            
                            <div style="margin-top: var(--space-5); padding-top: var(--space-4); border-top: 1px solid var(--color-border);">
                                <div style="display: flex; justify-content: flex-end; gap: var(--space-8);">
                                    <div style="text-align: right;">
                                        <div style="margin-bottom: var(--space-2);">
                                            <span style="color: var(--color-text-secondary);">Zwischensumme:</span>
                                            <span class="mono" style="margin-left: var(--space-4);" id="quoteSubtotal">‚Ç¨64,89</span>
                                        </div>
                                        <div style="margin-bottom: var(--space-2);">
                                            <span style="color: var(--color-text-secondary);">+ MwSt. 19%:</span>
                                            <span class="mono" style="margin-left: var(--space-4);" id="quoteMwst">‚Ç¨12,33</span>
                                        </div>
                                        <div style="font-size: 16px; font-weight: 600; padding-top: var(--space-2); border-top: 2px solid var(--color-primary);">
                                            <span>GESAMTBETRAG:</span>
                                            <span class="mono" style="margin-left: var(--space-4); color: var(--color-primary);" id="quoteTotal">‚Ç¨77,22</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- ========================================
                     SECTION: NC-CODE
                     ======================================== -->
                <div class="section" id="section-code">
                    <div class="card">
                        <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
                            <div style="display: flex; gap: var(--space-2);">
                                <button class="btn btn-primary btn-sm" id="btnHeidenhain">Heidenhain</button>
                                <button class="btn btn-secondary btn-sm" id="btnSiemens">Siemens</button>
                                <button class="btn btn-secondary btn-sm" id="btnFanuc">Fanuc</button>
                            </div>
                            <div style="display: flex; gap: var(--space-2);">
                                <button class="btn btn-secondary btn-sm" onclick="copyCode()">Kopieren</button>
                                <button class="btn btn-primary btn-sm" onclick="downloadCode()">Download</button>
                            </div>
                        </div>
                        <div class="card-body" style="padding: 0;">
                            <div class="code-block" id="codeBlock">
<pre><span class="code-comment">; ========================================</span>
<span class="code-comment">; VERBINDUNGSPLATTE</span>
<span class="code-comment">; Zeichnungsnr: 2500473.01.11.02.00.001</span>
<span class="code-comment">; Werkstoff: S235JR</span>
<span class="code-comment">; ========================================</span>
<span class="code-keyword">BEGIN PGM</span> VERBINDUNGSPLATTE <span class="code-keyword">MM</span>

<span class="code-keyword">TOOL DEF</span> <span class="code-number">1</span> L+<span class="code-number">0</span> R+<span class="code-number">25</span>    <span class="code-comment">; Planfr√§ser √ò50</span>
<span class="code-keyword">TOOL DEF</span> <span class="code-number">2</span> L+<span class="code-number">0</span> R+<span class="code-number">8</span>     <span class="code-comment">; VHM-Fr√§ser √ò16</span>

<span class="code-comment">; OP10: PLANFR√ÑSEN</span>
<span class="code-keyword">TOOL CALL</span> <span class="code-number">1</span> Z S<span class="code-number">1200</span>
L Z+<span class="code-number">100</span> R0 FMAX M3
L X+<span class="code-number">0</span> Y+<span class="code-number">0</span> FMAX

<span class="code-keyword">END PGM</span></pre>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- ========================================
                     SECTION: EINSTELLUNGEN
                     ======================================== -->
                <div class="section" id="section-settings">
                    <div class="grid-2">
                        <!-- Stundens√§tze -->
                        <div class="card">
                            <div class="card-header">Stundens√§tze</div>
                            <div class="card-body">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Arbeitsgang</th>
                                            <th class="right">Lohn (‚Ç¨/h)</th>
                                            <th class="right">Maschine (‚Ç¨/h)</th>
                                            <th class="right">Gesamt</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>CNC-Bearbeitung</td>
                                            <td class="right"><input type="number" class="input input-sm input-mono" value="49" id="rateCncLabor" onchange="updateRates()" style="width: 70px;"></td>
                                            <td class="right"><input type="number" class="input input-sm input-mono" value="42" id="rateCncMachine" onchange="updateRates()" style="width: 70px;"></td>
                                            <td class="right mono" id="rateCncTotal">‚Ç¨91</td>
                                        </tr>
                                        <tr>
                                            <td>S√§gen</td>
                                            <td class="right"><input type="number" class="input input-sm input-mono" value="43" id="rateSaegenLabor" onchange="updateRates()" style="width: 70px;"></td>
                                            <td class="right"><input type="number" class="input input-sm input-mono" value="12" id="rateSaegenMachine" onchange="updateRates()" style="width: 70px;"></td>
                                            <td class="right mono" id="rateSaegenTotal">‚Ç¨55</td>
                                        </tr>
                                        <tr>
                                            <td>Entgraten</td>
                                            <td class="right"><input type="number" class="input input-sm input-mono" value="32" id="rateEntgratenLabor" onchange="updateRates()" style="width: 70px;"></td>
                                            <td class="right"><input type="number" class="input input-sm input-mono" value="4" id="rateEntgratenMachine" onchange="updateRates()" style="width: 70px;"></td>
                                            <td class="right mono" id="rateEntgratenTotal">‚Ç¨36</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <!-- Materialpreise -->
                        <div class="card">
                            <div class="card-header">Materialpreise (‚Ç¨/kg)</div>
                            <div class="card-body">
                                <div class="grid-2" style="gap: var(--space-3);">
                                    <div class="form-group">
                                        <label class="form-label">S235JR</label>
                                        <input type="number" class="input input-mono" value="6.79" step="0.01" id="matS235JR" onchange="updateMaterials()">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">1.4301</label>
                                        <input type="number" class="input input-mono" value="8.50" step="0.01" id="mat14301" onchange="updateMaterials()">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">1.4571</label>
                                        <input type="number" class="input input-mono" value="14.00" step="0.01" id="mat14571" onchange="updateMaterials()">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">AlMg3</label>
                                        <input type="number" class="input input-mono" value="6.50" step="0.01" id="matAlMg3" onchange="updateMaterials()">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Sonstige Einstellungen -->
                    <div class="card" style="margin-top: var(--space-5);">
                        <div class="card-header">Sonstige Einstellungen</div>
                        <div class="card-body">
                            <div class="grid-3">
                                <div class="form-group">
                                    <label class="form-label">Werkzeugverschlei√ü pauschal (‚Ç¨)</label>
                                    <input type="number" class="input input-mono" value="20.74" step="0.01" id="settingToolWear" onchange="calculate()">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Materialverschnitt (%)</label>
                                    <input type="number" class="input input-mono" value="10" id="settingScrap" onchange="calculate()">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">MwSt. (%)</label>
                                    <input type="number" class="input input-mono" value="19" id="settingVat" onchange="calculate()">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-top: var(--space-5); display: flex; gap: var(--space-3);">
                        <button class="btn btn-primary" onclick="saveSettings()">Einstellungen speichern</button>
                        <button class="btn btn-secondary" onclick="resetSettings()">Zur√ºcksetzen</button>
                    </div>
                    
                    <p style="margin-top: var(--space-4); font-size: 12px; color: var(--color-text-muted);">
                        Einstellungen werden lokal im Browser gespeichert (localStorage).
                    </p>
                </div>
            </div>
        </main>
    </div>
    
    <!-- ================================================================
         JAVASCRIPT
         ================================================================ -->
    <script>
        // ================================================================
        // DATA
        // ================================================================
        
        const MATERIALS = {
            'S235JR': { name: 'S235JR', price: 6.79, density: 7.85, timeFactor: 1.00 },
            'S355J2': { name: 'S355J2', price: 7.50, density: 7.85, timeFactor: 1.02 },
            '1.4301': { name: '1.4301 (V2A)', price: 8.50, density: 7.90, timeFactor: 1.25 },
            '1.4571': { name: '1.4571', price: 14.00, density: 8.00, timeFactor: 1.35 },
            'AlMg3': { name: 'AlMg3', price: 6.50, density: 2.66, timeFactor: 0.65 },
            'AlMgSi1': { name: 'AlMgSi1', price: 7.00, density: 2.70, timeFactor: 0.68 }
        };
        
        const CLAMPING_TIMES = {
            'schraubstock': 15,
            'schraubstock2': 25,
            'tischspannung': 35,
            'nullpunkt': 5
        };
        
        const PROJECTS = {
            verbindungsplatte: {
                id: 'verbindungsplatte',
                name: 'Verbindungsplatte',
                partNumber: '2500473.01.11.02.00.001',
                material: 'S235JR',
                dims: { x: 440, y: 50, z: 20 },
                baseTime: 12.5,
                unitPrice: 28.40,
                thumbnail: 'demo-parts/2500473.01.11.02.00.001.pdf.png'
            },
            adapterplatte: {
                id: 'adapterplatte',
                name: 'Adapterplatte',
                partNumber: '2500473.01.01.02.01.001',
                material: 'AlMg3',
                dims: { x: 85, y: 70, z: 55 },
                baseTime: 24.8,
                unitPrice: 52.15,
                thumbnail: 'demo-parts/2500473.01.01.02.01.001.pdf.png'
            }
        };
        
        let RATES = {
            cnc: { labor: 49, machine: 42 },
            saegen: { labor: 43, machine: 12 },
            entgraten: { labor: 32, machine: 4 }
        };
        
        let currentProject = null;
        let currentSection = 'part';
        
        // ================================================================
        // NAVIGATION
        // ================================================================
        
        const SECTION_TITLES = {
            'part': 'Teil ausw√§hlen',
            'params': 'Parameter',
            'result': 'Ergebnis',
            'quote': 'Angebot',
            'code': 'NC-Code',
            'settings': 'Einstellungen'
        };
        
        function showSection(name) {
            currentSection = name;
            
            // Update nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            event.currentTarget.classList.add('active');
            
            // Update sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById('section-' + name).classList.add('active');
            
            // Update title
            document.getElementById('mainTitle').textContent = SECTION_TITLES[name] || name;
        }
        
        // ================================================================
        // PART SELECTION
        // ================================================================
        
        function renderPartGrid() {
            const grid = document.getElementById('partGrid');
            grid.innerHTML = Object.values(PROJECTS).map(p => `
                <div class="part-card ${currentProject?.id === p.id ? 'selected' : ''}" onclick="selectProject('${p.id}')">
                    <div class="part-thumb">
                        <img src="${p.thumbnail}" alt="${p.name}" onerror="this.parentElement.innerHTML='<span style=\\'color:var(--color-text-muted);font-size:11px;\\'>Keine Vorschau</span>'">
                    </div>
                    <div class="part-info">
                        <div class="part-name">${p.name}</div>
                        <div class="part-number">${p.partNumber}</div>
                        <div class="part-meta">
                            <span>${p.baseTime} min</span>
                            <span>${p.material}</span>
                            <span class="part-price">‚Ç¨${p.unitPrice.toFixed(2).replace('.', ',')}</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        function selectProject(id) {
            currentProject = PROJECTS[id];
            
            // Update form values
            document.getElementById('materialSelect').value = currentProject.material;
            document.getElementById('dimX').value = currentProject.dims.x;
            document.getElementById('dimY').value = currentProject.dims.y;
            document.getElementById('dimZ').value = currentProject.dims.z;
            
            // Re-render grid to show selection
            renderPartGrid();
            
            // Calculate and show params
            calculate();
            showSection('params');
        }
        
        // ================================================================
        // CALCULATION
        // ================================================================
        
        function calculate() {
            const mat = MATERIALS[document.getElementById('materialSelect').value];
            const x = parseFloat(document.getElementById('dimX').value) || 100;
            const y = parseFloat(document.getElementById('dimY').value) || 100;
            const z = parseFloat(document.getElementById('dimZ').value) || 20;
            const qty = parseInt(document.getElementById('quantity').value) || 1;
            const margin = parseFloat(document.getElementById('marginInput').value) || 10;
            const scrap = parseFloat(document.getElementById('settingScrap')?.value) || 10;
            const toolWear = parseFloat(document.getElementById('settingToolWear')?.value) || 20.74;
            const vat = parseFloat(document.getElementById('settingVat')?.value) || 19;
            
            // Clamping & Setup
            const clampingType = document.getElementById('clampingSelect').value;
            const setupCount = parseInt(document.getElementById('setupCount').value) || 1;
            const baseSetupTime = CLAMPING_TIMES[clampingType] || 15;
            const totalSetupTime = baseSetupTime + (setupCount - 1) * (baseSetupTime * 0.6);
            
            // Machine rate
            const cncRate = RATES.cnc.labor + RATES.cnc.machine;
            
            // Setup cost
            const setupCost = (totalSetupTime / 60) * cncRate;
            const setupCostPerPiece = setupCost / qty;
            
            // Volume & Weight
            const volumeMm3 = x * y * z;
            const volumeCm3 = volumeMm3 / 1000;
            const weightKg = (volumeCm3 * mat.density) / 1000;
            
            // Material cost (with scrap)
            const materialCost = weightKg * mat.price * (1 + scrap / 100);
            
            // Machining time (based on reference)
            const refVolume = currentProject ? (currentProject.dims.x * currentProject.dims.y * currentProject.dims.z) / 1000 : 440;
            const baseTime = currentProject ? currentProject.baseTime : 12.5;
            const sizeFactor = volumeCm3 / refVolume;
            const machiningTime = baseTime * Math.pow(sizeFactor, 0.7) * mat.timeFactor;
            
            // Machine cost
            const machineCost = (machiningTime / 60) * cncRate;
            
            // Optional operations
            let additionalCost = 0;
            if (document.getElementById('opEntgraten').checked) {
                const entgratenTime = parseFloat(document.getElementById('opEntgratenTime').value) || 5;
                const entgratenRate = RATES.entgraten.labor + RATES.entgraten.machine;
                additionalCost += (entgratenTime / 60) * entgratenRate;
            }
            if (document.getElementById('opSaegen').checked) {
                const saegenTime = parseFloat(document.getElementById('opSaegenTime').value) || 3;
                const saegenRate = RATES.saegen.labor + RATES.saegen.machine;
                additionalCost += (saegenTime / 60) * saegenRate;
            }
            
            // Tool cost (adjusted for material)
            const toolCost = toolWear * mat.timeFactor;
            
            // Total costs
            const totalCost = materialCost + machineCost + setupCostPerPiece + toolCost + additionalCost;
            const marginAmount = totalCost * (margin / 100);
            const sellPrice = totalCost + marginAmount;
            const orderTotal = sellPrice * qty;
            
            // MwSt
            const mwstAmount = sellPrice * (vat / 100);
            const totalWithVat = sellPrice + mwstAmount;
            
            // Update Setup Display
            document.getElementById('setupTimeDisplay').textContent = Math.round(totalSetupTime) + ' min';
            document.getElementById('setupCostDisplay').textContent = '‚Ç¨' + setupCost.toFixed(2).replace('.', ',');
            
            // Update Result Display
            document.getElementById('priceDisplay').textContent = '‚Ç¨' + sellPrice.toFixed(2).replace('.', ',');
            document.getElementById('matCost').textContent = '‚Ç¨' + materialCost.toFixed(2).replace('.', ',');
            document.getElementById('matFormula').textContent = weightKg.toFixed(2).replace('.', ',') + ' kg √ó ‚Ç¨' + mat.price.toFixed(2).replace('.', ',') + '/kg';
            document.getElementById('machCost').textContent = '‚Ç¨' + machineCost.toFixed(2).replace('.', ',');
            document.getElementById('machFormula').textContent = machiningTime.toFixed(1).replace('.', ',') + ' min √ó ‚Ç¨' + cncRate + '/h';
            document.getElementById('setupCost').textContent = '‚Ç¨' + setupCostPerPiece.toFixed(2).replace('.', ',');
            document.getElementById('setupFormula').textContent = Math.round(totalSetupTime) + ' min √ó ‚Ç¨' + cncRate + '/h √∑ ' + qty + ' Stk';
            document.getElementById('toolCost').textContent = '‚Ç¨' + toolCost.toFixed(2).replace('.', ',');
            document.getElementById('totalCost').textContent = '‚Ç¨' + totalCost.toFixed(2).replace('.', ',');
            document.getElementById('marginDisplay').textContent = margin;
            document.getElementById('marginCost').textContent = '‚Ç¨' + marginAmount.toFixed(2).replace('.', ',');
            document.getElementById('sellPrice').textContent = '‚Ç¨' + sellPrice.toFixed(2).replace('.', ',');
            document.getElementById('orderTotal').textContent = '‚Ç¨' + orderTotal.toFixed(2).replace('.', ',');
            
            // Quantity Table
            const qtys = [1, 5, 10, 25, 50];
            document.getElementById('quantityTable').innerHTML = qtys.map(q => {
                const setupPerPiece = setupCost / q;
                const unitCost = materialCost + machineCost + setupPerPiece + toolCost + additionalCost;
                const unitSell = unitCost * (1 + margin / 100);
                const totalSell = unitSell * q;
                return `<tr>
                    <td class="mono">${q}</td>
                    <td class="right mono">‚Ç¨${unitSell.toFixed(2).replace('.', ',')}</td>
                    <td class="right mono">‚Ç¨${totalSell.toFixed(2).replace('.', ',')}</td>
                </tr>`;
            }).join('');
            
            // Quote
            const projectName = currentProject ? currentProject.name + ' ' + currentProject.partNumber : 'Bauteil';
            document.getElementById('quoteDesc').textContent = projectName;
            document.getElementById('quoteQty').textContent = qty;
            document.getElementById('quoteEP').textContent = sellPrice.toFixed(2).replace('.', ',');
            document.getElementById('quoteGP').textContent = orderTotal.toFixed(2).replace('.', ',');
            document.getElementById('quoteSubtotal').textContent = '‚Ç¨' + orderTotal.toFixed(2).replace('.', ',');
            document.getElementById('quoteMwst').textContent = '‚Ç¨' + (mwstAmount * qty).toFixed(2).replace('.', ',');
            document.getElementById('quoteTotal').textContent = '‚Ç¨' + (totalWithVat * qty).toFixed(2).replace('.', ',');
        }
        
        // ================================================================
        // SETTINGS
        // ================================================================
        
        function updateRates() {
            RATES.cnc.labor = parseFloat(document.getElementById('rateCncLabor').value) || 49;
            RATES.cnc.machine = parseFloat(document.getElementById('rateCncMachine').value) || 42;
            RATES.saegen.labor = parseFloat(document.getElementById('rateSaegenLabor').value) || 43;
            RATES.saegen.machine = parseFloat(document.getElementById('rateSaegenMachine').value) || 12;
            RATES.entgraten.labor = parseFloat(document.getElementById('rateEntgratenLabor').value) || 32;
            RATES.entgraten.machine = parseFloat(document.getElementById('rateEntgratenMachine').value) || 4;
            
            document.getElementById('rateCncTotal').textContent = '‚Ç¨' + (RATES.cnc.labor + RATES.cnc.machine);
            document.getElementById('rateSaegenTotal').textContent = '‚Ç¨' + (RATES.saegen.labor + RATES.saegen.machine);
            document.getElementById('rateEntgratenTotal').textContent = '‚Ç¨' + (RATES.entgraten.labor + RATES.entgraten.machine);
            
            calculate();
        }
        
        function updateMaterials() {
            MATERIALS['S235JR'].price = parseFloat(document.getElementById('matS235JR').value) || 6.79;
            MATERIALS['1.4301'].price = parseFloat(document.getElementById('mat14301').value) || 8.50;
            MATERIALS['1.4571'].price = parseFloat(document.getElementById('mat14571').value) || 14.00;
            MATERIALS['AlMg3'].price = parseFloat(document.getElementById('matAlMg3').value) || 6.50;
            calculate();
        }
        
        function saveSettings() {
            const settings = { RATES, MATERIALS };
            localStorage.setItem('cncplanner_settings', JSON.stringify(settings));
            alert('Einstellungen gespeichert.');
        }
        
        function loadSettings() {
            const saved = localStorage.getItem('cncplanner_settings');
            if (saved) {
                const settings = JSON.parse(saved);
                Object.assign(RATES, settings.RATES);
                Object.assign(MATERIALS, settings.MATERIALS);
            }
        }
        
        function resetSettings() {
            localStorage.removeItem('cncplanner_settings');
            location.reload();
        }
        
        // ================================================================
        // EXPORT
        // ================================================================
        
        function generatePDF() {
            window.print();
        }
        
        function exportCSV() {
            alert('CSV Export ‚Äî Coming soon');
        }
        
        function copyCode() {
            const code = document.querySelector('#codeBlock pre').textContent;
            navigator.clipboard.writeText(code);
            alert('Code kopiert!');
        }
        
        function downloadCode() {
            const code = document.querySelector('#codeBlock pre').textContent;
            const blob = new Blob([code], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'programm.h';
            a.click();
        }
        
        // ================================================================
        // INIT
        // ================================================================
        
        document.addEventListener('DOMContentLoaded', function() {
            loadSettings();
            renderPartGrid();
            calculate();
        });
    </script>
</body>
</html>
