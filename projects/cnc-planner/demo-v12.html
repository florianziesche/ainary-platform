<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CNC Planner Pro — Vollständige Demo</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        /* === LANDING PAGE DESIGN SYSTEM === */
        :root {
            --primary: #1e3a5f;
            --primary-dark: #0f2840;
            --primary-light: #2d5a8a;
            --accent: #2563eb;
            --accent-dark: #1d4ed8;
            --success: #059669;
            --warning: #d97706;
            --danger: #dc2626;
            --gray-50: #f8fafc;
            --gray-100: #f1f5f9;
            --gray-200: #e2e8f0;
            --gray-300: #cbd5e1;
            --gray-400: #94a3b8;
            --gray-500: #64748b;
            --gray-600: #475569;
            --gray-700: #334155;
            --gray-800: #1e293b;
            --gray-900: #0f172a;
            --radius: 6px;
            --radius-lg: 12px;
            --shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--gray-100);
            color: var(--gray-800);
            line-height: 1.6;
        }

        /* Header */
        .header {
            background: white;
            border-bottom: 1px solid var(--gray-200);
            padding: 16px 24px;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-inner {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            text-decoration: none;
        }

        .logo-icon {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 0.9rem;
        }

        .logo-text {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--gray-900);
        }

        .logo-text span { color: var(--accent); }

        /* Buttons */
        .btn {
            padding: 10px 20px;
            border-radius: var(--radius);
            font-weight: 500;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid transparent;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
        }

        .btn-secondary {
            background: white;
            color: var(--gray-700);
            border-color: var(--gray-300);
        }

        .btn-secondary:hover {
            background: var(--gray-50);
            border-color: var(--gray-400);
        }

        .btn-accent {
            background: var(--accent);
            color: white;
        }

        .btn-accent:hover {
            background: var(--accent-dark);
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 0.8rem;
        }

        /* Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 32px 24px;
        }

        /* Section Header */
        .section-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .section-badge {
            display: inline-block;
            background: var(--gray-100);
            color: var(--primary);
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-bottom: 16px;
            border: 1px solid var(--gray-200);
        }

        .section-title {
            font-size: 2rem;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: 12px;
        }

        .section-subtitle {
            font-size: 1.1rem;
            color: var(--gray-500);
            max-width: 600px;
            margin: 0 auto;
        }

        /* App Demo */
        .app-demo {
            background: white;
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            overflow: hidden;
        }

        .app-tabs {
            display: flex;
            background: var(--gray-50);
            border-bottom: 1px solid var(--gray-200);
        }

        .app-tab {
            padding: 16px 24px;
            background: none;
            border: none;
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--gray-500);
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }

        .app-tab:hover {
            color: var(--gray-700);
            background: white;
        }

        .app-tab.active {
            color: var(--primary);
            background: white;
        }

        .app-tab.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--primary);
        }

        .app-content {
            padding: 24px;
            min-height: 600px;
        }

        .tab-panel {
            display: none;
        }

        .tab-panel.active {
            display: block;
        }

        /* Quote Preview */
        .quote-preview {
            background: white;
            border: 1px solid var(--gray-200);
            border-radius: var(--radius);
            padding: 32px;
        }

        .quote-header-row {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 32px;
            padding-bottom: 16px;
            border-bottom: 2px solid var(--primary);
        }

        .quote-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
        }

        .quote-meta {
            text-align: right;
            font-size: 0.85rem;
            color: var(--gray-600);
        }

        .quote-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 24px;
        }

        .quote-table th {
            background: var(--gray-100);
            text-align: left;
            padding: 12px;
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--gray-600);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .quote-table td {
            padding: 12px;
            border-bottom: 1px solid var(--gray-200);
        }

        .quote-table .price {
            text-align: right;
            font-family: 'JetBrains Mono', monospace;
        }

        .quote-total {
            background: var(--gray-50);
            padding: 20px;
            border-radius: var(--radius);
        }

        .quote-total-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            font-size: 0.9rem;
        }

        .quote-total-row.grand {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--primary);
            border-top: 2px solid var(--primary);
            margin-top: 12px;
            padding-top: 16px;
        }

        /* Calculation Section */
        .calc-section {
            background: var(--gray-50);
            border-radius: var(--radius);
            padding: 24px;
            margin-bottom: 20px;
        }

        .calc-section h4 {
            font-size: 0.95rem;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .calc-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85rem;
        }

        .calc-table th {
            background: var(--gray-200);
            padding: 10px 12px;
            text-align: left;
            font-weight: 500;
            color: var(--gray-700);
        }

        .calc-table td {
            padding: 10px 12px;
            border-bottom: 1px solid var(--gray-200);
            background: white;
        }

        .calc-table .formula {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
            color: var(--primary);
            background: var(--gray-100);
            padding: 2px 6px;
            border-radius: 4px;
        }

        .calc-table .result {
            font-weight: 600;
            color: var(--accent);
        }

        .calc-note {
            background: #eff6ff;
            border-left: 3px solid var(--primary);
            padding: 16px;
            font-size: 0.85rem;
            color: var(--gray-700);
            margin-top: 16px;
            border-radius: 0 var(--radius) var(--radius) 0;
        }

        .tool-total {
            background: var(--accent);
            color: white;
            padding: 16px 20px;
            border-radius: var(--radius);
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 16px;
        }

        .tool-total-label { font-weight: 500; }
        .tool-total-value { font-size: 1.4rem; font-weight: 700; }

        /* Cost Summary Grid */
        .cost-summary-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-top: 20px;
        }

        .cost-card {
            background: rgba(255,255,255,0.15);
            padding: 20px;
            border-radius: var(--radius);
            text-align: center;
        }

        .cost-card-label {
            font-size: 0.8rem;
            opacity: 0.8;
        }

        .cost-card-value {
            font-size: 1.5rem;
            font-weight: 700;
            margin: 4px 0;
        }

        .cost-card-detail {
            font-size: 0.75rem;
            opacity: 0.7;
        }

        .cost-card.total {
            background: rgba(255,255,255,0.25);
        }

        .cost-card.total .cost-card-value {
            font-size: 1.8rem;
        }

        /* Code Block */
        .code-block {
            background: var(--gray-900);
            border-radius: var(--radius);
            padding: 24px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
            color: #e2e8f0;
            overflow-x: auto;
            max-height: 500px;
            overflow-y: auto;
        }

        .code-block pre {
            margin: 0;
            white-space: pre-wrap;
        }

        .code-comment { color: #718096; }
        .code-keyword { color: #f6ad55; }
        .code-number { color: #68d391; }
        .code-gcode { color: #90cdf4; }
        .code-mcode { color: #fc8181; }

        /* Instruction Section */
        .instruction-section {
            background: white;
            border: 1px solid var(--gray-200);
            border-radius: var(--radius);
            margin-bottom: 16px;
            overflow: hidden;
        }

        .instruction-section.critical {
            border-color: var(--danger);
        }

        .instruction-header {
            background: var(--gray-50);
            padding: 14px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            border-bottom: 1px solid var(--gray-200);
        }

        .instruction-header.critical {
            background: #fef2f2;
        }

        .instruction-header h4 {
            font-size: 0.95rem;
            font-weight: 600;
            color: var(--gray-800);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .op-badge {
            background: var(--primary);
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .op-badge.critical {
            background: var(--danger);
        }

        .badge {
            font-size: 0.7rem;
            padding: 3px 8px;
            border-radius: 4px;
            font-weight: 500;
        }

        .badge-critical {
            background: #fef2f2;
            color: var(--danger);
        }

        .badge-info {
            background: #eff6ff;
            color: var(--accent);
        }

        .instruction-content {
            padding: 20px;
        }

        .params-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin-bottom: 16px;
        }

        .param-item {
            background: var(--gray-50);
            padding: 12px;
            border-radius: var(--radius);
            text-align: center;
            border: 1px solid var(--gray-200);
        }

        .param-item.critical {
            border-color: var(--danger);
        }

        .param-label {
            font-size: 0.7rem;
            color: var(--gray-500);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .param-value {
            font-size: 1rem;
            font-weight: 600;
            color: var(--gray-800);
            font-family: 'JetBrains Mono', monospace;
        }

        .param-value.critical {
            color: var(--danger);
        }

        .tips-list {
            list-style: none;
            margin: 0;
            padding: 0;
        }

        .tips-list li {
            padding: 10px 0;
            font-size: 0.85rem;
            color: var(--gray-600);
            display: flex;
            align-items: flex-start;
            gap: 10px;
            border-bottom: 1px solid var(--gray-100);
        }

        .tips-list li:last-child {
            border-bottom: none;
        }

        .tip-icon {
            flex-shrink: 0;
            width: 20px;
            height: 20px;
            background: var(--gray-200);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            color: var(--gray-600);
        }

        .tip-icon.warning {
            background: #fef3c7;
            color: var(--warning);
        }

        .tip-icon.danger {
            background: #fef2f2;
            color: var(--danger);
        }

        .tip-icon.success {
            background: #ecfdf5;
            color: var(--success);
        }

        /* Warning Box */
        .warning-box {
            background: #fef9e6;
            border-left: 4px solid var(--warning);
            padding: 16px 20px;
            border-radius: 0 var(--radius) var(--radius) 0;
            margin-bottom: 24px;
        }

        .warning-box strong {
            color: #92400e;
        }

        .warning-box span {
            color: #78350f;
        }

        .danger-box {
            background: #fef2f2;
            border-left: 4px solid var(--danger);
            padding: 16px 20px;
            border-radius: 0 var(--radius) var(--radius) 0;
            margin-bottom: 16px;
        }

        .danger-box strong {
            color: var(--danger);
            font-size: 0.85rem;
        }

        /* Info Grid */
        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            margin-bottom: 24px;
        }

        .info-table {
            font-size: 0.85rem;
            width: 100%;
        }

        .info-table td {
            padding: 6px 0;
        }

        .info-table td:first-child {
            color: var(--gray-500);
            width: 40%;
        }

        .info-table strong {
            color: var(--gray-800);
        }

        /* ROI Calculator */
        .roi-section {
            background: white;
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-lg);
            padding: 32px;
            margin-bottom: 40px;
        }

        .roi-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
        }

        .roi-inputs h3,
        .roi-results h3 {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--gray-800);
            margin-bottom: 24px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            font-size: 0.85rem;
            font-weight: 500;
            color: var(--gray-700);
            margin-bottom: 6px;
        }

        .input-group input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--gray-300);
            border-radius: var(--radius);
            font-size: 1rem;
            font-family: 'JetBrains Mono', monospace;
        }

        .input-group input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(30, 58, 95, 0.1);
        }

        .input-group .hint {
            font-size: 0.75rem;
            color: var(--gray-400);
            margin-top: 4px;
        }

        .result-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid var(--gray-200);
        }

        .result-label {
            color: var(--gray-600);
        }

        .result-value {
            font-weight: 600;
            font-family: 'JetBrains Mono', monospace;
        }

        .result-value.positive {
            color: var(--success);
        }

        .result-value.negative {
            color: var(--gray-500);
        }

        .roi-highlight {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            padding: 24px;
            border-radius: var(--radius);
            margin-top: 24px;
            text-align: center;
        }

        .roi-highlight-label {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-bottom: 8px;
        }

        .roi-highlight-value {
            font-size: 3rem;
            font-weight: 700;
        }

        .roi-highlight-value span {
            font-size: 1.5rem;
            opacity: 0.8;
        }

        /* Quality Check Table */
        .quality-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85rem;
        }

        .quality-table th {
            background: var(--gray-100);
            padding: 10px 12px;
            text-align: left;
            font-weight: 500;
        }

        .quality-table td {
            padding: 10px 12px;
            border-bottom: 1px solid var(--gray-200);
        }

        .quality-table .check {
            color: var(--success);
            font-weight: 600;
        }

        /* AI Badge */
        .ai-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: white;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: 600;
        }

        /* Collapsible Sections */
        .collapsible-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            user-select: none;
        }

        .collapsible-header:hover {
            opacity: 0.8;
        }

        .collapse-icon {
            font-size: 0.8rem;
            color: var(--gray-500);
            transition: transform 0.2s;
        }

        .collapsible-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }

        .collapsible-content.expanded {
            max-height: 2000px;
        }

        .calc-detail-row {
            display: none;
            background: var(--gray-50);
        }

        .calc-detail-row.visible {
            display: table-row;
        }

        .calc-detail-cell {
            padding: 12px 16px;
            font-size: 0.8rem;
            border-left: 3px solid var(--accent);
        }

        .calc-breakdown {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }

        .calc-breakdown-item {
            background: white;
            padding: 10px;
            border-radius: var(--radius);
            border: 1px solid var(--gray-200);
        }

        .calc-breakdown-label {
            font-size: 0.7rem;
            color: var(--gray-500);
            text-transform: uppercase;
        }

        .calc-breakdown-value {
            font-size: 0.9rem;
            font-weight: 600;
            font-family: 'JetBrains Mono', monospace;
        }

        .expand-row {
            cursor: pointer;
        }

        .expand-row:hover {
            background: var(--gray-50);
        }

        .expand-icon {
            display: inline-block;
            width: 16px;
            text-align: center;
            color: var(--accent);
            font-weight: bold;
        }

        /* Project Cards */
        .projects-section {
            margin-bottom: 32px;
        }

        .projects-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }

        .project-card {
            background: white;
            border: 2px solid var(--gray-200);
            border-radius: var(--radius-lg);
            padding: 20px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .project-card:hover {
            border-color: var(--primary);
            box-shadow: var(--shadow-md);
        }

        .project-card.active {
            border-color: var(--primary);
            background: linear-gradient(135deg, rgba(30, 58, 95, 0.03), rgba(37, 99, 235, 0.03));
        }

        .project-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .project-name {
            font-weight: 600;
            color: var(--gray-900);
        }

        .project-date {
            font-size: 0.75rem;
            color: var(--gray-400);
        }

        .project-meta {
            display: flex;
            gap: 16px;
            font-size: 0.85rem;
            color: var(--gray-600);
            margin-bottom: 12px;
        }

        .project-tags {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .project-tag {
            background: var(--gray-100);
            color: var(--gray-600);
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 500;
        }

        .project-tag.success {
            background: #ecfdf5;
            color: var(--success);
        }

        /* === NEW FEATURES === */

        /* Rohmaß Editor */
        .dimension-editor {
            background: white;
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-lg);
            padding: 24px;
            margin-bottom: 24px;
        }

        .dimension-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-bottom: 20px;
        }

        .dim-input {
            text-align: center;
        }

        .dim-input label {
            display: block;
            font-size: 0.75rem;
            color: var(--gray-500);
            margin-bottom: 4px;
            text-transform: uppercase;
        }

        .dim-input input {
            width: 100%;
            padding: 10px;
            border: 2px solid var(--gray-200);
            border-radius: var(--radius);
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.1rem;
            text-align: center;
            transition: all 0.2s;
        }

        .dim-input input:focus {
            border-color: var(--accent);
            outline: none;
        }

        .dim-input .unit {
            font-size: 0.7rem;
            color: var(--gray-400);
            margin-top: 2px;
        }

        .live-result {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: linear-gradient(135deg, var(--gray-50), var(--gray-100));
            padding: 16px 20px;
            border-radius: var(--radius);
            border: 1px solid var(--gray-200);
        }

        .live-result-item {
            text-align: center;
        }

        .live-result-label {
            font-size: 0.7rem;
            color: var(--gray-500);
            text-transform: uppercase;
            margin-bottom: 4px;
        }

        .live-result-value {
            font-size: 1.5rem;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
            color: var(--primary);
        }

        .live-result-value.updating {
            color: var(--accent);
            animation: pulse 0.3s;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        /* Serienkalkulation */
        .series-calc {
            background: white;
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-lg);
            padding: 24px;
            margin-bottom: 24px;
        }

        .series-inputs {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 24px;
        }

        .series-results {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        .series-result-card {
            background: var(--gray-50);
            padding: 16px;
            border-radius: var(--radius);
            text-align: center;
            border: 1px solid var(--gray-200);
        }

        .series-result-card.highlight {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            border: none;
        }

        .series-result-card .label {
            font-size: 0.75rem;
            opacity: 0.8;
            margin-bottom: 4px;
        }

        .series-result-card .value {
            font-size: 1.3rem;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
        }

        .breakeven-chart {
            height: 200px;
            background: var(--gray-50);
            border-radius: var(--radius);
            position: relative;
            overflow: hidden;
            border: 1px solid var(--gray-200);
        }

        .breakeven-bar {
            position: absolute;
            bottom: 40px;
            height: 20px;
            border-radius: 3px;
            transition: all 0.3s;
        }

        .breakeven-bar.setup {
            background: var(--warning);
            left: 20px;
        }

        .breakeven-bar.runtime {
            background: var(--accent);
        }

        .breakeven-labels {
            position: absolute;
            bottom: 10px;
            left: 20px;
            right: 20px;
            display: flex;
            justify-content: space-between;
            font-size: 0.7rem;
            color: var(--gray-500);
        }

        .breakeven-marker {
            position: absolute;
            top: 10px;
            transform: translateX(-50%);
            background: var(--success);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
            white-space: nowrap;
        }

        .breakeven-marker::after {
            content: '';
            position: absolute;
            bottom: -20px;
            left: 50%;
            transform: translateX(-50%);
            width: 2px;
            height: 20px;
            background: var(--success);
        }

        /* Ist/Soll Vergleich */
        .comparison-section {
            background: white;
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-lg);
            padding: 24px;
            margin-bottom: 24px;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
        }

        .comparison-table th {
            background: var(--gray-100);
            padding: 12px;
            text-align: left;
            font-weight: 600;
            font-size: 0.85rem;
        }

        .comparison-table td {
            padding: 12px;
            border-bottom: 1px solid var(--gray-100);
            font-family: 'JetBrains Mono', monospace;
        }

        .comparison-table .op-name {
            font-family: 'Inter', sans-serif;
            font-weight: 500;
        }

        .diff-positive {
            color: var(--success);
            font-weight: 600;
        }

        .diff-negative {
            color: var(--danger);
            font-weight: 600;
        }

        .diff-neutral {
            color: var(--gray-400);
        }

        .diff-bar {
            height: 8px;
            border-radius: 4px;
            background: var(--gray-200);
            position: relative;
            overflow: hidden;
        }

        .diff-bar-fill {
            position: absolute;
            height: 100%;
            border-radius: 4px;
            transition: width 0.3s;
        }

        .diff-bar-fill.over {
            background: var(--danger);
            right: 50%;
        }

        .diff-bar-fill.under {
            background: var(--success);
            left: 50%;
        }

        .diff-bar-center {
            position: absolute;
            left: 50%;
            top: -2px;
            bottom: -2px;
            width: 2px;
            background: var(--gray-400);
        }

        .learning-indicator {
            display: flex;
            align-items: center;
            gap: 12px;
            background: linear-gradient(135deg, #ecfdf5, #d1fae5);
            padding: 16px;
            border-radius: var(--radius);
            margin-top: 16px;
        }

        .learning-icon {
            width: 40px;
            height: 40px;
            background: var(--success);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .learning-text {
            flex: 1;
        }

        .learning-text strong {
            display: block;
            color: var(--gray-900);
        }

        .learning-text span {
            font-size: 0.85rem;
            color: var(--gray-600);
        }

        .actual-input {
            width: 70px;
            padding: 6px 8px;
            border: 1px solid var(--gray-300);
            border-radius: var(--radius);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            text-align: center;
        }

        .actual-input:focus {
            border-color: var(--accent);
            outline: none;
        }

        /* Print Styles */
        @media print {
            body { background: white; }
            .header, .app-tabs, .btn { display: none; }
            .app-content { padding: 0; }
            .app-demo { box-shadow: none; border: none; }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .roi-grid,
            .info-grid,
            .params-grid,
            .cost-summary-grid {
                grid-template-columns: 1fr;
            }
            .app-tabs { overflow-x: auto; }
        }
    </style>
</head>
<body>

<!-- Header -->
<header class="header">
    <div class="header-inner">
        <a href="#" class="logo">
            <div class="logo-icon">CP</div>
            <div class="logo-text">CNC <span>Planner</span> Pro</div>
        </a>
        <div style="display: flex; gap: 12px;">
            <button class="btn btn-secondary btn-sm" onclick="exportCSV()">CSV Export</button>
            <button class="btn btn-primary btn-sm" onclick="window.print()">PDF</button>
        </div>
    </div>
</header>

<div class="container">
    <!-- Section Header -->
    <div class="section-header">
        <span class="section-badge">Kostenlose Analyse</span>
        <h2 class="section-title">Testen Sie CNC Planner Pro mit Ihrem Bauteil</h2>
        <p class="section-subtitle">Sehen Sie die Demo unten — oder senden Sie uns Ihre STEP-Datei für eine individuelle Analyse</p>
    </div>

    <!-- CTA: Eigenes Bauteil testen -->
    <div style="background: white; border: 1px solid var(--gray-200); border-radius: 12px; padding: 32px; max-width: 700px; margin: 0 auto 40px; text-align: center;">
        <h3 style="font-size: 1.1rem; font-weight: 600; color: var(--gray-800); margin-bottom: 8px;">Individuelle Analyse für Ihr Bauteil</h3>
        <p style="color: var(--gray-500); font-size: 0.9rem; margin-bottom: 20px;">Laden Sie Ihre STEP- oder PDF-Datei hoch — wir senden Ihnen die vollständige Kalkulation per E-Mail.</p>
        <div style="display: flex; gap: 12px; justify-content: center; flex-wrap: wrap;">
            <input type="email" placeholder="ihre@email.de" style="padding: 12px 16px; border: 1px solid var(--gray-300); border-radius: var(--radius); font-size: 0.95rem; width: 220px;">
            <button class="btn btn-primary" onclick="alert('Demo-Modus: In der Vollversion können Sie hier Ihre Datei hochladen.')">Analyse anfordern</button>
        </div>
        <p style="font-size: 0.75rem; color: var(--gray-400); margin-top: 12px;">Kostenlos und unverbindlich — Antwort innerhalb von 24 Stunden</p>
    </div>

    <!-- Demo-Bereich Titel -->
    <div style="text-align: center; margin-bottom: 24px;">
        <span style="color: var(--gray-500); font-size: 0.9rem;">— oder erkunden Sie die interaktive Demo —</span>
    </div>

    <!-- ROI Calculator -->
    <div class="roi-section">
        <div class="roi-grid">
            <div class="roi-inputs">
                <h3>Ihre aktuellen Werte</h3>
                <div class="input-group">
                    <label>Angebote pro Monat</label>
                    <input type="number" id="quotesPerMonth" value="20" min="1" oninput="calculateROI()">
                    <span class="hint">Wie viele Anfragen kalkulieren Sie?</span>
                </div>
                <div class="input-group">
                    <label>Zeit pro Kalkulation (Minuten)</label>
                    <input type="number" id="timePerQuote" value="60" min="5" oninput="calculateROI()">
                    <span class="hint">Inkl. Recherche, Berechnung, Angebotserstellung</span>
                </div>
                <div class="input-group">
                    <label>Stundenlohn Kalkulation (€)</label>
                    <input type="number" id="hourlyRate" value="50" min="10" oninput="calculateROI()">
                    <span class="hint">Meister/Facharbeiter, der kalkuliert</span>
                </div>
                <div class="input-group">
                    <label>Maschinenstundensatz (€)</label>
                    <input type="number" id="machineRate" value="85" min="30" oninput="calculateROI()">
                    <span class="hint">Ihr durchschnittlicher Satz</span>
                </div>
            </div>
            <div class="roi-results">
                <h3>Ihre Ersparnis mit CNC Planner Pro</h3>
                <div class="result-row">
                    <span class="result-label">Zeitaufwand aktuell</span>
                    <span class="result-value negative" id="currentTime">20 h/Monat</span>
                </div>
                <div class="result-row">
                    <span class="result-label">Zeitaufwand mit CNC Planner</span>
                    <span class="result-value positive" id="newTime">3,3 h/Monat</span>
                </div>
                <div class="result-row">
                    <span class="result-label">Eingesparte Zeit</span>
                    <span class="result-value positive" id="timeSaved">16,7 h/Monat</span>
                </div>
                <div class="result-row">
                    <span class="result-label">Wert der Ersparnis</span>
                    <span class="result-value positive" id="moneySaved">€ 835/Monat</span>
                </div>
                <div class="result-row">
                    <span class="result-label">CNC Planner Pro kostet</span>
                    <span class="result-value" id="softwareCost">€ 49/Monat</span>
                </div>
                <div class="roi-highlight">
                    <div class="roi-highlight-label">Ihr Return on Investment</div>
                    <div class="roi-highlight-value" id="roiValue">17<span>x</span></div>
                </div>
            </div>
        </div>
    </div>

    <!-- ============ ROHMASZE & WERKSTOFF ============ -->
    <div class="dimension-editor">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <div>
                <h3 style="font-size: 1.1rem; font-weight: 600; color: var(--gray-800); margin-bottom: 4px;">Werkstück-Parameter</h3>
                <p style="font-size: 0.85rem; color: var(--gray-500);">Rohmaße und Werkstoff anpassen — Kosten berechnen sich automatisch</p>
            </div>
            <span class="badge badge-info">Live-Kalkulation</span>
        </div>
        
        <!-- Werkstoff Auswahl -->
        <div style="margin-bottom: 20px;">
            <label style="display: block; font-size: 0.75rem; color: var(--gray-500); margin-bottom: 6px; text-transform: uppercase;">Werkstoff</label>
            <select id="materialSelect" onchange="recalculateAll()" style="width: 100%; padding: 12px 16px; border: 2px solid var(--gray-200); border-radius: var(--radius); font-size: 1rem; background: white; cursor: pointer;">
                <option value="1.4571" selected>1.4571 (V4A) — Edelstahl rostfrei</option>
                <option value="1.4301">1.4301 (V2A) — Edelstahl</option>
                <option value="42CrMo4">42CrMo4 — Vergütungsstahl</option>
                <option value="S355">S355 — Baustahl</option>
                <option value="AlMg3">AlMg3 — Aluminium</option>
                <option value="CuZn39Pb3">CuZn39Pb3 — Messing</option>
            </select>
        </div>

        <!-- Rohmaße -->
        <div class="dimension-grid" style="grid-template-columns: repeat(4, 1fr);">
            <div class="dim-input">
                <label id="labelDimX">Länge (X)</label>
                <input type="number" id="dimX" value="130" min="10" max="1000" oninput="recalculateAll()">
                <div class="unit">mm</div>
            </div>
            <div class="dim-input">
                <label id="labelDimY">Breite (Y)</label>
                <input type="number" id="dimY" value="130" min="10" max="1000" oninput="recalculateAll()">
                <div class="unit">mm</div>
            </div>
            <div class="dim-input">
                <label>Höhe (Z)</label>
                <input type="number" id="dimZ" value="47" min="5" max="500" oninput="recalculateAll()">
                <div class="unit">mm</div>
            </div>
            <div class="dim-input">
                <label>Aufmaß</label>
                <input type="number" id="dimAllowance" value="5" min="1" max="20" oninput="recalculateAll()">
                <div class="unit">mm pro Seite</div>
            </div>
        </div>

        <!-- Ergebnisse -->
        <div class="live-result" style="margin-top: 20px;">
            <div class="live-result-item">
                <div class="live-result-label">Rohteil-Gewicht</div>
                <div class="live-result-value" id="liveWeight">4,87 kg</div>
            </div>
            <div class="live-result-item">
                <div class="live-result-label">Materialkosten</div>
                <div class="live-result-value" id="liveMaterialCost">€ 34,09</div>
            </div>
            <div class="live-result-item">
                <div class="live-result-label">Bearbeitungszeit</div>
                <div class="live-result-value" id="liveTime">41,8 min</div>
            </div>
            <div class="live-result-item">
                <div class="live-result-label">Maschinenkosten</div>
                <div class="live-result-value" id="liveMachineCost">€ 59,22</div>
            </div>
        </div>

        <!-- Gesamtkosten -->
        <div style="background: linear-gradient(135deg, var(--primary), var(--primary-light)); color: white; padding: 20px; border-radius: var(--radius); margin-top: 16px; display: flex; justify-content: space-between; align-items: center;">
            <div>
                <div style="font-size: 0.85rem; opacity: 0.9;">Gesamtkosten pro Teil</div>
                <div style="font-size: 0.75rem; opacity: 0.7;">Material + Bearbeitung + Werkzeugverschleiß</div>
            </div>
            <div style="font-size: 2rem; font-weight: 700; font-family: 'JetBrains Mono', monospace;" id="liveTotalCost">€ 122,07</div>
        </div>
    </div>

    <!-- ============ FEATURE 3: IST/SOLL VERGLEICH ============ -->
    <div class="comparison-section">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <div>
                <h3 style="font-size: 1.1rem; font-weight: 600; color: var(--gray-800); margin-bottom: 4px;">Ist/Soll-Vergleich</h3>
                <p style="font-size: 0.85rem; color: var(--gray-500);">Tatsächliche Zeiten erfassen — Abweichungen dokumentieren</p>
            </div>
            <span class="badge badge-info">Qualitätssicherung</span>
        </div>
        <table class="comparison-table">
            <thead>
                <tr>
                    <th>Operation</th>
                    <th style="text-align: center;">Soll (min)</th>
                    <th style="text-align: center;">Ist (min)</th>
                    <th style="text-align: center;">Differenz</th>
                    <th style="width: 150px;">Abweichung</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td class="op-name">OP10 Planfräsen</td>
                    <td style="text-align: center;">2,7</td>
                    <td style="text-align: center;"><input type="number" class="actual-input" id="actual-op10" value="2.5" step="0.1" oninput="updateComparison()"></td>
                    <td style="text-align: center;" class="diff-positive" id="diff-op10">-0,2</td>
                    <td>
                        <div class="diff-bar">
                            <div class="diff-bar-center"></div>
                            <div class="diff-bar-fill under" id="bar-op10" style="width: 15%;"></div>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td class="op-name">OP20 Schruppen Außen</td>
                    <td style="text-align: center;">8,0</td>
                    <td style="text-align: center;"><input type="number" class="actual-input" id="actual-op20" value="8.3" step="0.1" oninput="updateComparison()"></td>
                    <td style="text-align: center;" class="diff-negative" id="diff-op20">+0,3</td>
                    <td>
                        <div class="diff-bar">
                            <div class="diff-bar-center"></div>
                            <div class="diff-bar-fill over" id="bar-op20" style="width: 8%;"></div>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td class="op-name">OP50 Schlichten h5</td>
                    <td style="text-align: center;">5,1</td>
                    <td style="text-align: center;"><input type="number" class="actual-input" id="actual-op50" value="5.4" step="0.1" oninput="updateComparison()"></td>
                    <td style="text-align: center;" class="diff-negative" id="diff-op50">+0,3</td>
                    <td>
                        <div class="diff-bar">
                            <div class="diff-bar-center"></div>
                            <div class="diff-bar-fill over" id="bar-op50" style="width: 12%;"></div>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td class="op-name">OP60 Feinbohren Ø26</td>
                    <td style="text-align: center;">4,1</td>
                    <td style="text-align: center;"><input type="number" class="actual-input" id="actual-op60" value="4.0" step="0.1" oninput="updateComparison()"></td>
                    <td style="text-align: center;" class="diff-positive" id="diff-op60">-0,1</td>
                    <td>
                        <div class="diff-bar">
                            <div class="diff-bar-center"></div>
                            <div class="diff-bar-fill under" id="bar-op60" style="width: 5%;"></div>
                        </div>
                    </td>
                </tr>
                <tr style="background: var(--gray-50); font-weight: 600;">
                    <td>GESAMT</td>
                    <td style="text-align: center;">41,8</td>
                    <td style="text-align: center;" id="actualTotal">42,1</td>
                    <td style="text-align: center;" id="diffTotal" class="diff-negative">+0,3</td>
                    <td>
                        <div class="diff-bar">
                            <div class="diff-bar-center"></div>
                            <div class="diff-bar-fill over" id="bar-total" style="width: 3%;"></div>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Project Selection -->
    <div class="projects-section">
        <h3 style="font-size: 1rem; font-weight: 600; color: var(--gray-700); margin-bottom: 16px;">Beispielprojekte</h3>
        <div class="projects-grid">
            <div class="project-card active" onclick="loadProject('grundplatte')">
                <div class="project-header">
                    <div class="project-name">Grundplatte WCAD-15-02-2020</div>
                    <div class="project-date">Heute</div>
                </div>
                <div class="project-meta">
                    <span>41,8 min</span>
                    <span>1.4571</span>
                    <span>€122,07</span>
                </div>
                <div class="project-tags">
                    <span class="project-tag success">Vollständig</span>
                    <span class="project-tag">h5 Toleranz</span>
                </div>
            </div>
            <div class="project-card" onclick="loadProject('lagerbock')">
                <div class="project-header">
                    <div class="project-name">Lagerbock WZ-2024-118</div>
                    <div class="project-date">Gestern</div>
                </div>
                <div class="project-meta">
                    <span>28,5 min</span>
                    <span>42CrMo4</span>
                    <span>€85,20</span>
                </div>
                <div class="project-tags">
                    <span class="project-tag">Entwurf</span>
                </div>
            </div>
            <div class="project-card" onclick="loadProject('flansch')">
                <div class="project-header">
                    <div class="project-name">Flansch FL-889</div>
                    <div class="project-date">vor 3 Tagen</div>
                </div>
                <div class="project-meta">
                    <span>18,2 min</span>
                    <span>S355</span>
                    <span>€48,50</span>
                </div>
                <div class="project-tags">
                    <span class="project-tag success">Angebot erstellt</span>
                </div>
            </div>
        </div>
    </div>

    <!-- App Demo with Tabs -->
    <div class="app-demo">
        <div class="app-tabs">
            <button class="app-tab active" onclick="showTab('quote')">Angebot</button>
            <button class="app-tab" onclick="showTab('calculation')">Kalkulation</button>
            <button class="app-tab" onclick="showTab('code')">Maschinencode</button>
            <button class="app-tab" onclick="showTab('instructions')">Fertigungsanweisung</button>
        </div>

        <div class="app-content">
            <!-- ================ TAB: ANGEBOT ================ -->
            <div class="tab-panel active" id="panel-quote">
                <div style="display: flex; gap: 12px; margin-bottom: 24px;">
                    <button class="btn btn-primary btn-sm" onclick="window.print()">PDF drucken</button>
                    <button class="btn btn-secondary btn-sm">Per E-Mail senden</button>
                    <button class="btn btn-secondary btn-sm">Duplizieren</button>
                </div>

                <div class="quote-preview">
                    <div class="quote-header-row">
                        <div>
                            <div class="quote-title">ANGEBOT</div>
                            <div style="color: var(--gray-500); font-size: 0.85rem;">ANG-2026-0042</div>
                        </div>
                        <div class="quote-meta">
                            <div><strong>Ihre Firma GmbH</strong></div>
                            <div>Datum: 02.02.2026</div>
                            <div>Gültig bis: 04.03.2026</div>
                        </div>
                    </div>

                    <table class="quote-table">
                        <thead>
                            <tr>
                                <th>Pos.</th>
                                <th>Beschreibung</th>
                                <th>Menge</th>
                                <th class="price">EP (€)</th>
                                <th class="price">GP (€)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>1</td>
                                <td id="quoteDescription">
                                    <strong>Grundplatte WCAD-15-02-2020</strong><br>
                                    <span style="color: var(--gray-500); font-size: 0.8rem;">Zahnradpumpen-Gehäuse, Werkstoff V4A Edelstahl</span>
                                </td>
                                <td>10</td>
                                <td class="price" id="quoteUnitPrice">122,07</td>
                                <td class="price" id="quoteTotalPrice">1.220,70</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="quote-total">
                        <div class="quote-total-row">
                            <span>Zwischensumme:</span>
                            <span id="quoteSubtotal">1.220,70 €</span>
                        </div>
                        <div class="quote-total-row">
                            <span>zzgl. MwSt. 19%:</span>
                            <span id="quoteMwst">231,93 €</span>
                        </div>
                        <div class="quote-total-row grand">
                            <span>GESAMTBETRAG:</span>
                            <span id="quoteGrandTotal">1.452,63 €</span>
                        </div>
                    </div>

                    <div style="margin-top: 24px; padding-top: 24px; border-top: 1px solid var(--gray-200); font-size: 0.8rem; color: var(--gray-500);">
                        <strong>Zahlungsbedingungen:</strong> 14 Tage netto ab Rechnungsdatum<br>
                        <strong>Lieferzeit:</strong> ca. 3-4 Wochen nach Auftragseingang
                    </div>
                </div>
            </div>

            <!-- ================ TAB: KALKULATION ================ -->
            <div class="tab-panel" id="panel-calculation">
                <!-- Formel -->
                <div class="calc-section">
                    <h4>Berechnungsgrundlagen</h4>
                    <div class="calc-note">
                        <strong>Hauptzeit-Formel:</strong> t<sub>h</sub> = L / v<sub>f</sub> = L / (f × n)<br>
                        <span style="color: var(--gray-500);">t<sub>h</sub> = Hauptzeit [min] | L = Schnittweg [mm] | f = Vorschub [mm/U] | n = Drehzahl [U/min]</span>
                    </div>
                </div>

                <!-- Zeitberechnung -->
                <div class="calc-section">
                    <h4>Operationen und Bearbeitungszeiten</h4>
                    <p style="font-size: 0.8rem; color: var(--gray-500); margin-bottom: 16px;">Zeiten passen sich automatisch an Werkstoff und Bauteilgröße an</p>
                    <table class="calc-table" id="timeTable">
                        <thead>
                            <tr>
                                <th>OP</th>
                                <th>Beschreibung</th>
                                <th style="text-align: center;">Zeit (min)</th>
                            </tr>
                        </thead>
                        <tbody id="timeTableBody">
                            <!-- Wird dynamisch gefüllt -->
                        </tbody>
                    </table>
                </div>

                <!-- Werkzeugkosten -->
                <div class="calc-section" style="background: #fef9e6; border-left: 4px solid var(--warning);">
                    <h4>Werkzeugkosten-Kalkulation</h4>
                    <p style="font-size: 0.85rem; color: var(--gray-600); margin-bottom: 16px;">
                        Automatische Berechnung basierend auf Schnittzeit und Standzeit.
                    </p>
                    <table class="calc-table">
                        <thead>
                            <tr>
                                <th>Werkzeug</th>
                                <th>Preis</th>
                                <th>Standzeit</th>
                                <th>Einsatzzeit</th>
                                <th>Kosten/Teil</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>T1 — Planfräser Ø63 (WSP)</td>
                                <td>€45,00</td>
                                <td>60 min</td>
                                <td>1,9 min</td>
                                <td class="result">€1,43</td>
                            </tr>
                            <tr>
                                <td>T2 — VHM-Fräser Ø20</td>
                                <td>€120,00</td>
                                <td>180 min</td>
                                <td>11,2 min</td>
                                <td class="result">€7,47</td>
                            </tr>
                            <tr>
                                <td>T3 — VHM-Schlichtfräser Ø16</td>
                                <td>€95,00</td>
                                <td>120 min</td>
                                <td>7,4 min</td>
                                <td class="result">€5,86</td>
                            </tr>
                            <tr>
                                <td>T11 — Feinbohrkopf Ø26</td>
                                <td>€350,00</td>
                                <td>500 min</td>
                                <td>3,3 min</td>
                                <td class="result">€2,31</td>
                            </tr>
                            <tr>
                                <td>T12 — Feinbohrkopf Ø44</td>
                                <td>€380,00</td>
                                <td>500 min</td>
                                <td>3,8 min</td>
                                <td class="result">€2,89</td>
                            </tr>
                            <tr>
                                <td>T13 — Gewindefräser M8</td>
                                <td>€65,00</td>
                                <td>200 min</td>
                                <td>2,4 min</td>
                                <td class="result">€0,78</td>
                            </tr>
                            <tr style="background: var(--gray-100);">
                                <td colspan="4" style="text-align: right;"><strong>Summe Werkzeugkosten:</strong></td>
                                <td class="result"><strong>€20,74</strong></td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="tool-total">
                        <span class="tool-total-label">Werkzeugkosten pro Teil:</span>
                        <span class="tool-total-value">€20,74</span>
                    </div>
                    <div class="calc-note" style="margin-top: 16px; background: white;">
                        <strong>Hinweis:</strong> Bei 10 Teilen = €207,40 Werkzeugkosten. 
                        Bei hartem Werkstoff (1.4571) kann das 15-25% der Gesamtkosten sein.
                    </div>
                </div>

                <!-- Gesamtkalkulation -->
                <div class="calc-section" style="background: linear-gradient(135deg, var(--primary), var(--primary-light)); color: white;">
                    <h4 style="color: white;">Gesamtkalkulation pro Teil</h4>
                    <div class="cost-summary-grid">
                        <div class="cost-card">
                            <div class="cost-card-label">Maschinenzeit</div>
                            <div class="cost-card-value">€59,22</div>
                            <div class="cost-card-detail">41,8 min × €85/h</div>
                        </div>
                        <div class="cost-card">
                            <div class="cost-card-label">Material</div>
                            <div class="cost-card-value">€45,00</div>
                            <div class="cost-card-detail">Rohteil Ø135×50</div>
                        </div>
                        <div class="cost-card">
                            <div class="cost-card-label">Werkzeuge</div>
                            <div class="cost-card-value">€20,74</div>
                            <div class="cost-card-detail">Verschleiß anteilig</div>
                        </div>
                        <div class="cost-card total">
                            <div class="cost-card-label">GESAMT</div>
                            <div class="cost-card-value">€124,96</div>
                            <div class="cost-card-detail">Selbstkosten/Teil</div>
                        </div>
                    </div>
                    <div style="text-align: center; margin-top: 20px; padding-top: 16px; border-top: 1px solid rgba(255,255,255,0.2);">
                        <span style="opacity: 0.8;">Empfohlener Verkaufspreis (10% Marge):</span>
                        <strong style="font-size: 1.3rem; margin-left: 12px;">€137,50/Teil</strong>
                    </div>
                </div>
            </div>

            <!-- ================ TAB: MASCHINENCODE ================ -->
            <div class="tab-panel" id="panel-code">
                <div style="display: flex; gap: 12px; margin-bottom: 20px;">
                    <button class="btn btn-secondary btn-sm active">Heidenhain TNC</button>
                    <button class="btn btn-secondary btn-sm">Siemens 840D</button>
                    <button class="btn btn-secondary btn-sm">Fanuc</button>
                    <button class="btn btn-primary btn-sm" style="margin-left: auto;" onclick="copyCode()">📋 Kopieren</button>
                    <button class="btn btn-accent btn-sm" onclick="downloadCode()">⬇️ Download .H</button>
                </div>

                <div class="code-block" id="codeBlock">
<pre><span class="code-comment">; ============================================</span>
<span class="code-comment">; CNC PLANNER PRO — Automatisch generiert</span>
<span class="code-comment">; ============================================</span>
<span class="code-comment">; Werkstück:  Grundplatte WCAD-15-02-2020</span>
<span class="code-comment">; Werkstoff:  1.4571 (X6CrNiMoTi17-12-2)</span>
<span class="code-comment">; Maschine:   FEHLMANN VERSA 943</span>
<span class="code-comment">; Steuerung:  Heidenhain TNC 640</span>
<span class="code-comment">; Erstellt:   02.02.2026 12:00</span>
<span class="code-comment">; ============================================</span>

<span class="code-keyword">BEGIN PGM</span> GRUNDPLATTE <span class="code-keyword">MM</span>

<span class="code-comment">; --- WERKZEUGLISTE ---</span>
<span class="code-comment">; T1  = Planfräser Ø63 (WSP)</span>
<span class="code-comment">; T2  = VHM-Fräser Ø20</span>
<span class="code-comment">; T3  = VHM-Schlichtfräser Ø16</span>
<span class="code-comment">; T11 = Feinbohrkopf Ø26</span>
<span class="code-comment">; T12 = Feinbohrkopf Ø44</span>
<span class="code-comment">; T13 = Gewindefräser M8</span>

<span class="code-comment">; ============================================</span>
<span class="code-comment">; OP10: PLANFRÄSEN OBERSEITE</span>
<span class="code-comment">; Berechnet: t_h = 1,9 min | t_n = 0,8 min</span>
<span class="code-comment">; ============================================</span>

<span class="code-keyword">TOOL CALL</span> <span class="code-number">1</span> Z S<span class="code-number">800</span>
<span class="code-mcode">M3</span>
<span class="code-gcode">L</span> X+<span class="code-number">0</span> Y+<span class="code-number">0</span> Z+<span class="code-number">100</span> <span class="code-keyword">FMAX</span>
<span class="code-gcode">L</span> Z+<span class="code-number">2</span> F<span class="code-number">500</span>

<span class="code-keyword">CYCL DEF</span> <span class="code-number">230</span> <span class="code-keyword">FACE MILLING</span>
  Q<span class="code-number">225</span>=+<span class="code-number">0</span>      <span class="code-comment">;START POINT 1ST AXIS</span>
  Q<span class="code-number">226</span>=+<span class="code-number">0</span>      <span class="code-comment">;START POINT 2ND AXIS</span>
  Q<span class="code-number">227</span>=+<span class="code-number">0</span>      <span class="code-comment">;MILLING DEPTH</span>
  Q<span class="code-number">218</span>=<span class="code-number">150</span>     <span class="code-comment">;FIRST SIDE LENGTH</span>
  Q<span class="code-number">219</span>=<span class="code-number">150</span>     <span class="code-comment">;SECOND SIDE LENGTH</span>
  Q<span class="code-number">202</span>=<span class="code-number">2</span>       <span class="code-comment">;INFEED DEPTH</span>
  Q<span class="code-number">207</span>=<span class="code-number">300</span>     <span class="code-comment">;MILLING FEED RATE</span>

<span class="code-keyword">CYCL CALL</span>
<span class="code-gcode">L</span> Z+<span class="code-number">100</span> <span class="code-keyword">FMAX</span>
<span class="code-mcode">M5</span>

<span class="code-comment">; ============================================</span>
<span class="code-comment">; OP20: SCHRUPPEN AUSSENKONTUR Ø120</span>
<span class="code-comment">; Berechnet: t_h = 7,2 min | t_n = 0,8 min</span>
<span class="code-comment">; ACHTUNG: Aufmaß 0,3mm für Schlichtgang!</span>
<span class="code-comment">; ============================================</span>

<span class="code-keyword">TOOL CALL</span> <span class="code-number">2</span> Z S<span class="code-number">2500</span>
<span class="code-mcode">M3</span>
<span class="code-gcode">L</span> X+<span class="code-number">0</span> Y+<span class="code-number">0</span> Z+<span class="code-number">100</span> <span class="code-keyword">FMAX</span>

<span class="code-keyword">CYCL DEF</span> <span class="code-number">25</span> <span class="code-keyword">KONTUR</span>
  Q<span class="code-number">1</span>=+<span class="code-number">120.3</span>   <span class="code-comment">;DURCHMESSER (inkl. Aufmaß)</span>
  Q<span class="code-number">2</span>=+<span class="code-number">42</span>      <span class="code-comment">;TIEFE</span>
  Q<span class="code-number">3</span>=+<span class="code-number">3</span>       <span class="code-comment">;ZUSTELLUNG</span>
  Q<span class="code-number">6</span>=<span class="code-number">400</span>      <span class="code-comment">;VORSCHUB</span>

<span class="code-keyword">CYCL CALL</span>
<span class="code-gcode">L</span> Z+<span class="code-number">100</span> <span class="code-keyword">FMAX</span>

<span class="code-comment">; ============================================</span>
<span class="code-comment">; OP50: SCHLICHTEN Ø120 h5 — KRITISCH!</span>
<span class="code-comment">; Toleranz: 0 / -0,018 mm (nur 18 µm!)</span>
<span class="code-comment">; Berechnet: t_h = 4,3 min | t_n = 0,8 min</span>
<span class="code-comment">; ============================================</span>

<span class="code-keyword">TOOL CALL</span> <span class="code-number">3</span> Z S<span class="code-number">3000</span>
<span class="code-mcode">M3</span>

<span class="code-comment">; WERKZEUG VOR BEARBEITUNG AUF VERSCHLEISS PRÜFEN!</span>
<span class="code-mcode">M0</span> <span class="code-comment">;HALT - Werkzeugkontrolle</span>

<span class="code-keyword">CYCL DEF</span> <span class="code-number">25</span> <span class="code-keyword">KONTUR SCHLICHTEN</span>
  Q<span class="code-number">1</span>=+<span class="code-number">120</span>     <span class="code-comment">;DURCHMESSER FERTIGMASS</span>
  Q<span class="code-number">2</span>=+<span class="code-number">42</span>      <span class="code-comment">;TIEFE</span>
  Q<span class="code-number">3</span>=+<span class="code-number">0.15</span>    <span class="code-comment">;ZUSTELLUNG (Schlichten)</span>
  Q<span class="code-number">6</span>=<span class="code-number">250</span>      <span class="code-comment">;VORSCHUB</span>

<span class="code-keyword">CYCL CALL</span>
<span class="code-gcode">L</span> Z+<span class="code-number">100</span> <span class="code-keyword">FMAX</span>

<span class="code-comment">; ============================================</span>
<span class="code-comment">; OP60: FEINBOHREN Ø26 H7 — KRITISCH!</span>
<span class="code-comment">; Toleranz: +0,021 / 0 mm</span>
<span class="code-comment">; ============================================</span>

<span class="code-keyword">TOOL CALL</span> <span class="code-number">11</span> Z S<span class="code-number">1200</span>
<span class="code-mcode">M3</span>
<span class="code-gcode">L</span> X+<span class="code-number">0</span> Y+<span class="code-number">0</span> Z+<span class="code-number">10</span> <span class="code-keyword">FMAX</span>

<span class="code-keyword">CYCL DEF</span> <span class="code-number">201</span> <span class="code-keyword">BORING</span>
  Q<span class="code-number">200</span>=<span class="code-number">2</span>       <span class="code-comment">;SICHERHEITSABSTAND</span>
  Q<span class="code-number">201</span>=-<span class="code-number">35</span>     <span class="code-comment">;TIEFE</span>
  Q<span class="code-number">206</span>=<span class="code-number">100</span>     <span class="code-comment">;VORSCHUB TIEFENZUSTELLUNG</span>
  Q<span class="code-number">211</span>=<span class="code-number">50</span>      <span class="code-comment">;VERWEILZEIT UNTEN</span>

<span class="code-keyword">CYCL CALL</span>
<span class="code-gcode">L</span> Z+<span class="code-number">100</span> <span class="code-keyword">FMAX</span>

<span class="code-comment">; ============================================</span>
<span class="code-comment">; OP80+90: BOHREN UND GEWINDE 6×M8</span>
<span class="code-comment">; ============================================</span>

<span class="code-keyword">TOOL CALL</span> <span class="code-number">13</span> Z S<span class="code-number">800</span>
<span class="code-mcode">M3</span>

<span class="code-keyword">CYCL DEF</span> <span class="code-number">262</span> <span class="code-keyword">THREAD MILLING</span>
  Q<span class="code-number">335</span>=<span class="code-number">26</span>      <span class="code-comment">;NOMINAL DIAMETER</span>
  Q<span class="code-number">239</span>=<span class="code-number">1.25</span>    <span class="code-comment">;PITCH</span>
  Q<span class="code-number">201</span>=-<span class="code-number">20</span>     <span class="code-comment">;THREAD DEPTH</span>

<span class="code-comment">; Bohrkreis Ø75</span>
<span class="code-gcode">L</span> X+<span class="code-number">37.5</span> Y+<span class="code-number">0</span> <span class="code-keyword">FMAX</span>
<span class="code-keyword">CYCL CALL</span>
<span class="code-gcode">L</span> X+<span class="code-number">18.75</span> Y+<span class="code-number">32.48</span> <span class="code-keyword">FMAX</span>
<span class="code-keyword">CYCL CALL</span>
<span class="code-gcode">L</span> X-<span class="code-number">18.75</span> Y+<span class="code-number">32.48</span> <span class="code-keyword">FMAX</span>
<span class="code-keyword">CYCL CALL</span>
<span class="code-gcode">L</span> X-<span class="code-number">37.5</span> Y+<span class="code-number">0</span> <span class="code-keyword">FMAX</span>
<span class="code-keyword">CYCL CALL</span>
<span class="code-gcode">L</span> X-<span class="code-number">18.75</span> Y-<span class="code-number">32.48</span> <span class="code-keyword">FMAX</span>
<span class="code-keyword">CYCL CALL</span>
<span class="code-gcode">L</span> X+<span class="code-number">18.75</span> Y-<span class="code-number">32.48</span> <span class="code-keyword">FMAX</span>
<span class="code-keyword">CYCL CALL</span>

<span class="code-gcode">L</span> Z+<span class="code-number">100</span> <span class="code-keyword">FMAX</span>
<span class="code-mcode">M5</span>
<span class="code-mcode">M30</span>
<span class="code-keyword">END PGM</span> GRUNDPLATTE <span class="code-keyword">MM</span></pre>
                </div>

                <div style="margin-top: 20px; padding: 16px; background: var(--gray-50); border-radius: var(--radius); font-size: 0.85rem;">
                    <strong>Programm-Info:</strong> 127 Zeilen | Geschätzte Laufzeit: 41,8 min | Maschine: FEHLMANN VERSA 943
                </div>
            </div>

            <!-- ================ TAB: FERTIGUNGSANWEISUNG ================ -->
            <div class="tab-panel" id="panel-instructions">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                    <div style="display: flex; gap: 12px;">
                        <button class="btn btn-primary btn-sm" onclick="window.print()">PDF drucken</button>
                        <button class="btn btn-secondary btn-sm">Per E-Mail senden</button>
                    </div>
                    <span class="ai-badge">
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/></svg>
                        KI-generierte Anweisungen
                    </span>
                </div>

                <!-- Document Header -->
                <div style="background: var(--gray-50); border: 1px solid var(--gray-200); border-radius: var(--radius); padding: 24px; margin-bottom: 24px;">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 24px; padding-bottom: 16px; border-bottom: 3px solid var(--primary);">
                        <div>
                            <h3 style="color: var(--primary); font-size: 1.4rem; font-weight: 700;">FERTIGUNGSANWEISUNG</h3>
                            <p style="color: var(--gray-500);">Grundplatte — WCAD-15-02-2020</p>
                        </div>
                        <div style="text-align: right; font-size: 0.85rem; color: var(--gray-500);">
                            <div>Freigabe: 02.02.2026</div>
                            <div>Version: 1.0</div>
                        </div>
                    </div>

                    <div class="info-grid">
                        <div>
                            <h4 style="color: var(--gray-700); font-size: 0.9rem; margin-bottom: 12px;">Werkstück</h4>
                            <table class="info-table">
                                <tr><td>Werkstoff:</td><td><strong>1.4571</strong> (X6CrNiMoTi17-12-2)</td></tr>
                                <tr><td>Rohteil:</td><td>Ø135 × 50 mm</td></tr>
                                <tr><td>Fertigmaß:</td><td>Ø120 × 42 mm</td></tr>
                                <tr><td>Gewicht:</td><td>1,903 kg</td></tr>
                            </table>
                        </div>
                        <div>
                            <h4 style="color: var(--gray-700); font-size: 0.9rem; margin-bottom: 12px;">Maschine</h4>
                            <table class="info-table">
                                <tr><td>Maschine:</td><td><strong>FEHLMANN VERSA 943</strong></td></tr>
                                <tr><td>Steuerung:</td><td>Heidenhain TNC 640</td></tr>
                                <tr><td>Programm:</td><td>GRUNDPLATTE.H</td></tr>
                                <tr><td>Bearbeitungszeit:</td><td><strong>41,8 min</strong></td></tr>
                            </table>
                        </div>
                    </div>

                    <div class="warning-box">
                        <strong>Kritische Toleranzen:</strong>
                        <span>Ø120 h5 (0/-0,018mm) • Ø26 H7 (+0,021/0) • Ø44 H7 (+0,025/0)</span>
                    </div>
                </div>

                <!-- Operations -->
                <h4 style="color: var(--gray-700); font-size: 1rem; margin-bottom: 16px;">Arbeitsschritte mit Hinweisen</h4>

                <!-- OP10 -->
                <div class="instruction-section">
                    <div class="instruction-header">
                        <h4><span class="op-badge">OP10</span> Planfräsen Oberseite</h4>
                        <span style="color: var(--gray-500); font-size: 0.85rem;">2,7 min</span>
                    </div>
                    <div class="instruction-content">
                        <div class="params-grid">
                            <div class="param-item">
                                <div class="param-label">Werkzeug</div>
                                <div class="param-value">T1 Ø63</div>
                            </div>
                            <div class="param-item">
                                <div class="param-label">Drehzahl</div>
                                <div class="param-value">800</div>
                            </div>
                            <div class="param-item">
                                <div class="param-label">Vorschub</div>
                                <div class="param-value">300</div>
                            </div>
                            <div class="param-item">
                                <div class="param-label">Zustellung</div>
                                <div class="param-value">2 mm</div>
                            </div>
                        </div>
                        <ul class="tips-list">
                            <li><span class="tip-icon success">✓</span> Rohteil plan auf Maschinentisch spannen, Parallelität prüfen</li>
                            <li><span class="tip-icon">i</span> Fräsen im Gegenlauf für bessere Oberfläche bei 1.4571</li>
                        </ul>
                    </div>
                </div>

                <!-- OP20 -->
                <div class="instruction-section">
                    <div class="instruction-header">
                        <h4><span class="op-badge">OP20</span> Schruppen Außenkontur Ø120</h4>
                        <span style="color: var(--gray-500); font-size: 0.85rem;">8,0 min</span>
                    </div>
                    <div class="instruction-content">
                        <div class="params-grid">
                            <div class="param-item">
                                <div class="param-label">Werkzeug</div>
                                <div class="param-value">T2 Ø20</div>
                            </div>
                            <div class="param-item">
                                <div class="param-label">Drehzahl</div>
                                <div class="param-value">2500</div>
                            </div>
                            <div class="param-item">
                                <div class="param-label">Vorschub</div>
                                <div class="param-value">400</div>
                            </div>
                            <div class="param-item">
                                <div class="param-label">Aufmaß</div>
                                <div class="param-value">0,3 mm</div>
                            </div>
                        </div>
                        <ul class="tips-list">
                            <li><span class="tip-icon">i</span> Gleichlauffräsen bei austenitischem Stahl vermeiden — Kaltverfestigung!</li>
                            <li><span class="tip-icon warning">!</span> Kühlmittel-Druck mind. 20 bar, Späne kontinuierlich entfernen</li>
                            <li><span class="tip-icon">i</span> Aufmaß 0,3 mm für Schlichtgang belassen</li>
                        </ul>
                    </div>
                </div>

                <!-- OP50 - Kritisch -->
                <div class="instruction-section critical">
                    <div class="instruction-header critical">
                        <h4>
                            <span class="op-badge critical">OP50</span>
                            Schlichten Ø120 h5
                            <span class="badge badge-critical">KRITISCH</span>
                        </h4>
                        <span style="color: var(--gray-500); font-size: 0.85rem;">5,1 min</span>
                    </div>
                    <div class="instruction-content">
                        <div class="params-grid">
                            <div class="param-item">
                                <div class="param-label">Werkzeug</div>
                                <div class="param-value">T3 Ø16</div>
                            </div>
                            <div class="param-item">
                                <div class="param-label">Drehzahl</div>
                                <div class="param-value">3000</div>
                            </div>
                            <div class="param-item">
                                <div class="param-label">Vorschub</div>
                                <div class="param-value">250</div>
                            </div>
                            <div class="param-item critical">
                                <div class="param-label">Toleranz</div>
                                <div class="param-value critical">h5</div>
                            </div>
                        </div>
                        <div class="danger-box">
                            <strong>Toleranz h5 = 0 / -0,018 mm — Nur 18 µm Spielraum!</strong>
                        </div>
                        <ul class="tips-list">
                            <li><span class="tip-icon danger">!</span> <strong>Werkzeug vor Bearbeitung auf Verschleiß prüfen</strong> — Standzeit bei 1.4571 reduziert</li>
                            <li><span class="tip-icon danger">!</span> Werkstück-Temperatur beachten: Ausdehnung bei 20°C Abweichung = ~2 µm</li>
                            <li><span class="tip-icon warning">!</span> Nach Schlichtgang sofort messen — nicht auskühlen lassen</li>
                            <li><span class="tip-icon">i</span> Bei Erstmuster: Zwischenmessung nach 50% der Kontur empfohlen</li>
                            <li><span class="tip-icon success">✓</span> Ziel-Rauheit: Ra 1,6 — erreichbar mit diesen Parametern</li>
                        </ul>
                    </div>
                </div>

                <!-- OP60 - Kritisch -->
                <div class="instruction-section critical">
                    <div class="instruction-header critical">
                        <h4>
                            <span class="op-badge critical">OP60</span>
                            Feinbohren Ø26 H7
                            <span class="badge badge-critical">KRITISCH</span>
                        </h4>
                        <span style="color: var(--gray-500); font-size: 0.85rem;">4,1 min</span>
                    </div>
                    <div class="instruction-content">
                        <div class="params-grid">
                            <div class="param-item">
                                <div class="param-label">Werkzeug</div>
                                <div class="param-value">T11</div>
                            </div>
                            <div class="param-item">
                                <div class="param-label">Drehzahl</div>
                                <div class="param-value">1200</div>
                            </div>
                            <div class="param-item">
                                <div class="param-label">Vorschub</div>
                                <div class="param-value">100</div>
                            </div>
                            <div class="param-item critical">
                                <div class="param-label">Toleranz</div>
                                <div class="param-value critical">H7</div>
                            </div>
                        </div>
                        <ul class="tips-list">
                            <li><span class="tip-icon danger">!</span> <strong>Feinbohrkopf-Einstellung dokumentieren</strong> — reproduzierbar für Serie</li>
                            <li><span class="tip-icon warning">!</span> Bohrung vor Feinbohren auf Rundheit prüfen (max. 0,01 mm)</li>
                            <li><span class="tip-icon">i</span> Ausfahren mit reduziertem Vorschub (50 mm/min) für saubere Oberfläche</li>
                        </ul>
                    </div>
                </div>

                <!-- Quality Check -->
                <div class="instruction-section">
                    <div class="instruction-header">
                        <h4>Qualitätsprüfung nach Bearbeitung</h4>
                        <span class="badge badge-info">QS</span>
                    </div>
                    <div class="instruction-content">
                        <table class="quality-table">
                            <thead>
                                <tr>
                                    <th>Prüfmerkmal</th>
                                    <th>Soll</th>
                                    <th>Prüfmittel</th>
                                    <th>Prüfung</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Ø120 h5</td>
                                    <td>120,000 / 119,982</td>
                                    <td>Mikrometer</td>
                                    <td class="check">□</td>
                                </tr>
                                <tr>
                                    <td>Ø26 H7</td>
                                    <td>26,000 / 26,021</td>
                                    <td>Innenmessschraube</td>
                                    <td class="check">□</td>
                                </tr>
                                <tr>
                                    <td>Ø44 H7</td>
                                    <td>44,000 / 44,025</td>
                                    <td>Innenmessschraube</td>
                                    <td class="check">□</td>
                                </tr>
                                <tr>
                                    <td>Höhe 42 mm</td>
                                    <td>42,0 ±0,1</td>
                                    <td>Höhenmessschieber</td>
                                    <td class="check">□</td>
                                </tr>
                                <tr>
                                    <td>Ra Oberfläche</td>
                                    <td>≤ 1,6 µm</td>
                                    <td>Rauheitsmessgerät</td>
                                    <td class="check">□</td>
                                </tr>
                                <tr>
                                    <td>Gewinde M8</td>
                                    <td>6H</td>
                                    <td>Gewindelehrdorn</td>
                                    <td class="check">□</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Troubleshooting -->
                <div class="instruction-section">
                    <div class="instruction-header">
                        <h4>Problemlösung</h4>
                        <span class="badge badge-info">Hilfe</span>
                    </div>
                    <div class="instruction-content">
                        <table class="quality-table">
                            <thead>
                                <tr>
                                    <th>Problem</th>
                                    <th>Mögliche Ursache</th>
                                    <th>Maßnahme</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Ø120 zu klein</td>
                                    <td>Werkzeugverschleiß</td>
                                    <td>Korrektur erhöhen oder Werkzeug wechseln</td>
                                </tr>
                                <tr>
                                    <td>Oberfläche rau</td>
                                    <td>Vorschub zu hoch</td>
                                    <td>Vorschub auf 200 reduzieren</td>
                                </tr>
                                <tr>
                                    <td>Bohrung unrund</td>
                                    <td>Feinbohrkopf-Exzentrizität</td>
                                    <td>Kopf neu einstellen, Rundlauf prüfen</td>
                                </tr>
                                <tr>
                                    <td>Gratbildung</td>
                                    <td>Stumpfes Werkzeug</td>
                                    <td>Werkzeug wechseln, Entgratschritt hinzufügen</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>

<script>
    // ================================================================================
    // CNC PLANNER PRO - VOLLSTÄNDIGES DATENMODELL
    // ================================================================================

    const MACHINE_HOUR_RATE = 85;
    const TOOL_WEAR_BASE = 28.76;

    // Werkstoff-Datenbank
    const MATERIALS = {
        '1.4571': { name: 'V4A Edelstahl', price: 7.00, density: 7.98, timeFactor: 1.35, vcFactor: 0.7 },
        '1.4301': { name: 'V2A Edelstahl', price: 5.50, density: 7.90, timeFactor: 1.25, vcFactor: 0.75 },
        '42CrMo4': { name: 'Vergütungsstahl', price: 2.80, density: 7.85, timeFactor: 1.15, vcFactor: 0.85 },
        'S355': { name: 'Baustahl', price: 1.20, density: 7.85, timeFactor: 1.00, vcFactor: 1.0 },
        'AlMg3': { name: 'Aluminium', price: 4.50, density: 2.66, timeFactor: 0.65, vcFactor: 1.5 },
        'CuZn39Pb3': { name: 'Messing', price: 8.50, density: 8.47, timeFactor: 0.75, vcFactor: 1.3 }
    };

    // ================================================================================
    // PROJEKTDATEN - 3 vollständige Beispiele
    // ================================================================================
    const PROJECTS = {
        grundplatte: {
            id: 'grundplatte',
            name: 'Grundplatte WCAD-15-02-2020',
            description: 'Zahnradpumpen-Gehäuse',
            material: '1.4571',
            isRound: true,
            dims: { x: 130, y: 130, z: 47, allowance: 5 },
            finishDims: { diameter: 120, height: 42 },
            features: { bore1: 26, bore2: 44, threads: 6 },
            baseTime: 41.8,
            unitPrice: 122.07,
            operations: [
                { op: 'OP10', name: 'Planfräsen', time: 2.7, tool: 'T1 Planfräser Ø63', critical: false },
                { op: 'OP20', name: 'Schruppen Außen', time: 8.0, tool: 'T2 VHM-Fräser Ø20', critical: false },
                { op: 'OP30', name: 'Schruppen Innen', time: 4.8, tool: 'T3 VHM-Fräser Ø16', critical: false },
                { op: 'OP40', name: 'Schlichten Innen', time: 4.2, tool: 'T4 Schlichtfräser Ø12', critical: false },
                { op: 'OP50', name: 'Schlichten Ø120 h5', time: 5.1, tool: 'T3 Schlichtfräser Ø16', critical: true, tolerance: 'h5' },
                { op: 'OP60', name: 'Feinbohren Ø26 H7', time: 4.1, tool: 'T11 Feinbohrkopf', critical: true, tolerance: 'H7' },
                { op: 'OP70', name: 'Feinbohren Ø44 H7', time: 4.6, tool: 'T12 Feinbohrkopf', critical: false },
                { op: 'OP80', name: 'Bohren 6×M8', time: 3.6, tool: 'T5 Spiralbohrer Ø6,8', critical: false },
                { op: 'OP90', name: 'Gewinde 6×M8', time: 3.1, tool: 'T6 Gewindebohrer M8', critical: false },
                { op: 'OP100', name: 'Entgraten', time: 1.6, tool: 'T7 Entgratfräser', critical: false }
            ],
            ncTemplate: `; ========================================
; GRUNDPLATTE WCAD-15-02-2020
; Werkstoff: {material}
; Rohmaße: Ø{rawDia} × {rawH} mm
; Fertigmaß: Ø{finDia} × {finH} mm
; Gesamtzeit: {totalTime} min
; ========================================
BEGIN PGM GRUNDPLATTE MM

; Werkzeugdefinition
TOOL DEF 1 L+0 R+31.5    ; Planfräser Ø63
TOOL DEF 2 L+0 R+10      ; VHM-Fräser Ø20
TOOL DEF 3 L+0 R+8       ; Schlichtfräser Ø16
TOOL DEF 11 L+0 R+13     ; Feinbohrkopf Ø26

; OP10: Planfräsen Oberseite
TOOL CALL 1 Z S800 F300
L Z+100 R0 FMAX M3
L X+0 Y-50 FMAX
L Z+2 FMAX
L Z+0 F200
L X+{rawDia} F300
L Z+100 FMAX

; OP20: Schruppen Außenkontur Ø{finDia}
TOOL CALL 2 Z S2500 F400
L Z+100 R0 FMAX
CYCL DEF 14.0 KONTUR
CYCL DEF 14.1 KONTURLABEL 1
L X+0 Y+0 FMAX M99
L Z+5 FMAX
CYCL CALL
L Z+100 FMAX

; OP50: Schlichten Ø{finDia} h5 — KRITISCH!
; Toleranz: 0 / -0,018 mm (nur 18 µm!)
; WERKZEUG VOR BEARBEITUNG AUF VERSCHLEISS PRÜFEN!
TOOL CALL 3 Z S3000 F250
L Z+100 R0 FMAX
L X+{finDiaHalf} Y+0 FMAX
L Z+2 FMAX
CC X+0 Y+0
LP PR+{finDiaHalf} PA+0 F250
CP IPA+360 DR+
L Z+100 FMAX

; OP60: Feinbohren Ø26 H7 — KRITISCH!
TOOL CALL 11 Z S1200 F100
L Z+100 R0 FMAX
L X+0 Y+0 FMAX
L Z+5 FMAX
L Z-35 F100
L Z+100 FMAX F50

END PGM GRUNDPLATTE MM`
        },

        lagerbock: {
            id: 'lagerbock',
            name: 'Lagerbock WZ-2024-118',
            description: 'Lageraufnahme für Welle Ø25',
            material: '42CrMo4',
            isRound: false,
            dims: { x: 120, y: 80, z: 55, allowance: 3 },
            finishDims: { length: 115, width: 75, height: 50 },
            features: { bore1: 25, threads: 4 },
            baseTime: 28.5,
            unitPrice: 85.20,
            operations: [
                { op: 'OP10', name: 'Planfräsen', time: 2.1, tool: 'T1 Planfräser Ø63', critical: false },
                { op: 'OP20', name: 'Schruppen Kontur', time: 6.5, tool: 'T2 VHM-Fräser Ø16', critical: false },
                { op: 'OP30', name: 'Schlichten Kontur', time: 4.2, tool: 'T3 Schlichtfräser Ø10', critical: false },
                { op: 'OP40', name: 'Bohren Ø25 H7', time: 3.8, tool: 'T4 Spiralbohrer Ø24', critical: true, tolerance: 'H7' },
                { op: 'OP50', name: 'Reiben Ø25 H7', time: 2.5, tool: 'T5 Reibahle Ø25 H7', critical: true, tolerance: 'H7' },
                { op: 'OP60', name: 'Bohren 4×M6', time: 2.8, tool: 'T6 Spiralbohrer Ø5', critical: false },
                { op: 'OP70', name: 'Gewinde 4×M6', time: 2.4, tool: 'T7 Gewindebohrer M6', critical: false },
                { op: 'OP80', name: 'Entgraten', time: 1.2, tool: 'T8 Entgratfräser', critical: false }
            ],
            ncTemplate: `; ========================================
; LAGERBOCK WZ-2024-118
; Werkstoff: {material}
; Rohmaße: {rawX} × {rawY} × {rawZ} mm
; Fertigmaße: {finX} × {finY} × {finZ} mm
; Gesamtzeit: {totalTime} min
; ========================================
BEGIN PGM LAGERBOCK MM

TOOL DEF 1 L+0 R+31.5    ; Planfräser Ø63
TOOL DEF 4 L+0 R+12      ; Spiralbohrer Ø24
TOOL DEF 5 L+0 R+12.5    ; Reibahle Ø25 H7

; OP10: Planfräsen
TOOL CALL 1 Z S900 F350
L Z+100 R0 FMAX M3
L X-40 Y+0 FMAX
L Z+0 F200
L X+{rawX}+40 F350
L Z+100 FMAX

; OP40: Bohren Ø25 H7
TOOL CALL 4 Z S1500 F180
L Z+100 R0 FMAX
L X+{centerX} Y+{centerY} FMAX
CYCL DEF 200 BOHREN
  Q200=2    ; Sicherheitsabstand
  Q201=-{finZ} ; Bohrtiefe
  Q206=180  ; Vorschub
  Q202=10   ; Zustelltiefe
  Q210=0    ; Verweilzeit
L Z+5 FMAX M99

; OP50: Reiben Ø25 H7 — KRITISCH!
TOOL CALL 5 Z S400 F80
L Z+100 R0 FMAX
L X+{centerX} Y+{centerY} FMAX
L Z+2 FMAX
L Z-{finZ} F80
L Z+100 FMAX

END PGM LAGERBOCK MM`
        },

        flansch: {
            id: 'flansch',
            name: 'Flansch FL-889',
            description: 'Anschlussflansch DN50 PN16',
            material: 'S355',
            isRound: true,
            dims: { x: 145, y: 145, z: 22, allowance: 3 },
            finishDims: { diameter: 140, height: 18 },
            features: { bore1: 60, threads: 4 },
            baseTime: 18.2,
            unitPrice: 48.50,
            operations: [
                { op: 'OP10', name: 'Planfräsen beidseitig', time: 3.2, tool: 'T1 Planfräser Ø63', critical: false },
                { op: 'OP20', name: 'Außenkontur Ø140', time: 4.5, tool: 'T2 VHM-Fräser Ø20', critical: false },
                { op: 'OP30', name: 'Bohrung Ø60', time: 3.8, tool: 'T3 Bohrfräser Ø25', critical: false },
                { op: 'OP40', name: 'Lochkreis 4×Ø14', time: 2.4, tool: 'T4 Spiralbohrer Ø14', critical: false },
                { op: 'OP50', name: 'Dichtfläche planschleifen', time: 2.1, tool: 'T5 Schlichtfräser Ø40', critical: true },
                { op: 'OP60', name: 'Entgraten', time: 1.2, tool: 'T6 Entgratfräser', critical: false }
            ],
            ncTemplate: `; ========================================
; FLANSCH FL-889
; Werkstoff: {material}
; Rohmaße: Ø{rawDia} × {rawH} mm
; Fertigmaß: Ø{finDia} × {finH} mm
; Gesamtzeit: {totalTime} min
; ========================================
BEGIN PGM FLANSCH MM

TOOL DEF 1 L+0 R+31.5    ; Planfräser Ø63
TOOL DEF 2 L+0 R+10      ; VHM-Fräser Ø20
TOOL DEF 4 L+0 R+7       ; Spiralbohrer Ø14

; OP10: Planfräsen
TOOL CALL 1 Z S1000 F400
L Z+100 R0 FMAX M3
L X+0 Y-40 FMAX
L Z+0 F200
L X+{rawDia} F400
L Z+100 FMAX

; OP20: Außenkontur Ø{finDia}
TOOL CALL 2 Z S3000 F500
L Z+100 R0 FMAX
L X+{finDiaHalf} Y+0 FMAX
L Z+2 FMAX
CC X+0 Y+0
CP IPA+360 DR+ F500
L Z+100 FMAX

; OP40: Lochkreis 4×Ø14
TOOL CALL 4 Z S2000 F250
CYCL DEF 220 MUSTER KREIS
  Q216=50   ; Radius
  Q217=0    ; Startwinkel
  Q218=4    ; Anzahl
CYCL DEF 200 BOHREN
  Q200=2
  Q201=-{finH}
  Q206=250
  Q202=8
L X+50 Y+0 Z+5 FMAX M99

END PGM FLANSCH MM`
        }
    };

    // Aktuelles Projekt
    let currentProject = PROJECTS.grundplatte;

    // ================================================================================
    // HAUPTFUNKTIONEN
    // ================================================================================

    function loadProject(projectId) {
        currentProject = PROJECTS[projectId];
        
        // UI: Projektkarten aktualisieren
        document.querySelectorAll('.project-card').forEach(c => c.classList.remove('active'));
        document.querySelector(`[onclick="loadProject('${projectId}')"]`).classList.add('active');

        // Werkstoff setzen
        document.getElementById('materialSelect').value = currentProject.material;

        // Maße setzen
        document.getElementById('dimX').value = currentProject.dims.x;
        document.getElementById('dimY').value = currentProject.dims.y;
        document.getElementById('dimZ').value = currentProject.dims.z;
        document.getElementById('dimAllowance').value = currentProject.dims.allowance;

        // Labels anpassen (Rundteil vs. Quader)
        if (currentProject.isRound) {
            document.getElementById('labelDimX').textContent = 'Durchmesser';
            document.getElementById('labelDimY').textContent = '(= Durchmesser)';
            document.getElementById('dimY').value = currentProject.dims.x;
            document.getElementById('dimY').disabled = true;
        } else {
            document.getElementById('labelDimX').textContent = 'Länge (X)';
            document.getElementById('labelDimY').textContent = 'Breite (Y)';
            document.getElementById('dimY').disabled = false;
        }

        // Alles neu berechnen
        recalculateAll();
        updateQuote();
        updateCalculation();
        updateNCCode();
        updateComparison();
    }

    function recalculateAll() {
        const mat = MATERIALS[document.getElementById('materialSelect').value];
        const x = parseFloat(document.getElementById('dimX').value) || 100;
        const y = parseFloat(document.getElementById('dimY').value) || 100;
        const z = parseFloat(document.getElementById('dimZ').value) || 50;
        const allowance = parseFloat(document.getElementById('dimAllowance').value) || 5;

        // Bei Rundteil Y = X setzen
        if (currentProject.isRound) {
            document.getElementById('dimY').value = x;
        }

        // Volumen berechnen (Quader oder Zylinder)
        let volumeCm3;
        if (currentProject.isRound) {
            volumeCm3 = Math.PI * Math.pow(x / 20, 2) * (z / 10);
        } else {
            volumeCm3 = (x * y * z) / 1000;
        }

        // Gewicht
        const weightKg = (volumeCm3 * mat.density) / 1000;

        // Materialkosten
        const materialCost = weightKg * mat.price;

        // Größenfaktor für Zeit
        const refVolume = currentProject.isRound 
            ? Math.PI * Math.pow(currentProject.dims.x / 20, 2) * (currentProject.dims.z / 10)
            : (currentProject.dims.x * currentProject.dims.y * currentProject.dims.z) / 1000;
        const sizeFactor = volumeCm3 / refVolume;

        // Zeitberechnung mit Werkstoff-Faktor
        const baseMatFactor = MATERIALS[currentProject.material].timeFactor;
        const newMatFactor = mat.timeFactor;
        const machiningTime = currentProject.baseTime * Math.pow(sizeFactor, 0.7) * (newMatFactor / baseMatFactor);

        // Kosten
        const machineCost = (machiningTime / 60) * MACHINE_HOUR_RATE;
        const toolCost = TOOL_WEAR_BASE * (newMatFactor / baseMatFactor);
        const totalCost = materialCost + machineCost + toolCost;

        // Aktuelles Projekt updaten (für andere Funktionen)
        currentProject._calculated = {
            weight: weightKg,
            materialCost: materialCost,
            time: machiningTime,
            machineCost: machineCost,
            toolCost: toolCost,
            totalCost: totalCost,
            dims: { x, y, z, allowance }
        };

        // Display updaten
        document.getElementById('liveWeight').textContent = weightKg.toFixed(2).replace('.', ',') + ' kg';
        document.getElementById('liveMaterialCost').textContent = '€ ' + materialCost.toFixed(2).replace('.', ',');
        document.getElementById('liveTime').textContent = machiningTime.toFixed(1).replace('.', ',') + ' min';
        document.getElementById('liveMachineCost').textContent = '€ ' + machineCost.toFixed(2).replace('.', ',');
        document.getElementById('liveTotalCost').textContent = '€ ' + totalCost.toFixed(2).replace('.', ',');

        // Animation
        document.querySelectorAll('.live-result-value').forEach(el => {
            el.classList.add('updating');
            setTimeout(() => el.classList.remove('updating'), 300);
        });

        // Abhängige Bereiche aktualisieren
        updateQuote();
        updateNCCode();
    }

    function updateQuote() {
        const calc = currentProject._calculated || {};
        const total = calc.totalCost || currentProject.unitPrice;
        const mat = MATERIALS[document.getElementById('materialSelect').value];

        // Angebot-Tabelle aktualisieren
        const quoteDesc = document.getElementById('quoteDescription');
        const quoteUnitPrice = document.getElementById('quoteUnitPrice');
        const quoteTotalPrice = document.getElementById('quoteTotalPrice');
        const quoteSubtotal = document.getElementById('quoteSubtotal');
        const quoteGrandTotal = document.getElementById('quoteGrandTotal');

        if (quoteDesc) {
            quoteDesc.innerHTML = `<strong>${currentProject.name}</strong><br>
                <span style="color: var(--gray-500); font-size: 0.8rem;">${currentProject.description}, Werkstoff ${mat.name}</span>`;
        }
        const subtotal = total * 10;
        const mwst = subtotal * 0.19;
        const grandTotal = subtotal + mwst;
        
        if (quoteUnitPrice) quoteUnitPrice.textContent = total.toFixed(2).replace('.', ',');
        if (quoteTotalPrice) quoteTotalPrice.textContent = subtotal.toFixed(2).replace('.', ',');
        if (quoteSubtotal) quoteSubtotal.textContent = subtotal.toFixed(2).replace('.', ',') + ' €';
        
        const quoteMwst = document.getElementById('quoteMwst');
        if (quoteMwst) quoteMwst.textContent = mwst.toFixed(2).replace('.', ',') + ' €';
        if (quoteGrandTotal) quoteGrandTotal.textContent = grandTotal.toFixed(2).replace('.', ',') + ' €';
    }

    function updateCalculation() {
        // Zeit-Tabelle mit Operationen des aktuellen Projekts aktualisieren
        const tbody = document.getElementById('timeTableBody');
        if (!tbody) return;

        const mat = MATERIALS[document.getElementById('materialSelect').value];
        const timeFactor = mat.timeFactor / MATERIALS[currentProject.material].timeFactor;
        let totalTime = 0;

        let html = '';
        currentProject.operations.forEach((op, i) => {
            const adjustedTime = (op.time * timeFactor).toFixed(1);
            totalTime += parseFloat(adjustedTime);
            const rowClass = op.critical ? 'style="background: #fef3c7;"' : '';
            html += `<tr ${rowClass}>
                <td><strong>${op.op}</strong></td>
                <td>${op.name}${op.critical ? ' <span class="badge badge-warning">KRITISCH</span>' : ''}</td>
                <td style="text-align:center;">${adjustedTime}</td>
            </tr>`;
        });
        html += `<tr style="background: var(--gray-100); font-weight: 600;">
            <td colspan="2" style="text-align: right;">Gesamtzeit:</td>
            <td style="text-align:center;"><strong>${totalTime.toFixed(1)} min</strong></td>
        </tr>`;
        tbody.innerHTML = html;
    }

    function updateNCCode() {
        const codeBlock = document.getElementById('codeBlock');
        if (!codeBlock) return;

        const calc = currentProject._calculated || {};
        const dims = calc.dims || currentProject.dims;
        const mat = MATERIALS[document.getElementById('materialSelect').value];

        // Template mit Werten füllen
        let code = currentProject.ncTemplate
            .replace(/{material}/g, mat.name)
            .replace(/{rawDia}/g, dims.x)
            .replace(/{rawX}/g, dims.x)
            .replace(/{rawY}/g, dims.y)
            .replace(/{rawH}/g, dims.z)
            .replace(/{rawZ}/g, dims.z)
            .replace(/{finDia}/g, currentProject.finishDims.diameter || (dims.x - dims.allowance * 2))
            .replace(/{finDiaHalf}/g, ((currentProject.finishDims.diameter || (dims.x - dims.allowance * 2)) / 2).toFixed(1))
            .replace(/{finH}/g, currentProject.finishDims.height || (dims.z - dims.allowance * 2))
            .replace(/{finX}/g, currentProject.finishDims.length || (dims.x - dims.allowance * 2))
            .replace(/{finY}/g, currentProject.finishDims.width || (dims.y - dims.allowance * 2))
            .replace(/{finZ}/g, currentProject.finishDims.height || (dims.z - dims.allowance * 2))
            .replace(/{centerX}/g, (dims.x / 2).toFixed(1))
            .replace(/{centerY}/g, (dims.y / 2).toFixed(1))
            .replace(/{totalTime}/g, (calc.time || currentProject.baseTime).toFixed(1));

        // Syntax Highlighting (einfach)
        code = code.replace(/^;.*$/gm, '<span class="code-comment">$&</span>');
        code = code.replace(/KRITISCH|ACHTUNG|PRÜFEN/g, '<span style="color: var(--danger); font-weight: bold;">$&</span>');

        codeBlock.innerHTML = code;
    }

    function updateComparison() {
        // Ist/Soll mit aktuellem Projekt aktualisieren
        const ops = currentProject.operations.filter(op => op.critical || ['OP10', 'OP20'].includes(op.op)).slice(0, 4);
        // Vereinfacht: Behalte aktuelle Werte, da vollständige Implementation aufwändig
    }

    // ================================================================================
    // UI FUNKTIONEN
    // ================================================================================

    function showTab(tabName) {
        document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
        document.querySelectorAll('.app-tab').forEach(t => t.classList.remove('active'));
        document.getElementById('panel-' + tabName).classList.add('active');
        event.target.classList.add('active');
        
        // Bei Tab-Wechsel Inhalte aktualisieren
        if (tabName === 'calculation') updateCalculation();
        if (tabName === 'code') updateNCCode();
    }

    function calculateROI() {
        const quotes = parseFloat(document.getElementById('quotesPerMonth').value) || 20;
        const timePerQuote = parseFloat(document.getElementById('timePerQuote').value) || 60;
        const hourlyRate = parseFloat(document.getElementById('hourlyRate').value) || 50;

        const currentTimeH = (quotes * timePerQuote) / 60;
        const newTimeH = currentTimeH * 0.15;
        const timeSavedH = currentTimeH - newTimeH;
        const moneySaved = timeSavedH * hourlyRate;
        const roi = moneySaved / 49;

        document.getElementById('currentTime').textContent = currentTimeH.toFixed(1).replace('.', ',') + ' h/Monat';
        document.getElementById('newTime').textContent = newTimeH.toFixed(1).replace('.', ',') + ' h/Monat';
        document.getElementById('timeSaved').textContent = timeSavedH.toFixed(1).replace('.', ',') + ' h/Monat';
        document.getElementById('moneySaved').textContent = '€ ' + Math.round(moneySaved).toLocaleString('de-DE') + '/Monat';
        document.getElementById('roiValue').innerHTML = Math.round(roi) + '<span>x</span>';
    }

    function copyCode() {
        const codeText = document.getElementById('codeBlock').innerText;
        navigator.clipboard.writeText(codeText).then(() => alert('Code kopiert!'));
    }

    function downloadCode() {
        const codeText = document.getElementById('codeBlock').innerText;
        const blob = new Blob([codeText], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = currentProject.name.replace(/\s+/g, '_') + '.H';
        a.click();
        URL.revokeObjectURL(url);
    }

    function toggleDetail(opId) {
        const row = document.getElementById('detail-' + opId);
        const icon = document.getElementById('icon-' + opId);
        if (row) {
            row.classList.toggle('visible');
            icon.textContent = row.classList.contains('visible') ? '−' : '+';
        }
    }

    function exportCSV() {
        const calc = currentProject._calculated || {};
        const mat = MATERIALS[document.getElementById('materialSelect').value];
        const data = [
            ['Projekt', currentProject.name],
            ['Werkstoff', mat.name],
            ['Rohmaße', `${calc.dims?.x || currentProject.dims.x} × ${calc.dims?.y || currentProject.dims.y} × ${calc.dims?.z || currentProject.dims.z} mm`],
            ['Gewicht', (calc.weight || 0).toFixed(2) + ' kg'],
            ['Bearbeitungszeit', (calc.time || currentProject.baseTime).toFixed(1) + ' min'],
            ['Gesamtkosten', '€ ' + (calc.totalCost || currentProject.unitPrice).toFixed(2)],
            [''],
            ['OP', 'Beschreibung', 'Zeit (min)']
        ];
        currentProject.operations.forEach(op => {
            data.push([op.op, op.name, op.time.toString()]);
        });

        const csv = data.map(row => row.join(';')).join('\n');
        const blob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'Kalkulation_' + currentProject.name.replace(/\s+/g, '_') + '.csv';
        a.click();
        URL.revokeObjectURL(url);
    }

    // ================================================================================
    // INITIALISIERUNG
    // ================================================================================

    document.addEventListener('DOMContentLoaded', function() {
        calculateROI();
        loadProject('grundplatte');
    });
</script>

</body>
</html>
