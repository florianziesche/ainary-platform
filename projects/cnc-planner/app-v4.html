<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>CNC Planner Pro v4</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #1a365d;
      --primary-light: #2c5282;
      --accent: #ed8936;
      --accent-hover: #dd6b20;
      --success: #38a169;
      --warning: #e53e3e;
      --bg-dark: #0f1419;
      --bg-main: #1a1f2e;
      --bg-card: #242b3d;
      --bg-elevated: #2d3548;
      --border: #3d4663;
      --text: #f7fafc;
      --text-secondary: #a0aec0;
      --text-muted: #718096;
      --font-sans: 'Inter', -apple-system, sans-serif;
      --font-mono: 'JetBrains Mono', monospace;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: var(--font-sans);
      background: var(--bg-dark);
      color: var(--text);
      min-height: 100vh;
      display: flex;
    }

    /* Sidebar */
    .sidebar {
      width: 240px;
      background: var(--bg-main);
      border-right: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      position: fixed;
      height: 100vh;
    }
    .sidebar-header {
      padding: 20px;
      border-bottom: 1px solid var(--border);
    }
    .logo { font-weight: 700; font-size: 18px; }
    .logo span { color: var(--accent); }
    .version { font-size: 11px; color: var(--text-muted); margin-top: 4px; }
    .sidebar-nav { flex: 1; padding: 16px 12px; }
    .nav-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 16px;
      border-radius: 8px;
      color: var(--text-secondary);
      text-decoration: none;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.15s;
      margin-bottom: 4px;
    }
    .nav-item:hover { background: var(--bg-elevated); color: var(--text); }
    .nav-item.active { background: var(--accent); color: white; }
    .nav-item .icon { font-size: 18px; }
    .sidebar-footer {
      padding: 16px;
      border-top: 1px solid var(--border);
      font-size: 12px;
      color: var(--text-muted);
    }

    /* Main Content */
    .main { flex: 1; margin-left: 240px; min-height: 100vh; }
    .header {
      padding: 20px 32px;
      background: var(--bg-main);
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .header h1 { font-size: 20px; font-weight: 600; }
    .header-actions { display: flex; gap: 12px; }
    .content { padding: 32px; }

    /* Page Sections */
    .page { display: none; }
    .page.active { display: block; }

    /* Cards */
    .card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 12px;
      margin-bottom: 24px;
    }
    .card-header {
      padding: 16px 20px;
      border-bottom: 1px solid var(--border);
      font-weight: 600;
      font-size: 14px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .card-body { padding: 20px; }

    /* Forms */
    .form-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; }
    .form-grid.cols-3 { grid-template-columns: repeat(3, 1fr); }
    .form-grid.cols-4 { grid-template-columns: repeat(4, 1fr); }
    .form-group { margin-bottom: 16px; }
    .form-group.full { grid-column: 1 / -1; }
    .form-label {
      display: block;
      font-size: 13px;
      font-weight: 500;
      color: var(--text-secondary);
      margin-bottom: 6px;
    }
    .form-input, .form-select {
      width: 100%;
      padding: 10px 14px;
      background: var(--bg-main);
      border: 1px solid var(--border);
      border-radius: 6px;
      color: var(--text);
      font-size: 14px;
      font-family: inherit;
    }
    .form-input:focus, .form-select:focus { outline: none; border-color: var(--accent); }
    .form-input.mono { font-family: var(--font-mono); }

    /* Buttons */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 10px 20px;
      border-radius: 6px;
      font-weight: 600;
      font-size: 14px;
      border: none;
      cursor: pointer;
      transition: all 0.15s;
    }
    .btn-primary { background: var(--accent); color: white; }
    .btn-primary:hover { background: var(--accent-hover); }
    .btn-secondary { background: var(--bg-elevated); color: var(--text); border: 1px solid var(--border); }
    .btn-secondary:hover { background: var(--border); }
    .btn-success { background: var(--success); color: white; }
    .btn-sm { padding: 6px 12px; font-size: 13px; }

    /* Tables */
    .table-container { overflow-x: auto; }
    table { width: 100%; border-collapse: collapse; }
    th, td {
      padding: 12px 16px;
      text-align: left;
      border-bottom: 1px solid var(--border);
      font-size: 14px;
    }
    th {
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: var(--text-muted);
      background: var(--bg-elevated);
    }
    tr:hover td { background: rgba(255,255,255,0.02); }
    .mono { font-family: var(--font-mono); }
    .text-accent { color: var(--accent); }
    .text-success { color: var(--success); }
    .text-warning { color: var(--warning); }
    .text-muted { color: var(--text-muted); }

    /* Stats */
    .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 24px; }
    .stat-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 20px;
    }
    .stat-label { font-size: 12px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; }
    .stat-value { font-size: 28px; font-weight: 700; font-family: var(--font-mono); margin-top: 8px; }
    .stat-value.accent { color: var(--accent); }

    /* Badge */
    .badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 600;
      font-family: var(--font-mono);
    }
    .badge-primary { background: var(--primary); color: white; }
    .badge-warning { background: rgba(229, 62, 62, 0.2); color: var(--warning); }
    .badge-success { background: rgba(56, 161, 105, 0.2); color: var(--success); }

    /* Progress Bar */
    .progress-container { margin-bottom: 24px; }
    .progress-bar {
      height: 40px;
      background: var(--bg-main);
      border-radius: 8px;
      overflow: hidden;
      display: flex;
    }
    .progress-segment {
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      font-weight: 600;
      color: white;
      transition: all 0.3s;
    }
    .progress-segment:hover { filter: brightness(1.2); }
    .progress-legend {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin-top: 12px;
      font-size: 12px;
    }
    .legend-item { display: flex; align-items: center; gap: 6px; }
    .legend-color { width: 12px; height: 12px; border-radius: 3px; }

    /* Alert Boxes */
    .alert {
      padding: 16px 20px;
      border-radius: 8px;
      margin-bottom: 16px;
      display: flex;
      align-items: flex-start;
      gap: 12px;
    }
    .alert-warning {
      background: rgba(237, 137, 54, 0.1);
      border-left: 4px solid var(--accent);
    }
    .alert-danger {
      background: rgba(229, 62, 62, 0.1);
      border-left: 4px solid var(--warning);
    }
    .alert-info {
      background: rgba(56, 161, 105, 0.1);
      border-left: 4px solid var(--success);
    }
    .alert-icon { font-size: 20px; }
    .alert-content h4 { font-size: 14px; font-weight: 600; margin-bottom: 4px; }
    .alert-content p { font-size: 13px; color: var(--text-secondary); }

    /* Checklist */
    .checklist { list-style: none; }
    .checklist li {
      padding: 10px 14px;
      background: var(--bg-main);
      margin-bottom: 6px;
      border-radius: 6px;
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 14px;
    }
    .checkbox {
      width: 20px;
      height: 20px;
      border: 2px solid var(--accent);
      border-radius: 4px;
      flex-shrink: 0;
    }

    /* Correction Cards */
    .correction-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; }
    .correction-card {
      background: var(--bg-main);
      border-radius: 8px;
      padding: 16px;
      text-align: center;
    }
    .correction-card h4 { color: var(--text-secondary); font-size: 12px; margin-bottom: 8px; }
    .correction-value { font-size: 24px; font-weight: 700; color: var(--accent); font-family: var(--font-mono); }
    .correction-unit { font-size: 12px; color: var(--text-muted); }
    .correction-note { font-size: 11px; color: var(--text-muted); margin-top: 8px; font-style: italic; }

    /* Tool Life Bar */
    .tool-life-bar {
      width: 100%;
      height: 20px;
      background: var(--bg-main);
      border-radius: 4px;
      overflow: hidden;
    }
    .tool-life-fill {
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
      font-weight: 600;
      color: white;
    }
    .tool-life-fill.good { background: linear-gradient(90deg, var(--success), #48bb78); }
    .tool-life-fill.warning { background: linear-gradient(90deg, var(--accent), #f6ad55); }
    .tool-life-fill.critical { background: linear-gradient(90deg, var(--warning), #fc8181); }

    /* Upload Zone */
    .upload-zone {
      border: 2px dashed var(--border);
      border-radius: 8px;
      padding: 32px;
      text-align: center;
      cursor: pointer;
      transition: all 0.15s;
      background: var(--bg-main);
    }
    .upload-zone:hover { border-color: var(--accent); background: rgba(237, 137, 54, 0.05); }
    .upload-zone.has-file { border-color: var(--success); border-style: solid; }
    .upload-icon { font-size: 32px; margin-bottom: 12px; }
    .upload-text { font-weight: 500; margin-bottom: 4px; }
    .upload-hint { font-size: 13px; color: var(--text-muted); }
    .file-info {
      display: none;
      align-items: center;
      gap: 12px;
      padding: 12px;
      background: var(--bg-elevated);
      border-radius: 6px;
      margin-top: 12px;
    }
    .file-info.visible { display: flex; }

    /* Print Styles */
    @media print {
      body { background: white; color: black; }
      .sidebar, .header { display: none; }
      .main { margin-left: 0; }
      .card { border: 1px solid #ddd; background: white; }
      .btn { display: none; }
      .stat-card { background: #f5f5f5; }
    }
  </style>
</head>
<body>
  <!-- SIDEBAR -->
  <nav class="sidebar">
    <div class="sidebar-header">
      <div class="logo">CNC<span>Planner</span> Pro</div>
      <div class="version">v4.0 ‚Äî Enhanced FA</div>
    </div>
    <div class="sidebar-nav">
      <div class="nav-item active" onclick="showPage('kalkulation')">
        <span class="icon">üìä</span> Kalkulation
      </div>
      <div class="nav-item" onclick="showPage('angebot')">
        <span class="icon">üìÑ</span> Angebot
      </div>
      <div class="nav-item" onclick="showPage('fertigung')">
        <span class="icon">üîß</span> Fertigungsanweisung
      </div>
      <div class="nav-item" onclick="showPage('einstellungen')">
        <span class="icon">‚öôÔ∏è</span> Einstellungen
      </div>
    </div>
    <div class="sidebar-footer">
      <div>Maschinenbau Schlottwitz</div>
      <div>Demo Version</div>
    </div>
  </nav>

  <!-- MAIN CONTENT -->
  <main class="main">
    <!-- KALKULATION PAGE -->
    <div id="page-kalkulation" class="page active">
      <div class="header">
        <h1>üìä Kalkulation</h1>
        <div class="header-actions">
          <button class="btn btn-secondary" onclick="resetCalculation()">‚Ü∫ Zur√ºcksetzen</button>
          <button class="btn btn-primary" onclick="calculateAndShowQuote()">üìÑ Angebot erstellen</button>
        </div>
      </div>
      <div class="content">
        <!-- Stats -->
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-label">Bearbeitungszeit</div>
            <div class="stat-value accent" id="stat-time">41.8 min</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">St√ºckpreis</div>
            <div class="stat-value" id="stat-price">‚Ç¨127.50</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Teile/Schicht</div>
            <div class="stat-value" id="stat-parts">11 Stk</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Auftragswert</div>
            <div class="stat-value text-success" id="stat-total">‚Ç¨1,275</div>
          </div>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
          <!-- Left Column -->
          <div>
            <div class="card">
              <div class="card-header">Projekt & Material</div>
              <div class="card-body">
                <div class="form-grid">
                  <div class="form-group">
                    <label class="form-label">Projektname</label>
                    <input type="text" class="form-input" id="projectName" value="Grundplatte Antriebseinheit">
                  </div>
                  <div class="form-group">
                    <label class="form-label">Zeichnungs-Nr.</label>
                    <input type="text" class="form-input mono" id="drawingNr" value="WCAD-15-02-2020">
                  </div>
                  <div class="form-group">
                    <label class="form-label">Werkstoff</label>
                    <select class="form-select" id="material" onchange="recalculate()">
                      <option value="1.4571">1.4571 (Edelstahl)</option>
                      <option value="1.4301">1.4301 (V2A)</option>
                      <option value="AlMg3">AlMg3 (Aluminium)</option>
                      <option value="S235">S235 (Baustahl)</option>
                      <option value="C45">C45 (Verg√ºtungsstahl)</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label class="form-label">Maschine</label>
                    <select class="form-select" id="machine">
                      <option value="versa943">FEHLMANN VERSA 943 (5-Achs)</option>
                      <option value="cmx50">DMG MORI CMX 50 (3-Achs)</option>
                    </select>
                  </div>
                </div>
              </div>
            </div>

            <div class="card">
              <div class="card-header">Zeichnung / CAD</div>
              <div class="card-body">
                <div class="upload-zone" id="uploadZone" onclick="document.getElementById('fileInput').click()">
                  <div class="upload-icon">üìÅ</div>
                  <div class="upload-text">Zeichnung hochladen</div>
                  <div class="upload-hint">PDF, DXF, STEP oder Bild (max. 10 MB)</div>
                </div>
                <input type="file" id="fileInput" style="display:none" accept=".pdf,.dxf,.step,.stp,.jpg,.png" onchange="handleFileUpload(this)">
                <div class="file-info" id="fileInfo">
                  <span>üìÑ</span>
                  <span id="fileName">Datei.pdf</span>
                  <button class="btn btn-sm btn-secondary" onclick="removeFile()">‚úï</button>
                </div>
              </div>
            </div>
          </div>

          <!-- Right Column -->
          <div>
            <div class="card">
              <div class="card-header">Kalkulation</div>
              <div class="card-body">
                <div class="form-grid">
                  <div class="form-group">
                    <label class="form-label">St√ºckzahl</label>
                    <input type="number" class="form-input mono" id="quantity" value="10" onchange="recalculate()">
                  </div>
                  <div class="form-group">
                    <label class="form-label">Stundensatz (‚Ç¨/h)</label>
                    <input type="number" class="form-input mono" id="hourlyRate" value="85" onchange="recalculate()">
                  </div>
                  <div class="form-group">
                    <label class="form-label">Materialkosten (‚Ç¨/Stk)</label>
                    <input type="number" class="form-input mono" id="materialCost" value="45" onchange="recalculate()">
                  </div>
                  <div class="form-group">
                    <label class="form-label">Marge (%)</label>
                    <input type="number" class="form-input mono" id="margin" value="20" onchange="recalculate()">
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Operations Table -->
        <div class="card">
          <div class="card-header">
            <span>Arbeitsfolge</span>
            <button class="btn btn-sm btn-secondary" onclick="addOperation()">+ Arbeitsgang</button>
          </div>
          <div class="card-body" style="padding: 0;">
            <table>
              <thead>
                <tr>
                  <th>OP</th>
                  <th>Beschreibung</th>
                  <th>Werkzeug</th>
                  <th>n (U/min)</th>
                  <th>f (mm/min)</th>
                  <th>t‚Çï (min)</th>
                  <th>t‚Çô (min)</th>
                  <th>Œ£ (min)</th>
                  <th></th>
                </tr>
              </thead>
              <tbody id="opsBody"></tbody>
              <tfoot>
                <tr style="background: var(--bg-elevated); font-weight: 600;">
                  <td colspan="5" style="text-align: right;">SUMME</td>
                  <td class="mono text-accent" id="sumTh">33.2</td>
                  <td class="mono" id="sumTn">8.6</td>
                  <td class="mono text-accent" id="sumTotal">41.8</td>
                  <td></td>
                </tr>
              </tfoot>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- ANGEBOT PAGE -->
    <div id="page-angebot" class="page">
      <div class="header">
        <h1>üìÑ Angebot</h1>
        <div class="header-actions">
          <button class="btn btn-secondary" onclick="window.print()">üñ®Ô∏è Drucken</button>
          <button class="btn btn-primary" onclick="downloadPDF()">üì• PDF speichern</button>
        </div>
      </div>
      <div class="content">
        <div class="card">
          <div class="card-body">
            <div style="background: white; color: #1a1a1a; padding: 40px; border-radius: 12px; max-width: 800px;">
              <div style="display: flex; justify-content: space-between; margin-bottom: 32px; padding-bottom: 20px; border-bottom: 2px solid #eee;">
                <div>
                  <div style="font-size: 24px; font-weight: 700; color: #1a365d;">CNC<span style="color: #ed8936;">Planner</span> Pro</div>
                  <div style="margin-top: 8px; font-size: 14px; color: #666;">
                    Maschinenbau Schlottwitz GmbH<br>
                    Liebst√§dter Str. 3, 01768 Glash√ºtte
                  </div>
                </div>
                <div style="text-align: right;">
                  <div style="font-size: 28px; font-weight: 700; color: #1a365d;">ANGEBOT</div>
                  <div style="font-size: 16px;">Nr. <span id="quote-number">2026-0001</span></div>
                  <div style="margin-top: 8px; font-size: 14px; color: #666;">Datum: <span id="quote-date">02.02.2026</span></div>
                </div>
              </div>

              <table style="margin-top: 16px; width: 100%; border-collapse: collapse;">
                <thead>
                  <tr style="background: #f5f5f5;">
                    <th style="padding: 12px; text-align: left; border-bottom: 2px solid #ddd;">Pos.</th>
                    <th style="padding: 12px; text-align: left; border-bottom: 2px solid #ddd;">Beschreibung</th>
                    <th style="padding: 12px; text-align: left; border-bottom: 2px solid #ddd;">Werkstoff</th>
                    <th style="padding: 12px; text-align: right; border-bottom: 2px solid #ddd;">Menge</th>
                    <th style="padding: 12px; text-align: right; border-bottom: 2px solid #ddd;">Einzelpreis</th>
                    <th style="padding: 12px; text-align: right; border-bottom: 2px solid #ddd;">Gesamt</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td style="padding: 12px; border-bottom: 1px solid #eee;">1</td>
                    <td style="padding: 12px; border-bottom: 1px solid #eee;">Grundplatte nach Zeichnung</td>
                    <td style="padding: 12px; border-bottom: 1px solid #eee;" id="quote-material">1.4571</td>
                    <td style="padding: 12px; border-bottom: 1px solid #eee; text-align: right;" id="quote-qty">10 Stk</td>
                    <td style="padding: 12px; border-bottom: 1px solid #eee; text-align: right;" id="quote-unit">‚Ç¨127.50</td>
                    <td style="padding: 12px; border-bottom: 1px solid #eee; text-align: right;" id="quote-line-total">‚Ç¨1,275.00</td>
                  </tr>
                </tbody>
                <tfoot>
                  <tr>
                    <td colspan="5" style="padding: 12px; text-align: right; border-top: 2px solid #ddd;">Zwischensumme</td>
                    <td style="padding: 12px; text-align: right; border-top: 2px solid #ddd;" id="quote-subtotal">‚Ç¨1,275.00</td>
                  </tr>
                  <tr>
                    <td colspan="5" style="padding: 12px; text-align: right;">MwSt. (19%)</td>
                    <td style="padding: 12px; text-align: right;" id="quote-vat">‚Ç¨242.25</td>
                  </tr>
                  <tr style="font-size: 18px; font-weight: 700;">
                    <td colspan="5" style="padding: 12px; text-align: right;">Gesamtbetrag</td>
                    <td style="padding: 12px; text-align: right; color: #1a365d;" id="quote-total">‚Ç¨1,517.25</td>
                  </tr>
                </tfoot>
              </table>

              <div style="margin-top: 32px; font-size: 14px; color: #666;">
                <p><strong>Konditionen:</strong></p>
                <ul style="margin-top: 8px; padding-left: 20px;">
                  <li>Lieferzeit: 2-3 Wochen nach Auftragserteilung</li>
                  <li>Zahlungsziel: 14 Tage netto</li>
                  <li>G√ºltigkeit: 30 Tage</li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- FERTIGUNGSANWEISUNG PAGE (ENHANCED) -->
    <div id="page-fertigung" class="page">
      <div class="header">
        <h1>üîß Fertigungsanweisung</h1>
        <div class="header-actions">
          <button class="btn btn-secondary" onclick="window.print()">üñ®Ô∏è Drucken</button>
          <button class="btn btn-primary" onclick="exportNC()">üíæ NC-Code exportieren</button>
        </div>
      </div>
      <div class="content">
        <!-- Header Stats -->
        <div class="stats-grid" style="grid-template-columns: repeat(5, 1fr);">
          <div class="stat-card">
            <div class="stat-label">Auftrag</div>
            <div class="stat-value" style="font-size: 18px;" id="fa-order">2026-0001</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Teil</div>
            <div class="stat-value" style="font-size: 18px;" id="fa-part">Grundplatte</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Werkstoff</div>
            <div class="stat-value" style="font-size: 18px;" id="fa-material">1.4571</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">St√ºckzahl</div>
            <div class="stat-value" style="font-size: 18px;" id="fa-qty">10</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Gesamtzeit</div>
            <div class="stat-value accent" style="font-size: 18px;" id="fa-time">41.8 min</div>
          </div>
        </div>

        <!-- Progress Bar -->
        <div class="card">
          <div class="card-header">‚è±Ô∏è Zeitverteilung</div>
          <div class="card-body">
            <div class="progress-container">
              <div class="progress-bar" id="timeProgressBar">
                <!-- Filled by JS -->
              </div>
              <div class="progress-legend" id="timeLegend">
                <!-- Filled by JS -->
              </div>
            </div>
          </div>
        </div>

        <!-- Alerts -->
        <div class="alert alert-warning">
          <span class="alert-icon">‚ö†Ô∏è</span>
          <div class="alert-content">
            <h4>Werkstoff 1.4571 ‚Äî Edelstahl austenitisch</h4>
            <p>Kaltverfestigung beachten! Nie mit zu niedrigem Vorschub arbeiten. Bei Rattern: Drehzahl reduzieren (-15%).</p>
          </div>
        </div>

        <!-- Operations -->
        <div class="card">
          <div class="card-header">Arbeitsfolge</div>
          <div class="card-body" style="padding: 0;">
            <table>
              <thead>
                <tr>
                  <th>OP</th>
                  <th>Arbeitsgang</th>
                  <th>Werkzeug</th>
                  <th>n (U/min)</th>
                  <th>f (mm/min)</th>
                  <th>Zeit</th>
                  <th>Hinweise</th>
                </tr>
              </thead>
              <tbody id="faOpsBody">
                <!-- Filled by JS -->
              </tbody>
            </table>
          </div>
        </div>

        <!-- Two Column Layout -->
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
          <!-- Werkzeugliste -->
          <div class="card">
            <div class="card-header">üîß Werkzeugliste mit Standzeiten</div>
            <div class="card-body" style="padding: 0;">
              <table>
                <thead>
                  <tr><th>T-Nr</th><th>Werkzeug</th><th>√ò</th><th>Standzeit</th></tr>
                </thead>
                <tbody id="toolListEnhanced">
                  <!-- Filled by JS -->
                </tbody>
              </table>
            </div>
          </div>

          <!-- Pr√ºfmerkmale -->
          <div class="card">
            <div class="card-header">üìè Pr√ºfmerkmale</div>
            <div class="card-body" style="padding: 0;">
              <table>
                <thead>
                  <tr><th>Merkmal</th><th>Soll</th><th>Toleranz</th><th>Pr√ºfmittel</th></tr>
                </thead>
                <tbody id="inspectionList">
                  <!-- Filled by JS -->
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Korrekturwerte -->
        <div class="card">
          <div class="card-header">üîÑ Korrekturwerte (nach Verschlei√ü)</div>
          <div class="card-body">
            <div class="correction-grid">
              <div class="correction-card">
                <h4>√ò120 h5</h4>
                <div class="correction-value">-0,005</div>
                <div class="correction-unit">mm pro 5 Teile</div>
                <div class="correction-note">DR T3 anpassen wenn &gt;119,990</div>
              </div>
              <div class="correction-card">
                <h4>√ò26 H7</h4>
                <div class="correction-value">+0,003</div>
                <div class="correction-unit">mm pro 5 Teile</div>
                <div class="correction-note">T11 nachstellen wenn &lt;26,010</div>
              </div>
              <div class="correction-card">
                <h4>√ò44 H7</h4>
                <div class="correction-value">+0,004</div>
                <div class="correction-unit">mm pro 5 Teile</div>
                <div class="correction-note">T12 nachstellen wenn &lt;44,012</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Troubleshooting -->
        <div class="card">
          <div class="card-header">‚ö†Ô∏è St√∂rungsbeseitigung</div>
          <div class="card-body" style="padding: 0;">
            <table>
              <thead>
                <tr style="background: rgba(229, 62, 62, 0.2);">
                  <th>Problem</th>
                  <th>Ursache</th>
                  <th>L√∂sung</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td><strong>Rattern</strong></td>
                  <td>Drehzahl zu hoch, stumpfes WZ</td>
                  <td class="text-success">‚úÖ n -15%, WZ wechseln</td>
                </tr>
                <tr>
                  <td><strong>Ma√ü zu gro√ü</strong></td>
                  <td>WZ-Verschlei√ü, W√§rme</td>
                  <td class="text-success">‚úÖ Ausdrehkopf nachstellen</td>
                </tr>
                <tr>
                  <td><strong>Schlechte Oberfl√§che</strong></td>
                  <td>Stumpfes WZ, falscher Vorschub</td>
                  <td class="text-success">‚úÖ WZ wechseln, f anpassen</td>
                </tr>
                <tr>
                  <td><strong>Kaltverfestigung</strong></td>
                  <td>Vorschub zu niedrig</td>
                  <td class="text-success">‚úÖ f erh√∂hen, nie verweilen!</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Checklisten -->
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
          <div class="card">
            <div class="card-header">üìã Vor dem Start</div>
            <div class="card-body">
              <ul class="checklist">
                <li><span class="checkbox"></span>Werkzeugl√§ngen gepr√ºft</li>
                <li><span class="checkbox"></span>K√ºhlmittel 8-10%</li>
                <li><span class="checkbox"></span>Nullpunkt angetastet</li>
                <li><span class="checkbox"></span>Programm-Simulation OK</li>
                <li><span class="checkbox"></span>Spannmittel gepr√ºft</li>
              </ul>
            </div>
          </div>
          <div class="card">
            <div class="card-header">‚úÖ Nach Bearbeitung</div>
            <div class="card-body">
              <ul class="checklist">
                <li><span class="checkbox"></span>Kritische Ma√üe gepr√ºft</li>
                <li><span class="checkbox"></span>Oberfl√§cheng√ºte OK</li>
                <li><span class="checkbox"></span>Teil entgratet</li>
                <li><span class="checkbox"></span>Messwerte dokumentiert</li>
                <li><span class="checkbox"></span>Teil gereinigt</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- EINSTELLUNGEN PAGE -->
    <div id="page-einstellungen" class="page">
      <div class="header">
        <h1>‚öôÔ∏è Einstellungen</h1>
        <div class="header-actions">
          <button class="btn btn-primary" onclick="saveSettings()">üíæ Speichern</button>
        </div>
      </div>
      <div class="content">
        <div class="card">
          <div class="card-header">Firmendaten</div>
          <div class="card-body">
            <div class="form-grid">
              <div class="form-group">
                <label class="form-label">Firmenname</label>
                <input type="text" class="form-input" value="Maschinenbau Schlottwitz GmbH">
              </div>
              <div class="form-group">
                <label class="form-label">Inhaber</label>
                <input type="text" class="form-input" value="Andreas Brand">
              </div>
              <div class="form-group full">
                <label class="form-label">Adresse</label>
                <input type="text" class="form-input" value="Liebst√§dter Str. 3, 01768 Glash√ºtte">
              </div>
              <div class="form-group">
                <label class="form-label">Telefon</label>
                <input type="text" class="form-input" value="(035053) 412-0">
              </div>
              <div class="form-group">
                <label class="form-label">E-Mail</label>
                <input type="email" class="form-input" value="info@maschinenbau-schlottwitz.de">
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <script>
    // Demo operations data with enhanced info
    let operations = [
      { op: 'OP10', desc: 'Planfr√§sen Oberseite', tool: '√ò63 Planfr√§ser', toolNr: 'T1', dia: 63, n: 800, f: 300, th: 1.9, tn: 0.8, life: 85, lifeStatus: 'good' },
      { op: 'OP20', desc: 'Schruppen Au√üenkontur', tool: '√ò20 VHM-Fr√§ser', toolNr: 'T2', dia: 20, n: 2500, f: 400, th: 7.2, tn: 0.8, life: 55, lifeStatus: 'warning' },
      { op: 'OP30', desc: 'Schruppen Innenbohrung', tool: '√ò12 VHM-Fr√§ser', toolNr: 'T4', dia: 12, n: 3000, f: 350, th: 4.0, tn: 0.8, life: 50, lifeStatus: 'warning' },
      { op: 'OP40', desc: 'Lochkreis (8√ó √ò6,8)', tool: '√ò6,8 VHM-Bohrer', toolNr: 'T8', dia: 6.8, n: 2800, f: 180, th: 3.2, tn: 1.2, life: 35, lifeStatus: 'critical' },
      { op: 'OP50', desc: 'Schlichten √ò120 h5', tool: '√ò16 Schlichtfr√§ser', toolNr: 'T3', dia: 16, n: 3500, f: 250, th: 4.3, tn: 0.8, life: 75, lifeStatus: 'good', critical: true },
      { op: 'OP60', desc: 'Feinbohren √ò26 H7', tool: 'Ausdrehwerkzeug', toolNr: 'T11', dia: 26, n: 1500, f: 100, th: 3.3, tn: 0.8, life: 70, lifeStatus: 'good', critical: true },
      { op: 'OP70', desc: 'Feinbohren √ò44 H7', tool: 'Ausdrehwerkzeug', toolNr: 'T12', dia: 44, n: 1200, f: 80, th: 2.3, tn: 0.8, life: 80, lifeStatus: 'good' },
      { op: 'OP80', desc: 'Stufenfr√§sen (15mm)', tool: '√ò16 VHM-Fr√§ser', toolNr: 'T3', dia: 16, n: 3000, f: 300, th: 3.1, tn: 0.8, life: 75, lifeStatus: 'good' },
      { op: 'OP90', desc: 'Gewindefr√§sen M8 (4√ó)', tool: 'Gewindefr√§ser M8', toolNr: 'T13', dia: 8, n: 2000, f: 200, th: 2.4, tn: 1.0, life: 85, lifeStatus: 'good' },
      { op: 'OP100', desc: 'Anfasen', tool: '√ò12 Fasenfr√§ser 45¬∞', toolNr: 'T15', dia: 12, n: 4000, f: 300, th: 1.5, tn: 0.8, life: 95, lifeStatus: 'good' }
    ];

    const colors = ['#3498db', '#2980b9', '#1abc9c', '#16a085', '#e74c3c', '#c0392b', '#9b59b6', '#8e44ad', '#f39c12', '#d35400'];

    // Page navigation
    function showPage(page) {
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
      document.getElementById('page-' + page).classList.add('active');
      event.target.closest('.nav-item').classList.add('active');
      
      if (page === 'fertigung') updateFertigungsanweisung();
    }

    // Render operations table
    function renderOperations() {
      const tbody = document.getElementById('opsBody');
      tbody.innerHTML = operations.map((op, i) => `
        <tr>
          <td><span class="badge ${op.critical ? 'badge-warning' : 'badge-primary'}">${op.op}</span></td>
          <td>${op.desc}</td>
          <td>${op.tool}</td>
          <td class="mono">${op.n}</td>
          <td class="mono">${op.f}</td>
          <td class="mono text-accent">${op.th.toFixed(1)}</td>
          <td class="mono">${op.tn.toFixed(1)}</td>
          <td class="mono text-accent">${(op.th + op.tn).toFixed(1)}</td>
          <td><button class="btn btn-sm btn-secondary" onclick="removeOperation(${i})">‚úï</button></td>
        </tr>
      `).join('');
      
      const sumTh = operations.reduce((a, b) => a + b.th, 0);
      const sumTn = operations.reduce((a, b) => a + b.tn, 0);
      document.getElementById('sumTh').textContent = sumTh.toFixed(1);
      document.getElementById('sumTn').textContent = sumTn.toFixed(1);
      document.getElementById('sumTotal').textContent = (sumTh + sumTn).toFixed(1);
    }

    function addOperation() {
      const num = operations.length + 1;
      operations.push({
        op: 'OP' + (num * 10),
        desc: 'Neuer Arbeitsschritt',
        tool: 'Werkzeug',
        toolNr: 'T' + num,
        dia: 10,
        n: 2000,
        f: 200,
        th: 2.0,
        tn: 0.8,
        life: 100,
        lifeStatus: 'good'
      });
      renderOperations();
      recalculate();
    }

    function removeOperation(index) {
      operations.splice(index, 1);
      renderOperations();
      recalculate();
    }

    // Recalculate
    function recalculate() {
      const qty = parseInt(document.getElementById('quantity').value) || 10;
      const hourlyRate = parseFloat(document.getElementById('hourlyRate').value) || 85;
      const materialCost = parseFloat(document.getElementById('materialCost').value) || 45;
      const margin = parseFloat(document.getElementById('margin').value) || 20;
      
      const totalTime = operations.reduce((a, b) => a + b.th + b.tn, 0);
      const laborCost = (totalTime / 60) * hourlyRate;
      const unitPrice = (laborCost + materialCost) * (1 + margin / 100);
      const totalPrice = unitPrice * qty;
      const partsPerShift = Math.floor(480 / totalTime);
      
      document.getElementById('stat-time').textContent = totalTime.toFixed(1) + ' min';
      document.getElementById('stat-price').textContent = '‚Ç¨' + unitPrice.toFixed(2);
      document.getElementById('stat-parts').textContent = partsPerShift + ' Stk';
      document.getElementById('stat-total').textContent = '‚Ç¨' + totalPrice.toLocaleString('de-DE', {minimumFractionDigits: 0});
      
      window.calcData = { qty, unitPrice, totalPrice, totalTime, materialCost, margin };
    }

    // File upload
    function handleFileUpload(input) {
      if (input.files.length > 0) {
        const file = input.files[0];
        document.getElementById('fileName').textContent = file.name;
        document.getElementById('fileInfo').classList.add('visible');
        document.getElementById('uploadZone').classList.add('has-file');
      }
    }

    function removeFile() {
      document.getElementById('fileInput').value = '';
      document.getElementById('fileInfo').classList.remove('visible');
      document.getElementById('uploadZone').classList.remove('has-file');
    }

    function calculateAndShowQuote() {
      recalculate();
      updateQuote();
      showPage('angebot');
      document.querySelectorAll('.nav-item')[1].click();
    }

    function updateQuote() {
      const data = window.calcData || { qty: 10, unitPrice: 127.50, totalPrice: 1275 };
      const material = document.getElementById('material').value;
      const subtotal = data.totalPrice;
      const vat = subtotal * 0.19;
      const total = subtotal + vat;
      
      document.getElementById('quote-number').textContent = '2026-' + String(Math.floor(Math.random() * 9000) + 1000).padStart(4, '0');
      document.getElementById('quote-date').textContent = new Date().toLocaleDateString('de-DE');
      document.getElementById('quote-material').textContent = material;
      document.getElementById('quote-qty').textContent = data.qty + ' Stk';
      document.getElementById('quote-unit').textContent = '‚Ç¨' + data.unitPrice.toFixed(2);
      document.getElementById('quote-line-total').textContent = '‚Ç¨' + data.totalPrice.toLocaleString('de-DE', {minimumFractionDigits: 2});
      document.getElementById('quote-subtotal').textContent = '‚Ç¨' + subtotal.toLocaleString('de-DE', {minimumFractionDigits: 2});
      document.getElementById('quote-vat').textContent = '‚Ç¨' + vat.toLocaleString('de-DE', {minimumFractionDigits: 2});
      document.getElementById('quote-total').textContent = '‚Ç¨' + total.toLocaleString('de-DE', {minimumFractionDigits: 2});
    }

    // Enhanced Fertigungsanweisung
    function updateFertigungsanweisung() {
      const material = document.getElementById('material').value;
      const qty = document.getElementById('quantity').value;
      const totalTime = operations.reduce((a, b) => a + b.th + b.tn, 0);
      
      document.getElementById('fa-material').textContent = material;
      document.getElementById('fa-qty').textContent = qty;
      document.getElementById('fa-time').textContent = totalTime.toFixed(1) + ' min';
      
      // Progress bar
      const progressBar = document.getElementById('timeProgressBar');
      const legend = document.getElementById('timeLegend');
      
      progressBar.innerHTML = operations.map((op, i) => {
        const pct = ((op.th + op.tn) / totalTime * 100).toFixed(1);
        return `<div class="progress-segment" style="width: ${pct}%; background: ${colors[i % colors.length]};" title="${op.op}: ${(op.th + op.tn).toFixed(1)} min">${op.op.replace('OP','')}</div>`;
      }).join('');
      
      legend.innerHTML = operations.map((op, i) => 
        `<div class="legend-item"><div class="legend-color" style="background: ${colors[i % colors.length]};"></div>${op.op}: ${(op.th + op.tn).toFixed(1)} min${op.critical ? ' ‚ö†Ô∏è' : ''}</div>`
      ).join('');
      
      // Operations table
      document.getElementById('faOpsBody').innerHTML = operations.map(op => `
        <tr${op.critical ? ' style="background: rgba(229, 62, 62, 0.1);"' : ''}>
          <td><span class="badge ${op.critical ? 'badge-warning' : 'badge-primary'}">${op.op}</span></td>
          <td>${op.critical ? 'üéØ ' : ''}${op.desc}</td>
          <td>${op.toolNr} ${op.tool}</td>
          <td class="mono">${op.n}</td>
          <td class="mono">${op.f}</td>
          <td class="mono text-accent">${(op.th + op.tn).toFixed(1)} min</td>
          <td class="text-muted">${op.critical ? '‚ö†Ô∏è Toleranz pr√ºfen!' : ''}</td>
        </tr>
      `).join('');
      
      // Tool list with life bars
      const tools = operations.reduce((acc, op) => {
        if (!acc.find(t => t.toolNr === op.toolNr)) {
          acc.push({ toolNr: op.toolNr, tool: op.tool, dia: op.dia, life: op.life, lifeStatus: op.lifeStatus });
        }
        return acc;
      }, []);
      
      document.getElementById('toolListEnhanced').innerHTML = tools.map(t => `
        <tr>
          <td><strong>${t.toolNr}</strong></td>
          <td>${t.tool}</td>
          <td class="mono">√ò${t.dia}</td>
          <td>
            <div class="tool-life-bar">
              <div class="tool-life-fill ${t.lifeStatus}" style="width: ${t.life}%;">${t.life}%</div>
            </div>
          </td>
        </tr>
      `).join('');
      
      // Inspection
      document.getElementById('inspectionList').innerHTML = `
        <tr style="background: rgba(229, 62, 62, 0.1);"><td><strong>√ò120 h5</strong></td><td>120.000</td><td class="text-warning">-0.013</td><td>B√ºgelmessschraube</td></tr>
        <tr style="background: rgba(229, 62, 62, 0.1);"><td><strong>√ò26 H7</strong></td><td>26.000</td><td class="text-warning">+0.021</td><td>Innenmessschraube</td></tr>
        <tr style="background: rgba(229, 62, 62, 0.1);"><td><strong>√ò44 H7</strong></td><td>44.000</td><td class="text-warning">+0.025</td><td>Innenmessschraube</td></tr>
        <tr><td>Planfl√§che</td><td>Ra 1.6</td><td>-</td><td>Rauheitsmessger√§t</td></tr>
        <tr><td>Gesamth√∂he</td><td>42.0</td><td>¬±0.1</td><td>H√∂henmessger√§t</td></tr>
      `;
    }

    function resetCalculation() {
      document.getElementById('quantity').value = 10;
      document.getElementById('materialCost').value = 45;
      document.getElementById('margin').value = 20;
      removeFile();
      recalculate();
    }

    function downloadPDF() {
      alert('PDF-Export wird vorbereitet...\n\nIn der Vollversion wird hier ein professionelles PDF generiert.');
      window.print();
    }

    function exportNC() {
      alert('NC-Code Export (Heidenhain TNC 640)\n\nDiese Funktion ist in der Vollversion verf√ºgbar.\n\nProgrammkopf:\nBEGIN PGM GRUNDPLATTE MM\n; Grundplatte Antriebseinheit\n; Werkstoff: 1.4571\n...');
    }

    function saveSettings() {
      alert('Einstellungen gespeichert!');
    }

    // Initialize
    renderOperations();
    recalculate();
  </script>
</body>
</html>
