<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CNC Planner Pro — Fertigungsplanung & Kalkulation</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        /* === DESIGN SYSTEM === */
        :root {
            --primary: #1e3a5f;
            --primary-dark: #152a45;
            --primary-light: #2d5a8a;
            --accent: #2563eb;
            --accent-dark: #1d4ed8;
            --success: #059669;
            --warning: #d97706;
            --danger: #dc2626;
            --gray-50: #f8fafc;
            --gray-100: #f1f5f9;
            --gray-200: #e2e8f0;
            --gray-300: #cbd5e1;
            --gray-400: #94a3b8;
            --gray-500: #64748b;
            --gray-600: #475569;
            --gray-700: #334155;
            --gray-800: #1e293b;
            --gray-900: #0f172a;
            --radius: 6px;
            --radius-lg: 12px;
            --shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background: var(--gray-100);
            color: var(--gray-800);
            line-height: 1.6;
            min-height: 100vh;
        }

        /* === HEADER === */
        .header {
            background: white;
            border-bottom: 1px solid var(--gray-200);
            padding: 12px 20px;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-inner {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 20px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            text-decoration: none;
        }

        .logo-icon {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 0.85rem;
        }

        .logo-text {
            font-weight: 700;
            color: var(--gray-900);
        }

        .logo-text span { color: var(--primary); }

        .header-actions {
            display: flex;
            gap: 8px;
        }

        /* === BUTTONS === */
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 16px;
            border-radius: var(--radius);
            font-weight: 500;
            font-size: 0.85rem;
            text-decoration: none;
            transition: all 0.15s;
            border: none;
            cursor: pointer;
        }

        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: var(--primary-dark); }
        .btn-accent { background: var(--accent); color: white; }
        .btn-accent:hover { background: var(--accent-dark); }
        .btn-success { background: var(--success); color: white; }
        .btn-secondary { background: white; color: var(--gray-700); border: 1px solid var(--gray-300); }
        .btn-secondary:hover { background: var(--gray-50); }
        .btn-sm { padding: 6px 12px; font-size: 0.8rem; }
        .btn-lg { padding: 12px 24px; font-size: 1rem; }

        /* === LAYOUT === */
        .main-layout {
            display: grid;
            grid-template-columns: 380px 1fr;
            gap: 0;
            max-width: 1400px;
            margin: 0 auto;
            min-height: calc(100vh - 61px);
        }

        @media (max-width: 1024px) {
            .main-layout {
                grid-template-columns: 1fr;
            }
        }

        /* === LEFT SIDEBAR: INPUT === */
        .sidebar {
            background: white;
            border-right: 1px solid var(--gray-200);
            overflow-y: auto;
            max-height: calc(100vh - 61px);
        }

        .sidebar-section {
            padding: 20px;
            border-bottom: 1px solid var(--gray-200);
        }

        .sidebar-section:last-child { border-bottom: none; }

        .sidebar-title {
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--gray-500);
            margin-bottom: 12px;
        }

        /* === FORM ELEMENTS === */
        .form-group {
            margin-bottom: 16px;
        }

        .form-group:last-child { margin-bottom: 0; }

        .form-label {
            display: block;
            font-size: 0.85rem;
            font-weight: 500;
            color: var(--gray-700);
            margin-bottom: 6px;
        }

        .form-input, .form-select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--gray-300);
            border-radius: var(--radius);
            font-size: 0.9rem;
            font-family: inherit;
            transition: all 0.15s;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(30, 58, 95, 0.1);
        }

        .form-input::placeholder { color: var(--gray-400); }

        .form-row {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }

        .form-hint {
            font-size: 0.75rem;
            color: var(--gray-500);
            margin-top: 4px;
        }

        .input-group {
            display: flex;
            align-items: center;
        }

        .input-group .form-input {
            border-radius: var(--radius) 0 0 var(--radius);
        }

        .input-suffix {
            padding: 10px 12px;
            background: var(--gray-100);
            border: 1px solid var(--gray-300);
            border-left: none;
            border-radius: 0 var(--radius) var(--radius) 0;
            font-size: 0.85rem;
            color: var(--gray-500);
        }

        /* === OPERATIONS LIST === */
        .operations-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .operation-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
            background: var(--gray-50);
            border: 1px solid var(--gray-200);
            border-radius: var(--radius);
            cursor: pointer;
            transition: all 0.15s;
        }

        .operation-item:hover {
            border-color: var(--primary);
            background: white;
        }

        .operation-item.active {
            border-color: var(--primary);
            background: #eff6ff;
        }

        .operation-checkbox {
            width: 18px;
            height: 18px;
            accent-color: var(--primary);
        }

        .operation-info { flex: 1; }
        .operation-name { font-weight: 500; font-size: 0.9rem; }
        .operation-desc { font-size: 0.75rem; color: var(--gray-500); }
        .operation-time { font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; color: var(--primary); }

        /* === MAIN CONTENT === */
        .main-content {
            padding: 20px;
            overflow-y: auto;
            max-height: calc(100vh - 61px);
        }

        /* === RESULTS PANEL === */
        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .results-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--gray-900);
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        @media (max-width: 1200px) {
            .results-grid { grid-template-columns: repeat(2, 1fr); }
        }

        .result-card {
            background: white;
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-lg);
            padding: 20px;
            text-align: center;
        }

        .result-card.highlight {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            border: none;
        }

        .result-label {
            font-size: 0.8rem;
            color: var(--gray-500);
            margin-bottom: 4px;
        }

        .result-card.highlight .result-label { color: rgba(255,255,255,0.8); }

        .result-value {
            font-size: 1.8rem;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
            color: var(--gray-900);
        }

        .result-card.highlight .result-value { color: white; }

        .result-detail {
            font-size: 0.75rem;
            color: var(--gray-400);
            margin-top: 4px;
        }

        .result-card.highlight .result-detail { color: rgba(255,255,255,0.7); }

        /* === TABS === */
        .tabs {
            display: flex;
            gap: 4px;
            background: var(--gray-100);
            padding: 4px;
            border-radius: var(--radius);
            margin-bottom: 20px;
        }

        .tab {
            flex: 1;
            padding: 10px 16px;
            border: none;
            background: transparent;
            border-radius: var(--radius);
            font-weight: 500;
            font-size: 0.85rem;
            color: var(--gray-600);
            cursor: pointer;
            transition: all 0.15s;
        }

        .tab:hover { color: var(--gray-800); }
        .tab.active { background: white; color: var(--primary); box-shadow: var(--shadow); }

        .tab-panel { display: none; }
        .tab-panel.active { display: block; }

        /* === DATA TABLES === */
        .data-card {
            background: white;
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-lg);
            overflow: hidden;
            margin-bottom: 20px;
        }

        .data-card-header {
            padding: 16px 20px;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .data-card-title {
            font-weight: 600;
            color: var(--gray-900);
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85rem;
        }

        .data-table th {
            background: var(--gray-50);
            padding: 12px 16px;
            text-align: left;
            font-weight: 500;
            color: var(--gray-600);
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .data-table td {
            padding: 12px 16px;
            border-bottom: 1px solid var(--gray-100);
        }

        .data-table tr:last-child td { border-bottom: none; }

        .data-table .mono {
            font-family: 'JetBrains Mono', monospace;
        }

        .data-table .right { text-align: right; }
        .data-table .center { text-align: center; }

        .data-table .total-row {
            background: var(--gray-50);
            font-weight: 600;
        }

        /* === SERIES CALCULATOR === */
        .series-calc {
            background: linear-gradient(135deg, #eff6ff, #dbeafe);
            border: 1px solid #93c5fd;
            border-radius: var(--radius-lg);
            padding: 20px;
            margin-bottom: 20px;
        }

        .series-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .series-title {
            font-weight: 600;
            color: var(--primary);
        }

        .series-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 12px;
        }

        .series-item {
            background: white;
            border-radius: var(--radius);
            padding: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.15s;
            border: 2px solid transparent;
        }

        .series-item:hover { border-color: var(--primary); }
        .series-item.active { border-color: var(--primary); background: #eff6ff; }

        .series-qty {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--gray-900);
        }

        .series-price {
            font-size: 0.85rem;
            color: var(--success);
            font-weight: 600;
            font-family: 'JetBrains Mono', monospace;
        }

        .series-unit {
            font-size: 0.7rem;
            color: var(--gray-500);
        }

        /* === CODE BLOCK === */
        .code-block {
            background: var(--gray-900);
            border-radius: var(--radius);
            overflow: hidden;
        }

        .code-header {
            background: var(--gray-800);
            padding: 10px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .code-tabs {
            display: flex;
            gap: 4px;
        }

        .code-tab {
            padding: 6px 12px;
            border: none;
            background: transparent;
            color: var(--gray-400);
            font-size: 0.8rem;
            font-weight: 500;
            cursor: pointer;
            border-radius: var(--radius);
        }

        .code-tab:hover { color: white; }
        .code-tab.active { background: var(--gray-700); color: white; }

        .code-content {
            padding: 16px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
            color: #e2e8f0;
            overflow-x: auto;
            max-height: 400px;
            overflow-y: auto;
        }

        .code-content pre { margin: 0; white-space: pre; }
        .code-comment { color: #6b7280; }
        .code-keyword { color: #60a5fa; }
        .code-number { color: #34d399; }
        .code-string { color: #fbbf24; }

        /* === PDF PREVIEW === */
        .pdf-preview {
            background: white;
            border: 1px solid var(--gray-300);
            border-radius: var(--radius);
            padding: 40px;
            box-shadow: var(--shadow-lg);
            max-width: 800px;
            margin: 0 auto;
        }

        .pdf-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 3px solid var(--primary);
        }

        .pdf-logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
        }

        .pdf-meta { text-align: right; font-size: 0.85rem; color: var(--gray-600); }

        /* === FLOATING ACTION === */
        .floating-cta {
            position: fixed;
            bottom: 24px;
            right: 24px;
            z-index: 100;
        }

        .floating-btn {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 14px 24px;
            background: var(--success);
            color: white;
            border: none;
            border-radius: 50px;
            font-weight: 600;
            font-size: 0.95rem;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(5, 150, 105, 0.4);
            transition: all 0.2s;
        }

        .floating-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(5, 150, 105, 0.5);
        }

        /* === BADGE === */
        .badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 20px;
            font-size: 0.7rem;
            font-weight: 600;
        }

        .badge-success { background: #d1fae5; color: #065f46; }
        .badge-warning { background: #fef3c7; color: #92400e; }
        .badge-info { background: #dbeafe; color: #1e40af; }

        /* === EMPTY STATE === */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--gray-500);
        }

        .empty-icon {
            font-size: 3rem;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        /* === MATERIAL SELECT === */
        .material-option {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
        }

        .material-name { font-weight: 500; }
        .material-code { color: var(--gray-500); font-size: 0.85rem; }

        /* === LIVE UPDATE INDICATOR === */
        .live-indicator {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font-size: 0.75rem;
            color: var(--success);
        }

        .live-dot {
            width: 8px;
            height: 8px;
            background: var(--success);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* === PRINT STYLES === */
        @media print {
            .header, .sidebar, .tabs, .floating-cta { display: none !important; }
            .main-layout { display: block; }
            .main-content { max-height: none; overflow: visible; }
        }
    </style>
</head>
<body>
    <!-- HEADER -->
    <header class="header">
        <div class="header-inner">
            <a href="#" class="logo">
                <div class="logo-icon">CP</div>
                <div class="logo-text">CNC Planner <span>Pro</span></div>
            </a>
            
            <div class="live-indicator">
                <div class="live-dot"></div>
                Live-Berechnung aktiv
            </div>
            
            <div class="header-actions">
                <button class="btn btn-secondary btn-sm" onclick="saveProject()">Speichern</button>
                <button class="btn btn-secondary btn-sm" onclick="loadProject()">Laden</button>
                <button class="btn btn-primary btn-sm" onclick="exportPDF()">PDF Export</button>
            </div>
        </div>
    </header>

    <div class="main-layout">
        <!-- LEFT SIDEBAR: INPUT -->
        <aside class="sidebar">
            <!-- Project Info -->
            <div class="sidebar-section">
                <div class="sidebar-title">Projekt</div>
                <div class="form-group">
                    <label class="form-label">Projektname</label>
                    <input type="text" class="form-input" id="projectName" value="Neues Bauteil" oninput="calculate()">
                </div>
                <div class="form-group">
                    <label class="form-label">Zeichnungsnummer</label>
                    <input type="text" class="form-input" id="drawingNo" placeholder="z.B. WZ-2026-001" oninput="calculate()">
                </div>
            </div>

            <!-- Dimensions -->
            <div class="sidebar-section">
                <div class="sidebar-title">Rohmaße (mm)</div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Länge</label>
                        <input type="number" class="form-input" id="dimLength" value="150" min="1" oninput="calculate()">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Breite</label>
                        <input type="number" class="form-input" id="dimWidth" value="100" min="1" oninput="calculate()">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Höhe</label>
                        <input type="number" class="form-input" id="dimHeight" value="40" min="1" oninput="calculate()">
                    </div>
                </div>
                <div class="form-hint" id="volumeHint">Volumen: 600.000 mm³</div>
            </div>

            <!-- Material -->
            <div class="sidebar-section">
                <div class="sidebar-title">Werkstoff</div>
                <div class="form-group">
                    <select class="form-select" id="material" onchange="calculate()">
                        <optgroup label="Edelstahl">
                            <option value="1.4571" selected>1.4571 (V4A) — Edelstahl</option>
                            <option value="1.4301">1.4301 (V2A) — Edelstahl</option>
                            <option value="1.4404">1.4404 — Edelstahl</option>
                        </optgroup>
                        <optgroup label="Stahl">
                            <option value="S355">S355 — Baustahl</option>
                            <option value="C45">C45 — Vergütungsstahl</option>
                            <option value="42CrMo4">42CrMo4 — Vergütungsstahl</option>
                            <option value="16MnCr5">16MnCr5 — Einsatzstahl</option>
                        </optgroup>
                        <optgroup label="Aluminium">
                            <option value="AlMg3">AlMg3 — Aluminium</option>
                            <option value="AlMgSi1">AlMgSi1 — Aluminium</option>
                            <option value="Al7075">Al 7075 — Hochfest</option>
                        </optgroup>
                        <optgroup label="Sonstige">
                            <option value="CuZn39Pb3">CuZn39Pb3 — Messing</option>
                            <option value="CuSn8">CuSn8 — Bronze</option>
                            <option value="PA6">PA6 — Kunststoff</option>
                            <option value="POM">POM — Kunststoff</option>
                        </optgroup>
                    </select>
                </div>
                <div class="form-hint" id="materialHint">Dichte: 7,98 g/cm³ | Preis: €7,00/kg</div>
            </div>

            <!-- Operations -->
            <div class="sidebar-section">
                <div class="sidebar-title">Operationen</div>
                <div class="operations-list">
                    <label class="operation-item">
                        <input type="checkbox" class="operation-checkbox" checked data-op="planfraesen" data-time="5" onchange="calculate()">
                        <div class="operation-info">
                            <div class="operation-name">Planfräsen</div>
                            <div class="operation-desc">Oberseite planen</div>
                        </div>
                        <div class="operation-time">5 min</div>
                    </label>
                    <label class="operation-item">
                        <input type="checkbox" class="operation-checkbox" checked data-op="konturfraesen" data-time="15" onchange="calculate()">
                        <div class="operation-info">
                            <div class="operation-name">Konturfräsen</div>
                            <div class="operation-desc">Außenkontur</div>
                        </div>
                        <div class="operation-time">15 min</div>
                    </label>
                    <label class="operation-item">
                        <input type="checkbox" class="operation-checkbox" checked data-op="taschen" data-time="12" onchange="calculate()">
                        <div class="operation-info">
                            <div class="operation-name">Taschenfräsen</div>
                            <div class="operation-desc">Innentaschen</div>
                        </div>
                        <div class="operation-time">12 min</div>
                    </label>
                    <label class="operation-item">
                        <input type="checkbox" class="operation-checkbox" checked data-op="bohren" data-time="8" onchange="calculate()">
                        <div class="operation-info">
                            <div class="operation-name">Bohren</div>
                            <div class="operation-desc">Bohrungen + Gewinde</div>
                        </div>
                        <div class="operation-time">8 min</div>
                    </label>
                    <label class="operation-item">
                        <input type="checkbox" class="operation-checkbox" data-op="schlichten" data-time="10" onchange="calculate()">
                        <div class="operation-info">
                            <div class="operation-name">Schlichten</div>
                            <div class="operation-desc">Feinbearbeitung</div>
                        </div>
                        <div class="operation-time">10 min</div>
                    </label>
                </div>
            </div>

            <!-- Settings -->
            <div class="sidebar-section">
                <div class="sidebar-title">Einstellungen</div>
                <div class="form-group">
                    <label class="form-label">Stundensatz (€/h)</label>
                    <input type="number" class="form-input" id="hourlyRate" value="85" min="1" oninput="calculate()">
                </div>
                <div class="form-group">
                    <label class="form-label">Marge (%)</label>
                    <input type="number" class="form-input" id="margin" value="15" min="0" max="100" oninput="calculate()">
                </div>
                <div class="form-group">
                    <label class="form-label">Stückzahl</label>
                    <input type="number" class="form-input" id="quantity" value="1" min="1" oninput="calculate()">
                </div>
            </div>
        </aside>

        <!-- MAIN CONTENT -->
        <main class="main-content">
            <!-- Results Summary -->
            <div class="results-header">
                <div class="results-title" id="resultsTitle">Kalkulation: Neues Bauteil</div>
                <span class="badge badge-success">Berechnet</span>
            </div>

            <div class="results-grid">
                <div class="result-card">
                    <div class="result-label">Bearbeitungszeit</div>
                    <div class="result-value" id="resultTime">40 min</div>
                    <div class="result-detail" id="resultTimeDetail">Haupt + Neben</div>
                </div>
                <div class="result-card">
                    <div class="result-label">Materialkosten</div>
                    <div class="result-value" id="resultMaterial">€33,50</div>
                    <div class="result-detail" id="resultMaterialDetail">4,79 kg × €7,00</div>
                </div>
                <div class="result-card">
                    <div class="result-label">Maschinenkosten</div>
                    <div class="result-value" id="resultMachine">€56,67</div>
                    <div class="result-detail" id="resultMachineDetail">40 min × €85/h</div>
                </div>
                <div class="result-card highlight">
                    <div class="result-label">Verkaufspreis</div>
                    <div class="result-value" id="resultTotal">€103,70</div>
                    <div class="result-detail" id="resultTotalDetail">inkl. 15% Marge</div>
                </div>
            </div>

            <!-- Series Calculator -->
            <div class="series-calc">
                <div class="series-header">
                    <div class="series-title">Serienkalkulation</div>
                    <span class="badge badge-info">Mengenrabatt eingerechnet</span>
                </div>
                <div class="series-grid">
                    <div class="series-item active" onclick="setQuantity(1)">
                        <div class="series-qty">1 Stk</div>
                        <div class="series-price" id="price1">€103,70</div>
                        <div class="series-unit">pro Stück</div>
                    </div>
                    <div class="series-item" onclick="setQuantity(5)">
                        <div class="series-qty">5 Stk</div>
                        <div class="series-price" id="price5">€95,40</div>
                        <div class="series-unit">pro Stück</div>
                    </div>
                    <div class="series-item" onclick="setQuantity(10)">
                        <div class="series-qty">10 Stk</div>
                        <div class="series-price" id="price10">€89,20</div>
                        <div class="series-unit">pro Stück</div>
                    </div>
                    <div class="series-item" onclick="setQuantity(25)">
                        <div class="series-qty">25 Stk</div>
                        <div class="series-price" id="price25">€82,90</div>
                        <div class="series-unit">pro Stück</div>
                    </div>
                    <div class="series-item" onclick="setQuantity(50)">
                        <div class="series-qty">50 Stk</div>
                        <div class="series-price" id="price50">€78,50</div>
                        <div class="series-unit">pro Stück</div>
                    </div>
                </div>
            </div>

            <!-- Tabs -->
            <div class="tabs">
                <button class="tab active" onclick="showTab('kalkulation')">Kalkulation</button>
                <button class="tab" onclick="showTab('angebot')">Angebot</button>
                <button class="tab" onclick="showTab('werkzeuge')">Werkzeuge</button>
                <button class="tab" onclick="showTab('nccode')">NC-Code</button>
            </div>

            <!-- Tab: Kalkulation -->
            <div class="tab-panel active" id="panel-kalkulation">
                <!-- Time Breakdown -->
                <div class="data-card">
                    <div class="data-card-header">
                        <div class="data-card-title">Zeitkalkulation</div>
                    </div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Operation</th>
                                <th>Beschreibung</th>
                                <th class="right">Zeit (min)</th>
                            </tr>
                        </thead>
                        <tbody id="timeBreakdown">
                            <!-- Filled by JS -->
                        </tbody>
                    </table>
                </div>

                <!-- Cost Breakdown -->
                <div class="data-card">
                    <div class="data-card-header">
                        <div class="data-card-title">Kostenkalkulation</div>
                    </div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Position</th>
                                <th>Berechnung</th>
                                <th class="right">Betrag</th>
                            </tr>
                        </thead>
                        <tbody id="costBreakdown">
                            <!-- Filled by JS -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Tab: Angebot -->
            <div class="tab-panel" id="panel-angebot">
                <div class="pdf-preview">
                    <div class="pdf-header">
                        <div>
                            <div class="pdf-logo">Ihre Firma GmbH</div>
                            <div style="font-size: 0.85rem; color: var(--gray-500); margin-top: 4px;">
                                Musterstraße 123 · 12345 Musterstadt
                            </div>
                        </div>
                        <div class="pdf-meta">
                            <strong>ANGEBOT</strong><br>
                            Nr: <span id="quoteNo">ANG-2026-0001</span><br>
                            Datum: <span id="quoteDate">03.02.2026</span>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 30px;">
                        <strong>Kunde:</strong><br>
                        <div style="color: var(--gray-500);">Kundenname einfügen</div>
                    </div>

                    <table class="data-table" style="margin-bottom: 20px;">
                        <thead>
                            <tr>
                                <th>Pos</th>
                                <th>Beschreibung</th>
                                <th class="center">Menge</th>
                                <th class="right">EP (€)</th>
                                <th class="right">GP (€)</th>
                            </tr>
                        </thead>
                        <tbody id="quoteItems">
                            <!-- Filled by JS -->
                        </tbody>
                    </table>

                    <div style="display: flex; justify-content: flex-end;">
                        <div style="width: 250px;">
                            <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--gray-200);">
                                <span>Netto:</span>
                                <span id="quoteNetto" class="mono">€103,70</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--gray-200);">
                                <span>MwSt. 19%:</span>
                                <span id="quoteMwst" class="mono">€19,70</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 12px 0; font-weight: 700; font-size: 1.1rem; color: var(--primary);">
                                <span>Gesamt:</span>
                                <span id="quoteBrutto" class="mono">€123,40</span>
                            </div>
                        </div>
                    </div>

                    <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid var(--gray-200); font-size: 0.8rem; color: var(--gray-500);">
                        <strong>Zahlungsbedingungen:</strong> 14 Tage netto<br>
                        <strong>Lieferzeit:</strong> ca. 2-3 Wochen nach Auftragserteilung<br>
                        <strong>Gültigkeit:</strong> 30 Tage
                    </div>
                </div>
            </div>

            <!-- Tab: Werkzeuge -->
            <div class="tab-panel" id="panel-werkzeuge">
                <div class="data-card">
                    <div class="data-card-header">
                        <div class="data-card-title">Werkzeugliste & Schnittdaten</div>
                        <span class="badge badge-warning">Werkstoffabhängig</span>
                    </div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Werkzeug</th>
                                <th>Operation</th>
                                <th class="right">Vc (m/min)</th>
                                <th class="right">n (U/min)</th>
                                <th class="right">fz (mm)</th>
                                <th class="right">vf (mm/min)</th>
                                <th class="right">Kosten</th>
                            </tr>
                        </thead>
                        <tbody id="toolsTable">
                            <!-- Filled by JS -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Tab: NC-Code -->
            <div class="tab-panel" id="panel-nccode">
                <div class="code-block">
                    <div class="code-header">
                        <div class="code-tabs">
                            <button class="code-tab active" onclick="setCodeFormat('heidenhain')">Heidenhain</button>
                            <button class="code-tab" onclick="setCodeFormat('siemens')">Siemens</button>
                            <button class="code-tab" onclick="setCodeFormat('fanuc')">Fanuc</button>
                        </div>
                        <div>
                            <button class="btn btn-sm btn-secondary" onclick="copyCode()">Kopieren</button>
                            <button class="btn btn-sm btn-primary" onclick="downloadCode()">Download</button>
                        </div>
                    </div>
                    <div class="code-content">
                        <pre id="ncCodeContent">; Wählen Sie ein Projekt und Operationen</pre>
                    </div>
                </div>
                <div style="margin-top: 16px; padding: 12px 16px; background: #fef3c7; border-radius: var(--radius); font-size: 0.85rem; color: #92400e;">
                    <strong>Hinweis:</strong> NC-Code vor Einsatz prüfen. Automatisch generierte Programme müssen an die jeweilige Maschine angepasst werden.
                </div>
            </div>
        </main>
    </div>

    <!-- Floating CTA -->
    <div class="floating-cta">
        <button class="floating-btn" onclick="exportPDF()">
            <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24"><path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/></svg>
            Angebot erstellen
        </button>
    </div>

    <script>
        // ==========================================
        // CNC PLANNER PRO — CALCULATION ENGINE
        // ==========================================

        // Material Database
        const MATERIALS = {
            '1.4571': { name: 'V4A Edelstahl', density: 7.98, price: 7.00, factor: 1.0 },
            '1.4301': { name: 'V2A Edelstahl', density: 7.90, price: 5.50, factor: 0.9 },
            '1.4404': { name: 'Edelstahl', density: 7.95, price: 6.50, factor: 0.95 },
            'S355': { name: 'Baustahl', density: 7.85, price: 1.20, factor: 0.6 },
            'C45': { name: 'Vergütungsstahl', density: 7.85, price: 1.80, factor: 0.7 },
            '42CrMo4': { name: 'Vergütungsstahl', density: 7.85, price: 2.50, factor: 0.8 },
            '16MnCr5': { name: 'Einsatzstahl', density: 7.85, price: 2.20, factor: 0.75 },
            'AlMg3': { name: 'Aluminium', density: 2.66, price: 4.50, factor: 0.4 },
            'AlMgSi1': { name: 'Aluminium', density: 2.70, price: 5.00, factor: 0.45 },
            'Al7075': { name: 'Alu Hochfest', density: 2.81, price: 8.00, factor: 0.5 },
            'CuZn39Pb3': { name: 'Messing', density: 8.47, price: 8.00, factor: 0.5 },
            'CuSn8': { name: 'Bronze', density: 8.80, price: 12.00, factor: 0.55 },
            'PA6': { name: 'Kunststoff', density: 1.14, price: 6.00, factor: 0.3 },
            'POM': { name: 'Kunststoff', density: 1.41, price: 5.50, factor: 0.3 }
        };

        // Tool Database
        const TOOLS = {
            'planfraesen': { name: 'Planfräser Ø63', price: 45, standzeit: 60, vc: 160 },
            'konturfraesen': { name: 'VHM-Fräser Ø20', price: 120, standzeit: 180, vc: 120 },
            'taschen': { name: 'VHM-Fräser Ø16', price: 95, standzeit: 150, vc: 130 },
            'bohren': { name: 'Spiralbohrer Ø10', price: 25, standzeit: 200, vc: 80 },
            'schlichten': { name: 'Schlichtfräser Ø12', price: 85, standzeit: 120, vc: 140 }
        };

        // State
        let currentProject = {
            name: 'Neues Bauteil',
            drawingNo: '',
            dimensions: { l: 150, w: 100, h: 40 },
            material: '1.4571',
            operations: ['planfraesen', 'konturfraesen', 'taschen', 'bohren'],
            hourlyRate: 85,
            margin: 15,
            quantity: 1
        };

        // Calculate everything
        function calculate() {
            // Get inputs
            currentProject.name = document.getElementById('projectName').value || 'Neues Bauteil';
            currentProject.drawingNo = document.getElementById('drawingNo').value;
            currentProject.dimensions.l = parseFloat(document.getElementById('dimLength').value) || 150;
            currentProject.dimensions.w = parseFloat(document.getElementById('dimWidth').value) || 100;
            currentProject.dimensions.h = parseFloat(document.getElementById('dimHeight').value) || 40;
            currentProject.material = document.getElementById('material').value;
            currentProject.hourlyRate = parseFloat(document.getElementById('hourlyRate').value) || 85;
            currentProject.margin = parseFloat(document.getElementById('margin').value) || 15;
            currentProject.quantity = parseInt(document.getElementById('quantity').value) || 1;

            // Get selected operations
            currentProject.operations = [];
            document.querySelectorAll('.operation-checkbox:checked').forEach(cb => {
                currentProject.operations.push(cb.dataset.op);
            });

            // Material calculations
            const mat = MATERIALS[currentProject.material];
            const volume = currentProject.dimensions.l * currentProject.dimensions.w * currentProject.dimensions.h;
            const volumeCm3 = volume / 1000;
            const weight = volumeCm3 * mat.density / 1000; // kg
            const materialCost = weight * mat.price * 1.1; // +10% Verschnitt

            // Time calculations
            let totalTime = 0;
            const timeBreakdown = [];
            currentProject.operations.forEach(op => {
                const baseTime = parseFloat(document.querySelector(`[data-op="${op}"]`)?.dataset.time || 10);
                const adjustedTime = baseTime * mat.factor * (volume / 600000); // Scale with size
                const finalTime = Math.max(2, Math.round(adjustedTime * 10) / 10);
                totalTime += finalTime;
                timeBreakdown.push({ op, name: TOOLS[op]?.name || op, time: finalTime });
            });

            // Add setup time
            const setupTime = 15;
            totalTime += setupTime;

            // Machine cost
            const machineCost = (totalTime / 60) * currentProject.hourlyRate;

            // Tool cost (simplified)
            let toolCost = 0;
            currentProject.operations.forEach(op => {
                const tool = TOOLS[op];
                if (tool) {
                    const usage = timeBreakdown.find(t => t.op === op)?.time || 5;
                    toolCost += (tool.price / tool.standzeit) * usage;
                }
            });

            // Total cost
            const selfCost = materialCost + machineCost + toolCost;
            const sellPrice = selfCost * (1 + currentProject.margin / 100);

            // Update UI
            document.getElementById('resultsTitle').textContent = `Kalkulation: ${currentProject.name}`;
            document.getElementById('volumeHint').textContent = `Volumen: ${volume.toLocaleString('de-DE')} mm³`;
            document.getElementById('materialHint').textContent = `Dichte: ${mat.density} g/cm³ | Preis: €${mat.price.toFixed(2)}/kg`;

            document.getElementById('resultTime').textContent = `${Math.round(totalTime)} min`;
            document.getElementById('resultTimeDetail').textContent = `inkl. ${setupTime} min Rüstzeit`;
            
            document.getElementById('resultMaterial').textContent = `€${materialCost.toFixed(2)}`;
            document.getElementById('resultMaterialDetail').textContent = `${weight.toFixed(2)} kg × €${mat.price.toFixed(2)}`;
            
            document.getElementById('resultMachine').textContent = `€${machineCost.toFixed(2)}`;
            document.getElementById('resultMachineDetail').textContent = `${Math.round(totalTime)} min × €${currentProject.hourlyRate}/h`;
            
            document.getElementById('resultTotal').textContent = `€${sellPrice.toFixed(2)}`;
            document.getElementById('resultTotalDetail').textContent = `inkl. ${currentProject.margin}% Marge`;

            // Series pricing
            const seriesDiscount = { 1: 0, 5: 0.08, 10: 0.14, 25: 0.20, 50: 0.24 };
            Object.keys(seriesDiscount).forEach(qty => {
                const setupPerPiece = (setupTime / 60) * currentProject.hourlyRate / parseInt(qty);
                const adjustedPrice = (selfCost - (setupTime / 60) * currentProject.hourlyRate + setupPerPiece) * (1 - seriesDiscount[qty]) * (1 + currentProject.margin / 100);
                document.getElementById(`price${qty}`).textContent = `€${adjustedPrice.toFixed(2)}`;
            });

            // Time breakdown table
            const timeTableHtml = timeBreakdown.map(t => `
                <tr>
                    <td>${TOOLS[t.op]?.name || t.op}</td>
                    <td>${getOpDescription(t.op)}</td>
                    <td class="right mono">${t.time.toFixed(1)}</td>
                </tr>
            `).join('') + `
                <tr>
                    <td>Rüstzeit</td>
                    <td>Einrichten, Spannen, Messen</td>
                    <td class="right mono">${setupTime.toFixed(1)}</td>
                </tr>
                <tr class="total-row">
                    <td colspan="2"><strong>Gesamt</strong></td>
                    <td class="right mono"><strong>${totalTime.toFixed(1)} min</strong></td>
                </tr>
            `;
            document.getElementById('timeBreakdown').innerHTML = timeTableHtml;

            // Cost breakdown table
            const costTableHtml = `
                <tr>
                    <td>Material (${currentProject.material})</td>
                    <td class="mono">${weight.toFixed(2)} kg × €${mat.price.toFixed(2)}/kg × 1,1</td>
                    <td class="right mono">€${materialCost.toFixed(2)}</td>
                </tr>
                <tr>
                    <td>Maschinenzeit</td>
                    <td class="mono">${totalTime.toFixed(0)} min × €${currentProject.hourlyRate}/h</td>
                    <td class="right mono">€${machineCost.toFixed(2)}</td>
                </tr>
                <tr>
                    <td>Werkzeugverschleiß</td>
                    <td class="mono">anteilig</td>
                    <td class="right mono">€${toolCost.toFixed(2)}</td>
                </tr>
                <tr class="total-row">
                    <td><strong>Selbstkosten</strong></td>
                    <td></td>
                    <td class="right mono"><strong>€${selfCost.toFixed(2)}</strong></td>
                </tr>
                <tr>
                    <td>Marge ${currentProject.margin}%</td>
                    <td></td>
                    <td class="right mono">€${(sellPrice - selfCost).toFixed(2)}</td>
                </tr>
                <tr class="total-row" style="background: var(--primary); color: white;">
                    <td><strong>Verkaufspreis</strong></td>
                    <td></td>
                    <td class="right mono"><strong>€${sellPrice.toFixed(2)}</strong></td>
                </tr>
            `;
            document.getElementById('costBreakdown').innerHTML = costTableHtml;

            // Quote
            const qty = currentProject.quantity;
            const totalPrice = sellPrice * qty;
            const mwst = totalPrice * 0.19;
            document.getElementById('quoteItems').innerHTML = `
                <tr>
                    <td>1</td>
                    <td>
                        <strong>${currentProject.name}</strong><br>
                        <span style="color: var(--gray-500); font-size: 0.8rem;">
                            ${currentProject.drawingNo || 'Ohne Zeichnungsnummer'} · ${currentProject.material} · 
                            ${currentProject.dimensions.l}×${currentProject.dimensions.w}×${currentProject.dimensions.h} mm
                        </span>
                    </td>
                    <td class="center">${qty}</td>
                    <td class="right mono">€${sellPrice.toFixed(2)}</td>
                    <td class="right mono">€${totalPrice.toFixed(2)}</td>
                </tr>
            `;
            document.getElementById('quoteNetto').textContent = `€${totalPrice.toFixed(2)}`;
            document.getElementById('quoteMwst').textContent = `€${mwst.toFixed(2)}`;
            document.getElementById('quoteBrutto').textContent = `€${(totalPrice + mwst).toFixed(2)}`;

            // Tools table
            const toolsHtml = currentProject.operations.map(op => {
                const tool = TOOLS[op];
                if (!tool) return '';
                const n = Math.round((tool.vc * 1000) / (Math.PI * 20));
                const vf = Math.round(n * 0.1 * 4);
                const usage = timeBreakdown.find(t => t.op === op)?.time || 5;
                const cost = (tool.price / tool.standzeit) * usage;
                return `
                    <tr>
                        <td><strong>${tool.name}</strong></td>
                        <td>${getOpDescription(op)}</td>
                        <td class="right mono">${tool.vc}</td>
                        <td class="right mono">${n}</td>
                        <td class="right mono">0.10</td>
                        <td class="right mono">${vf}</td>
                        <td class="right mono">€${cost.toFixed(2)}</td>
                    </tr>
                `;
            }).join('');
            document.getElementById('toolsTable').innerHTML = toolsHtml + `
                <tr class="total-row">
                    <td colspan="6"><strong>Gesamte Werkzeugkosten</strong></td>
                    <td class="right mono"><strong>€${toolCost.toFixed(2)}</strong></td>
                </tr>
            `;

            // Generate NC Code
            generateNCCode();
        }

        function getOpDescription(op) {
            const descriptions = {
                'planfraesen': 'Oberseite planen',
                'konturfraesen': 'Außenkontur fräsen',
                'taschen': 'Innentaschen ausfräsen',
                'bohren': 'Bohrungen + Gewinde',
                'schlichten': 'Oberfläche schlichten'
            };
            return descriptions[op] || op;
        }

        // Tab switching
        function showTab(tabId) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
            document.querySelector(`[onclick="showTab('${tabId}')"]`).classList.add('active');
            document.getElementById(`panel-${tabId}`).classList.add('active');
        }

        // Series quantity selection
        function setQuantity(qty) {
            document.getElementById('quantity').value = qty;
            document.querySelectorAll('.series-item').forEach(s => s.classList.remove('active'));
            event.target.closest('.series-item').classList.add('active');
            calculate();
        }

        // NC Code generation
        let currentCodeFormat = 'heidenhain';
        
        function setCodeFormat(format) {
            currentCodeFormat = format;
            document.querySelectorAll('.code-tab').forEach(t => t.classList.remove('active'));
            document.querySelector(`[onclick="setCodeFormat('${format}')"]`).classList.add('active');
            generateNCCode();
        }

        function generateNCCode() {
            const p = currentProject;
            const mat = MATERIALS[p.material];
            let code = '';
            
            if (currentCodeFormat === 'heidenhain') {
                code = `<span class="code-comment">; ============================================</span>
<span class="code-comment">; CNC PLANNER PRO — Automatisch generiert</span>
<span class="code-comment">; ============================================</span>
<span class="code-comment">; Werkstück:  ${p.name}</span>
<span class="code-comment">; Zeichnung:  ${p.drawingNo || 'N/A'}</span>
<span class="code-comment">; Werkstoff:  ${p.material} (${mat.name})</span>
<span class="code-comment">; Rohmaße:    ${p.dimensions.l} × ${p.dimensions.w} × ${p.dimensions.h} mm</span>
<span class="code-comment">; Erstellt:   ${new Date().toLocaleString('de-DE')}</span>
<span class="code-comment">; ============================================</span>

<span class="code-keyword">BEGIN PGM</span> ${p.name.toUpperCase().replace(/\s+/g, '_')} <span class="code-keyword">MM</span>

<span class="code-comment">; --- WERKZEUGLISTE ---</span>
${p.operations.map((op, i) => `<span class="code-comment">; T${i+1} = ${TOOLS[op]?.name || op}</span>`).join('\n')}

<span class="code-comment">; --- NULLPUNKT ---</span>
<span class="code-keyword">CYCL DEF</span> <span class="code-number">7.0</span> NULLPUNKT
<span class="code-keyword">CYCL DEF</span> <span class="code-number">7.1</span> X+<span class="code-number">${p.dimensions.l/2}</span>
<span class="code-keyword">CYCL DEF</span> <span class="code-number">7.2</span> Y+<span class="code-number">${p.dimensions.w/2}</span>
<span class="code-keyword">CYCL DEF</span> <span class="code-number">7.3</span> Z+<span class="code-number">0</span>

${p.operations.map((op, i) => generateHeidenhainOp(op, i+1)).join('\n\n')}

<span class="code-comment">; --- ENDE ---</span>
<span class="code-keyword">L</span> Z+<span class="code-number">100</span> <span class="code-keyword">R0 FMAX M30</span>

<span class="code-keyword">END PGM</span> ${p.name.toUpperCase().replace(/\s+/g, '_')} <span class="code-keyword">MM</span>`;
            } else if (currentCodeFormat === 'siemens') {
                code = `<span class="code-comment">; ============================================</span>
<span class="code-comment">; CNC PLANNER PRO — Siemens 840D</span>
<span class="code-comment">; Werkstück: ${p.name}</span>
<span class="code-comment">; ============================================</span>

<span class="code-keyword">G90 G17 G54</span>
<span class="code-keyword">G0</span> Z<span class="code-number">100</span>

${p.operations.map((op, i) => `<span class="code-comment">; OP${(i+1)*10}: ${getOpDescription(op)}</span>
<span class="code-keyword">T${i+1} M6</span>
<span class="code-keyword">S</span><span class="code-number">${Math.round((TOOLS[op]?.vc || 100) * 1000 / (Math.PI * 20))}</span> <span class="code-keyword">M3</span>
<span class="code-keyword">G0</span> X<span class="code-number">0</span> Y<span class="code-number">0</span>
<span class="code-keyword">G0</span> Z<span class="code-number">5</span>
<span class="code-keyword">G1</span> Z<span class="code-number">-2</span> <span class="code-keyword">F</span><span class="code-number">200</span>
<span class="code-comment">; ... Bearbeitungszyklus ...</span>
<span class="code-keyword">G0</span> Z<span class="code-number">100</span>`).join('\n\n')}

<span class="code-keyword">M30</span>`;
            } else {
                code = `<span class="code-comment">(CNC PLANNER PRO - Fanuc)</span>
<span class="code-comment">(Werkstück: ${p.name})</span>

<span class="code-keyword">O0001</span>
<span class="code-keyword">G90 G17 G21 G54</span>
<span class="code-keyword">G0</span> Z<span class="code-number">100.</span>

${p.operations.map((op, i) => `<span class="code-comment">(OP${(i+1)*10}: ${getOpDescription(op)})</span>
<span class="code-keyword">T${i+1} M6</span>
<span class="code-keyword">S</span><span class="code-number">${Math.round((TOOLS[op]?.vc || 100) * 1000 / (Math.PI * 20))}</span> <span class="code-keyword">M3</span>
<span class="code-keyword">G0</span> X<span class="code-number">0.</span> Y<span class="code-number">0.</span>
<span class="code-keyword">G43</span> H${i+1} Z<span class="code-number">5.</span>
<span class="code-keyword">G1</span> Z<span class="code-number">-2.</span> <span class="code-keyword">F</span><span class="code-number">200</span>
<span class="code-comment">(Bearbeitungszyklus)</span>
<span class="code-keyword">G0</span> Z<span class="code-number">100.</span>`).join('\n\n')}

<span class="code-keyword">M30</span>
<span class="code-keyword">%</span>`;
            }
            
            document.getElementById('ncCodeContent').innerHTML = code;
        }

        function generateHeidenhainOp(op, tNum) {
            const tool = TOOLS[op];
            const n = Math.round((tool?.vc || 100) * 1000 / (Math.PI * 20));
            const vf = Math.round(n * 0.1 * 4);
            
            return `<span class="code-comment">; --- OP${tNum*10}: ${getOpDescription(op)} ---</span>
<span class="code-keyword">TOOL CALL</span> ${tNum} <span class="code-keyword">Z S</span><span class="code-number">${n}</span>
<span class="code-keyword">L</span> Z+<span class="code-number">100</span> <span class="code-keyword">R0 FMAX M3</span>
<span class="code-keyword">L</span> X+<span class="code-number">0</span> Y+<span class="code-number">0</span> <span class="code-keyword">R0 FMAX</span>
<span class="code-keyword">L</span> Z+<span class="code-number">5</span> <span class="code-keyword">R0 FMAX</span>
<span class="code-keyword">L</span> Z-<span class="code-number">2</span> <span class="code-keyword">R0 F</span><span class="code-number">${vf}</span>
<span class="code-comment">; ... Bearbeitungszyklus ...</span>
<span class="code-keyword">L</span> Z+<span class="code-number">100</span> <span class="code-keyword">R0 FMAX M5</span>`;
        }

        // Copy code
        function copyCode() {
            const code = document.getElementById('ncCodeContent').innerText;
            navigator.clipboard.writeText(code);
            alert('NC-Code in Zwischenablage kopiert!');
        }

        // Download code
        function downloadCode() {
            const code = document.getElementById('ncCodeContent').innerText;
            const ext = currentCodeFormat === 'heidenhain' ? 'h' : currentCodeFormat === 'siemens' ? 'mpf' : 'nc';
            const blob = new Blob([code], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${currentProject.name.replace(/\s+/g, '_')}.${ext}`;
            a.click();
        }

        // Save/Load projects
        function saveProject() {
            const data = JSON.stringify(currentProject);
            localStorage.setItem('cncplanner_project', data);
            alert('Projekt gespeichert!');
        }

        function loadProject() {
            const data = localStorage.getItem('cncplanner_project');
            if (data) {
                currentProject = JSON.parse(data);
                // Restore UI
                document.getElementById('projectName').value = currentProject.name;
                document.getElementById('drawingNo').value = currentProject.drawingNo;
                document.getElementById('dimLength').value = currentProject.dimensions.l;
                document.getElementById('dimWidth').value = currentProject.dimensions.w;
                document.getElementById('dimHeight').value = currentProject.dimensions.h;
                document.getElementById('material').value = currentProject.material;
                document.getElementById('hourlyRate').value = currentProject.hourlyRate;
                document.getElementById('margin').value = currentProject.margin;
                document.getElementById('quantity').value = currentProject.quantity;
                
                // Restore checkboxes
                document.querySelectorAll('.operation-checkbox').forEach(cb => {
                    cb.checked = currentProject.operations.includes(cb.dataset.op);
                });
                
                calculate();
                alert('Projekt geladen!');
            } else {
                alert('Kein gespeichertes Projekt gefunden.');
            }
        }

        // PDF Export
        function exportPDF() {
            window.print();
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', calculate);
    </script>
</body>
</html>
